import{S as Ee,i as Ne,s as we,e as C,a as U,t as W,b as T,d as z,j as L,f as K,g as v,A as _,l as D,k as E,K as P,n as Ie,L as Ce,v as $,M as he,D as le,c as jt,N as Re,u as Ut,m as Lt,o as Pt,p as F,q as Q,O as _e,P as ge,F as ae,G as ue,H as ce,I as fe,Q as ye,R as ke,T as be,U as Je,r as Ge,V as nt,w as ve,C as Pe,x as Be,W as Me,X as Ve,z as Bt,Y as De,Z as Oe,_ as st}from"../chunks/index.4d86df2e.js";import{w as xe,r as je}from"../chunks/index.9d73ec15.js";const Ae=xe(!0),qe=xe(void 0),oe=xe({inicio:{texto:"Érase una vez un círculo...",display:{x:150,y:90},opciones:[{btn:"dejar tranquilo",escena:"final1"},{btn:"aplastar",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{x:50,y:300}},final2:{texto:"Parece que la historia formó una elipsis",sinSalida:!0,display:{x:230,y:300}}}),$e=je(i=>i.scene===void 0&&i.escena!==void 0?"escena":"scene"),Qe=je(i=>i.options===void 0&&i.opciones!==void 0?"opciones":"options"),Wt=je(i=>i.text===void 0&&i.texto!==void 0?"texto":"text"),Rt=je(i=>i.image===void 0&&i.imagen!==void 0?"imagen":"image");function Vt(i,e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([i],{type:e})),n.setAttribute("download",t),document.body.appendChild(n),n.click(),document.body.removeChild(n)}const Kt=je((i,e)=>{Vt(JSON.stringify(i,null,2),"application/json",`${e.includes(".json")?e:e+".json"}`)}),Ft=je(i=>{Vt(i,"text/plain;charset=utf-8","index.html")}),Ht=function(i,e,t){return`
<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
  </head>
  <body>
  </body>
  <script>
    const lang = "es";
    const options = {typewriterSpeed: 20, defaultCSS: false};
  <\/script>
  <style>
    
  #storygeneraldiv {
    box-sizing: border-box;
    margin: auto;
    max-width: 600px;
    font-family: 'Courier New', Courier, monospace;
    background: white;
  }
  
  .storydiv {
    border: solid black 1px;
    width: 100%;
    display: flex;
    padding: 10px;
    flex-direction: column;
    box-sizing: border-box;
  }
  
  .storyp {
    font-size: 18px;
    min-height: 25px;
  }
  
  .storybutton-container {
    margin: auto;
  }
  
  .storybutton {
    background: white;
    box-shadow: none;
    border: solid 1px;
    margin: 0px 1em 0px 0px;
    font-size: 20px;
    font-family: 'Courier New', Courier, monospace;
    cursor: pointer;
  }
  
  .storybutton:hover {
    color: white;
    background: black;
  }
  
  .storyimage-container {
    box-sizing: content-box;
    position: relative;
    width: 100%;
    margin: auto;
  }
  
  .storyimage {
    justify-content: center;
    width: 100%;
    margin: auto;
    border-radius: 20px;
    display: block;
  }
  
  .storyimage-area {
    font-size: 14px;
    position: absolute;
    cursor: pointer;
    text-align: center;
    color: black;
    background: #ffffff00;
    border: solid 1px black;
  }
  
  .storyimage-area:hover {
    background: #ffffff33;
  }
  
  @media screen and (max-device-width: 500px) {
    #storygeneraldiv {
      max-width:100%;
    }
    .storyp {
      font-size: 7vw;
    }
    .storybutton {
      font-size: 10vw;
    }
  }
  
  </style>
  <script>
    const A = ${i}
  <\/script>
  <script>
    const scenes = ${e};
    const aventura = new A(lang, options);
    aventura.setScenes(scenes).startAdventure('${t}');
  <\/script>
</html>
`},qt=je(Ht);class Jt{constructor(e="en",t){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,adventureSlide:!0,evalTags:!1,igramaFormat:"png",urlWord:"URL",vizWidth:1e3,vizHeight:1e3,vizBg:"#313131",vizCol:"black",vizImageSize:50,vizLoading:!0,minigifOptions:{},sceneCallback:n=>n},t&&(this.options=Object.assign(this.options,this.setOptionsTranslations(t))),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.fijarDatosEscenas=this.setDataScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setOptionsTranslations(e){const t={velocidadMaquina:"typewriterSpeed",CSSporDefecto:"defaultCSS",contenedorAventura:"adventureContainer",rolloAventura:"adventureScroll",deslizarAImagen:"adventureSlide",ejecutarEtiquetas:"evalTags",formatoIgrama:"igramaFormat",palabraUrl:"urlWord",anchoVis:"vizWidth",altoVis:"vizHeight",fondoVis:"vizBg",colorVis:"vizCol",tamanoImagenVis:"visImageSize",cargandoVis:"vizLoading",opcionesMinigif:"minigifOptions",funcionEscena:"sceneCallback"};for(let[n,o]of Object.entries(e))t[n]!==void 0&&(e[t[n]]=o,delete e[n]);return e}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[t,n]of Object.entries(e.grammar));return this}setScenes(e){this.options.defaultCSS&&this.setCSS(),this.scenes=e;for(let t of Object.keys(e)){this.scenes[t].key=t;const n=this.scenes[t].image||this.scenes[t].imagen;n!==void 0&&this.storyPreload[n]===void 0&&(this.storyPreload[n]=new Image,this.storyPreload[n].src=n,this.storyPreload[n].className="storyimage")}return this}async setDataScenes(e,t=void 0,n=[]){if(this.options.defaultCSS&&this.setCSS(),typeof d3>"u"){console.error(this.lang==="es"?"Para crear visualizaciones debes tener también la librería D3":"To create visualizations you must have also the D3 library");return}return this.scenes=JSON.parse(JSON.stringify(e)),this.metaKeys=n,t!==void 0&&(this.data=JSON.parse(JSON.stringify(t)),await this.setViz(this.scenes,this.data)),this.setScenes(this.scenes),this}async setViz(e,t){const n=Object.keys(e),o={compare:Xt,scatter:Yt,pack:Zt};let s=0;for(let c of n)e[c].viz!==void 0&&s++;let r=0,a;const l=this.lang==="en"?"Loading...":"Cargando...";this.options.vizLoading&&(a=document.createElement("div"),a.id="storygeneraldiv",a.className="storydiv",a.textContent=l,(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(a));function f(c,u=15){let d="";for(let h=0;h<Math.ceil(u);h++)d+=h<c*u?"|":"-";return d}for(let c of n){if(e[c].viz===void 0)continue;const{filter:u,type:d,x:h,y:N}=e[c].viz;if(o[d]===void 0||h===void 0||N===void 0){const g=this.lang==="es"?`Parámetros incorrectos de visualización en la escena "${c}"`:`Incorrect parameteres in the scene "${c}"`;console.error(g)}let b=t;for(let g of u)b=this.filterFn(g)(b);let k=r;const{viz:y,areas:p}=await o[d](this,b,h,N,g=>{r=k+g/s;const m=Math.ceil(r*100);this.options.vizLoading&&(a.textContent=`${l} ${f(r)} ${m}%`)});e[c].image=y,e[c].areas=p}for(let c of t){if(c.ID===void 0){const u=this.lang==="es"?"Todos los datos deben tener un valor único con la clave ID":"All data must have a unique value with the ID key";console.error(u),this.scenes={};break}e[`ind_${c.ID}`]={text:`${c.CONT||""}`,meta:c.ID,dataScene:!0,options:[{btn:"<<<",scene:`ind_${c.ID}`}]},c.IMGURL!==void 0&&(e[`ind_${c.ID}`].image=c.IMGURL),c.URL!==void 0&&(e[`ind_${c.ID}`].url=c.URL)}a.remove()}filterFn(e){const t=e[1];if(t==="="||t==="=="||t==="===")return o=>o.filter(s=>n(s[e[0]])==n(e[2]));return t==="<"?o=>o.filter(s=>n(s[e[0]])<n(e[2])):t===">"?o=>o.filter(s=>n(s[e[0]])>n(e[2])):o=>o;function n(o){return o==="true"?!0:o==="false"?!1:o}}setMarkov(e){return this.markov=e,this}expandGrammar(e){const t=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(t)}expandIgrama(e){const t=this.igrama.grammar,n=this.selectGrammarRule(t[e]);return this.grammarRuleRecursion(n,t).split("|").map(s=>this.decodeDrawing(s))}grammarRuleRecursion(e,t){let n=t||this.grammar,o=this.setNewRules(e);const s=o.match(/<[\w\d.,/#]+>/gi);if(!s)return o;for(let r of s){const a=this.defineTransformations(r);o=o.replace(r,()=>{r=r.replace(/[<>]/gi,""),r=r.replace(/#[\w\d.,/]+#/g,"");const l=r.search(/[.]/)>-1?this.getNestedObject(n,r.match(/[\w\d]+/g)):n[r];if(!l){const c=this.lang==="es"?`Se intentó expandir desde la regla "${r}", pero no se pudo encontrar`:`Tried to expand from rule "${r}", but couldn't find it`;console.error(c)}const f=this.selectGrammarRule(l);return this.transformString(f,a)})}return this.grammarRuleRecursion(o,n)}setNewRules(e,t){let n;t===void 0?n=this.grammar:n=t;let o=e;const s=o.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(s)for(;s.length;){const r=s.pop();o=o.replace(r,"");const{symbol:a,pairsString:l}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(r).groups,f=l.match(/[-]?[\w\d]+:[\w\d]+/gi).map(c=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(c).groups);if(f){n[a]=n[a]||{};for(let c of f){const u=n[c.value];if(!u){const N=this.lang==="es"?`Se intentó crear la nueva regla "${a}", pero no se pudo encontrar "${c.value}" para producir la subregla "${c.key}"`:`Tried to create new rule: "${a}", but couldn't find "${c.value}" to produce "${c.key}" subrule`;console.error(N)}const d=c.remove==="-",h=this.selectGrammarRule(u);if(d){const N=u.indexOf(h);n[c.value]=[...u.slice(0,N),...u.slice(N+1)]}n[a][c.key]=[h]}}}return o}startAdventure(e){const t=document.createElement("div");return t.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(t),this.prevScene=e,this.goToScene(this.scenes[e]),this}goToScene(e){const t=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(l=>l.remove()),[...document.getElementsByClassName("storyimage-area")].map(a=>a.remove());const o=document.createElement("div");if(o.className="storydiv",t.appendChild(o),e.image||e.imagen){const a=document.createElement("div");a.className="storyimage-container",o.appendChild(a);const l=e.image||e.imagen,f=this.options.adventureScroll?this.storyPreload[l].cloneNode():this.storyPreload[l];a.appendChild(f),e.areas&&(f.complete?this.setAreas(f,a,e.areas):f.onload=()=>{this.setAreas(f,a,e.areas)})}else if(e.igrama!==void 0){const a=document.createElement("div");a.className="storyimage-container",o.appendChild(a);const l=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(l),this.igramaDataUrl(l,this.options.igramaFormat).then(f=>{const c=new Image;c.src=f,c.className="storyimage",a.appendChild(c)})}if(e.title||e.titulo){const a=document.createElement("div");a.className="storytitle-container",o.appendChild(a);const l=document.createElement("h1");l.className="storytitle",l.textContent=e.title||e.titulo,a.appendChild(l)}if(e.meta!==void 0){const a=document.createElement("div");a.className="storymeta-container",o.appendChild(a);const l=this.data.find(f=>f.ID==e.meta);for(let f of this.metaKeys){if(l[f]===void 0)continue;const c=document.createElement("div");c.className="storymeta-subcontainer",a.appendChild(c);const u=document.createElement("span");u.className="storymeta-key",u.textContent=`${f}: `,c.appendChild(u);const d=document.createElement("span");d.className="storymeta-val",d.textContent=l[f],c.appendChild(d)}}const s=document.createElement("div");s.className="storyp-container",(e.text||e.texto||e.igramaText)&&o.appendChild(s);const r=document.createElement("p");if(r.className="storyp",r.textContent="",s.appendChild(r),e.url){const a=document.createElement("a");a.className="storyurl",a.href=e.url,a.target="_blank",a.textContent=this.options.urlWord,s.appendChild(a)}this.options.adventureSlide&&document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(r,e),this.data&&(e.viz!==void 0?this.prevScene=e.key:e.dataScene===!0&&(e.options[0].scene=this.prevScene)),this.options.sceneCallback(e)}setAreas(e,t,n){const o=e.getBoundingClientRect(),s=t.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,t,n)},[...document.getElementsByClassName("storyimage-area")].map(a=>a.remove());for(let a of n){let l=document.createElement("div");l.className="storyimage-area";const f=(a.x-Math.floor(a.w/2))*o.width/e.naturalWidth;l.style.left=`${o.left-s.left+f}px`;const c=(a.y-Math.floor(a.h/2))*o.height/e.naturalHeight;l.style.top=`${o.top-s.top+c}px`,l.style.width=`${a.w*o.width/e.naturalWidth}px`,l.style.height=`${a.h*o.height/e.naturalHeight}px`,l.textContent=a.btn||"",f>0&&f<o.width&&c>0&&c<o.height&&t.appendChild(l),l.style.fontSize=`${18*o.height/e.naturalHeight}px`,l.onclick=()=>{const u=a.scene||a.escena;this.goToScene(this.scenes[u])},a.tooltip!==void 0&&(l.onmouseover=()=>{l.textContent=a.tooltip||"",l.style.zIndex="100"},l.onmouseout=()=>{l.textContent=a.btn||"",l.style.zIndex="0"})}}async typewriter(e,t){const n=t.text||t.texto||t.igramaText||"";let o=this.grammar?this.grammarRuleRecursion(n):n;if(o=o.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let s=0;await new Promise(r=>{const a=setInterval(()=>{const l=o.substring(0,s);this.options.evalTags?e.innerHTML=l:e.textContent=l,s++,s>o.length&&(clearInterval(a),r(!0))},Math.floor(this.options.typewriterSpeed))}),this.optionButtons(t)}else this.options.evalTags?e.innerHTML=o:e.textContent=o,this.optionButtons(t)}optionButtons(e){const t=[...document.getElementsByClassName("storydiv")],n=t[t.length-1];[...document.getElementsByClassName("storybutton-container")].map(r=>r.remove());const s=document.createElement("div");if(s.className="storybutton-container",n.appendChild(s),e.options||e.opciones){const r=e.options||e.opciones;for(let a of r){const l=document.createElement("button");l.className="storybutton",l.textContent=a.btn,s.appendChild(l),l.addEventListener("click",()=>{if((a.text||a.texto)===void 0){const c=a.scene||a.escena;this.goToScene(this.scenes[c])}else this.goToScene(a)})}}else if(e.scene||e.escena){const r=e.scene||e.escena,a=document.createElement("button");a.className="storybutton",a.textContent=this.lang==="en"?"Continue":"Continuar",s.appendChild(a),a.addEventListener("click",()=>{this.goToScene(this.scenes[r])})}this.options.adventureSlide&&document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const o=Math.random()*e.prob.reduce((r,a)=>r+a);let s=0;for(let r=0;r<e.prob.length;r++){if(s<=o&&o<s+e.prob[r])return e[r];s+=e.prob[r]}}const t=Math.floor(Math.random()*e.length);return e[t]}getNestedObject(e,t){return t.reduce((n,o)=>n&&n[o]!==void 0?n[o]:void 0,e)}defineTransformations(e){let t={};const n=/#(?<trans>[\w\d,]+)#/gi.exec(e),o=n?n.groups.trans.match(/[\w]+/gi):[];for(let s of o)t[s]=!0;return t}transformString(e,t){let n=e;return t.CAPITALIZE&&(n=n.charAt(0).toUpperCase()+n.slice(1)),t.ALLCAPS&&(n=n.toUpperCase()),n}decodeDrawing(e){if(e==="")return[];const[t,n,o]=e.split("%%");let s={};return t==="vector"?s.content=n.split("**").map(r=>{const[a,l,f]=r.split("&"),c=[];if(c.color=a,c.weight=l,f===void 0)return c;const u=f.split(",");for(let d=0;d<u.length;d+=2)c.push([+u[d],+u[d+1]]);return c}):s.content=n,s.attribute=o,s.type=t,s}async getMarkovModel(e,t=1,n=!1){let o=await(await fetch(`./${e}`)).text();o=o.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const s=o.split(this.markovSeparator),r={};for(let l=0;l<s.length-t;l++){let f="";for(let u=0;u<t;u++)f+=u===0?s[l+u]:" "+s[l+u];r[f]===void 0&&(r[f]={});const c=s[l+t];r[f][c]===void 0?r[f][c]=1:r[f][c]++}const a={};for(let l of Object.keys(r)){const f=Object.keys(r[l]);a[l]={probs:[],grams:f};let c=0;for(let u=0;u<f.length;u++)c+=r[l][f[u]];for(let u=0;u<f.length;u++)a[l].probs[u]=r[l][f[u]]/c}if(n){const l=e.split("/");this.saveJSON(a,`${l[l.length-1]}_markovModel_${t}N.json`)}return a}markovChain(e,t,n=.1){let o=t===void 0||this.markov[t]===void 0?this.randomMarkovWord():t,s=o;for(let a=0;a<e-1;a++){let l=this.getNextMarkov(this.markov[s]);l===void 0&&(l=this.getNextMarkov(this.randomMarkovWord()));let f=s.split(this.markovSeparator);f.push(l),f=f.slice(1).join(" "),s=f,o+=` ${l}`}return this.formatMarkov(o,n)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const t=Math.random();let n=0;if(e!==void 0)for(let o=0;o<e.probs.length;o++){if(n<=t&&t<n+e.probs[o])return e.grams[o];n+=e.probs[o]}}formatMarkov(e,t=.1){let n=e.replace(/ ([,:.;])/g,"$1");return n=n.replaceAll(/([.]) ([\wáéíóú])/ig,(o,s,r,a,l)=>Math.random()<t?`.
${r.toUpperCase()}`:`. ${r.toUpperCase()}`),n.charAt(0).toUpperCase()+n.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),n.setAttribute("download",`${t.includes(".json")?t:t+".json"}`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}testScenes(e){const t=e||this.scenes;if(!t){const o=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(o)}let n=[];for(let o of Object.keys(t)){const s=t[o];if(s.options||s.opciones){const a=(s.options||s.opciones).filter(l=>!t[l.scene||l.escena]);n=[...n,...a.map(l=>`${o} => ${l.btn} => ${l.scene||l.escena}`)]}else{if(s.deadEnd||s.sinSalida)continue;t[s.scene||s.escena]||n.push(`${o} => ${s.scene||s.escena}`)}}if(n.length>0){const o=this.lang==="es"?`Las siguientes escenas no llevan a ningún lado: ${n.join(", ")}`:`The following scenes are dead ends: ${n.join(", ")}`;console.error(o),this.scenesError=!0}return this}testGrammar(e){const t=e||this.grammar;if(!t){const n=this.lang==="es"?"No hay gramática para probar":"There is not grammar to test";console.error(n)}for(let n of Object.keys(t)){const o=t[n];for(let s of o){const r=s.match(/<([\w\d]+)>/gi),a=r?r.map(u=>u.replace(/[<>]/g,"")):[],l=s.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),f=l?l.map(u=>u.match(/([ ]?:[\w\d]+)/g).map(d=>/[ ]?:(?<key>[\w\d]+)/.exec(d).groups.key)).reduce((u,d)=>[...u,...d],[]):[],c=[...a,...f].filter(u=>!t[u]);if(c.length>0){const u=this.lang==="es"?`Las siguientes reglas, que se referencian en "${n}", no existen: ${c.join(", ")}`:`The following rules, referenced in "${n}", do not exist: ${c.join(", ")}`;this.grammarError=!0,console.error(u)}}}return this}testDistribution(e){const t=e||this.markov;if(t===void 0){const f=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(f)}const n={},o={};let s=0;const r=Object.values(t);for(let f of r)for(let c of f.probs){const u=(Math.round(c/.05)*.05).toFixed(2);o[s]=u,s++,n[u]===void 0?n[u]=1:n[u]++}console.log("------------------------------------ DIST ------------------------------------");const a=Math.max(...Object.values(n)),l=Object.entries(n).sort((f,c)=>f[0]>c[0]?1:f[0]<c[0]?-1:0);for(let f of l)console.log(`${f[0]}... ${"|".repeat(Math.ceil(f[1]*100/a))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,t="png",n){const o=await this.igramaDataUrl(e,t),s=new Image;s.src=o,n==null?document.body.appendChild(s):document.getElementById(n).appendChild(s)}async igramaDataUrl(e,t="png"){const n=this.igrama.metadata.width,o=this.igrama.metadata.height;let s=document.createElement("canvas");s.width=n,s.height=o;const r=s.getContext("2d");r.lineJoin="round",r.lineCap="round",r.fillStyle=this.igrama.metadata.bg||"#FFFFFF",r.fillRect(0,0,n,o),await this.drawLayers(e,r);let a;if(t==="png")a=s.toDataURL();else if(t==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener también la librería MiniGif":"To create Gifs you must have also the MiniGif library"),"";const l={colorResolution:7,dither:!1,delay:50};Object.assign(l,this.minigifOptions);const f=new MiniGif(l);f.addFrame(s);const c=this.getLayerWiggle(e);r.fillStyle=this.igrama.metadata.bg||"#FFFFFF",r.fillRect(0,0,n,o),await this.drawLayers(c,r),f.addFrame(s);const u=f.makeGif();a="data:image/gif;base64,"+await this.base64_arraybuffer(u)}return s.remove(),a}async base64_arraybuffer(e){return(await new Promise(n=>{const o=new FileReader;o.onload=()=>n(o.result),o.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const n=JSON.parse(JSON.stringify(e)),o=(s,r)=>Math.floor(s+Math.random()*(r-s));for(let[s,r]of n.entries())if(r.type==="vector")for(let[a,l]of r.content.entries()){for(let[f,c]of l.entries())Math.random()<.5?c[0]+=o(-3,3):c[1]+=o(-3,3);l.color=e[s].content[a].color,l.weight=e[s].content[a].weight}return n}getIgramaText(e){return e.map(n=>n.attribute).reverse().join(" ").trim()}async drawLayers(e,t){for(let[n,o]of e.entries())if(o.type==="url"){const{w:s,h:r,x:a,y:l}=this.igrama.sections[n];if(this.imgsMemo[o.content]===void 0){const f=new Image;f.src=o.content,this.imgsMemo[o.content]=await new Promise(c=>{f.addEventListener("load",()=>{c(f)},!1)})}t.drawImage(this.imgsMemo[o.content],a,l,s,r)}else if(o.type=="vector")for(let s of o.content){if(s.length===0)continue;const r=this.getSpline(s);this.drawSpline(r,t,s.color,s.weight)}}drawSpline(e,t,n,o){t.lineWidth=o,t.strokeStyle=n,t.fillStyle="rgba(0,0,0,0)",t.beginPath();for(let s=0;s<e.length;s++)s===0?t.moveTo(...e[0]):t.lineTo(...e[s]);t.stroke()}getSpline(e){let t=[];for(let n=0;n<e.length-1;n++){const o=[];o[0]=n>0?e[n-1]:e[0],o[1]=e[n],o[2]=e[n+1],o[3]=n<e.length-2?e[n+2]:e[e.length-1];for(let s=0;s<1;s+=.05){const r=this.getSplinePoint(s,o);t.push(r)}}return t}getSplinePoint(e,t){const n=Math.floor(e)+1,o=n+1,s=o+1,r=n-1,a=e*e,l=a*e,f=-l+2*a-e,c=3*l-5*a+2,u=-3*l+4*a+e,d=l-a,h=.5*(t[r][0]*f+t[n][0]*c+t[o][0]*u+t[s][0]*d),N=.5*(t[r][1]*f+t[n][1]*c+t[o][1]*u+t[s][1]*d);return[h,N]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=Qt,document.getElementsByTagName("head")[0].appendChild(e)}}async function Xt(i,e,t,n,o=()=>{}){const s=[e.find(b=>b.ID==t),e.find(b=>b.ID==n)],r=i.options.vizWidth,a=i.options.vizHeight;let l=0;const f=[];for(let b of s){const k=new Image;k.setAttribute("crossorigin","anonymous"),k.src=b.IMGURL,await new Promise(y=>{k.onload=()=>{y(!0)}}),f.push({url:b.IMGURL,img:k,ID:b.ID}),o(l/s.length),l++}const c=document.createElement("canvas"),u=c.getContext("2d");c.width=r,c.height=a,u.fillStyle=i.options.vizBg,u.fillRect(0,0,r,a);const d=[];let h=0;for(let b of f){const k=parseInt(r/2)*.1,y=parseInt(r/2)-k,p=parseInt(y*b.img.height/b.img.width),g=h*(y+k)+y/2+k/2,m=a/2;u.save(),u.translate(-y/2,-p/2),u.drawImage(b.img,g,m,y,p),u.restore();const w={x:g,y:m,w:y,h:p,btn:"",scene:`ind_${b.ID}`,tooltip:""};d.push(w),h++}const N=c.toDataURL("image/png");return c.remove(),{viz:N,areas:d}}async function Yt(i,e,t,n,o=()=>{}){const s=i.options.vizWidth,r=i.options.vizHeight,a=i.options.vizImageSize,l={l:.2*s,r:.1*s,t:.1*r,b:.1*r},f=s-l.l-l.r,c=r-l.t-l.b,u=e,d=[...new Set(u.map(I=>I[t]))],h=[...new Set(u.map(I=>I[n]))],N=d3.scalePoint().domain(d).range([0,f]).padding(.5).round(!0),b=d3.scalePoint().domain(h).range([0,c]).padding(.5).round(!0);let k=0;const y=[];for(let I of u){if(i.imgsMemo[I.IMGURL]===void 0){const R=new Image;R.setAttribute("crossorigin","anonymous"),R.src=I.IMGURL,i.imgsMemo[I.IMGURL]=await new Promise(V=>{R.onload=()=>{V(R)}})}y.push({url:I.IMGURL,x:N(I[t]),y:b(I[n]),img:i.imgsMemo[I.IMGURL],r:a,ID:I.ID}),o(k/u.length),k++}d3.forceSimulation(y).force("charge",d3.forceManyBody().strength(5)).force("collide",d3.forceCollide(10)).tick(200);const p=document.createElement("canvas"),g=p.getContext("2d");p.width=s,p.height=r,g.fillStyle=i.options.vizBg,g.fillRect(0,0,s,r),g.strokeStyle=i.options.vizCol,g.font="14px serif",g.textBaseline="middle",g.textAlign="center";for(let I of d)g.fillStyle=i.options.vizCol,g.fillText(I,l.l+N(I),l.t+c+l.b/2);g.beginPath(),g.moveTo(l.l,l.t+c),g.lineTo(l.l+f,l.t+c),g.stroke(),g.textAlign="right";for(let I of h)g.fillStyle=i.options.vizCol,g.fillText(I,l.l-5,l.t+b(I));g.beginPath(),g.moveTo(l.l,l.t),g.lineTo(l.l,l.t+c),g.stroke(),g.strokeStyle=i.options.vizCol;const m=[];for(let I of y){const R=a,V=R*I.img.height/I.img.width,Y=I.x+l.l,x=I.y+l.t;g.save(),g.translate(-R/2,-V/2),g.drawImage(I.img,Y,x,R,V),g.restore();const A={x:Y,y:x,w:R,h:V,btn:"",scene:`ind_${I.ID}`,tooltip:""};m.push(A)}const w=p.toDataURL("image/png");return p.remove(),{viz:w,areas:m}}async function Zt(i,e,t,n,o=()=>{}){const s=i.options.vizWidth,r=i.options.vizHeight,a=e,l=d3.rollup(a,m=>m.length,m=>m[t],m=>m[n]),f=([m,w])=>w.size&&Array.from(w),c=d3.hierarchy(l,f).sum(([,m])=>m).sort((m,w)=>w.value-m.value),u=[...d3.schemeGreys[4]].reverse(),d=c.descendants(),h=m=>u[m];d3.pack(c).size([s,r]).padding(20)(c);const N=[];let b=0;for(let m of a){for(let w of c.leaves())if(m[t]===w.parent.data[0]&&m[n]===w.data[0]){if(i.imgsMemo[m.IMGURL]===void 0){const I=new Image;I.setAttribute("crossorigin","anonymous"),I.src=m.IMGURL,i.imgsMemo[m.IMGURL]=await new Promise(R=>{I.onload=()=>{R(I)}})}N.push({url:m.IMGURL,x:w.x,y:w.y,r:i.options.vizImageSize,img:i.imgsMemo[m.IMGURL],ID:m.ID})}o(b/a.length),b++}d3.forceSimulation(N).force("collide",d3.forceCollide(20)).tick(200);const k=document.createElement("canvas"),y=k.getContext("2d");k.width=s,k.height=r,y.fillStyle=i.options.vizBg,y.fillRect(0,0,s,r),y.font="12px serif",y.textBaseline="middle",y.textAlign="center";for(let m of d)y.save(),y.translate(m.x,m.y),y.strokeStyle=i.options.vizCol,y.fillStyle=h(m.depth),y.beginPath(),y.ellipse(0,0,m.r,m.r,0,0,Math.PI*2),y.fill(),y.stroke(),y.fillStyle=i.options.vizCol,y.fillText(m.depth===1||m.depth===2?m.data[0]:"",0,-m.r-5),y.restore();const p=[];for(let m of N){const w=parseInt(50),I=parseInt(w*m.img.height/m.img.width),R=m.x,V=m.y;y.save(),y.translate(-w/2,-I/2),y.drawImage(m.img,R,V,w,I),y.restore();const Y={x:R,y:V,w,h:I,btn:"",scene:`ind_${m.ID}`,tooltip:""};p.push(Y)}const g=k.toDataURL("image/png");return k.remove(),{viz:g,areas:p}}const Qt=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  box-sizing: border-box;
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 1em;
  flex-direction: column;
}

.storytitle {
  font-size: 2em;
  margin: 0.1em 0;
}

.storyp {
  font-size: 1em;
}

.storymeta-container {
  margin: 0.5em 0;
}

.storymeta-key {
  font-weight: 700;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  box-sizing: border-box;
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: #ffffff00;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: #ffffff33;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,Gt=je(Jt);function xt(i){let e,t,n,o,s,r,a,l,f,c,u,d,h,N,b,k,y,p,g,m,w,I,R,V;return{c(){e=C("div"),t=C("input"),n=U(),o=C("div"),s=C("button"),r=W("Nuevo proyecto"),a=U(),l=C("label"),f=W("Importar"),c=U(),u=C("button"),d=W("Exportar"),h=U(),N=C("button"),b=W("Previsualizar"),k=U(),y=C("button"),p=W("Generar interactivo final"),g=U(),m=C("div"),w=C("button"),I=W("Nueva escena"),this.h()},l(Y){e=T(Y,"DIV",{class:!0});var x=z(e);t=T(x,"INPUT",{type:!0,id:!0}),n=L(x),o=T(x,"DIV",{class:!0});var A=z(o);s=T(A,"BUTTON",{class:!0});var H=z(s);r=K(H,"Nuevo proyecto"),H.forEach(v),a=L(A),l=T(A,"LABEL",{class:!0,for:!0});var Z=z(l);f=K(Z,"Importar"),Z.forEach(v),c=L(A),u=T(A,"BUTTON",{class:!0});var q=z(u);d=K(q,"Exportar"),q.forEach(v),h=L(A),N=T(A,"BUTTON",{class:!0});var ne=z(N);b=K(ne,"Previsualizar"),ne.forEach(v),k=L(A),y=T(A,"BUTTON",{class:!0});var B=z(y);p=K(B,"Generar interactivo final"),B.forEach(v),A.forEach(v),g=L(x),m=T(x,"DIV",{class:!0});var ee=z(m);w=T(ee,"BUTTON",{class:!0});var se=z(w);I=K(se,"Nueva escena"),se.forEach(v),ee.forEach(v),x.forEach(v),this.h()},h(){_(t,"type","file"),_(t,"id","load-input"),t.hidden=!0,_(s,"class","toolbar-button svelte-1wzh48a"),_(l,"class","toolbar-button svelte-1wzh48a"),_(l,"for","load-input"),_(u,"class","toolbar-button svelte-1wzh48a"),_(N,"class","toolbar-button svelte-1wzh48a"),_(y,"class","toolbar-button svelte-1wzh48a"),_(o,"class","project-toolbar subtoolbar svelte-1wzh48a"),_(w,"class","toolbar-button svelte-1wzh48a"),_(m,"class","scene-toolbar subtoolbar svelte-1wzh48a"),_(e,"class","toolbar svelte-1wzh48a")},m(Y,x){D(Y,e,x),E(e,t),i[9](t),E(e,n),E(e,o),E(o,s),E(s,r),E(o,a),E(o,l),E(l,f),E(o,c),E(o,u),E(u,d),E(o,h),E(o,N),E(N,b),E(o,k),E(o,y),E(y,p),E(e,g),E(e,m),E(m,w),E(w,I),R||(V=[P(t,"change",i[3]),P(s,"click",i[2]),P(u,"click",i[4]),P(N,"click",i[5]),P(y,"click",i[6]),P(w,"click",i[1])],R=!0)},p:Ie,i:Ie,o:Ie,d(Y){Y&&v(e),i[9](null),R=!1,Ce(V)}}}function $t(i,e,t){let n,o,s,r,a;$(i,Ft,p=>t(10,n=p)),$(i,qt,p=>t(11,o=p)),$(i,oe,p=>t(12,s=p)),$(i,Gt,p=>t(13,r=p)),$(i,Kt,p=>t(14,a=p));let{showNewScene:l}=e,{showTest:f}=e,c;function u(){t(7,l=!0)}function d(){he(oe,s={},s)}function h(){d();const p=c.files[0];if(p.type==="application/json"){const g=new FileReader;g.addEventListener("load",function(){he(oe,s={},s);const m=g.result,w=JSON.parse(m);he(oe,s=w,s)}),this.value=null,g.readAsText(p);return}else alert("Formato de archivo incorrecto / incorrect file format")}function N(){a(s,"aventuraInteractiva")}function b(){t(8,f=!0)}function k(){const p=Object.entries(s).sort((I,R)=>I[1].display.y-R[1].display.y);if(p.length===0){alert("No hay escenas / There are no scenes");return}const g=r.toString(),m=JSON.stringify(s),w=o(g,m,p[0][0]);n(w)}function y(p){le[p?"unshift":"push"](()=>{c=p,t(0,c)})}return i.$$set=p=>{"showNewScene"in p&&t(7,l=p.showNewScene),"showTest"in p&&t(8,f=p.showTest)},[c,u,d,h,N,b,k,l,f,y]}class en extends Ee{constructor(e){super(),Ne(this,e,$t,xt,we,{showNewScene:7,showTest:8})}}function tn(i){let e,t,n,o;const s=i[5].default,r=jt(s,i,i[4],null);return{c(){e=C("div"),r&&r.c(),this.h()},l(a){e=T(a,"DIV",{class:!0,key:!0});var l=z(e);r&&r.l(l),l.forEach(v),this.h()},h(){_(e,"class","scene-node-container svelte-sua7yb"),_(e,"key",i[0])},m(a,l){D(a,e,l),r&&r.m(e,null),t=!0,n||(o=Re(i[1].call(null,e)),n=!0)},p(a,[l]){r&&r.p&&(!t||l&16)&&Ut(r,s,a,a[4],t?Pt(s,a[4],l,null):Lt(a[4]),null),(!t||l&1)&&_(e,"key",a[0])},i(a){t||(F(r,a),t=!0)},o(a){Q(r,a),t=!1},d(a){a&&v(e),r&&r.d(a),n=!1,o()}}}function nn(i,e,t){let{$$slots:n={},$$scope:o}=e,{scene:s}=e,{movingNode:r=!1}=e,{key:a}=e;function l(f){let c=!1;f.style.left=`${s.display.x}px`,f.style.top=`${s.display.y}px`,f.addEventListener("mousedown",()=>{c=!0,t(3,r=!0)}),window.addEventListener("mousemove",u=>{c&&(t(2,s.display.x+=u.movementX,s),t(2,s.display.y+=u.movementY,s),f.style.left=`${s.display.x}px`,f.style.top=`${s.display.y}px`)}),window.addEventListener("mouseup",()=>{c=!1,t(3,r=!1)})}return i.$$set=f=>{"scene"in f&&t(2,s=f.scene),"movingNode"in f&&t(3,r=f.movingNode),"key"in f&&t(0,a=f.key),"$$scope"in f&&t(4,o=f.$$scope)},[a,l,s,r,o,n]}class sn extends Ee{constructor(e){super(),Ne(this,e,nn,tn,we,{scene:2,movingNode:3,key:0})}}function on(i){let e,t,n,o;const s=i[5].default,r=jt(s,i,i[4],null);return{c(){e=C("div"),r&&r.c(),this.h()},l(a){e=T(a,"DIV",{class:!0});var l=z(e);r&&r.l(l),l.forEach(v),this.h()},h(){_(e,"class","draggui svelte-lq1cua")},m(a,l){D(a,e,l),r&&r.m(e,null),t=!0,n||(o=[Re(i[0].call(null,e)),Re(i[1].call(null,e)),P(e,"mousedown",_e(i[6]))],n=!0)},p(a,[l]){r&&r.p&&(!t||l&16)&&Ut(r,s,a,a[4],t?Pt(s,a[4],l,null):Lt(a[4]),null)},i(a){t||(F(r,a),t=!0)},o(a){Q(r,a),t=!1},d(a){a&&v(e),r&&r.d(a),n=!1,Ce(o)}}}function rn(i,e,t){let{$$slots:n={},$$scope:o}=e,{pos:s}=e,{displace:r={x:s.x,y:s.y}}=e;function a(c){c.style.left=`${r.x}px`,c.style.top=`${r.y}px`}function l(c){let u=!1;c.style.left=`${r.x}px`,c.style.top=`${r.y}px`,c.addEventListener("mousedown",()=>{u=!0}),window.addEventListener("mousemove",d=>{u&&(t(2,r.x+=d.movementX,r),t(2,r.y+=d.movementY,r),c.style.left=`${r.x}px`,c.style.top=`${r.y}px`,c.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{u=!1,c.style.cursor="grab"})}function f(c){ge.call(this,i,c)}return i.$$set=c=>{"pos"in c&&t(3,s=c.pos),"displace"in c&&t(2,r=c.displace),"$$scope"in c&&t(4,o=c.$$scope)},[a,l,r,s,o,n,f]}class Xe extends Ee{constructor(e){super(),Ne(this,e,rn,on,we,{pos:3,displace:2})}}function ln(i){let e,t,n,o,s;return{c(){e=C("div"),t=C("button"),n=W("X"),this.h()},l(r){e=T(r,"DIV",{class:!0});var a=z(e);t=T(a,"BUTTON",{class:!0});var l=z(t);n=K(l,"X"),l.forEach(v),a.forEach(v),this.h()},h(){_(t,"class","x-button"),_(e,"class","top-bar svelte-15bdkib")},m(r,a){D(r,e,a),E(e,t),E(t,n),o||(s=P(t,"click",i[0]),o=!0)},p:Ie,i:Ie,o:Ie,d(r){r&&v(e),o=!1,s()}}}function an(i,e,t){let{toggle:n}=e;function o(){t(1,n=!1)}return i.$$set=s=>{"toggle"in s&&t(1,n=s.toggle)},[o,n]}class Ye extends Ee{constructor(e){super(),Ne(this,e,an,ln,we,{toggle:1})}}function un(i){let e,t,n,o,s,r,a,l,f,c,u,d,h,N,b;function k(p){i[7](p)}let y={};return i[0]!==void 0&&(y.toggle=i[0]),e=new Ye({props:y}),le.push(()=>ye(e,"toggle",k)),{c(){ae(e.$$.fragment),n=U(),o=C("div"),s=C("label"),r=W("Btn:"),a=U(),l=C("input"),f=U(),c=C("div"),u=C("button"),d=W("Aceptar"),this.h()},l(p){ue(e.$$.fragment,p),n=L(p),o=T(p,"DIV",{});var g=z(o);s=T(g,"LABEL",{for:!0});var m=z(s);r=K(m,"Btn:"),m.forEach(v),a=L(g),l=T(g,"INPUT",{id:!0,type:!0}),g.forEach(v),f=L(p),c=T(p,"DIV",{class:!0});var w=z(c);u=T(w,"BUTTON",{class:!0});var I=z(u);d=K(I,"Aceptar"),I.forEach(v),w.forEach(v),this.h()},h(){_(s,"for","inp"),_(l,"id","inp"),_(l,"type","text"),l.autofocus=!0,_(u,"class","gui-button"),_(c,"class","bar svelte-1bhrmvp")},m(p,g){ce(e,p,g),D(p,n,g),D(p,o,g),E(o,s),E(s,r),E(o,a),E(o,l),ke(l,i[2]),D(p,f,g),D(p,c,g),E(c,u),E(u,d),h=!0,l.focus(),N||(b=[P(l,"input",i[8]),P(l,"mousedown",_e(i[6])),P(u,"click",i[3])],N=!0)},p(p,g){const m={};!t&&g&1&&(t=!0,m.toggle=p[0],be(()=>t=!1)),e.$set(m),g&4&&l.value!==p[2]&&ke(l,p[2])},i(p){h||(F(e.$$.fragment,p),h=!0)},o(p){Q(e.$$.fragment,p),h=!1},d(p){fe(e,p),p&&v(n),p&&v(o),p&&v(f),p&&v(c),N=!1,Ce(b)}}}function cn(i){let e,t,n,o;return e=new Xe({props:{pos:i[1],$$slots:{default:[un]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(s){ue(e.$$.fragment,s)},m(s,r){ce(e,s,r),t=!0,n||(o=P(window,"keydown",i[4]),n=!0)},p(s,[r]){const a={};r&2&&(a.pos=s[1]),r&4101&&(a.$$scope={dirty:r,ctx:s}),e.$set(a)},i(s){t||(F(e.$$.fragment,s),t=!0)},o(s){Q(e.$$.fragment,s),t=!1},d(s){fe(e,s),n=!1,o()}}}function fn(i,e,t){let n,o,s;$(i,oe,b=>t(9,o=b)),$(i,Qe,b=>t(10,s=b));let{key:r}=e,{pos:a}=e,{showNewOption:l}=e;const f=s(o[r]);function c(){o[r][f]===void 0&&he(oe,o[r][f]=[],o),o[r][f].push({btn:n}),oe.set(o),t(0,l=!1)}function u(b){b.key==="Enter"&&c(),b.key==="Escape"&&t(0,l=!1)}function d(b){ge.call(this,i,b)}function h(b){l=b,t(0,l)}function N(){n=this.value,t(2,n)}return i.$$set=b=>{"key"in b&&t(5,r=b.key),"pos"in b&&t(1,a=b.pos),"showNewOption"in b&&t(0,l=b.showNewOption)},t(2,n=""),[l,a,n,c,u,r,d,h,N]}class dn extends Ee{constructor(e){super(),Ne(this,e,fn,cn,we,{key:5,pos:1,showNewOption:0})}}function ot(i){let e,t,n,o;return{c(){e=C("div"),t=W(i[8]),this.h()},l(s){e=T(s,"DIV",{class:!0});var r=z(e);t=K(r,i[8]),r.forEach(v),this.h()},h(){_(e,"class","area svelte-1picauk")},m(s,r){D(s,e,r),E(e,t),i[23](e),n||(o=P(e,"mousedown",_e(i[14])),n=!0)},p(s,r){r&256&&Ge(t,s[8])},d(s){s&&v(e),i[23](null),n=!1,o()}}}function hn(i){let e,t,n,o,s,r,a,l,f,c,u,d,h,N,b,k,y,p,g,m,w,I,R,V,Y,x,A,H,Z,q,ne,B,ee,se,J,ie,O,G,te;function re(M){i[18](M)}let S={};i[0]!==void 0&&(S.toggle=i[0]),e=new Ye({props:S}),le.push(()=>ye(e,"toggle",re));let j=i[5]&&ot(i);return{c(){ae(e.$$.fragment),n=U(),o=C("div"),s=C("h1"),r=W(i[1]),a=U(),l=C("div"),f=C("div"),c=C("h2"),u=W("Nombre de referencia"),d=U(),h=C("input"),N=U(),b=C("div"),k=C("h2"),y=W("Btn"),p=U(),g=C("input"),m=U(),w=C("div"),I=C("h2"),R=W("Tooltip"),V=U(),Y=C("input"),x=U(),A=C("div"),H=C("div"),Z=C("div"),q=C("img"),B=U(),j&&j.c(),ee=U(),se=C("div"),J=C("button"),ie=W("Aceptar"),this.h()},l(M){ue(e.$$.fragment,M),n=L(M),o=T(M,"DIV",{});var X=z(o);s=T(X,"H1",{class:!0});var de=z(s);r=K(de,i[1]),de.forEach(v),X.forEach(v),a=L(M),l=T(M,"DIV",{class:!0});var me=z(l);f=T(me,"DIV",{class:!0});var Te=z(f);c=T(Te,"H2",{class:!0});var Ue=z(c);u=K(Ue,"Nombre de referencia"),Ue.forEach(v),d=L(Te),h=T(Te,"INPUT",{}),Te.forEach(v),N=L(me),b=T(me,"DIV",{class:!0});var Le=z(b);k=T(Le,"H2",{class:!0});var We=z(k);y=K(We,"Btn"),We.forEach(v),p=L(Le),g=T(Le,"INPUT",{}),Le.forEach(v),m=L(me),w=T(me,"DIV",{class:!0});var ze=z(w);I=T(ze,"H2",{class:!0});var Ke=z(I);R=K(Ke,"Tooltip"),Ke.forEach(v),V=L(ze),Y=T(ze,"INPUT",{}),ze.forEach(v),me.forEach(v),x=L(M),A=T(M,"DIV",{class:!0});var Fe=z(A);H=T(Fe,"DIV",{class:!0});var He=z(H);Z=T(He,"DIV",{class:!0});var Ze=z(Z);q=T(Ze,"IMG",{src:!0,alt:!0,class:!0}),B=L(Ze),j&&j.l(Ze),Ze.forEach(v),He.forEach(v),Fe.forEach(v),ee=L(M),se=T(M,"DIV",{class:!0});var et=z(se);J=T(et,"BUTTON",{class:!0});var tt=z(J);ie=K(tt,"Aceptar"),tt.forEach(v),et.forEach(v),this.h()},h(){_(s,"class","svelte-1picauk"),_(c,"class","svelte-1picauk"),_(f,"class","input"),_(k,"class","svelte-1picauk"),_(b,"class","input"),_(I,"class","svelte-1picauk"),_(w,"class","input"),_(l,"class","inputs svelte-1picauk"),Je(q.src,ne=i[9][i[10]])||_(q,"src",ne),_(q,"alt","Preview"),_(q,"class","img-preview svelte-1picauk"),_(Z,"class","area-container"),_(H,"class","area-absolute-container svelte-1picauk"),_(A,"class","area-normal-container svelte-1picauk"),_(J,"class","gui-button"),_(se,"class","bar")},m(M,X){ce(e,M,X),D(M,n,X),D(M,o,X),E(o,s),E(s,r),D(M,a,X),D(M,l,X),E(l,f),E(f,c),E(c,u),E(f,d),E(f,h),ke(h,i[6]),E(l,N),E(l,b),E(b,k),E(k,y),E(b,p),E(b,g),ke(g,i[8]),E(l,m),E(l,w),E(w,I),E(I,R),E(w,V),E(w,Y),ke(Y,i[7]),D(M,x,X),D(M,A,X),E(A,H),E(H,Z),E(Z,q),i[22](q),E(Z,B),j&&j.m(Z,null),D(M,ee,X),D(M,se,X),E(se,J),E(J,ie),O=!0,G||(te=[P(h,"input",i[19]),P(h,"mousedown",_e(i[17])),P(g,"input",i[20]),P(g,"mousedown",_e(i[16])),P(Y,"input",i[21]),P(Y,"mousedown",_e(i[15])),Re(i[11].call(null,q)),P(H,"mousedown",_e(i[13])),P(J,"click",i[12])],G=!0)},p(M,X){const de={};!t&&X&1&&(t=!0,de.toggle=M[0],be(()=>t=!1)),e.$set(de),(!O||X&2)&&Ge(r,M[1]),X&64&&h.value!==M[6]&&ke(h,M[6]),X&256&&g.value!==M[8]&&ke(g,M[8]),X&128&&Y.value!==M[7]&&ke(Y,M[7]),M[5]?j?j.p(M,X):(j=ot(M),j.c(),j.m(Z,null)):j&&(j.d(1),j=null)},i(M){O||(F(e.$$.fragment,M),O=!0)},o(M){Q(e.$$.fragment,M),O=!1},d(M){fe(e,M),M&&v(n),M&&v(o),M&&v(a),M&&v(l),M&&v(x),M&&v(A),i[22](null),j&&j.d(),M&&v(ee),M&&v(se),G=!1,Ce(te)}}}function pn(i){let e,t;return e=new Xe({props:{pos:i[2],$$slots:{default:[hn]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,o){ce(e,n,o),t=!0},p(n,[o]){const s={};o&4&&(s.pos=n[2]),o&536871419&&(s.$$scope={dirty:o,ctx:n}),e.$set(s)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function mn(i,e,t){let n,o,s,r,a,l;$(i,Ae,B=>t(25,r=B)),$(i,oe,B=>t(26,a=B)),$(i,Rt,B=>t(27,l=B));let{key:f}=e,{pos:c}=e,{showNewArea:u}=e,d,h=a[f];const N=l(h);let b={},k,y;function p(B){let ee=!1;B.addEventListener("mousedown",J=>{J.preventDefault(),ee=!0,t(5,y={x1:J.offsetX,y1:J.offsetY,x2:J.offsetX,y2:J.offsetY})}),B.addEventListener("mousemove",J=>{ee&&g(J)}),B.addEventListener("mouseup",J=>{se(J)}),B.addEventListener("mouseout",J=>{se(J)});function se(J){if(y===void 0||!ee)return;ee=!1;const ie=g(J),O={};for(let G of Object.keys(ie))O[G]=Math.floor(ie[G]*d.naturalWidth/d.width);Object.assign(b,{...O}),b.x=Math.floor(O.x+O.w/2),b.y=Math.floor(O.y+O.h/2)}}function g(B){t(5,y.x2=B.offsetX,y),t(5,y.y2=B.offsetY,y);const ee=Math.min(y.x1,y.x2),se=Math.max(y.x1,y.x2),J=Math.min(y.y1,y.y2),ie=Math.max(y.y1,y.y2),O={x:ee,y:J,w:se-ee,h:ie-J};return t(4,k.style.width=`${O.w}px`,k),t(4,k.style.height=`${O.h}px`,k),t(4,k.style.top=`${O.y}px`,k),t(4,k.style.left=`${O.x}px`,k),O}function m(){if(b===void 0){alert("debes escoger un area / you must choose an area");return}Object.assign(b,{btn:n,tooltip:o,name:s}),a[f].areas===void 0&&he(oe,a[f].areas=[],a),a[f].areas.push(b),oe.set(a),t(0,u=!1),he(Ae,r=!r,r)}function w(B){ge.call(this,i,B)}function I(B){ge.call(this,i,B)}function R(B){ge.call(this,i,B)}function V(B){ge.call(this,i,B)}function Y(B){ge.call(this,i,B)}function x(B){u=B,t(0,u)}function A(){s=this.value,t(6,s)}function H(){n=this.value,t(8,n)}function Z(){o=this.value,t(7,o)}function q(B){le[B?"unshift":"push"](()=>{d=B,t(3,d)})}function ne(B){le[B?"unshift":"push"](()=>{k=B,t(4,k)})}return i.$$set=B=>{"key"in B&&t(1,f=B.key),"pos"in B&&t(2,c=B.pos),"showNewArea"in B&&t(0,u=B.showNewArea)},t(8,n=""),t(7,o=""),t(6,s="area"),[u,f,c,d,k,y,s,o,n,h,N,p,m,w,I,R,V,Y,x,A,H,Z,q,ne]}class gn extends Ee{constructor(e){super(),Ne(this,e,mn,pn,we,{key:1,pos:2,showNewArea:0})}}function _n(i){let e,t,n,o,s,r,a,l,f,c,u;return{c(){e=C("input"),t=U(),n=C("label"),o=W("Cargar archivo"),s=U(),r=C("div"),a=C("img"),this.h()},l(d){e=T(d,"INPUT",{type:!0,id:!0}),t=L(d),n=T(d,"LABEL",{class:!0,for:!0});var h=z(n);o=K(h,"Cargar archivo"),h.forEach(v),s=L(d),r=T(d,"DIV",{class:!0,id:!0});var N=z(r);a=T(N,"IMG",{src:!0,alt:!0,class:!0}),N.forEach(v),this.h()},h(){_(e,"type","file"),_(e,"id","load-image"),e.hidden=!0,_(n,"class","gui-button svelte-1f4uqrr"),_(n,"for","load-image"),Je(a.src,l=i[0])||_(a,"src",l),_(a,"alt","Preview"),_(a,"class",f=nt(`img-preview ${i[0]?"":"hide"}`)+" svelte-1f4uqrr"),_(r,"class","image-preview-container svelte-1f4uqrr"),_(r,"id","image-preview-container")},m(d,h){D(d,e,h),i[4](e),D(d,t,h),D(d,n,h),E(n,o),D(d,s,h),D(d,r,h),E(r,a),i[5](a),c||(u=P(e,"change",i[3]),c=!0)},p(d,[h]){h&1&&!Je(a.src,l=d[0])&&_(a,"src",l),h&1&&f!==(f=nt(`img-preview ${d[0]?"":"hide"}`)+" svelte-1f4uqrr")&&_(a,"class",f)},i:Ie,o:Ie,d(d){d&&v(e),i[4](null),d&&v(t),d&&v(n),d&&v(s),d&&v(r),i[5](null),c=!1,u()}}}function vn(i,e,t){let{imageUrl:n}=e,o,s;function r(){const f=o.files[0];if(f){const c=new FileReader;c.addEventListener("load",function(){s.setAttribute("src",c.result),t(0,n=c.result)}),c.readAsDataURL(f)}}function a(f){le[f?"unshift":"push"](()=>{o=f,t(1,o)})}function l(f){le[f?"unshift":"push"](()=>{s=f,t(2,s)})}return i.$$set=f=>{"imageUrl"in f&&t(0,n=f.imageUrl)},[n,o,s,r,a,l]}class yn extends Ee{constructor(e){super(),Ne(this,e,vn,_n,we,{imageUrl:0})}}function bn(i){let e,t,n,o,s,r,a,l,f,c,u,d,h,N,b,k,y,p,g,m,w,I,R,V,Y,x,A,H,Z,q,ne,B;function ee(O){i[8](O)}let se={};i[0]!==void 0&&(se.toggle=i[0]),e=new Ye({props:se}),le.push(()=>ye(e,"toggle",ee));function J(O){i[11](O)}let ie={};return i[3]!==void 0&&(ie.imageUrl=i[3]),V=new yn({props:ie}),le.push(()=>ye(V,"imageUrl",J)),{c(){ae(e.$$.fragment),n=U(),o=C("div"),s=C("h1"),r=W(i[1]),a=U(),l=C("div"),f=C("h2"),c=W("Texto"),u=U(),d=C("textarea"),h=U(),N=C("div"),b=C("h2"),k=W("Imagen (opcional)"),y=U(),p=C("div"),g=C("label"),m=W("Url:"),w=U(),I=C("input"),R=W(`
      o
      `),ae(V.$$.fragment),x=U(),A=C("div"),H=C("button"),Z=W("Aceptar"),this.h()},l(O){ue(e.$$.fragment,O),n=L(O),o=T(O,"DIV",{});var G=z(o);s=T(G,"H1",{class:!0});var te=z(s);r=K(te,i[1]),te.forEach(v),G.forEach(v),a=L(O),l=T(O,"DIV",{});var re=z(l);f=T(re,"H2",{class:!0});var S=z(f);c=K(S,"Texto"),S.forEach(v),u=L(re),d=T(re,"TEXTAREA",{class:!0}),z(d).forEach(v),re.forEach(v),h=L(O),N=T(O,"DIV",{});var j=z(N);b=T(j,"H2",{class:!0});var M=z(b);k=K(M,"Imagen (opcional)"),M.forEach(v),y=L(j),p=T(j,"DIV",{});var X=z(p);g=T(X,"LABEL",{for:!0});var de=z(g);m=K(de,"Url:"),de.forEach(v),w=L(X),I=T(X,"INPUT",{id:!0,type:!0}),R=K(X,`
      o
      `),ue(V.$$.fragment,X),X.forEach(v),x=L(j),A=T(j,"DIV",{class:!0});var me=z(A);H=T(me,"BUTTON",{class:!0});var Te=z(H);Z=K(Te,"Aceptar"),Te.forEach(v),me.forEach(v),j.forEach(v),this.h()},h(){_(s,"class","svelte-8prumv"),_(f,"class","no-select svelte-8prumv"),_(d,"class","svelte-8prumv"),_(b,"class","no-select svelte-8prumv"),_(g,"for","inp"),_(I,"id","inp"),_(I,"type","text"),_(H,"class","gui-button"),_(A,"class","bar")},m(O,G){ce(e,O,G),D(O,n,G),D(O,o,G),E(o,s),E(s,r),D(O,a,G),D(O,l,G),E(l,f),E(f,c),E(l,u),E(l,d),ke(d,i[4]),D(O,h,G),D(O,N,G),E(N,b),E(b,k),E(N,y),E(N,p),E(p,g),E(g,m),E(p,w),E(p,I),ke(I,i[3]),E(p,R),ce(V,p,null),E(N,x),E(N,A),E(A,H),E(H,Z),q=!0,ne||(B=[P(d,"input",i[9]),P(d,"mousedown",_e(i[7])),P(I,"input",i[10]),P(I,"mousedown",_e(i[6])),P(H,"click",i[5])],ne=!0)},p(O,G){const te={};!t&&G&1&&(t=!0,te.toggle=O[0],be(()=>t=!1)),e.$set(te),(!q||G&2)&&Ge(r,O[1]),G&16&&ke(d,O[4]),G&8&&I.value!==O[3]&&ke(I,O[3]);const re={};!Y&&G&8&&(Y=!0,re.imageUrl=O[3],be(()=>Y=!1)),V.$set(re)},i(O){q||(F(e.$$.fragment,O),F(V.$$.fragment,O),q=!0)},o(O){Q(e.$$.fragment,O),Q(V.$$.fragment,O),q=!1},d(O){fe(e,O),O&&v(n),O&&v(o),O&&v(a),O&&v(l),O&&v(h),O&&v(N),fe(V),ne=!1,Ce(B)}}}function wn(i){let e,t;return e=new Xe({props:{pos:i[2],$$slots:{default:[bn]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,o){ce(e,n,o),t=!0},p(n,[o]){const s={};o&4&&(s.pos=n[2]),o&65563&&(s.$$scope={dirty:o,ctx:n}),e.$set(s)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function kn(i,e,t){let n,o,s;$(i,Ae,g=>t(12,o=g)),$(i,oe,g=>t(13,s=g));let{key:r}=e,{pos:a}=e,{showEditor:l}=e,f=null,c=s[r];const u=c.text===void 0&&c.texto!==void 0?"texto":"text";function d(){he(oe,s[r][u]=n,s),f!==null&&he(oe,s[r].image=f,s),t(0,l=!1),he(Ae,o=!o,o)}function h(g){ge.call(this,i,g)}function N(g){ge.call(this,i,g)}function b(g){l=g,t(0,l)}function k(){n=this.value,t(4,n),t(14,c)}function y(){f=this.value,t(3,f)}function p(g){f=g,t(3,f)}return i.$$set=g=>{"key"in g&&t(1,r=g.key),"pos"in g&&t(2,a=g.pos),"showEditor"in g&&t(0,l=g.showEditor)},i.$$.update=()=>{i.$$.dirty&2&&he(oe,s[r]=c,s)},t(4,n=c[u]),[l,r,a,f,n,d,h,N,b,k,y,p]}class En extends Ee{constructor(e){super(),Ne(this,e,kn,wn,we,{key:1,pos:2,showEditor:0})}}function it(i,e,t){const n=i.slice();return n[38]=e[t],n[40]=t,n}function rt(i,e,t){const n=i.slice();return n[41]=e[t],n[40]=t,n}function lt(i){let e,t,n,o,s,r,a,l;return{c(){e=C("div"),t=C("img"),o=U(),s=C("button"),r=W("x"),this.h()},l(f){e=T(f,"DIV",{class:!0});var c=z(e);t=T(c,"IMG",{src:!0,alt:!0,class:!0}),o=L(c),s=T(c,"BUTTON",{class:!0});var u=z(s);r=K(u,"x"),u.forEach(v),c.forEach(v),this.h()},h(){Je(t.src,n=i[6][i[13]])||_(t,"src",n),_(t,"alt","Preview"),_(t,"class","img-preview svelte-cnz2jn"),_(s,"class","x-button image-x-button"),_(e,"class","img-preview-container svelte-cnz2jn")},m(f,c){D(f,e,c),E(e,t),E(e,o),E(e,s),E(s,r),a||(l=P(s,"click",i[23]),a=!0)},p(f,c){c[0]&64&&!Je(t.src,n=f[6][f[13]])&&_(t,"src",n)},d(f){f&&v(e),a=!1,l()}}}function at(i){let e,t,n,o,s,r,a,l,f;return{c(){e=C("div"),t=C("span"),n=W("área"),o=U(),s=C("div"),r=C("button"),a=W("+"),this.h()},l(c){e=T(c,"DIV",{});var u=z(e);t=T(u,"SPAN",{class:!0});var d=z(t);n=K(d,"área"),d.forEach(v),o=L(u),s=T(u,"DIV",{class:!0});var h=z(s);r=T(h,"BUTTON",{class:!0});var N=z(r);a=K(N,"+"),N.forEach(v),h.forEach(v),u.forEach(v),this.h()},h(){_(t,"class","btns-name svelte-cnz2jn"),_(r,"class","svelte-cnz2jn"),_(s,"class","node-btns-div svelte-cnz2jn")},m(c,u){D(c,e,u),E(e,t),E(t,n),E(e,o),E(e,s),E(s,r),E(r,a),l||(f=P(r,"click",i[10]),l=!0)},p:Ie,d(c){c&&v(e),l=!1,f()}}}function ut(i,e){let t,n,o,s,r,a,l,f,c,u,d,h,N,b;return{key:i,first:null,c(){t=C("div"),n=C("input"),r=U(),a=C("button"),l=W("x"),c=U(),u=C("div"),this.h()},l(k){t=T(k,"DIV",{class:!0});var y=z(t);n=T(y,"INPUT",{type:!0,class:!0,i:!0}),r=L(y),a=T(y,"BUTTON",{class:!0,i:!0});var p=z(a);l=K(p,"x"),p.forEach(v),c=L(y),u=T(y,"DIV",{type:!0,key:!0,content:!0,class:!0,i:!0}),z(u).forEach(v),y.forEach(v),this.h()},h(){_(n,"type","text"),_(n,"class","output-text svelte-cnz2jn"),n.value=o=e[41].btn,_(n,"i",s=e[40]),_(a,"class","x-button"),_(a,"i",f=e[40]),_(u,"type","ops"),_(u,"key",e[1]),_(u,"content",d=e[41].btn),_(u,"class","connection output option-connection svelte-cnz2jn"),_(u,"i",h=e[40]),_(t,"class","output-container svelte-cnz2jn"),this.first=t},m(k,y){D(k,t,y),E(t,n),E(t,r),E(t,a),E(a,l),E(t,c),E(t,u),N||(b=[Re(e[15].call(null,n)),P(n,"change",e[14]),P(n,"mousedown",_e(e[27])),P(a,"click",e[21]),P(u,"click",e[18]),P(u,"mousedown",_e(e[26]))],N=!0)},p(k,y){e=k,y[0]&6&&o!==(o=e[41].btn)&&n.value!==o&&(n.value=o),y[0]&6&&s!==(s=e[40])&&_(n,"i",s),y[0]&6&&f!==(f=e[40])&&_(a,"i",f),y[0]&2&&_(u,"key",e[1]),y[0]&6&&d!==(d=e[41].btn)&&_(u,"content",d),y[0]&6&&h!==(h=e[40])&&_(u,"i",h)},d(k){k&&v(t),N=!1,Ce(b)}}}function ct(i,e){let t,n,o,s,r,a,l,f,c,u,d,h,N,b,k;return{key:i,first:null,c(){t=C("div"),n=C("input"),r=U(),a=C("button"),l=W("x"),c=U(),u=C("div"),N=U(),this.h()},l(y){t=T(y,"DIV",{class:!0});var p=z(t);n=T(p,"INPUT",{type:!0,class:!0,i:!0}),r=L(p),a=T(p,"BUTTON",{class:!0,i:!0});var g=z(a);l=K(g,"x"),g.forEach(v),c=L(p),u=T(p,"DIV",{type:!0,key:!0,content:!0,class:!0,i:!0}),z(u).forEach(v),N=L(p),p.forEach(v),this.h()},h(){_(n,"type","text"),_(n,"class","output-text svelte-cnz2jn"),n.value=o=e[38].name,_(n,"i",s=e[40]),_(a,"class","x-button"),_(a,"i",f=e[40]),_(u,"type","areas"),_(u,"key",e[1]),_(u,"content",d=e[38].name),_(u,"class","connection output area-connection svelte-cnz2jn"),_(u,"i",h=e[40]),_(t,"class","output-container svelte-cnz2jn"),this.first=t},m(y,p){D(y,t,p),E(t,n),E(t,r),E(t,a),E(a,l),E(t,c),E(t,u),E(t,N),b||(k=[Re(e[17].call(null,n)),P(n,"change",e[16]),P(n,"mousedown",_e(e[25])),P(a,"click",e[22]),P(u,"click",e[18]),P(u,"mousedown",_e(e[24]))],b=!0)},p(y,p){e=y,p[0]&6&&o!==(o=e[38].name)&&n.value!==o&&(n.value=o),p[0]&6&&s!==(s=e[40])&&_(n,"i",s),p[0]&6&&f!==(f=e[40])&&_(a,"i",f),p[0]&2&&_(u,"key",e[1]),p[0]&6&&d!==(d=e[38].name)&&_(u,"content",d),p[0]&6&&h!==(h=e[40])&&_(u,"i",h)},d(y){y&&v(t),b=!1,Ce(k)}}}function ft(i){let e,t=[],n=new Map,o,s=[],r=new Map,a=i[2][i[1]][i[12]]||[];const l=u=>"op"+u[40];for(let u=0;u<a.length;u+=1){let d=rt(i,a,u),h=l(d);n.set(h,t[u]=ut(h,d))}let f=i[2][i[1]].areas||[];const c=u=>"a"+u[40];for(let u=0;u<f.length;u+=1){let d=it(i,f,u),h=c(d);r.set(h,s[u]=ct(h,d))}return{c(){e=C("div");for(let u=0;u<t.length;u+=1)t[u].c();o=U();for(let u=0;u<s.length;u+=1)s[u].c();this.h()},l(u){e=T(u,"DIV",{class:!0});var d=z(e);for(let h=0;h<t.length;h+=1)t[h].l(d);o=L(d);for(let h=0;h<s.length;h+=1)s[h].l(d);d.forEach(v),this.h()},h(){_(e,"class","node-outputs svelte-cnz2jn")},m(u,d){D(u,e,d);for(let h=0;h<t.length;h+=1)t[h].m(e,null);E(e,o);for(let h=0;h<s.length;h+=1)s[h].m(e,null)},p(u,d){d[0]&2379782&&(a=u[2][u[1]][u[12]]||[],t=Me(t,d,l,1,u,a,n,e,Ve,ut,o,rt)),d[0]&4521990&&(f=u[2][u[1]].areas||[],s=Me(s,d,c,1,u,f,r,e,Ve,ct,null,it))},d(u){u&&v(e);for(let d=0;d<t.length;d+=1)t[d].d();for(let d=0;d<s.length;d+=1)s[d].d()}}}function Nn(i){let e,t,n,o,s,r,a,l,f,c=(i[6][i[11]].length<210?i[6][i[11]]:i[6][i[11]].slice(0,210)+"...")+"",u,d,h,N,b,k,y,p,g,m,w,I,R,V,Y,x,A,H,Z,q,ne,B,ee,se=i[7],J,ie,O,G=i[6][i[13]]!==void 0&&i[6][i[13]]!==null&&lt(i),te=i[6][i[13]]!==void 0&&i[6][i[13]]!==null&&at(i),re=ft(i);return{c(){e=C("div"),t=U(),n=C("h1"),o=W("Escena: "),s=W(i[1]),r=U(),G&&G.c(),a=U(),l=C("div"),f=C("p"),u=W(c),d=U(),h=C("div"),N=C("div"),b=C("span"),k=W("escena"),y=U(),p=C("div"),g=C("button"),m=W("editar"),w=U(),I=C("button"),R=W("x"),V=U(),Y=C("div"),x=C("span"),A=W("btn"),H=U(),Z=C("div"),q=C("button"),ne=W("+"),B=U(),te&&te.c(),ee=U(),re.c(),J=ve(),this.h()},l(S){e=T(S,"DIV",{key:!0,class:!0}),z(e).forEach(v),t=L(S),n=T(S,"H1",{class:!0});var j=z(n);o=K(j,"Escena: "),s=K(j,i[1]),j.forEach(v),r=L(S),G&&G.l(S),a=L(S),l=T(S,"DIV",{class:!0});var M=z(l);f=T(M,"P",{class:!0});var X=z(f);u=K(X,c),X.forEach(v),M.forEach(v),d=L(S),h=T(S,"DIV",{class:!0});var de=z(h);N=T(de,"DIV",{});var me=z(N);b=T(me,"SPAN",{class:!0});var Te=z(b);k=K(Te,"escena"),Te.forEach(v),y=L(me),p=T(me,"DIV",{class:!0});var Ue=z(p);g=T(Ue,"BUTTON",{class:!0});var Le=z(g);m=K(Le,"editar"),Le.forEach(v),w=L(Ue),I=T(Ue,"BUTTON",{class:!0});var We=z(I);R=K(We,"x"),We.forEach(v),Ue.forEach(v),me.forEach(v),V=L(de),Y=T(de,"DIV",{});var ze=z(Y);x=T(ze,"SPAN",{class:!0});var Ke=z(x);A=K(Ke,"btn"),Ke.forEach(v),H=L(ze),Z=T(ze,"DIV",{class:!0});var Fe=z(Z);q=T(Fe,"BUTTON",{class:!0});var He=z(q);ne=K(He,"+"),He.forEach(v),Fe.forEach(v),ze.forEach(v),B=L(de),te&&te.l(de),de.forEach(v),ee=L(S),re.l(S),J=ve(),this.h()},h(){_(e,"key",i[1]),_(e,"class","connection input svelte-cnz2jn"),_(n,"class","svelte-cnz2jn"),_(f,"class","text-p svelte-cnz2jn"),_(l,"class","p-container svelte-cnz2jn"),_(b,"class","btns-name svelte-cnz2jn"),_(g,"class","svelte-cnz2jn"),_(I,"class","svelte-cnz2jn"),_(p,"class","node-btns-div svelte-cnz2jn"),_(x,"class","btns-name svelte-cnz2jn"),_(q,"class","svelte-cnz2jn"),_(Z,"class","node-btns-div svelte-cnz2jn"),_(h,"class","node-btns svelte-cnz2jn")},m(S,j){D(S,e,j),D(S,t,j),D(S,n,j),E(n,o),E(n,s),D(S,r,j),G&&G.m(S,j),D(S,a,j),D(S,l,j),E(l,f),E(f,u),D(S,d,j),D(S,h,j),E(h,N),E(N,b),E(b,k),E(N,y),E(N,p),E(p,g),E(g,m),E(p,w),E(p,I),E(I,R),E(h,V),E(h,Y),E(Y,x),E(x,A),E(Y,H),E(Y,Z),E(Z,q),E(q,ne),E(h,B),te&&te.m(h,null),D(S,ee,j),re.m(S,j),D(S,J,j),ie||(O=[P(e,"mousedown",_e(i[28])),P(e,"click",i[19]),P(g,"click",i[8]),P(I,"click",i[20]),P(q,"click",i[9])],ie=!0)},p(S,j){j[0]&2&&_(e,"key",S[1]),j[0]&2&&Ge(s,S[1]),S[6][S[13]]!==void 0&&S[6][S[13]]!==null?G?G.p(S,j):(G=lt(S),G.c(),G.m(a.parentNode,a)):G&&(G.d(1),G=null),j[0]&64&&c!==(c=(S[6][S[11]].length<210?S[6][S[11]]:S[6][S[11]].slice(0,210)+"...")+"")&&Ge(u,c),S[6][S[13]]!==void 0&&S[6][S[13]]!==null?te?te.p(S,j):(te=at(S),te.c(),te.m(h,null)):te&&(te.d(1),te=null),j[0]&128&&we(se,se=S[7])?(re.d(1),re=ft(S),re.c(),re.m(J.parentNode,J)):re.p(S,j)},d(S){S&&v(e),S&&v(t),S&&v(n),S&&v(r),G&&G.d(S),S&&v(a),S&&v(l),S&&v(d),S&&v(h),te&&te.d(),S&&v(ee),S&&v(J),re.d(S),ie=!1,Ce(O)}}}function dt(i){let e,t,n;function o(r){i[30](r)}let s={key:i[1],pos:i[6].display};return i[3]!==void 0&&(s.showEditor=i[3]),e=new En({props:s}),le.push(()=>ye(e,"showEditor",o)),{c(){ae(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,a){ce(e,r,a),n=!0},p(r,a){const l={};a[0]&2&&(l.key=r[1]),a[0]&64&&(l.pos=r[6].display),!t&&a[0]&8&&(t=!0,l.showEditor=r[3],be(()=>t=!1)),e.$set(l)},i(r){n||(F(e.$$.fragment,r),n=!0)},o(r){Q(e.$$.fragment,r),n=!1},d(r){fe(e,r)}}}function ht(i){let e,t,n;function o(r){i[31](r)}let s={key:i[1],pos:i[6].display};return i[4]!==void 0&&(s.showNewOption=i[4]),e=new dn({props:s}),le.push(()=>ye(e,"showNewOption",o)),{c(){ae(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,a){ce(e,r,a),n=!0},p(r,a){const l={};a[0]&2&&(l.key=r[1]),a[0]&64&&(l.pos=r[6].display),!t&&a[0]&16&&(t=!0,l.showNewOption=r[4],be(()=>t=!1)),e.$set(l)},i(r){n||(F(e.$$.fragment,r),n=!0)},o(r){Q(e.$$.fragment,r),n=!1},d(r){fe(e,r)}}}function pt(i){let e,t,n;function o(r){i[32](r)}let s={key:i[1],pos:i[6].display};return i[5]!==void 0&&(s.showNewArea=i[5]),e=new gn({props:s}),le.push(()=>ye(e,"showNewArea",o)),{c(){ae(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,a){ce(e,r,a),n=!0},p(r,a){const l={};a[0]&2&&(l.key=r[1]),a[0]&64&&(l.pos=r[6].display),!t&&a[0]&32&&(t=!0,l.showNewArea=r[5],be(()=>t=!1)),e.$set(l)},i(r){n||(F(e.$$.fragment,r),n=!0)},o(r){Q(e.$$.fragment,r),n=!1},d(r){fe(e,r)}}}function Sn(i){let e,t,n,o,s,r,a;function l(h){i[29](h)}let f={scene:i[6],key:i[1],$$slots:{default:[Nn]},$$scope:{ctx:i}};i[0]!==void 0&&(f.movingNode=i[0]),e=new sn({props:f}),le.push(()=>ye(e,"movingNode",l));let c=i[3]&&dt(i),u=i[4]&&ht(i),d=i[5]&&pt(i);return{c(){ae(e.$$.fragment),n=U(),c&&c.c(),o=U(),u&&u.c(),s=U(),d&&d.c(),r=ve()},l(h){ue(e.$$.fragment,h),n=L(h),c&&c.l(h),o=L(h),u&&u.l(h),s=L(h),d&&d.l(h),r=ve()},m(h,N){ce(e,h,N),D(h,n,N),c&&c.m(h,N),D(h,o,N),u&&u.m(h,N),D(h,s,N),d&&d.m(h,N),D(h,r,N),a=!0},p(h,N){const b={};N[0]&64&&(b.scene=h[6]),N[0]&2&&(b.key=h[1]),N[0]&198|N[1]&4096&&(b.$$scope={dirty:N,ctx:h}),!t&&N[0]&1&&(t=!0,b.movingNode=h[0],be(()=>t=!1)),e.$set(b),h[3]?c?(c.p(h,N),N[0]&8&&F(c,1)):(c=dt(h),c.c(),F(c,1),c.m(o.parentNode,o)):c&&(Pe(),Q(c,1,1,()=>{c=null}),Be()),h[4]?u?(u.p(h,N),N[0]&16&&F(u,1)):(u=ht(h),u.c(),F(u,1),u.m(s.parentNode,s)):u&&(Pe(),Q(u,1,1,()=>{u=null}),Be()),h[5]?d?(d.p(h,N),N[0]&32&&F(d,1)):(d=pt(h),d.c(),F(d,1),d.m(r.parentNode,r)):d&&(Pe(),Q(d,1,1,()=>{d=null}),Be())},i(h){a||(F(e.$$.fragment,h),F(c),F(u),F(d),a=!0)},o(h){Q(e.$$.fragment,h),Q(c),Q(u),Q(d),a=!1},d(h){fe(e,h),h&&v(n),c&&c.d(h),h&&v(o),u&&u.d(h),h&&v(s),d&&d.d(h),h&&v(r)}}}function In(i,e,t){let n,o,s,r,a,l,f;$(i,Ae,S=>t(7,n=S)),$(i,oe,S=>t(2,o=S)),$(i,$e,S=>t(33,s=S)),$(i,Qe,S=>t(34,r=S)),$(i,qe,S=>t(35,a=S)),$(i,Rt,S=>t(36,l=S)),$(i,Wt,S=>t(37,f=S));let{movingNode:c=!1}=e,{key:u}=e,d=!1,h=!1,N=!1;function b(){t(3,d=!0)}function k(){t(4,h=!0)}function y(){t(5,N=!0)}let p=o[u];const g=f(p),m=r(p),w=l(p);p.display===void 0&&(p.display={x:0,y:0});function I(){R(this)}function R(S){const j=+S.getAttribute("i");S.style.width=S.value.length*6.1+"px",t(6,p[m][j].btn=S.value,p),oe.set(o)}function V(){Y(this)}function Y(S){const j=+S.getAttribute("i");S.style.width=S.value.length*6.1+"px",t(6,p.areas[j].name=S.value,p),oe.set(o)}function x(S){const j=S.target,M=+j.getAttribute("i"),X=j.getAttribute("type");if(a!==void 0&&a.key===u&&a.i===M&&a.type===X){he(qe,a=void 0,a);const de=X==="ops"?m:"areas",me=s(p[de][M]);t(6,p[de][M][me]=void 0,p);return}he(qe,a={key:u,i:M,type:X},a)}function A(){if(a===void 0)return;const S=o[a.key],j=a.type==="ops"?r(S):"areas",M=s(S[j][a.i]);S[j][a.i][M]=u,he(qe,a=void 0,a)}function H(){for(let S of Object.keys(o)){const j=r(o[S]);if(o[S][j]!==void 0){for(let M of o[S][j]){const X=s(M);M[X]===u&&(M[X]=void 0)}if(o[S].areas!==void 0)for(let M of o[S].areas){const X=s(M);M[X]===u&&(M[X]=void 0)}}}delete o[u],oe.set(o)}function Z(S){const M=+S.target.getAttribute("i");o[u][m].splice(M,1),oe.set(o),he(Ae,n=!n,n)}function q(S){const M=+S.target.getAttribute("i");o[u].areas.splice(M,1),oe.set(o),he(Ae,n=!n,n)}function ne(){delete o[u][w],delete o[u].areas,oe.set(o),he(Ae,n=!n,n)}function B(S){ge.call(this,i,S)}function ee(S){ge.call(this,i,S)}function se(S){ge.call(this,i,S)}function J(S){ge.call(this,i,S)}function ie(S){ge.call(this,i,S)}function O(S){c=S,t(0,c)}function G(S){d=S,t(3,d)}function te(S){h=S,t(4,h)}function re(S){N=S,t(5,N)}return i.$$set=S=>{"movingNode"in S&&t(0,c=S.movingNode),"key"in S&&t(1,u=S.key)},i.$$.update=()=>{i.$$.dirty[0]&6&&t(6,p=o[u])},[c,u,o,d,h,N,p,n,b,k,y,g,m,w,I,R,V,Y,x,A,H,Z,q,ne,B,ee,se,J,ie,O,G,te,re]}class Cn extends Ee{constructor(e){super(),Ne(this,e,In,Sn,we,{movingNode:0,key:1},null,[-1,-1])}}function mt(i,e,t){const n=i.slice();return n[13]=e[t],n[15]=t,n}function gt(i,e,t){const n=i.slice();return n[13]=e[t],n[15]=t,n}function _t(i){let e,t=[],n=new Map,o,s=[],r=new Map,a=i[0][i[2]]||[];const l=u=>"op"+u[15];for(let u=0;u<a.length;u+=1){let d=gt(i,a,u),h=l(d);n.set(h,t[u]=vt(h,d))}let f=i[0].areas||[];const c=u=>"a"+u[15];for(let u=0;u<f.length;u+=1){let d=mt(i,f,u),h=c(d);r.set(h,s[u]=yt(h,d))}return{c(){e=De("g");for(let u=0;u<t.length;u+=1)t[u].c();o=ve();for(let u=0;u<s.length;u+=1)s[u].c()},l(u){e=Oe(u,"g",{});var d=z(e);for(let h=0;h<t.length;h+=1)t[h].l(d);o=ve();for(let h=0;h<s.length;h+=1)s[h].l(d);d.forEach(v)},m(u,d){D(u,e,d);for(let h=0;h<t.length;h+=1)t[h].m(e,null);E(e,o);for(let h=0;h<s.length;h+=1)s[h].m(e,null)},p(u,d){d&13&&(a=u[0][u[2]]||[],t=Me(t,d,l,1,u,a,n,e,Ve,vt,o,gt)),d&9&&(f=u[0].areas||[],s=Me(s,d,c,1,u,f,r,e,Ve,yt,null,mt))},d(u){u&&v(e);for(let d=0;d<t.length;d+=1)t[d].d();for(let d=0;d<s.length;d+=1)s[d].d()}}}function vt(i,e){let t,n;return{key:i,first:null,c(){t=De("path"),this.h()},l(o){t=Oe(o,"path",{class:!0,d:!0}),z(t).forEach(v),this.h()},h(){_(t,"class","connection op-connection svelte-1h0rpzd"),_(t,"d",n=e[3]("ops",e[15])),this.first=t},m(o,s){D(o,t,s)},p(o,s){e=o,s&1&&n!==(n=e[3]("ops",e[15]))&&_(t,"d",n)},d(o){o&&v(t)}}}function yt(i,e){let t,n;return{key:i,first:null,c(){t=De("path"),this.h()},l(o){t=Oe(o,"path",{class:!0,d:!0}),z(t).forEach(v),this.h()},h(){_(t,"class","connection a-connection svelte-1h0rpzd"),_(t,"d",n=e[3]("areas",e[15])),this.first=t},m(o,s){D(o,t,s)},p(o,s){e=o,s&1&&n!==(n=e[3]("areas",e[15]))&&_(t,"d",n)},d(o){o&&v(t)}}}function Tn(i){let e,t=i[1]&&_t(i);return{c(){t&&t.c(),e=ve()},l(n){t&&t.l(n),e=ve()},m(n,o){t&&t.m(n,o),D(n,e,o)},p(n,[o]){n[1]?t?t.p(n,o):(t=_t(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ie,o:Ie,d(n){t&&t.d(n),n&&v(e)}}}function zn(i,e,t){let n,o,s,r;$(i,oe,k=>t(7,n=k)),$(i,qe,k=>t(8,o=k)),$(i,$e,k=>t(9,s=k)),$(i,Qe,k=>t(10,r=k));let{key:a}=e,{pageMouse:l}=e,{movingNode:f}=e,c=n[a],u=r(c),d=!1;Bt(()=>{t(1,d=!0)});function h(k,y,p){const g=document.querySelector(`[type=${y}][i="${p}"][key=${a}]`);if(!g)return n[a].display[k];const m=k==="x"?g.offsetLeft:g.offsetTop,w=k==="x"?g.offsetWidth/2+2:g.offsetHeight;return n[a].display[k]+m+w}function N(k,y,p){const g=y==="ops"?u:"areas",m=c[g][p],w=s(m),I=c[g][p][w];if(o!==void 0&&o.key===a&&o.i===p&&o.type===y)return l[k];if(I===void 0)return h(k,y,p);{const R=document.querySelector(`.input[key=${I}]`);return n[I].display[k]+(k==="x"?R.offsetLeft:R.offsetTop)+7}}function b(k,y){const p={x:h("x",k,y),y:h("y",k,y)},g={x:N("x",k,y),y:N("y",k,y)},m=(g.y-p.y)/2,w=(p.y-g.y)/2;return`M ${p.x}, ${p.y} C ${p.x}, ${p.y+m} ${g.x}, ${g.y+w} ${g.x}, ${g.y}`}return i.$$set=k=>{"key"in k&&t(4,a=k.key),"pageMouse"in k&&t(5,l=k.pageMouse),"movingNode"in k&&t(6,f=k.movingNode)},i.$$.update=()=>{i.$$.dirty&225&&(l||n||f)&&(t(0,c),t(5,l),t(7,n),t(6,f))},[c,d,u,b,a,l,f,n]}class Mn extends Ee{constructor(e){super(),Ne(this,e,zn,Tn,we,{key:4,pageMouse:5,movingNode:6})}}function Dn(i){let e,t,n,o,s,r,a,l,f,c,u,d,h,N,b;function k(p){i[8](p)}let y={};return i[0]!==void 0&&(y.toggle=i[0]),e=new Ye({props:y}),le.push(()=>ye(e,"toggle",k)),{c(){ae(e.$$.fragment),n=U(),o=C("div"),s=C("label"),r=W("Escena:"),a=U(),l=C("input"),f=U(),c=C("div"),u=C("button"),d=W("Aceptar"),this.h()},l(p){ue(e.$$.fragment,p),n=L(p),o=T(p,"DIV",{});var g=z(o);s=T(g,"LABEL",{for:!0});var m=z(s);r=K(m,"Escena:"),m.forEach(v),a=L(g),l=T(g,"INPUT",{id:!0,type:!0}),g.forEach(v),f=L(p),c=T(p,"DIV",{class:!0});var w=z(c);u=T(w,"BUTTON",{class:!0});var I=z(u);d=K(I,"Aceptar"),I.forEach(v),w.forEach(v),this.h()},h(){_(s,"for","inp"),_(l,"id","inp"),_(l,"type","text"),_(u,"class","gui-button"),_(c,"class","bar svelte-1bhrmvp")},m(p,g){ce(e,p,g),D(p,n,g),D(p,o,g),E(o,s),E(s,r),E(o,a),E(o,l),ke(l,i[2]),D(p,f,g),D(p,c,g),E(c,u),E(u,d),h=!0,N||(b=[P(l,"input",i[9]),P(l,"mousedown",_e(i[7])),P(u,"click",i[4])],N=!0)},p(p,g){const m={};!t&&g&1&&(t=!0,m.toggle=p[0],be(()=>t=!1)),e.$set(m),g&4&&l.value!==p[2]&&ke(l,p[2])},i(p){h||(F(e.$$.fragment,p),h=!0)},o(p){Q(e.$$.fragment,p),h=!1},d(p){fe(e,p),p&&v(n),p&&v(o),p&&v(f),p&&v(c),N=!1,Ce(b)}}}function On(i){let e,t,n,o,s;function r(l){i[10](l)}let a={pos:i[3],$$slots:{default:[Dn]},$$scope:{ctx:i}};return i[1]!==void 0&&(a.displace=i[1]),e=new Xe({props:a}),le.push(()=>ye(e,"displace",r)),{c(){ae(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,f){ce(e,l,f),n=!0,o||(s=P(window,"keydown",i[5]),o=!0)},p(l,[f]){const c={};f&8197&&(c.$$scope={dirty:f,ctx:l}),!t&&f&2&&(t=!0,c.displace=l[1],be(()=>t=!1)),e.$set(c)},i(l){n||(F(e.$$.fragment,l),n=!0)},o(l){Q(e.$$.fragment,l),n=!1},d(l){fe(e,l),o=!1,s()}}}function An(i){const e=["á","é","í","ó","ú","ü","ñ"],t=["a","e","i","o","u","u","n"],n=i.toLowerCase();let o="";for(let s=0;s<i.length;s++){const r=n.charAt(s),a=i.charAt(s);if(e.includes(r)){let l;for(let f=0;f<e.length;f++)if(e[f]===r){l=f;break}a===a.toUpperCase()?o+=t[l].toUpperCase():o+=t[l]}else o+=a}return o}function jn(i,e,t){let n,o;$(i,oe,k=>t(12,o=k));let{showNewScene:s}=e,{offset:r}=e,a=o,l={x:r.x*-1+20,y:r.y*-1+20},f;function c(){if(n.length<=0){alert(`Debes dar un nombre a la escena /
You must give a name to the scene`);return}if(/^\d/.test(n)===!0){alert(`El nombre de la escena no puede empezar con un número /
The name of the scene cannot start with a number`);return}let k=n.replace(/\s/gi,"_").replace(/\W/,"").replace(/[;.,:{}()<>$%&!¡?¿"'/\\#@&*+-]/gi,"");if(k=An(k),o[k]!==void 0){alert(`Ya existe una escena con ese nombre /
There is already a scene with that name`);return}a[k]={text:"",display:{x:l.x,y:l.y}},he(oe,o[k]=a[k],o),t(0,s=!1)}function u(k){k.key==="Enter"&&c(),k.key==="Escape"&&t(0,s=!1)}function d(k){ge.call(this,i,k)}function h(k){s=k,t(0,s)}function N(){n=this.value,t(2,n)}function b(k){f=k,t(1,f)}return i.$$set=k=>{"showNewScene"in k&&t(0,s=k.showNewScene),"offset"in k&&t(6,r=k.offset)},t(2,n=""),[s,f,n,l,c,u,r,d,h,N,b]}class Un extends Ee{constructor(e){super(),Ne(this,e,jn,On,we,{showNewScene:0,offset:6})}}function bt(i,e,t){const n=i.slice();return n[24]=e[t][0],n[25]=e[t][1],n}function wt(i,e,t){const n=i.slice();return n[28]=e[t],n[30]=t,n}function kt(i,e,t){const n=i.slice();return n[28]=e[t],n[30]=t,n}function Et(i,e,t){const n=i.slice();return n[32]=e[t],n}function Nt(i,e,t){const n=i.slice();return n[32]=e[t],n}function St(i,e){let t,n,o,s,r,a,l;function f(u){e[16](u)}let c={key:e[32]};return e[4]!==void 0&&(c.movingNode=e[4]),n=new Cn({props:c}),le.push(()=>ye(n,"movingNode",f)),{key:i,first:null,c(){t=C("div"),ae(n.$$.fragment),this.h()},l(u){t=T(u,"DIV",{class:!0,key:!0});var d=z(t);ue(n.$$.fragment,d),d.forEach(v),this.h()},h(){_(t,"class","scene-node-container-div"),_(t,"key",s=e[32]),this.first=t},m(u,d){D(u,t,d),ce(n,t,null),r=!0,a||(l=P(t,"mouseenter",Pn),a=!0)},p(u,d){e=u;const h={};d[0]&128&&(h.key=e[32]),!o&&d[0]&16&&(o=!0,h.movingNode=e[4],be(()=>o=!1)),n.$set(h),(!r||d[0]&128&&s!==(s=e[32]))&&_(t,"key",s)},i(u){r||(F(n.$$.fragment,u),r=!0)},o(u){Q(n.$$.fragment,u),r=!1},d(u){u&&v(t),fe(n),a=!1,l()}}}function It(i,e){let t,n,o;return n=new Mn({props:{key:e[32],pageMouse:e[1],movingNode:e[4]}}),{key:i,first:null,c(){t=ve(),ae(n.$$.fragment),this.h()},l(s){t=ve(),ue(n.$$.fragment,s),this.h()},h(){this.first=t},m(s,r){D(s,t,r),ce(n,s,r),o=!0},p(s,r){e=s;const a={};r[0]&128&&(a.key=e[32]),r[0]&2&&(a.pageMouse=e[1]),r[0]&16&&(a.movingNode=e[4]),n.$set(a)},i(s){o||(F(n.$$.fragment,s),o=!0)},o(s){Q(n.$$.fragment,s),o=!1},d(s){s&&v(t),fe(n,s)}}}function Ct(i){let e,t,n;function o(r){i[17](r)}let s={offset:i[5]};return i[0]!==void 0&&(s.showNewScene=i[0]),e=new Un({props:s}),le.push(()=>ye(e,"showNewScene",o)),{c(){ae(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,a){ce(e,r,a),n=!0},p(r,a){const l={};a[0]&32&&(l.offset=r[5]),!t&&a[0]&1&&(t=!0,l.showNewScene=r[0],be(()=>t=!1)),e.$set(l)},i(r){n||(F(e.$$.fragment,r),n=!0)},o(r){Q(e.$$.fragment,r),n=!1},d(r){fe(e,r)}}}function Tt(i){let e,t=[],n=new Map,o,s,r,a=i[2];const l=c=>c[24];for(let c=0;c<a.length;c+=1){let u=bt(i,a,c),d=l(u);n.set(d,t[c]=Dt(d,u))}let f=i[6]!==void 0&&Ot(i);return{c(){e=De("svg");for(let c=0;c<t.length;c+=1)t[c].c();o=ve(),f&&f.c(),this.h()},l(c){e=Oe(c,"svg",{width:!0,height:!0});var u=z(e);for(let d=0;d<t.length;d+=1)t[d].l(u);o=ve(),f&&f.l(u),u.forEach(v),this.h()},h(){_(e,"width","100%"),_(e,"height","100%")},m(c,u){D(c,e,u);for(let d=0;d<t.length;d+=1)t[d].m(e,null);E(e,o),f&&f.m(e,null),s||(r=P(e,"click",i[9]),s=!0)},p(c,u){u[0]&8516&&(a=c[2],t=Me(t,u,l,1,c,a,n,e,Ve,Dt,o,bt)),c[6]!==void 0?f?f.p(c,u):(f=Ot(c),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(c){c&&v(e);for(let u=0;u<t.length;u+=1)t[u].d();f&&f.d(),s=!1,r()}}}function zt(i,e){let t,n,o,s,r;return{key:i,first:null,c(){t=De("line"),this.h()},l(a){t=Oe(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0});var l=z(t);l.forEach(v),this.h()},h(){_(t,"x1",n=e[25].display.x/pe+Se(e[24],"width")/2),_(t,"y1",o=e[25].display.y/pe+Se(e[24],"height")),_(t,"x2",s=e[13](e[25],e[28],"x")),_(t,"y2",r=e[13](e[25],e[28],"y")),_(t,"stroke","var(--scene-stroke)"),this.first=t},m(a,l){D(a,t,l)},p(a,l){e=a,l[0]&4&&n!==(n=e[25].display.x/pe+Se(e[24],"width")/2)&&_(t,"x1",n),l[0]&4&&o!==(o=e[25].display.y/pe+Se(e[24],"height"))&&_(t,"y1",o),l[0]&260&&s!==(s=e[13](e[25],e[28],"x"))&&_(t,"x2",s),l[0]&260&&r!==(r=e[13](e[25],e[28],"y"))&&_(t,"y2",r)},d(a){a&&v(t)}}}function Mt(i,e){let t,n,o,s,r;return{key:i,first:null,c(){t=De("line"),this.h()},l(a){t=Oe(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0});var l=z(t);l.forEach(v),this.h()},h(){_(t,"x1",n=e[25].display.x/pe+Se(e[24],"width")/2),_(t,"y1",o=e[25].display.y/pe+Se(e[24],"height")),_(t,"x2",s=e[13](e[25],e[28],"x")),_(t,"y2",r=e[13](e[25],e[28],"y")),_(t,"stroke","var(--area-stroke)"),this.first=t},m(a,l){D(a,t,l)},p(a,l){e=a,l[0]&4&&n!==(n=e[25].display.x/pe+Se(e[24],"width")/2)&&_(t,"x1",n),l[0]&4&&o!==(o=e[25].display.y/pe+Se(e[24],"height"))&&_(t,"y1",o),l[0]&4&&s!==(s=e[13](e[25],e[28],"x"))&&_(t,"x2",s),l[0]&4&&r!==(r=e[13](e[25],e[28],"y"))&&_(t,"y2",r)},d(a){a&&v(t)}}}function Dt(i,e){let t,n=[],o=new Map,s,r=[],a=new Map,l,f,c,u,d,h,N,b=e[25][e[8](e[25])]||[];const k=m=>m[30];for(let m=0;m<b.length;m+=1){let w=kt(e,b,m),I=k(w);o.set(I,n[m]=zt(I,w))}let y=e[25].areas||[];const p=m=>m[30];for(let m=0;m<y.length;m+=1){let w=wt(e,y,m),I=p(w);a.set(I,r[m]=Mt(I,w))}function g(){return e[19](e[24])}return{key:i,first:null,c(){t=ve();for(let m=0;m<n.length;m+=1)n[m].c();s=ve();for(let m=0;m<r.length;m+=1)r[m].c();l=De("rect"),this.h()},l(m){t=ve();for(let I=0;I<n.length;I+=1)n[I].l(m);s=ve();for(let I=0;I<r.length;I+=1)r[I].l(m);l=Oe(m,"rect",{class:!0,x:!0,y:!0,width:!0,height:!0});var w=z(l);w.forEach(v),this.h()},h(){_(l,"class","minimap-rect svelte-j7o2a0"),_(l,"x",f=e[25].display.x/pe),_(l,"y",c=e[25].display.y/pe),_(l,"width",u=Se(e[24],"width")),_(l,"height",d=Se(e[24],"height")),this.first=t},m(m,w){D(m,t,w);for(let I=0;I<n.length;I+=1)n[I].m(m,w);D(m,s,w);for(let I=0;I<r.length;I+=1)r[I].m(m,w);D(m,l,w),h||(N=[P(l,"mouseleave",e[18]),P(l,"mouseenter",g)],h=!0)},p(m,w){e=m,w[0]&8452&&(b=e[25][e[8](e[25])]||[],n=Me(n,w,k,1,e,b,o,s.parentNode,Ve,zt,s,kt)),w[0]&8196&&(y=e[25].areas||[],r=Me(r,w,p,1,e,y,a,l.parentNode,Ve,Mt,l,wt)),w[0]&4&&f!==(f=e[25].display.x/pe)&&_(l,"x",f),w[0]&4&&c!==(c=e[25].display.y/pe)&&_(l,"y",c),w[0]&4&&u!==(u=Se(e[24],"width"))&&_(l,"width",u),w[0]&4&&d!==(d=Se(e[24],"height"))&&_(l,"height",d)},d(m){m&&v(t);for(let w=0;w<n.length;w+=1)n[w].d(m);m&&v(s);for(let w=0;w<r.length;w+=1)r[w].d(m);m&&v(l),h=!1,Ce(N)}}}function Ot(i){let e,t;return{c(){e=De("text"),t=W(i[6]),this.h()},l(n){e=Oe(n,"text",{x:!0,y:!0,fill:!0,"font-size":!0});var o=z(e);t=K(o,i[6]),o.forEach(v),this.h()},h(){_(e,"x",5),_(e,"y",343),_(e,"fill","#ffffff99"),_(e,"font-size","0.9em")},m(n,o){D(n,e,o),E(e,t)},p(n,o){o[0]&64&&Ge(t,n[6])},d(n){n&&v(e)}}}function Ln(i){let e,t=[],n=new Map,o,s,r=[],a=new Map,l,f,c,u,d,h,N=i[7];const b=m=>m[32];for(let m=0;m<N.length;m+=1){let w=Nt(i,N,m),I=b(w);n.set(I,t[m]=St(I,w))}let k=i[7];const y=m=>m[32];for(let m=0;m<k.length;m+=1){let w=Et(i,k,m),I=y(w);a.set(I,r[m]=It(I,w))}let p=i[0]&&Ct(i),g=i[3]&&Tt(i);return{c(){e=C("div");for(let m=0;m<t.length;m+=1)t[m].c();o=U(),s=De("svg");for(let m=0;m<r.length;m+=1)r[m].c();l=U(),p&&p.c(),f=U(),c=C("div"),g&&g.c(),this.h()},l(m){e=T(m,"DIV",{class:!0});var w=z(e);for(let V=0;V<t.length;V+=1)t[V].l(w);o=L(w),s=Oe(w,"svg",{class:!0});var I=z(s);for(let V=0;V<r.length;V+=1)r[V].l(I);I.forEach(v),l=L(w),p&&p.l(w),w.forEach(v),f=L(m),c=T(m,"DIV",{class:!0});var R=z(c);g&&g.l(R),R.forEach(v),this.h()},h(){_(s,"class","connections-container svelte-j7o2a0"),_(e,"class","node-page svelte-j7o2a0"),_(c,"class","minimap-container svelte-j7o2a0")},m(m,w){D(m,e,w);for(let I=0;I<t.length;I+=1)t[I].m(e,null);E(e,o),E(e,s);for(let I=0;I<r.length;I+=1)r[I].m(s,null);E(e,l),p&&p.m(e,null),D(m,f,w),D(m,c,w),g&&g.m(c,null),u=!0,d||(h=[P(e,"mousedown",i[10]),P(e,"mouseup",i[11]),P(e,"mousemove",i[12]),P(e,"mouseleave",i[11]),P(c,"mousedown",_e(i[15]))],d=!0)},p(m,w){w[0]&144&&(N=m[7],Pe(),t=Me(t,w,b,1,m,N,n,e,st,St,o,Nt),Be()),w[0]&146&&(k=m[7],Pe(),r=Me(r,w,y,1,m,k,a,s,st,It,null,Et),Be()),m[0]?p?(p.p(m,w),w[0]&1&&F(p,1)):(p=Ct(m),p.c(),F(p,1),p.m(e,null)):p&&(Pe(),Q(p,1,1,()=>{p=null}),Be()),m[3]?g?g.p(m,w):(g=Tt(m),g.c(),g.m(c,null)):g&&(g.d(1),g=null)},i(m){if(!u){for(let w=0;w<N.length;w+=1)F(t[w]);for(let w=0;w<k.length;w+=1)F(r[w]);F(p),u=!0}},o(m){for(let w=0;w<t.length;w+=1)Q(t[w]);for(let w=0;w<r.length;w+=1)Q(r[w]);Q(p),u=!1},d(m){m&&v(e);for(let w=0;w<t.length;w+=1)t[w].d();for(let w=0;w<r.length;w+=1)r[w].d();p&&p.d(),m&&v(f),m&&v(c),g&&g.d(),d=!1,Ce(h)}}}let pe=20;function Pn(i){[...document.getElementsByClassName("scene-node-container")].forEach(e=>e.style.zIndex="0"),i.target.firstChild.style.zIndex="1"}function Se(i,e){const t=document.querySelector(`.scene-node-container[key=${i}]`),n=getComputedStyle(t);return Math.floor(+n[e].replace("px","")/pe)}function Bn(i,e,t){let n,o,s,r,a;$(i,oe,A=>t(14,s=A)),$(i,$e,A=>t(23,r=A)),$(i,Qe,A=>t(8,a=A));let l=!1;Bt(()=>{t(3,l=!0)});let{showNewScene:f}=e,c,u={},d,h,N=!1;const b={x:0,y:0};let k;function y(A){const H=document.querySelector(".node-page"),Z=getComputedStyle(H),q=+Z.width.replace("px",""),ne=+Z.height.replace("px",""),B=document.querySelector(".page-container"),ee=getComputedStyle(B),se=+ee.borderWidth.replace("px","")*2,J=+ee.width.replace("px","")-se,ie=+ee.height.replace("px","")-se;t(5,b.x=-A.offsetX*pe+J/2,b),t(5,b.y=-A.offsetY*pe+ie/2,b),t(5,b.x=b.x>0?0:-b.x>q-J?-q+J:b.x,b),t(5,b.y=b.y>0?0:-b.y>ne-ie?-ne+ie:b.y,b),H.style.left=`${b.x}px`,H.style.top=`${b.y}px`}function p(){N=!0,this.style.cursor="grabbing"}function g(){N=!1,this.style.cursor="grab"}function m(A){if(N&&!c){d===void 0&&(d=+getComputedStyle(this).width.replace("px","")),h===void 0&&(h=+getComputedStyle(this).height.replace("px",""));const Z=+getComputedStyle(this.offsetParent).borderWidth.replace("px","")*2,q=+getComputedStyle(this.offsetParent).width.replace("px","")-Z,ne=+getComputedStyle(this.offsetParent).height.replace("px","")-Z;t(5,b.x+=A.movementX,b),t(5,b.y+=A.movementY,b),t(5,b.x=b.x>0?0:q-b.x>d?q-d:b.x,b),t(5,b.y=b.y>0?0:ne-b.y>h?ne-h:b.y,b),this.style.left=`${b.x}px`,this.style.top=`${b.y}px`}t(1,u={x:A.offsetX,y:A.offsetY});let H=A.target;for(;H!==this;)t(1,u.x+=H.offsetLeft,u),t(1,u.y+=H.offsetTop,u),H=H.offsetParent}function w(A,H,Z){const q=H[r(H)],ne=s[q];return ne===void 0?A.display[Z]/pe:ne.display[Z]/pe+(Z==="x"?Se(q,"width")/2:0)}function I(A){ge.call(this,i,A)}function R(A){c=A,t(4,c)}function V(A){f=A,t(0,f)}const Y=()=>{t(6,k=void 0)},x=A=>{t(6,k=A)};return i.$$set=A=>{"showNewScene"in A&&t(0,f=A.showNewScene)},i.$$.update=()=>{i.$$.dirty[0]&16384&&t(7,n=Object.keys(s)),i.$$.dirty[0]&16384&&t(2,o=Object.entries(s)),i.$$.dirty[0]&6&&u&&(t(2,o),t(14,s),t(1,u))},[f,u,o,l,c,b,k,n,a,y,p,g,m,w,s,I,R,V,Y,x]}let Rn=class extends Ee{constructor(e){super(),Ne(this,e,Bn,Ln,we,{showNewScene:0},null,[-1,-1])}};function At(i){let e,t;return e=new Xe({props:{pos:i[2],$$slots:{default:[Vn]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,o){ce(e,n,o),t=!0},p(n,o){const s={};o&1026&&(s.$$scope={dirty:o,ctx:n}),e.$set(s)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function Vn(i){let e,t,n,o,s,r,a;function l(c){i[7](c)}let f={};return i[1]!==void 0&&(f.toggle=i[1]),e=new Ye({props:f}),le.push(()=>ye(e,"toggle",l)),{c(){ae(e.$$.fragment),n=U(),o=C("div"),this.h()},l(c){ue(e.$$.fragment,c),n=L(c),o=T(c,"DIV",{class:!0,id:!0}),z(o).forEach(v),this.h()},h(){_(o,"class","test-story-container svelte-1sigivs"),_(o,"id","test-story-container")},m(c,u){ce(e,c,u),D(c,n,u),D(c,o,u),s=!0,r||(a=Re(i[3].call(null,o)),r=!0)},p(c,u){const d={};!t&&u&2&&(t=!0,d.toggle=c[1],be(()=>t=!1)),e.$set(d)},i(c){s||(F(e.$$.fragment,c),s=!0)},o(c){Q(e.$$.fragment,c),s=!1},d(c){fe(e,c),c&&v(n),c&&v(o),r=!1,a()}}}function Gn(i){let e,t,n,o,s,r,a,l,f,c,u;function d(p){i[4](p)}function h(p){i[5](p)}let N={};i[0]!==void 0&&(N.showNewScene=i[0]),i[1]!==void 0&&(N.showTest=i[1]),t=new en({props:N}),le.push(()=>ye(t,"showNewScene",d)),le.push(()=>ye(t,"showTest",h));function b(p){i[6](p)}let k={};i[0]!==void 0&&(k.showNewScene=i[0]),l=new Rn({props:k}),le.push(()=>ye(l,"showNewScene",b));let y=i[1]&&At(i);return{c(){e=C("div"),ae(t.$$.fragment),s=U(),r=C("div"),a=C("div"),ae(l.$$.fragment),c=U(),y&&y.c(),this.h()},l(p){e=T(p,"DIV",{class:!0});var g=z(e);ue(t.$$.fragment,g),s=L(g),r=T(g,"DIV",{class:!0});var m=z(r);a=T(m,"DIV",{class:!0});var w=z(a);ue(l.$$.fragment,w),w.forEach(v),m.forEach(v),c=L(g),y&&y.l(g),g.forEach(v),this.h()},h(){_(a,"class","page-container svelte-1sigivs"),_(r,"class","static-page-container svelte-1sigivs"),_(e,"class","main-window-container svelte-1sigivs")},m(p,g){D(p,e,g),ce(t,e,null),E(e,s),E(e,r),E(r,a),ce(l,a,null),E(e,c),y&&y.m(e,null),u=!0},p(p,[g]){const m={};!n&&g&1&&(n=!0,m.showNewScene=p[0],be(()=>n=!1)),!o&&g&2&&(o=!0,m.showTest=p[1],be(()=>o=!1)),t.$set(m);const w={};!f&&g&1&&(f=!0,w.showNewScene=p[0],be(()=>f=!1)),l.$set(w),p[1]?y?(y.p(p,g),g&2&&F(y,1)):(y=At(p),y.c(),F(y,1),y.m(e,null)):y&&(Pe(),Q(y,1,1,()=>{y=null}),Be())},i(p){u||(F(t.$$.fragment,p),F(l.$$.fragment,p),F(y),u=!0)},o(p){Q(t.$$.fragment,p),Q(l.$$.fragment,p),Q(y),u=!1},d(p){p&&v(e),fe(t),fe(l),y&&y.d()}}}function Wn(i,e,t){let n,o;$(i,oe,h=>t(8,n=h)),$(i,Gt,h=>t(9,o=h));let s=!1,r=!1,a={x:40,y:40};function l(){console.log(n);const h=document.getElementById("storygeneraldiv");h&&h.remove();const N=new o("es",{adventureSlide:!1,typewriterSpeed:20}),b=Object.entries(n).sort((p,g)=>p[1].display.y-g[1].display.y);if(b.length===0){alert("No hay escenas / There are no scenes");return}N.setScenes(n).startAdventure(b[0][0]);const k=document.getElementById("test-story-container"),y=document.getElementById("storygeneraldiv");k.appendChild(y)}function f(h){s=h,t(0,s)}function c(h){r=h,t(1,r)}function u(h){s=h,t(0,s)}function d(h){r=h,t(1,r)}return[s,r,a,l,f,c,u,d]}class Kn extends Ee{constructor(e){super(),Ne(this,e,Wn,Gn,we,{})}}function Fn(i){let e,t,n,o,s,r,a,l,f,c,u,d,h,N,b;return u=new Kn({}),{c(){e=C("section"),t=C("div"),n=C("h1"),o=W("Aventura interactiva"),s=U(),r=C("span"),a=W("Un editor de historias interactivas para la librería "),l=C("a"),f=W("Aventura.js"),c=U(),ae(u.$$.fragment),d=U(),h=C("footer"),N=W("Sergio Rodríguez Gómez — 2023 — v1.0.0"),this.h()},l(k){e=T(k,"SECTION",{class:!0});var y=z(e);t=T(y,"DIV",{class:!0});var p=z(t);n=T(p,"H1",{class:!0});var g=z(n);o=K(g,"Aventura interactiva"),g.forEach(v),s=L(p),r=T(p,"SPAN",{class:!0});var m=z(r);a=K(m,"Un editor de historias interactivas para la librería "),l=T(m,"A",{href:!0,target:!0,rel:!0,class:!0});var w=z(l);f=K(w,"Aventura.js"),w.forEach(v),m.forEach(v),p.forEach(v),c=L(y),ue(u.$$.fragment,y),d=L(y),h=T(y,"FOOTER",{class:!0});var I=z(h);N=K(I,"Sergio Rodríguez Gómez — 2023 — v1.0.0"),I.forEach(v),y.forEach(v),this.h()},h(){_(n,"class","svelte-18pgm1v"),_(l,"href","https://github.com/srsergiorodriguez/aventura/blob/master/README_es.md"),_(l,"target","_blank"),_(l,"rel","noreferrer"),_(l,"class","svelte-18pgm1v"),_(r,"class","svelte-18pgm1v"),_(t,"class","main-title svelte-18pgm1v"),_(h,"class","no-select svelte-18pgm1v"),_(e,"class","general no-select")},m(k,y){D(k,e,y),E(e,t),E(t,n),E(n,o),E(t,s),E(t,r),E(r,a),E(r,l),E(l,f),E(e,c),ce(u,e,null),E(e,d),E(e,h),E(h,N),b=!0},p:Ie,i(k){b||(F(u.$$.fragment,k),b=!0)},o(k){Q(u.$$.fragment,k),b=!1},d(k){k&&v(e),fe(u)}}}class Xn extends Ee{constructor(e){super(),Ne(this,e,null,Fn,we,{})}}export{Xn as default};
