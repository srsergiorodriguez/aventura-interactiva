import{S as pe,i as me,s as he,F as De,l as N,m as E,n as S,h as p,p as y,b as T,K as we,L as R,M as Ne,G as Ae,H as Be,I as Re,f as G,t as q,N as Ee,O as ke,r as H,u as J,J as v,E as ve,a as U,c as j,P as Ue,Q as te,w as se,x as oe,y as ie,B as re,R as ne,T as le,U as fe,V as be,W as de,v as je,e as Se,g as Te,d as Ce,X as at,Y as Pe,Z as Ve,_ as Je,$ as qe}from"../chunks/index-5968fb5e.js";import{w as ft,r as Oe}from"../chunks/index-57b615c3.js";const Y=ft({inicio:{texto:"\xC9rase una vez un c\xEDrculo...",display:{ops:[],x:346,y:110},opciones:[{btn:"dejar tranquilo",texto:"dejas al c\xEDrculo en paz",escena:"final1"},{btn:"aplastar",text:"...aplastamiento activado...",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{ops:[],x:263,y:289}},final2:{texto:"Parece que la historia form\xF3 una elipsis",sinSalida:!0,display:{ops:[],x:518,y:289}}}),ut=Oe(a=>a.scene===void 0&&a.escena!==void 0?"escena":"scene"),ct=Oe(a=>a.options===void 0&&a.opciones!==void 0?"opciones":"options"),dt=Oe(a=>a.text===void 0&&a.texto!==void 0?"texto":"text"),pt=Oe(a=>a.image===void 0&&a.imagen!==void 0?"imagen":"image");function mt(a){let e,n,t,l;const o=a[5].default,s=De(o,a,a[4],null);return{c(){e=N("div"),s&&s.c(),this.h()},l(r){e=E(r,"DIV",{class:!0});var i=S(e);s&&s.l(i),i.forEach(p),this.h()},h(){y(e,"class","draggui svelte-11g4b1g")},m(r,i){T(r,e,i),s&&s.m(e,null),n=!0,t||(l=[we(a[0].call(null,e)),we(a[1].call(null,e)),R(e,"mousedown",Ne(a[6]))],t=!0)},p(r,[i]){s&&s.p&&(!n||i&16)&&Ae(s,o,r,r[4],n?Re(o,r[4],i,null):Be(r[4]),null)},i(r){n||(G(s,r),n=!0)},o(r){q(s,r),n=!1},d(r){r&&p(e),s&&s.d(r),t=!1,Ee(l)}}}function ht(a,e,n){let{$$slots:t={},$$scope:l}=e,{pos:o}=e,{displace:s={x:o.x,y:o.y}}=e;function r(u){u.style.left=`${s.x}px`,u.style.top=`${s.y}px`}function i(u){let f=!1;u.style.left=`${s.x}px`,u.style.top=`${s.y}px`,u.addEventListener("mousedown",()=>{f=!0}),window.addEventListener("mousemove",d=>{f&&(n(2,s.x+=d.movementX,s),n(2,s.y+=d.movementY,s),u.style.left=`${s.x}px`,u.style.top=`${s.y}px`,u.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{f=!1,u.style.cursor="grab"})}function c(u){ke.call(this,a,u)}return a.$$set=u=>{"pos"in u&&n(3,o=u.pos),"displace"in u&&n(2,s=u.displace),"$$scope"in u&&n(4,l=u.$$scope)},[r,i,s,o,l,t,c]}class Ge extends pe{constructor(e){super(),me(this,e,ht,mt,he,{pos:3,displace:2})}}function gt(a){let e,n,t,l,o;return{c(){e=N("div"),n=N("button"),t=H("X"),this.h()},l(s){e=E(s,"DIV",{class:!0});var r=S(e);n=E(r,"BUTTON",{class:!0});var i=S(n);t=J(i,"X"),i.forEach(p),r.forEach(p),this.h()},h(){y(n,"class","x-button"),y(e,"class","top-bar svelte-15bdkib")},m(s,r){T(s,e,r),v(e,n),v(n,t),l||(o=R(n,"click",a[0]),l=!0)},p:ve,i:ve,o:ve,d(s){s&&p(e),l=!1,o()}}}function _t(a,e,n){let{toggle:t}=e;function l(){n(1,t=!1)}return a.$$set=o=>{"toggle"in o&&n(1,t=o.toggle)},[l,t]}class ze extends pe{constructor(e){super(),me(this,e,_t,gt,he,{toggle:1})}}function Xe(a){let e,n;return{c(){e=N("img"),this.h()},l(t){e=E(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Ue(e.src,n="")||y(e,"src",n),y(e,"alt","Preview"),y(e,"class","img-preview svelte-ekr4m4")},m(t,l){T(t,e,l),a[6](e)},p:ve,d(t){t&&p(e),a[6](null)}}}function vt(a){let e,n,t,l,o,s=a[2]&&Xe(a);return{c(){e=N("input"),n=U(),t=N("div"),s&&s.c(),this.h()},l(r){e=E(r,"INPUT",{type:!0}),n=j(r),t=E(r,"DIV",{class:!0,id:!0});var i=S(t);s&&s.l(i),i.forEach(p),this.h()},h(){y(e,"type","file"),y(t,"class","image-preview-container svelte-ekr4m4"),y(t,"id","image-preview-container")},m(r,i){T(r,e,i),a[5](e),T(r,n,i),T(r,t,i),s&&s.m(t,null),l||(o=R(e,"change",a[3]),l=!0)},p(r,[i]){r[2]?s?s.p(r,i):(s=Xe(r),s.c(),s.m(t,null)):s&&(s.d(1),s=null)},i:ve,o:ve,d(r){r&&p(e),a[5](null),r&&p(n),r&&p(t),s&&s.d(),l=!1,o()}}}function yt(a,e,n){let{imageUrl:t}=e,l,o,s=!1;function r(){const u=l.files[0];if(u){n(2,s=!0);const f=new FileReader;f.addEventListener("load",function(){n(4,t=f.result),o.setAttribute("src",f.result)}),f.readAsDataURL(u);return}n(2,s=!1)}function i(u){te[u?"unshift":"push"](()=>{l=u,n(0,l)})}function c(u){te[u?"unshift":"push"](()=>{o=u,n(1,o)})}return a.$$set=u=>{"imageUrl"in u&&n(4,t=u.imageUrl)},[l,o,s,r,t,i,c]}class bt extends pe{constructor(e){super(),me(this,e,yt,vt,he,{imageUrl:4})}}function wt(a){let e,n,t,l,o,s,r,i,c,u,f,d,g,_,I,P,V,h,m,O,M,L,x,z,K,Z,ae,A,ee,W,w,B,F,b,k,D;function Q(C){a[8](C)}let X={};a[0]!==void 0&&(X.toggle=a[0]),e=new ze({props:X}),te.push(()=>fe(e,"toggle",Q));function ue(C){a[11](C)}let ce={};return a[3]!==void 0&&(ce.imageUrl=a[3]),A=new bt({props:ce}),te.push(()=>fe(A,"imageUrl",ue)),{c(){se(e.$$.fragment),t=U(),l=N("div"),o=N("h1"),s=H(a[1]),r=U(),i=N("div"),c=N("h2"),u=H("Texto"),f=U(),d=N("textarea"),g=U(),_=N("div"),I=N("h2"),P=H("Imagen (opcional)"),V=U(),h=N("div"),m=N("label"),O=H("Url:"),M=U(),L=N("input"),x=H(`
    o
    `),z=N("div"),K=N("span"),Z=H("Archivo:"),ae=U(),se(A.$$.fragment),W=U(),w=N("div"),B=N("button"),F=H("Aceptar"),this.h()},l(C){oe(e.$$.fragment,C),t=j(C),l=E(C,"DIV",{});var $=S(l);o=E($,"H1",{class:!0});var ye=S(o);s=J(ye,a[1]),ye.forEach(p),$.forEach(p),r=j(C),i=E(C,"DIV",{});var _e=S(i);c=E(_e,"H2",{class:!0});var Ie=S(c);u=J(Ie,"Texto"),Ie.forEach(p),f=j(_e),d=E(_e,"TEXTAREA",{class:!0}),S(d).forEach(p),_e.forEach(p),g=j(C),_=E(C,"DIV",{});var ge=S(_);I=E(ge,"H2",{class:!0});var xe=S(I);P=J(xe,"Imagen (opcional)"),xe.forEach(p),V=j(ge),h=E(ge,"DIV",{});var Me=S(h);m=E(Me,"LABEL",{for:!0});var Fe=S(m);O=J(Fe,"Url:"),Fe.forEach(p),M=j(Me),L=E(Me,"INPUT",{id:!0,type:!0}),Me.forEach(p),x=J(ge,`
    o
    `),z=E(ge,"DIV",{});var Le=S(z);K=E(Le,"SPAN",{});var Ke=S(K);Z=J(Ke,"Archivo:"),Ke.forEach(p),ae=j(Le),oe(A.$$.fragment,Le),Le.forEach(p),W=j(ge),w=E(ge,"DIV",{class:!0});var We=S(w);B=E(We,"BUTTON",{});var He=S(B);F=J(He,"Aceptar"),He.forEach(p),We.forEach(p),ge.forEach(p),this.h()},h(){y(o,"class","svelte-2p34te"),y(c,"class","svelte-2p34te"),y(d,"class","svelte-2p34te"),y(I,"class","svelte-2p34te"),y(m,"for","inp"),y(L,"id","inp"),y(L,"type","text"),y(w,"class","bar svelte-2p34te")},m(C,$){ie(e,C,$),T(C,t,$),T(C,l,$),v(l,o),v(o,s),T(C,r,$),T(C,i,$),v(i,c),v(c,u),v(i,f),v(i,d),be(d,a[4]),T(C,g,$),T(C,_,$),v(_,I),v(I,P),v(_,V),v(_,h),v(h,m),v(m,O),v(h,M),v(h,L),be(L,a[3]),v(_,x),v(_,z),v(z,K),v(K,Z),v(z,ae),ie(A,z,null),v(_,W),v(_,w),v(w,B),v(B,F),b=!0,k||(D=[R(d,"input",a[9]),R(d,"mousedown",Ne(a[7])),R(L,"input",a[10]),R(L,"mousedown",Ne(a[6])),R(B,"click",a[5])],k=!0)},p(C,$){const ye={};!n&&$&1&&(n=!0,ye.toggle=C[0],de(()=>n=!1)),e.$set(ye),(!b||$&2)&&je(s,C[1]),$&16&&be(d,C[4]),$&8&&L.value!==C[3]&&be(L,C[3]);const _e={};!ee&&$&8&&(ee=!0,_e.imageUrl=C[3],de(()=>ee=!1)),A.$set(_e)},i(C){b||(G(e.$$.fragment,C),G(A.$$.fragment,C),b=!0)},o(C){q(e.$$.fragment,C),q(A.$$.fragment,C),b=!1},d(C){re(e,C),C&&p(t),C&&p(l),C&&p(r),C&&p(i),C&&p(g),C&&p(_),re(A),k=!1,Ee(D)}}}function kt(a){let e,n;return e=new Ge({props:{pos:a[2],$$slots:{default:[wt]},$$scope:{ctx:a}}}),{c(){se(e.$$.fragment)},l(t){oe(e.$$.fragment,t)},m(t,l){ie(e,t,l),n=!0},p(t,[l]){const o={};l&4&&(o.pos=t[2]),l&32795&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(G(e.$$.fragment,t),n=!0)},o(t){q(e.$$.fragment,t),n=!1},d(t){re(e,t)}}}function Nt(a,e,n){let t,l;ne(a,Y,h=>n(12,l=h));let{key:o}=e,{pos:s}=e,{showEditor:r}=e,i=null,c=l[o];const u=c.text===void 0&&c.texto!==void 0?"texto":"text";function f(){le(Y,l[o][u]=t,l),i!==null&&le(Y,l[o].image=i,l),n(0,r=!1)}function d(h){ke.call(this,a,h)}function g(h){ke.call(this,a,h)}function _(h){r=h,n(0,r)}function I(){t=this.value,n(4,t),n(13,c)}function P(){i=this.value,n(3,i)}function V(h){i=h,n(3,i)}return a.$$set=h=>{"key"in h&&n(1,o=h.key),"pos"in h&&n(2,s=h.pos),"showEditor"in h&&n(0,r=h.showEditor)},a.$$.update=()=>{a.$$.dirty&2&&le(Y,l[o]=c,l)},n(4,t=c[u]),[r,o,s,i,t,f,d,g,_,I,P,V]}class Et extends pe{constructor(e){super(),me(this,e,Nt,kt,he,{key:1,pos:2,showEditor:0})}}function St(a){let e,n,t,l,o,s,r,i,c,u,f,d,g,_,I;function P(h){a[7](h)}let V={};return a[0]!==void 0&&(V.toggle=a[0]),e=new ze({props:V}),te.push(()=>fe(e,"toggle",P)),{c(){se(e.$$.fragment),t=U(),l=N("div"),o=N("label"),s=H("Btn:"),r=U(),i=N("input"),c=U(),u=N("div"),f=N("button"),d=H("Aceptar"),this.h()},l(h){oe(e.$$.fragment,h),t=j(h),l=E(h,"DIV",{});var m=S(l);o=E(m,"LABEL",{for:!0});var O=S(o);s=J(O,"Btn:"),O.forEach(p),r=j(m),i=E(m,"INPUT",{id:!0,type:!0}),m.forEach(p),c=j(h),u=E(h,"DIV",{class:!0});var M=S(u);f=E(M,"BUTTON",{});var L=S(f);d=J(L,"Aceptar"),L.forEach(p),M.forEach(p),this.h()},h(){y(o,"for","inp"),y(i,"id","inp"),y(i,"type","text"),y(u,"class","bar svelte-1bhrmvp")},m(h,m){ie(e,h,m),T(h,t,m),T(h,l,m),v(l,o),v(o,s),v(l,r),v(l,i),be(i,a[2]),T(h,c,m),T(h,u,m),v(u,f),v(f,d),g=!0,_||(I=[R(i,"input",a[8]),R(i,"mousedown",Ne(a[6])),R(f,"click",a[3])],_=!0)},p(h,m){const O={};!n&&m&1&&(n=!0,O.toggle=h[0],de(()=>n=!1)),e.$set(O),m&4&&i.value!==h[2]&&be(i,h[2])},i(h){g||(G(e.$$.fragment,h),g=!0)},o(h){q(e.$$.fragment,h),g=!1},d(h){re(e,h),h&&p(t),h&&p(l),h&&p(c),h&&p(u),_=!1,Ee(I)}}}function It(a){let e,n;return e=new Ge({props:{pos:a[1],$$slots:{default:[St]},$$scope:{ctx:a}}}),{c(){se(e.$$.fragment)},l(t){oe(e.$$.fragment,t)},m(t,l){ie(e,t,l),n=!0},p(t,[l]){const o={};l&2&&(o.pos=t[1]),l&2053&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(G(e.$$.fragment,t),n=!0)},o(t){q(e.$$.fragment,t),n=!1},d(t){re(e,t)}}}function Tt(a,e,n){let t,l;ne(a,Y,_=>n(9,l=_));let{key:o}=e,{pos:s}=e,{showNewOutput:r}=e,i=l[o];const c=i.options===void 0&&i.opciones!==void 0?"opciones":"options";function u(){i[c]===void 0&&n(5,i[c]=[],i),i[c].push({btn:t}),n(0,r=!1),le(Y,l[o][c]=i[c],l)}function f(_){ke.call(this,a,_)}function d(_){r=_,n(0,r)}function g(){t=this.value,n(2,t)}return a.$$set=_=>{"key"in _&&n(4,o=_.key),"pos"in _&&n(1,s=_.pos),"showNewOutput"in _&&n(0,r=_.showNewOutput)},a.$$.update=()=>{a.$$.dirty&48&&le(Y,l[o]=i,l)},n(2,t=""),[r,s,t,u,o,i,f,d,g]}class Ct extends pe{constructor(e){super(),me(this,e,Tt,It,he,{key:4,pos:1,showNewOutput:0})}}function Ot(a){let e,n,t,l;const o=a[5].default,s=De(o,a,a[4],null);return{c(){e=N("div"),s&&s.c(),this.h()},l(r){e=E(r,"DIV",{class:!0});var i=S(e);s&&s.l(i),i.forEach(p),this.h()},h(){y(e,"class","scene-node-container svelte-14kdql5")},m(r,i){T(r,e,i),s&&s.m(e,null),n=!0,t||(l=we(a[0].call(null,e)),t=!0)},p(r,[i]){s&&s.p&&(!n||i&16)&&Ae(s,o,r,r[4],n?Re(o,r[4],i,null):Be(r[4]),null)},i(r){n||(G(s,r),n=!0)},o(r){q(s,r),n=!1},d(r){r&&p(e),s&&s.d(r),t=!1,l()}}}function Mt(a,e,n){let t;ne(a,Y,u=>n(3,t=u));let{$$slots:l={},$$scope:o}=e,{key:s}=e,{movingNode:r=!1}=e,i=t[s];i.display===void 0&&(i.display={x:0,y:0,ops:[]});function c(u){let f=!1;u.style.left=`${i.display.x}px`,u.style.top=`${i.display.y}px`,u.addEventListener("mousedown",()=>{f=!0,n(1,r=!0)}),window.addEventListener("mousemove",d=>{f&&(i.display.x+=d.movementX,i.display.y+=d.movementY,u.style.left=`${i.display.x}px`,u.style.top=`${i.display.y}px`,le(Y,t[s]=i,t))}),window.addEventListener("mouseup",()=>{f=!1,n(1,r=!1)})}return a.$$set=u=>{"key"in u&&n(2,s=u.key),"movingNode"in u&&n(1,r=u.movingNode),"$$scope"in u&&n(4,o=u.$$scope)},a.$$.update=()=>{a.$$.dirty&12&&(i=t[s])},[c,r,s,t,o,l]}class Lt extends pe{constructor(e){super(),me(this,e,Mt,Ot,he,{key:2,movingNode:1})}}function Ye(a,e,n){const t=a.slice();return t[31]=e[n],t[33]=n,t}function Ze(a){let e,n,t,l,o;return{c(){e=N("div"),n=N("img"),this.h()},l(s){e=E(s,"DIV",{class:!0});var r=S(e);n=E(r,"IMG",{src:!0,alt:!0,class:!0}),r.forEach(p),this.h()},h(){Ue(n.src,t=a[2][a[7]])||y(n,"src",t),y(n,"alt","Preview"),y(n,"class","img-preview svelte-1tde7cb"),y(e,"class","img-preview-container svelte-1tde7cb")},m(s,r){T(s,e,r),v(e,n),l||(o=we(a[12].call(null,n)),l=!0)},p(s,r){r[0]&4&&!Ue(n.src,t=s[2][s[7]])&&y(n,"src",t)},d(s){s&&p(e),l=!1,o()}}}function Qe(a){let e,n,t,l,o,s,r,i;return{c(){e=N("div"),n=N("input"),l=U(),o=N("div"),s=U(),this.h()},l(c){e=E(c,"DIV",{class:!0});var u=S(e);n=E(u,"INPUT",{type:!0,class:!0,i:!0}),l=j(u),o=E(u,"DIV",{class:!0,i:!0}),S(o).forEach(p),s=j(u),u.forEach(p),this.h()},h(){y(n,"type","text"),y(n,"class","output-text svelte-1tde7cb"),n.value=t=a[31].btn,y(n,"i",a[33]),y(o,"class","connection output svelte-1tde7cb"),y(o,"i",a[33]),y(e,"class","output-container svelte-1tde7cb")},m(c,u){T(c,e,u),v(e,n),v(e,l),v(e,o),v(e,s),r||(i=[we(a[10].call(null,n)),R(n,"change",a[9]),R(n,"mousedown",Ne(a[20])),we(a[11].call(null,o)),we(a[13].call(null,o)),R(o,"mousedown",Ne(a[19]))],r=!0)},p(c,u){u[0]&4&&t!==(t=c[31].btn)&&n.value!==t&&(n.value=t)},d(c){c&&p(e),r=!1,Ee(i)}}}function Ut(a){let e,n,t,l,o,s,r,i,c=a[2][a[8]].slice(0,30)+"...",u,f,d,g,_,I,P,V,h,m,O,M,L,x,z,K,Z,ae,A=a[2][a[7]]!==void 0&&a[2][a[7]]!==null&&Ze(a),ee=a[2][a[6]]||[],W=[];for(let w=0;w<ee.length;w+=1)W[w]=Qe(Ye(a,ee,w));return{c(){e=N("div"),n=U(),t=N("h1"),l=H("Escena: "),o=H(a[1]),s=U(),A&&A.c(),r=U(),i=N("p"),u=H(c),f=U(),d=N("div"),g=N("button"),_=H("editar"),I=U(),P=N("button"),V=H("x"),h=U(),m=N("button"),O=H("-"),M=U(),L=N("button"),x=H("+"),z=U(),K=N("div");for(let w=0;w<W.length;w+=1)W[w].c();this.h()},l(w){e=E(w,"DIV",{class:!0}),S(e).forEach(p),n=j(w),t=E(w,"H1",{class:!0});var B=S(t);l=J(B,"Escena: "),o=J(B,a[1]),B.forEach(p),s=j(w),A&&A.l(w),r=j(w),i=E(w,"P",{class:!0});var F=S(i);u=J(F,c),F.forEach(p),f=j(w),d=E(w,"DIV",{class:!0});var b=S(d);g=E(b,"BUTTON",{class:!0});var k=S(g);_=J(k,"editar"),k.forEach(p),I=j(b),P=E(b,"BUTTON",{class:!0});var D=S(P);V=J(D,"x"),D.forEach(p),h=j(b),m=E(b,"BUTTON",{class:!0});var Q=S(m);O=J(Q,"-"),Q.forEach(p),M=j(b),L=E(b,"BUTTON",{class:!0});var X=S(L);x=J(X,"+"),X.forEach(p),b.forEach(p),z=j(w),K=E(w,"DIV",{class:!0});var ue=S(K);for(let ce=0;ce<W.length;ce+=1)W[ce].l(ue);ue.forEach(p),this.h()},h(){y(e,"class","connection input svelte-1tde7cb"),y(t,"class","svelte-1tde7cb"),y(i,"class","text-p svelte-1tde7cb"),y(g,"class","svelte-1tde7cb"),y(P,"class","svelte-1tde7cb"),y(m,"class","svelte-1tde7cb"),y(L,"class","svelte-1tde7cb"),y(d,"class","node-btns svelte-1tde7cb"),y(K,"class","node-outputs svelte-1tde7cb")},m(w,B){T(w,e,B),T(w,n,B),T(w,t,B),v(t,l),v(t,o),T(w,s,B),A&&A.m(w,B),T(w,r,B),T(w,i,B),v(i,u),T(w,f,B),T(w,d,B),v(d,g),v(g,_),v(d,I),v(d,P),v(P,V),v(d,h),v(d,m),v(m,O),v(d,M),v(d,L),v(L,x),T(w,z,B),T(w,K,B);for(let F=0;F<W.length;F+=1)W[F].m(K,null);a[22](K),Z||(ae=[R(e,"mousedown",Ne(a[21])),R(e,"click",a[14]),R(g,"click",a[16]),R(P,"click",Dt),R(m,"click",a[15]),R(L,"click",a[17])],Z=!0)},p(w,B){if(B[0]&2&&je(o,w[1]),w[2][w[7]]!==void 0&&w[2][w[7]]!==null?A?A.p(w,B):(A=Ze(w),A.c(),A.m(r.parentNode,r)):A&&(A.d(1),A=null),B[0]&4&&c!==(c=w[2][w[8]].slice(0,30)+"...")&&je(u,c),B[0]&580){ee=w[2][w[6]]||[];let F;for(F=0;F<ee.length;F+=1){const b=Ye(w,ee,F);W[F]?W[F].p(b,B):(W[F]=Qe(b),W[F].c(),W[F].m(K,null))}for(;F<W.length;F+=1)W[F].d(1);W.length=ee.length}},d(w){w&&p(e),w&&p(n),w&&p(t),w&&p(s),A&&A.d(w),w&&p(r),w&&p(i),w&&p(f),w&&p(d),w&&p(z),w&&p(K),at(W,w),a[22](null),Z=!1,Ee(ae)}}}function $e(a){let e,n,t;function l(s){a[24](s)}let o={key:a[1],pos:a[2].display};return a[4]!==void 0&&(o.showEditor=a[4]),e=new Et({props:o}),te.push(()=>fe(e,"showEditor",l)),{c(){se(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,r){ie(e,s,r),t=!0},p(s,r){const i={};r[0]&2&&(i.key=s[1]),r[0]&4&&(i.pos=s[2].display),!n&&r[0]&16&&(n=!0,i.showEditor=s[4],de(()=>n=!1)),e.$set(i)},i(s){t||(G(e.$$.fragment,s),t=!0)},o(s){q(e.$$.fragment,s),t=!1},d(s){re(e,s)}}}function et(a){let e,n,t;function l(s){a[25](s)}let o={key:a[1],pos:a[2].display};return a[5]!==void 0&&(o.showNewOutput=a[5]),e=new Ct({props:o}),te.push(()=>fe(e,"showNewOutput",l)),{c(){se(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,r){ie(e,s,r),t=!0},p(s,r){const i={};r[0]&2&&(i.key=s[1]),r[0]&4&&(i.pos=s[2].display),!n&&r[0]&32&&(n=!0,i.showNewOutput=s[5],de(()=>n=!1)),e.$set(i)},i(s){t||(G(e.$$.fragment,s),t=!0)},o(s){q(e.$$.fragment,s),t=!1},d(s){re(e,s)}}}function jt(a){let e,n,t,l,o,s;function r(f){a[23](f)}let i={key:a[1],$$slots:{default:[Ut]},$$scope:{ctx:a}};a[0]!==void 0&&(i.movingNode=a[0]),e=new Lt({props:i}),te.push(()=>fe(e,"movingNode",r));let c=a[4]&&$e(a),u=a[5]&&et(a);return{c(){se(e.$$.fragment),t=U(),c&&c.c(),l=U(),u&&u.c(),o=Se()},l(f){oe(e.$$.fragment,f),t=j(f),c&&c.l(f),l=j(f),u&&u.l(f),o=Se()},m(f,d){ie(e,f,d),T(f,t,d),c&&c.m(f,d),T(f,l,d),u&&u.m(f,d),T(f,o,d),s=!0},p(f,d){const g={};d[0]&2&&(g.key=f[1]),d[0]&14|d[1]&8&&(g.$$scope={dirty:d,ctx:f}),!n&&d[0]&1&&(n=!0,g.movingNode=f[0],de(()=>n=!1)),e.$set(g),f[4]?c?(c.p(f,d),d[0]&16&&G(c,1)):(c=$e(f),c.c(),G(c,1),c.m(l.parentNode,l)):c&&(Te(),q(c,1,1,()=>{c=null}),Ce()),f[5]?u?(u.p(f,d),d[0]&32&&G(u,1)):(u=et(f),u.c(),G(u,1),u.m(o.parentNode,o)):u&&(Te(),q(u,1,1,()=>{u=null}),Ce())},i(f){s||(G(e.$$.fragment,f),G(c),G(u),s=!0)},o(f){q(e.$$.fragment,f),q(c),q(u),s=!1},d(f){re(e,f),f&&p(t),c&&c.d(f),f&&p(l),u&&u.d(f),f&&p(o)}}}function Dt(){}function At(a,e,n){let t,l,o,s,r;ne(a,Y,b=>n(18,t=b)),ne(a,ut,b=>n(26,l=b)),ne(a,ct,b=>n(27,o=b)),ne(a,dt,b=>n(28,s=b)),ne(a,pt,b=>n(29,r=b));let{key:i}=e,{movingNode:c=!1}=e,u=t[i];const f=o(u),d=r(u),g=s(u);let _,I=!1,P=!1;u.display===void 0&&(u.display={x:0,y:0,ops:[]});function V(){h(this)}function h(b){const k=+b.getAttribute("i");b.style.width=b.value.length*6.1+"px",n(2,u[f][k].btn=b.value,u),O()}function m(b){const k=+b.getAttribute("i");u.display.ops[k]===void 0?n(2,u.display.ops[k]={x:b.offsetLeft,y:b.offsetTop,rewiring:!1},u):Object.assign(u.display.ops[k],{x:b.offsetLeft,y:b.offsetTop}),le(Y,t[i]=u,t)}function O(){if(_===void 0)return;const b=_.getElementsByClassName("output");for(let k of b)m(k)}function M(){const b=Object.keys(t);for(let k of b){const D=t[k],Q=o(D);for(let X=0;X<D.display.ops.length;X++){const ue=l(D[Q][X]);D.display.ops[X].rewiring&&(D.display.ops[X].rewiring=!1,D[Q][X][ue]=D.display.ops[X].prevWiring)}le(Y,t[k]=D,t)}}function L(b){const k=+b.getAttribute("i");b.addEventListener("click",()=>{M();const D=l(u[f][k]);u.display.ops[k].rewiring||(n(2,u.display.ops[k].prevWiring=u[f][k][D],u),n(2,u.display.ops[k].rewiring=!0,u),n(2,u[f][k][D]=void 0,u))})}function x(){const b=Object.keys(t);let k;for(let X of b){const ue=t[X];let ce=0;for(let C of ue.display.ops)C.rewiring&&(C.rewiring=!1,k={scene:ue,i:ce}),ce++}if(k===void 0)return;const D=o(k.scene),Q=l(k.scene[D][k.i]);k.scene[D][k.i][Q]=i}function z(){u[f]!==void 0&&(u[f].pop(),u.display.ops.pop(),le(Y,t[i][f]=u[f],t))}function K(){n(4,I=!0)}function Z(){n(5,P=!0)}function ae(b){ke.call(this,a,b)}function A(b){ke.call(this,a,b)}function ee(b){ke.call(this,a,b)}function W(b){te[b?"unshift":"push"](()=>{_=b,n(3,_)})}function w(b){c=b,n(0,c)}function B(b){I=b,n(4,I)}function F(b){P=b,n(5,P)}return a.$$set=b=>{"key"in b&&n(1,i=b.key),"movingNode"in b&&n(0,c=b.movingNode)},a.$$.update=()=>{a.$$.dirty[0]&262146&&n(2,u=t[i]),a.$$.dirty[0]&4&&O(u[d])},[c,i,u,_,I,P,f,d,g,V,h,m,O,L,x,z,K,Z,t,ae,A,ee,W,w,B,F]}class Bt extends pe{constructor(e){super(),me(this,e,At,jt,he,{key:1,movingNode:0},null,[-1,-1])}}function tt(a,e,n){const t=a.slice();return t[5]=e[n],t[7]=n,t}function nt(a){let e,n,t,l,o;return{c(){e=Pe("line"),this.h()},l(s){e=Ve(s,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0}),S(e).forEach(p),this.h()},h(){y(e,"class","node-connection svelte-nz6q29"),y(e,"x1",n=a[0].display.x+a[5].x+5),y(e,"y1",t=a[0].display.y+a[5].y+10),y(e,"x2",l=a[1][a[7]].x+5),y(e,"y2",o=a[1][a[7]].y+5)},m(s,r){T(s,e,r)},p(s,r){r&1&&n!==(n=s[0].display.x+s[5].x+5)&&y(e,"x1",n),r&1&&t!==(t=s[0].display.y+s[5].y+10)&&y(e,"y1",t),r&2&&l!==(l=s[1][s[7]].x+5)&&y(e,"x2",l),r&2&&o!==(o=s[1][s[7]].y+5)&&y(e,"y2",o)},d(s){s&&p(e)}}}function Rt(a){let e,n=a[0].display.ops||[],t=[];for(let l=0;l<n.length;l+=1)t[l]=nt(tt(a,n,l));return{c(){e=Pe("g");for(let l=0;l<t.length;l+=1)t[l].c()},l(l){e=Ve(l,"g",{});var o=S(e);for(let s=0;s<t.length;s+=1)t[s].l(o);o.forEach(p)},m(l,o){T(l,e,o);for(let s=0;s<t.length;s+=1)t[s].m(e,null)},p(l,[o]){if(o&3){n=l[0].display.ops||[];let s;for(s=0;s<n.length;s+=1){const r=tt(l,n,s);t[s]?t[s].p(r,o):(t[s]=nt(r),t[s].c(),t[s].m(e,null))}for(;s<t.length;s+=1)t[s].d(1);t.length=n.length}},i:ve,o:ve,d(l){l&&p(e),at(t,l)}}}function Pt(a,e,n){let t,l;ne(a,Y,i=>n(4,l=i));let{key:o}=e,{mouse:s}=e,r=l[o];return a.$$set=i=>{"key"in i&&n(2,o=i.key),"mouse"in i&&n(3,s=i.mouse)},a.$$.update=()=>{a.$$.dirty&20&&n(0,r=l[o]),a.$$.dirty&25&&n(1,t=(r.options||r.opciones||[]).map((i,c)=>{const u=i.escena||i.scene;return u===void 0?r.display.ops[c].rewiring?s:r.display:l[u].display}))},[r,t,o,s,l]}class Vt extends pe{constructor(e){super(),me(this,e,Pt,Rt,he,{key:2,mouse:3})}}function Gt(a){let e,n,t,l,o,s,r,i,c,u,f,d,g,_,I;function P(h){a[7](h)}let V={};return a[0]!==void 0&&(V.toggle=a[0]),e=new ze({props:V}),te.push(()=>fe(e,"toggle",P)),{c(){se(e.$$.fragment),t=U(),l=N("div"),o=N("label"),s=H("Escena:"),r=U(),i=N("input"),c=U(),u=N("div"),f=N("button"),d=H("Aceptar"),this.h()},l(h){oe(e.$$.fragment,h),t=j(h),l=E(h,"DIV",{});var m=S(l);o=E(m,"LABEL",{for:!0});var O=S(o);s=J(O,"Escena:"),O.forEach(p),r=j(m),i=E(m,"INPUT",{id:!0,type:!0}),m.forEach(p),c=j(h),u=E(h,"DIV",{class:!0});var M=S(u);f=E(M,"BUTTON",{});var L=S(f);d=J(L,"Aceptar"),L.forEach(p),M.forEach(p),this.h()},h(){y(o,"for","inp"),y(i,"id","inp"),y(i,"type","text"),y(u,"class","bar svelte-1bhrmvp")},m(h,m){ie(e,h,m),T(h,t,m),T(h,l,m),v(l,o),v(o,s),v(l,r),v(l,i),be(i,a[2]),T(h,c,m),T(h,u,m),v(u,f),v(f,d),g=!0,_||(I=[R(i,"input",a[8]),R(i,"mousedown",Ne(a[6])),R(f,"click",a[4])],_=!0)},p(h,m){const O={};!n&&m&1&&(n=!0,O.toggle=h[0],de(()=>n=!1)),e.$set(O),m&4&&i.value!==h[2]&&be(i,h[2])},i(h){g||(G(e.$$.fragment,h),g=!0)},o(h){q(e.$$.fragment,h),g=!1},d(h){re(e,h),h&&p(t),h&&p(l),h&&p(c),h&&p(u),_=!1,Ee(I)}}}function zt(a){let e,n,t;function l(s){a[9](s)}let o={pos:a[3],$$slots:{default:[Gt]},$$scope:{ctx:a}};return a[1]!==void 0&&(o.displace=a[1]),e=new Ge({props:o}),te.push(()=>fe(e,"displace",l)),{c(){se(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,r){ie(e,s,r),t=!0},p(s,[r]){const i={};r&4101&&(i.$$scope={dirty:r,ctx:s}),!n&&r&2&&(n=!0,i.displace=s[1],de(()=>n=!1)),e.$set(i)},i(s){t||(G(e.$$.fragment,s),t=!0)},o(s){q(e.$$.fragment,s),t=!1},d(s){re(e,s)}}}function xt(a){const e=["\xE1","\xE9","\xED","\xF3","\xFA","\xFC","\xF1"],n=["a","e","i","o","u","u","n"],t=a.toLowerCase();let l="";for(let o=0;o<a.length;o++){const s=t.charAt(o),r=a.charAt(o);if(e.includes(s)){let i;for(let c=0;c<e.length;c++)if(e[c]===s){i=c;break}r===r.toUpperCase()?l+=n[i].toUpperCase():l+=n[i]}else l+=r}return l}function Ft(a,e,n){let t,l;ne(a,Y,I=>n(11,l=I));let{showNewScene:o}=e,{offset:s}=e,r=l,i={x:s.x*-1+20,y:s.y*-1+20},c;function u(){if(/^\d/.test(t)===!0){alert(`El nombre de la escena no puede empezar con un n\xFAmero /
The name of the scene cannot start with a number`);return}let I=t.replace(/\s/gi,"_").replace(/\W/,"").replace(/[;.,:{}()<>$%&!¡?¿"'/\\#@&*+-=~^]/gi,"");I=xt(I),r[I]={text:"",display:{x:i.x,y:i.y,ops:[]}},le(Y,l[I]=r[I],l),n(0,o=!1)}function f(I){ke.call(this,a,I)}function d(I){o=I,n(0,o)}function g(){t=this.value,n(2,t)}function _(I){c=I,n(1,c)}return a.$$set=I=>{"showNewScene"in I&&n(0,o=I.showNewScene),"offset"in I&&n(5,s=I.offset)},n(2,t=""),[o,c,t,i,u,s,f,d,g,_]}class Kt extends pe{constructor(e){super(),me(this,e,Ft,zt,he,{showNewScene:0,offset:5})}}function st(a){let e,n,t;function l(s){a[10](s)}let o={offset:a[1]};return a[0]!==void 0&&(o.showNewScene=a[0]),e=new Kt({props:o}),te.push(()=>fe(e,"showNewScene",l)),{c(){se(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,r){ie(e,s,r),t=!0},p(s,r){const i={};r&2&&(i.offset=s[1]),!n&&r&1&&(n=!0,i.showNewScene=s[0],de(()=>n=!1)),e.$set(i)},i(s){t||(G(e.$$.fragment,s),t=!0)},o(s){q(e.$$.fragment,s),t=!1},d(s){re(e,s)}}}function Wt(a){let e,n,t,l,o;const s=a[9].default,r=De(s,a,a[8],null);let i=a[0]&&st(a);return{c(){e=N("div"),r&&r.c(),n=U(),i&&i.c(),this.h()},l(c){e=E(c,"DIV",{class:!0});var u=S(e);r&&r.l(u),n=j(u),i&&i.l(u),u.forEach(p),this.h()},h(){y(e,"class","node-page svelte-147bzl")},m(c,u){T(c,e,u),r&&r.m(e,null),v(e,n),i&&i.m(e,null),t=!0,l||(o=[we(a[2].call(null,e)),R(e,"mousedown",a[3]),R(e,"mouseup",a[4]),R(e,"mousemove",a[5])],l=!0)},p(c,[u]){r&&r.p&&(!t||u&256)&&Ae(r,s,c,c[8],t?Re(s,c[8],u,null):Be(c[8]),null),c[0]?i?(i.p(c,u),u&1&&G(i,1)):(i=st(c),i.c(),G(i,1),i.m(e,null)):i&&(Te(),q(i,1,1,()=>{i=null}),Ce())},i(c){t||(G(r,c),G(i),t=!0)},o(c){q(r,c),q(i),t=!1},d(c){c&&p(e),r&&r.d(c),i&&i.d(),l=!1,Ee(o)}}}function Ht(a,e,n){let t,l,o;ne(a,Y,m=>n(12,t=m)),ne(a,ut,m=>n(13,l=m)),ne(a,ct,m=>n(14,o=m));let{$$slots:s={},$$scope:r}=e,{movingNode:i}=e,{mouse:c}=e,{showNewScene:u}=e,f=!1;const d={x:0,y:0};function g(m){m.style.left=`${d.x}px`,m.style.top=`${d.y}px`}function _(){const m=Object.keys(t);for(let O of m){const M=t[O],L=o(M);for(let x=0;x<M.display.ops.length;x++){const z=l(M[L][x]);M.display.ops[x].rewiring&&(M.display.ops[x].rewiring=!1,M[L][x][z]=M.display.ops[x].prevWiring)}le(Y,t[O]=M,t)}}function I(){f=!0,this.style.cursor="grabbing",_()}function P(){f=!1,this.style.cursor="grab"}function V(m){if(f&&!i){const M=+getComputedStyle(this.offsetParent).width.replace("px",""),L=+getComputedStyle(this).width.replace("px",""),x=+getComputedStyle(this.offsetParent).height.replace("px",""),z=+getComputedStyle(this).height.replace("px","");n(1,d.x+=m.movementX,d),n(1,d.y+=m.movementY,d),n(1,d.x=d.x>0?0:M-d.x>L?M-L:d.x,d),n(1,d.y=d.y>0?0:x-d.y>z?x-z:d.y,d),this.style.left=`${d.x}px`,this.style.top=`${d.y}px`}n(6,c={x:m.offsetX,y:m.offsetY});let O=m.target;for(;O!==this;)n(6,c.x+=O.offsetLeft,c),n(6,c.y+=O.offsetTop,c),O=O.offsetParent}function h(m){u=m,n(0,u)}return a.$$set=m=>{"movingNode"in m&&n(7,i=m.movingNode),"mouse"in m&&n(6,c=m.mouse),"showNewScene"in m&&n(0,u=m.showNewScene),"$$scope"in m&&n(8,r=m.$$scope)},[u,d,g,I,P,V,c,i,r,s,h]}class Jt extends pe{constructor(e){super(),me(this,e,Ht,Wt,he,{movingNode:7,mouse:6,showNewScene:0})}}class qt{constructor(e="en",n){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,igramaFormat:"png",minigifOptions:{},sceneCallback:t=>t},n&&(this.options=Object.assign(this.options,n)),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[n,t]of Object.entries(e.grammar));return this}setScenes(e){this.scenes=e;for(let n of Object.keys(e)){this.scenes[n].key=n;const t=this.scenes[n].image||this.scenes[n].imagen;t!==void 0&&this.storyPreload[t]===void 0&&(this.storyPreload[t]=new Image,this.storyPreload[t].src=t,this.storyPreload[t].className="storyimage")}return this}setMarkov(e){return this.markov=e,this}expandGrammar(e){const n=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(n)}expandIgrama(e){const n=this.igrama.grammar,t=this.selectGrammarRule(n[e]);return this.grammarRuleRecursion(t,n).split("|").map(o=>this.decodeDrawing(o))}grammarRuleRecursion(e,n){let t=n||this.grammar,l=this.setNewRules(e);const o=l.match(/<[\w\d.,/#]+>/gi);if(!o)return l;for(let s of o){const r=this.defineTransformations(s);l=l.replace(s,()=>{s=s.replace(/[<>]/gi,""),s=s.replace(/#[\w\d.,/]+#/g,"");const i=s.search(/[.]/)>-1?this.getNestedObject(t,s.match(/[\w\d]+/g)):t[s];if(!i){const u=this.lang==="es"?`Se intent\xF3 expandir desde la regla "${s}", pero no se pudo encontrar`:`Tried to expand from rule "${s}", but couldn't find it`;console.error(u)}const c=this.selectGrammarRule(i);return this.transformString(c,r)})}return this.grammarRuleRecursion(l,t)}setNewRules(e,n){let t;n===void 0?t=this.grammar:t=n;let l=e;const o=l.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(o)for(;o.length;){const s=o.pop();l=l.replace(s,"");const{symbol:r,pairsString:i}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(s).groups,c=i.match(/[-]?[\w\d]+:[\w\d]+/gi).map(u=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(u).groups);if(c){t[r]=t[r]||{};for(let u of c){const f=t[u.value];if(!f){const _=this.lang==="es"?`Se intent\xF3 crear la nueva regla "${r}", pero no se pudo encontrar "${u.value}" para producir la subregla "${u.key}"`:`Tried to create new rule: "${r}", but couldn't find "${u.value}" to produce "${u.key}" subrule`;console.error(_)}const d=u.remove==="-",g=this.selectGrammarRule(f);if(d){const _=f.indexOf(g);t[u.value]=[...f.slice(0,_),...f.slice(_+1)]}t[r][u.key]=[g]}}}return l}startAdventure(e){this.options.defaultCSS&&this.setCSS();const n=document.createElement("div");return n.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(n),this.goToScene(this.scenes[e]),this}goToScene(e){const n=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(i=>i.remove()),[...document.getElementsByClassName("storyimage-area")].map(r=>r.remove());const l=document.createElement("div");if(l.className="storydiv",n.appendChild(l),e.image||e.imagen){const r=document.createElement("div");r.className="storyimage-container",l.appendChild(r);const i=e.image||e.imagen,c=this.options.adventureScroll?this.storyPreload[i].cloneNode():this.storyPreload[i];r.appendChild(c),e.areas&&(c.complete?this.setAreas(c,r,e.areas):c.onload=()=>{this.setAreas(c,r,e.areas)})}else if(e.igrama!==void 0){const r=document.createElement("div");r.className="storyimage-container",l.appendChild(r);const i=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(i),this.igramaDataUrl(i,this.options.igramaFormat).then(c=>{const u=new Image;u.src=c,u.className="storyimage",r.appendChild(u)})}const o=document.createElement("div");o.className="storyp-container",(e.text||e.texto||e.igramaText)&&l.appendChild(o);const s=document.createElement("p");s.className="storyp",s.innerHTML="",o.appendChild(s),document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(s,e),this.options.sceneCallback(e)}setAreas(e,n,t){const l=e.getBoundingClientRect(),o=n.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,n,t)},[...document.getElementsByClassName("storyimage-area")].map(r=>r.remove());for(let r of t){let i=document.createElement("div");i.className="storyimage-area";const c=(r.x-Math.floor(r.w/2))*l.width/e.naturalWidth;i.style.left=`${l.left-o.left+c}px`;const u=(r.y-Math.floor(r.h/2))*l.height/e.naturalHeight;i.style.top=`${l.top-o.top+u}px`,i.style.width=`${r.w*l.width/e.naturalWidth}px`,i.style.height=`${r.h*l.height/e.naturalHeight}px`,i.innerHTML=r.btn||"",n.appendChild(i),i.style.fontSize=`${18*l.height/e.naturalHeight}px`,i.onclick=()=>{const f=r.scene||r.escena;this.goToScene(this.scenes[f])},r.tooltip!==void 0&&(i.onmouseover=()=>{i.innerHTML=r.tooltip||"",i.style.zIndex="100"},i.onmouseout=()=>{i.innerHTML=r.btn||"",i.style.zIndex="0"})}}typewriter(e,n){const t=n.text||n.texto||n.igramaText||"";let l=this.grammar?this.grammarRuleRecursion(t):t;if(l=l.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let o=0;const s=setInterval(()=>{const r=l.substring(0,o);e.innerHTML=r,o++,o>l.length&&(clearInterval(s),this.optionButtons(n))},Math.floor(this.options.typewriterSpeed))}else e.innerHTML=l,this.optionButtons(n)}optionButtons(e){const n=[...document.getElementsByClassName("storydiv")],t=n[n.length-1];[...document.getElementsByClassName("storybutton-container")].map(s=>s.remove());const o=document.createElement("div");if(o.className="storybutton-container",t.appendChild(o),e.options||e.opciones){const s=e.options||e.opciones;for(let r of s){const i=document.createElement("button");i.className="storybutton",i.innerHTML=r.btn,o.appendChild(i),i.addEventListener("click",()=>{if((r.text||r.texto)===void 0){const u=r.scene||r.escena;this.goToScene(this.scenes[u])}else this.goToScene(r)})}}else if(e.scene||e.escena){const s=e.scene||e.escena,r=document.createElement("button");r.className="storybutton",r.innerHTML=this.lang==="en"?"Continue":"Continuar",o.appendChild(r),r.addEventListener("click",()=>{this.goToScene(this.scenes[s])})}document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const l=Math.random()*e.prob.reduce((s,r)=>s+r);let o=0;for(let s=0;s<e.prob.length;s++){if(o<=l&&l<o+e.prob[s])return e[s];o+=e.prob[s]}}const n=Math.floor(Math.random()*e.length);return e[n]}getNestedObject(e,n){return n.reduce((t,l)=>t&&t[l]!==void 0?t[l]:void 0,e)}defineTransformations(e){let n={};const t=/#(?<trans>[\w\d,]+)#/gi.exec(e),l=t?t.groups.trans.match(/[\w]+/gi):[];for(let o of l)n[o]=!0;return n}transformString(e,n){let t=e;return n.CAPITALIZE&&(t=t.charAt(0).toUpperCase()+t.slice(1)),n.ALLCAPS&&(t=t.toUpperCase()),t}decodeDrawing(e){if(e==="")return[];const[n,t,l]=e.split("%%");let o={};return n==="vector"?o.content=t.split("**").map(s=>{const[r,i,c]=s.split("&"),u=[];if(u.color=r,u.weight=i,c===void 0)return u;const f=c.split(",");for(let d=0;d<f.length;d+=2)u.push([+f[d],+f[d+1]]);return u}):o.content=t,o.attribute=l,o.type=n,o}async getMarkovModel(e,n=1,t=!1){let l=await(await fetch(`./${e}`)).text();l=l.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const o=l.split(this.markovSeparator),s={};for(let i=0;i<o.length-n;i++){let c="";for(let f=0;f<n;f++)c+=f===0?o[i+f]:" "+o[i+f];s[c]===void 0&&(s[c]={});const u=o[i+n];s[c][u]===void 0?s[c][u]=1:s[c][u]++}const r={};for(let i of Object.keys(s)){const c=Object.keys(s[i]);r[i]={probs:[],grams:c};let u=0;for(let f=0;f<c.length;f++)u+=s[i][c[f]];for(let f=0;f<c.length;f++)r[i].probs[f]=s[i][c[f]]/u}if(t){const i=e.split("/");this.saveJSON(r,`${i[i.length-1]}_markovModel_${n}N.json`)}return r}markovChain(e,n,t=.1){let l=n===void 0||this.markov[n]===void 0?this.randomMarkovWord():n,o=l;for(let r=0;r<e-1;r++){let i=this.getNextMarkov(this.markov[o]);i===void 0&&(i=this.getNextMarkov(this.randomMarkovWord()));let c=o.split(this.markovSeparator);c.push(i),c=c.slice(1).join(" "),o=c,l+=` ${i}`}return this.formatMarkov(l,t)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const n=Math.random();let t=0;if(e!==void 0)for(let l=0;l<e.probs.length;l++){if(t<=n&&n<t+e.probs[l])return e.grams[l];t+=e.probs[l]}}formatMarkov(e,n=.1){let t=e.replace(/ ([,:.;])/g,"$1");return t=t.replaceAll(/([.]) ([\wáéíóú])/ig,(l,o,s,r,i)=>Math.random()<n?`.
${s.toUpperCase()}`:`. ${s.toUpperCase()}`),t.charAt(0).toUpperCase()+t.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,n){const t=document.createElement("a");t.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),t.setAttribute("download",`${n.includes(".json")?n:n+".json"}`),document.body.appendChild(t),t.click(),document.body.removeChild(t)}testScenes(e){const n=e||this.scenes;if(!n){const l=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(l)}let t=[];for(let l of Object.keys(n)){const o=n[l];if(o.options||o.opciones){const r=(o.options||o.opciones).filter(i=>!n[i.scene||i.escena]);t=[...t,...r.map(i=>`${l} => ${i.btn} => ${i.scene||i.escena}`)]}else{if(o.deadEnd||o.sinSalida)continue;n[o.scene||o.escena]||t.push(`${l} => ${o.scene||o.escena}`)}}if(t.length>0){const l=this.lang==="es"?`Las siguientes escenas no llevan a ning\xFAn lado: ${t.join(", ")}`:`The following scenes are dead ends: ${t.join(", ")}`;console.error(l),this.scenesError=!0}return this}testGrammar(e){const n=e||this.grammar;if(!n){const t=this.lang==="es"?"No hay gram\xE1tica para probar":"There is not grammar to test";console.error(t)}for(let t of Object.keys(n)){const l=n[t];for(let o of l){const s=o.match(/<([\w\d]+)>/gi),r=s?s.map(f=>f.replace(/[<>]/g,"")):[],i=o.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),c=i?i.map(f=>f.match(/([ ]?:[\w\d]+)/g).map(d=>/[ ]?:(?<key>[\w\d]+)/.exec(d).groups.key)).reduce((f,d)=>[...f,...d],[]):[],u=[...r,...c].filter(f=>!n[f]);if(u.length>0){const f=this.lang==="es"?`Las siguientes reglas, que se referencian en "${t}", no existen: ${u.join(", ")}`:`The following rules, referenced in "${t}", do not exist: ${u.join(", ")}`;this.grammarError=!0,console.error(f)}}}return this}testDistribution(e){const n=e||this.markov;if(n===void 0){const c=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(c)}const t={},l={};let o=0;const s=Object.values(n);for(let c of s)for(let u of c.probs){const f=(Math.round(u/.05)*.05).toFixed(2);l[o]=f,o++,t[f]===void 0?t[f]=1:t[f]++}console.log("------------------------------------ DIST ------------------------------------");const r=Math.max(...Object.values(t)),i=Object.entries(t).sort((c,u)=>c[0]>u[0]?1:c[0]<u[0]?-1:0);for(let c of i)console.log(`${c[0]}... ${"|".repeat(Math.ceil(c[1]*100/r))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,n="png",t){const l=await this.igramaDataUrl(e,n),o=new Image;o.src=l,t==null?document.body.appendChild(o):document.getElementById(t).appendChild(o)}async igramaDataUrl(e,n="png"){const t=this.igrama.metadata.width,l=this.igrama.metadata.height;let o=document.createElement("canvas");o.width=t,o.height=l;const s=o.getContext("2d");s.lineJoin="round",s.lineCap="round",s.fillStyle=this.igrama.metadata.bg||"#FFFFFF",s.fillRect(0,0,t,l),await this.drawLayers(e,s);let r;if(n==="png")r=o.toDataURL();else if(n==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener tambi\xE9n la librer\xEDa MiniGif":"To create Gifs you must have also the MiniGif library"),"";const i={colorResolution:7,dither:!1,delay:50};Object.assign(i,this.minigifOptions);const c=new MiniGif(i);c.addFrame(o);const u=this.getLayerWiggle(e);s.fillStyle=this.igrama.metadata.bg||"#FFFFFF",s.fillRect(0,0,t,l),await this.drawLayers(u,s),c.addFrame(o);const f=c.makeGif(),d=await this.base64_arraybuffer(f);r="data:image/gif;base64,"+d}return o.remove(),r}async base64_arraybuffer(e){return(await new Promise(t=>{const l=new FileReader;l.onload=()=>t(l.result),l.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const t=JSON.parse(JSON.stringify(e)),l=(o,s)=>Math.floor(o+Math.random()*(s-o));for(let[o,s]of t.entries())if(s.type==="vector")for(let[r,i]of s.content.entries()){for(let[c,u]of i.entries())Math.random()<.5?u[0]+=l(-3,3):u[1]+=l(-3,3);i.color=e[o].content[r].color,i.weight=e[o].content[r].weight}return t}getIgramaText(e){return e.map(t=>t.attribute).reverse().join(" ").trim()}async drawLayers(e,n){for(let[t,l]of e.entries())if(l.type==="url"){const{w:o,h:s,x:r,y:i}=this.igrama.sections[t];if(this.imgsMemo[l.content]===void 0){const c=new Image;c.src=l.content,this.imgsMemo[l.content]=await new Promise(u=>{c.addEventListener("load",()=>{u(c)},!1)})}n.drawImage(this.imgsMemo[l.content],r,i,o,s)}else if(l.type=="vector")for(let o of l.content){if(o.length===0)continue;const s=this.getSpline(o);this.drawSpline(s,n,o.color,o.weight)}}drawSpline(e,n,t,l){n.lineWidth=l,n.strokeStyle=t,n.fillStyle="rgba(0,0,0,0)",n.beginPath();for(let o=0;o<e.length;o++)o===0?n.moveTo(...e[0]):n.lineTo(...e[o]);n.stroke()}getSpline(e){let n=[];for(let t=0;t<e.length-1;t++){const l=[];l[0]=t>0?e[t-1]:e[0],l[1]=e[t],l[2]=e[t+1],l[3]=t<e.length-2?e[t+2]:e[e.length-1];for(let o=0;o<1;o+=.05){const s=this.getSplinePoint(o,l);n.push(s)}}return n}getSplinePoint(e,n){const t=Math.floor(e)+1,l=t+1,o=l+1,s=t-1,r=e*e,i=r*e,c=-i+2*r-e,u=3*i-5*r+2,f=-3*i+4*r+e,d=i-r,g=.5*(n[s][0]*c+n[t][0]*u+n[l][0]*f+n[o][0]*d),_=.5*(n[s][1]*c+n[t][1]*u+n[l][1]*f+n[o][1]*d);return[g,_]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=Xt,document.getElementsByTagName("head")[0].appendChild(e)}}const Xt=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 10px;
  flex-direction: column;
  box-sizing: border-box;
}

.storyp {
  font-size: 18px;
  min-height: 25px;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: white;
  border-radius: 4px;
  padding: 10px;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: black;
  color: white;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,Yt=Oe(qt);function ot(a,e,n){const t=a.slice();return t[17]=e[n],t}function it(a,e,n){const t=a.slice();return t[17]=e[n],t}function rt(a,e){let n,t,l,o;function s(i){e[12](i)}let r={key:e[17]};return e[0]!==void 0&&(r.movingNode=e[0]),t=new Bt({props:r}),te.push(()=>fe(t,"movingNode",s)),{key:a,first:null,c(){n=Se(),se(t.$$.fragment),this.h()},l(i){n=Se(),oe(t.$$.fragment,i),this.h()},h(){this.first=n},m(i,c){T(i,n,c),ie(t,i,c),o=!0},p(i,c){e=i;const u={};c&8&&(u.key=e[17]),!l&&c&1&&(l=!0,u.movingNode=e[0],de(()=>l=!1)),t.$set(u)},i(i){o||(G(t.$$.fragment,i),o=!0)},o(i){q(t.$$.fragment,i),o=!1},d(i){i&&p(n),re(t,i)}}}function lt(a,e){let n,t,l;return t=new Vt({props:{key:e[17],mouse:e[4]}}),{key:a,first:null,c(){n=Se(),se(t.$$.fragment),this.h()},l(o){n=Se(),oe(t.$$.fragment,o),this.h()},h(){this.first=n},m(o,s){T(o,n,s),ie(t,o,s),l=!0},p(o,s){e=o;const r={};s&8&&(r.key=e[17]),s&16&&(r.mouse=e[4]),t.$set(r)},i(o){l||(G(t.$$.fragment,o),l=!0)},o(o){q(t.$$.fragment,o),l=!1},d(o){o&&p(n),re(t,o)}}}function Zt(a){let e=[],n=new Map,t,l,o=[],s=new Map,r,i=a[3];const c=d=>d[17];for(let d=0;d<i.length;d+=1){let g=it(a,i,d),_=c(g);n.set(_,e[d]=rt(_,g))}let u=a[3];const f=d=>d[17];for(let d=0;d<u.length;d+=1){let g=ot(a,u,d),_=f(g);s.set(_,o[d]=lt(_,g))}return{c(){for(let d=0;d<e.length;d+=1)e[d].c();t=U(),l=Pe("svg");for(let d=0;d<o.length;d+=1)o[d].c();this.h()},l(d){for(let _=0;_<e.length;_+=1)e[_].l(d);t=j(d),l=Ve(d,"svg",{class:!0});var g=S(l);for(let _=0;_<o.length;_+=1)o[_].l(g);g.forEach(p),this.h()},h(){y(l,"class","connections-container svelte-4kbf32")},m(d,g){for(let _=0;_<e.length;_+=1)e[_].m(d,g);T(d,t,g),T(d,l,g);for(let _=0;_<o.length;_+=1)o[_].m(l,null);r=!0},p(d,g){g&9&&(i=d[3],Te(),e=Je(e,g,c,1,d,i,n,t.parentNode,qe,rt,t,it),Ce()),g&24&&(u=d[3],Te(),o=Je(o,g,f,1,d,u,s,l,qe,lt,null,ot),Ce())},i(d){if(!r){for(let g=0;g<i.length;g+=1)G(e[g]);for(let g=0;g<u.length;g+=1)G(o[g]);r=!0}},o(d){for(let g=0;g<e.length;g+=1)q(e[g]);for(let g=0;g<o.length;g+=1)q(o[g]);r=!1},d(d){for(let g=0;g<e.length;g+=1)e[g].d(d);d&&p(t),d&&p(l);for(let g=0;g<o.length;g+=1)o[g].d()}}}function Qt(a){let e,n,t,l,o,s,r,i,c,u,f,d,g,_,I,P,V,h,m,O,M,L,x,z,K,Z,ae,A,ee,W,w;function B(k){a[13](k)}function F(k){a[14](k)}let b={movingNode:a[0],$$slots:{default:[Zt,({offset:k})=>({16:k}),({offset:k})=>k?65536:0]},$$scope:{ctx:a}};return a[1]!==void 0&&(b.showNewScene=a[1]),a[4]!==void 0&&(b.mouse=a[4]),Z=new Jt({props:b}),te.push(()=>fe(Z,"showNewScene",B)),te.push(()=>fe(Z,"mouse",F)),{c(){e=N("input"),n=U(),t=N("div"),l=U(),o=N("div"),s=N("div"),r=N("div"),i=N("button"),c=H("Nuevo proyecto"),u=U(),f=N("label"),d=H("Importar"),g=U(),_=N("button"),I=H("Exportar"),P=U(),V=N("button"),h=H("Previsualizar"),m=U(),O=N("div"),M=N("button"),L=H("Nueva escena"),x=U(),z=N("div"),K=N("div"),se(Z.$$.fragment),this.h()},l(k){e=E(k,"INPUT",{type:!0,id:!0}),n=j(k),t=E(k,"DIV",{class:!0,id:!0}),S(t).forEach(p),l=j(k),o=E(k,"DIV",{class:!0});var D=S(o);s=E(D,"DIV",{class:!0});var Q=S(s);r=E(Q,"DIV",{class:!0});var X=S(r);i=E(X,"BUTTON",{class:!0});var ue=S(i);c=J(ue,"Nuevo proyecto"),ue.forEach(p),u=j(X),f=E(X,"LABEL",{class:!0,for:!0});var ce=S(f);d=J(ce,"Importar"),ce.forEach(p),g=j(X),_=E(X,"BUTTON",{class:!0});var C=S(_);I=J(C,"Exportar"),C.forEach(p),P=j(X),V=E(X,"BUTTON",{class:!0});var $=S(V);h=J($,"Previsualizar"),$.forEach(p),X.forEach(p),m=j(Q),O=E(Q,"DIV",{class:!0});var ye=S(O);M=E(ye,"BUTTON",{class:!0});var _e=S(M);L=J(_e,"Nueva escena"),_e.forEach(p),ye.forEach(p),Q.forEach(p),x=j(D),z=E(D,"DIV",{class:!0});var Ie=S(z);K=E(Ie,"DIV",{class:!0});var ge=S(K);oe(Z.$$.fragment,ge),ge.forEach(p),Ie.forEach(p),D.forEach(p),this.h()},h(){y(e,"type","file"),y(e,"id","load-input"),e.hidden=!0,y(t,"class","test-story-container svelte-4kbf32"),y(t,"id","test-story-container"),y(i,"class","toolbar-button svelte-4kbf32"),y(f,"class","toolbar-button svelte-4kbf32"),y(f,"for","load-input"),y(_,"class","toolbar-button svelte-4kbf32"),y(V,"class","toolbar-button svelte-4kbf32"),y(r,"class","project-toolbar svelte-4kbf32"),y(M,"class","toolbar-button svelte-4kbf32"),y(O,"class","scene-toolbar svelte-4kbf32"),y(s,"class","toolbar svelte-4kbf32"),y(K,"class","page-container svelte-4kbf32"),y(z,"class","static-page-container svelte-4kbf32"),y(o,"class","design-window-container svelte-4kbf32")},m(k,D){T(k,e,D),a[11](e),T(k,n,D),T(k,t,D),T(k,l,D),T(k,o,D),v(o,s),v(s,r),v(r,i),v(i,c),v(r,u),v(r,f),v(f,d),v(r,g),v(r,_),v(_,I),v(r,P),v(r,V),v(V,h),v(s,m),v(s,O),v(O,M),v(M,L),v(o,x),v(o,z),v(z,K),ie(Z,K,null),ee=!0,W||(w=[R(e,"change",a[5]),R(i,"click",a[7]),R(_,"click",a[9]),R(V,"click",a[8]),R(M,"click",a[6])],W=!0)},p(k,[D]){const Q={};D&1&&(Q.movingNode=k[0]),D&4194329&&(Q.$$scope={dirty:D,ctx:k}),!ae&&D&2&&(ae=!0,Q.showNewScene=k[1],de(()=>ae=!1)),!A&&D&16&&(A=!0,Q.mouse=k[4],de(()=>A=!1)),Z.$set(Q)},i(k){ee||(G(Z.$$.fragment,k),ee=!0)},o(k){q(Z.$$.fragment,k),ee=!1},d(k){k&&p(e),a[11](null),k&&p(n),k&&p(t),k&&p(l),k&&p(o),re(Z),W=!1,Ee(w)}}}function $t(a){a.scrollIntoView({block:"start"})}function en(a,e){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([JSON.stringify(a,null,2)],{type:"application/json"})),n.setAttribute("download",`${e.includes(".json")?e:e+".json"}`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function tn(a,e,n){let t,l,o,s;ne(a,Y,m=>n(10,o=m)),ne(a,Yt,m=>n(15,s=m));let r=!1,i=!1,c;function u(){const m=c.files[0];if(m.type==="application/json"){le(Y,o={},o);const O=new FileReader;O.addEventListener("load",function(){const M=O.result,L=JSON.parse(M);le(Y,o=L,o)}),this.value=null,O.readAsText(m);return}else alert("Formato de archivo incorrecto / incorrect file format")}function f(){n(1,i=!0)}function d(){le(Y,o={},o)}function g(){console.log(o);const m=document.getElementById("storygeneraldiv");m&&m.remove();const O=new s("es"),M=Object.entries(o).sort((z,K)=>z[1].display.y-K[1].display.y);if(M.length===0){alert("No hay escenas / There are no scenes");return}O.setScenes(o).startAdventure(M[0][0]);const L=document.getElementById("test-story-container"),x=document.getElementById("storygeneraldiv");L.appendChild(x),$t(x)}function _(){en(o,"aventuraInteractiva")}function I(m){te[m?"unshift":"push"](()=>{c=m,n(2,c)})}function P(m){r=m,n(0,r)}function V(m){i=m,n(1,i)}function h(m){t=m,n(4,t)}return a.$$.update=()=>{a.$$.dirty&1024&&n(3,l=Object.keys(o))},n(4,t={x:0,y:0}),[r,i,c,l,t,u,f,d,g,_,o,I,P,V,h]}class nn extends pe{constructor(e){super(),me(this,e,tn,Qt,he,{})}}function sn(a){let e,n,t,l,o,s,r,i,c;return o=new nn({}),{c(){e=N("section"),n=N("h1"),t=H("Aventura interactiva (beta)"),l=U(),se(o.$$.fragment),s=U(),r=N("footer"),i=H("Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.1b"),this.h()},l(u){e=E(u,"SECTION",{class:!0});var f=S(e);n=E(f,"H1",{class:!0});var d=S(n);t=J(d,"Aventura interactiva (beta)"),d.forEach(p),l=j(f),oe(o.$$.fragment,f),s=j(f),r=E(f,"FOOTER",{class:!0});var g=S(r);i=J(g,"Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.1b"),g.forEach(p),f.forEach(p),this.h()},h(){y(n,"class","svelte-aiip2m"),y(r,"class","svelte-aiip2m"),y(e,"class","svelte-aiip2m")},m(u,f){T(u,e,f),v(e,n),v(n,t),v(e,l),ie(o,e,null),v(e,s),v(e,r),v(r,i),c=!0},p:ve,i(u){c||(G(o.$$.fragment,u),c=!0)},o(u){q(o.$$.fragment,u),c=!1},d(u){u&&p(e),re(o)}}}class ln extends pe{constructor(e){super(),me(this,e,null,sn,he,{})}}export{ln as default};
