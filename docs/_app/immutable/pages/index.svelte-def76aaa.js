import{S as Te,i as Ce,s as Oe,F as et,l as w,m as k,n as S,h,p as _,b as O,K as Ae,L as R,M as Se,G as tt,H as nt,I as st,f as H,t as $,N as De,O as Ne,r as q,u as J,J as g,E as Le,a as D,c as L,P as Ze,Q as ge,w as me,x as _e,y as ve,B as ye,R as he,T as Ie,U as we,V as Ee,W as ke,v as Ge,e as Ue,g as Ve,d as Re,X as ze,Y as Qe,Z as xe,_ as $e,k as jt,$ as ft}from"../chunks/index-91fd3258.js";import{w as Bt,r as je}from"../chunks/index-1c2f5156.js";const ae=Bt({inicio:{texto:"\xC9rase una vez un c\xEDrculo...",display:{ops:[],areas:[],x:40,y:40},opciones:[{btn:"dejar tranquilo",escena:"final1"},{btn:"aplastar",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{ops:[],areas:[],x:40,y:250}},final2:{texto:"Parece que la historia form\xF3 una elipsis",sinSalida:!0,display:{ops:[],areas:[],x:220,y:250}}}),Dt=je(r=>r.scene===void 0&&r.escena!==void 0?"escena":"scene"),ot=je(r=>r.options===void 0&&r.opciones!==void 0?"opciones":"options"),Pt=je(r=>r.text===void 0&&r.texto!==void 0?"texto":"text"),Lt=je(r=>r.image===void 0&&r.imagen!==void 0?"imagen":"image");function Ut(r,e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([r],{type:e})),n.setAttribute("download",t),document.body.appendChild(n),n.click(),document.body.removeChild(n)}const Vt=je((r,e)=>{Ut(JSON.stringify(r,null,2),"application/json",`${e.includes(".json")?e:e+".json"}`)}),Rt=je(r=>{Ut(r,"text/plain;charset=utf-8","index.html")}),Gt=function(r,e,t){return`
<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
  </head>
  <body>
  </body>
  <script>
    const lang = "es";
    const options = {typewriterSpeed: 20, defaultCSS: false};
  <\/script>
  <style>
    
  #storygeneraldiv {
    box-sizing: border-box;
    margin: auto;
    max-width: 600px;
    font-family: 'Courier New', Courier, monospace;
    background: white;
  }
  
  .storydiv {
    border: solid black 1px;
    width: 100%;
    display: flex;
    padding: 10px;
    flex-direction: column;
    box-sizing: border-box;
  }
  
  .storyp {
    font-size: 18px;
    min-height: 25px;
  }
  
  .storybutton-container {
    margin: auto;
  }
  
  .storybutton {
    background: white;
    box-shadow: none;
    border: solid 1px;
    margin: 0px 1em 0px 0px;
    font-size: 20px;
    font-family: 'Courier New', Courier, monospace;
    cursor: pointer;
  }
  
  .storybutton:hover {
    color: white;
    background: black;
  }
  
  .storyimage-container {
    box-sizing: content-box;
    position: relative;
    width: 100%;
    margin: auto;
  }
  
  .storyimage {
    justify-content: center;
    width: 100%;
    margin: auto;
    border-radius: 20px;
    display: block;
  }
  
  .storyimage-area {
    font-size: 14px;
    position: absolute;
    cursor: pointer;
    text-align: center;
    color: black;
    background: #ffffff00;
    border: solid 1px black;
  }
  
  .storyimage-area:hover {
    background: #ffffff33;
  }
  
  @media screen and (max-device-width: 500px) {
    #storygeneraldiv {
      max-width:100%;
    }
    .storyp {
      font-size: 7vw;
    }
    .storybutton {
      font-size: 10vw;
    }
  }
  
  </style>
  <script>
    const A = ${r}
  <\/script>
  <script>
    const scenes = ${e};
    const aventura = new A(lang, options);
    aventura.setScenes(scenes).startAdventure('${t}');
  <\/script>
</html>
`},zt=je(Gt);function Kt(r){let e,t,n,l;const o=r[5].default,s=et(o,r,r[4],null);return{c(){e=w("div"),s&&s.c(),this.h()},l(i){e=k(i,"DIV",{class:!0});var a=S(e);s&&s.l(a),a.forEach(h),this.h()},h(){_(e,"class","draggui svelte-1r8lyx3")},m(i,a){O(i,e,a),s&&s.m(e,null),t=!0,n||(l=[Ae(r[0].call(null,e)),Ae(r[1].call(null,e)),R(e,"mousedown",Se(r[6]))],n=!0)},p(i,[a]){s&&s.p&&(!t||a&16)&&tt(s,o,i,i[4],t?st(o,i[4],a,null):nt(i[4]),null)},i(i){t||(H(s,i),t=!0)},o(i){$(s,i),t=!1},d(i){i&&h(e),s&&s.d(i),n=!1,De(l)}}}function Ft(r,e,t){let{$$slots:n={},$$scope:l}=e,{pos:o}=e,{displace:s={x:o.x,y:o.y}}=e;function i(u){u.style.left=`${s.x}px`,u.style.top=`${s.y}px`}function a(u){let f=!1;u.style.left=`${s.x}px`,u.style.top=`${s.y}px`,u.addEventListener("mousedown",()=>{f=!0}),window.addEventListener("mousemove",d=>{f&&(t(2,s.x+=d.movementX,s),t(2,s.y+=d.movementY,s),u.style.left=`${s.x}px`,u.style.top=`${s.y}px`,u.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{f=!1,u.style.cursor="grab"})}function c(u){Ne.call(this,r,u)}return r.$$set=u=>{"pos"in u&&t(3,o=u.pos),"displace"in u&&t(2,s=u.displace),"$$scope"in u&&t(4,l=u.$$scope)},[i,a,s,o,l,n,c]}class He extends Te{constructor(e){super(),Ce(this,e,Ft,Kt,Oe,{pos:3,displace:2})}}function Ht(r){let e,t,n,l,o;return{c(){e=w("div"),t=w("button"),n=q("X"),this.h()},l(s){e=k(s,"DIV",{class:!0});var i=S(e);t=k(i,"BUTTON",{class:!0});var a=S(t);n=J(a,"X"),a.forEach(h),i.forEach(h),this.h()},h(){_(t,"class","x-button"),_(e,"class","top-bar svelte-15bdkib")},m(s,i){O(s,e,i),g(e,t),g(t,n),l||(o=R(t,"click",r[0]),l=!0)},p:Le,i:Le,o:Le,d(s){s&&h(e),l=!1,o()}}}function Wt(r,e,t){let{toggle:n}=e;function l(){t(1,n=!1)}return r.$$set=o=>{"toggle"in o&&t(1,n=o.toggle)},[l,n]}class We extends Te{constructor(e){super(),Ce(this,e,Wt,Ht,Oe,{toggle:1})}}function ct(r){let e,t;return{c(){e=w("img"),this.h()},l(n){e=k(n,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Ze(e.src,t="")||_(e,"src",t),_(e,"alt","Preview"),_(e,"class","img-preview svelte-cj21gd")},m(n,l){O(n,e,l),r[6](e)},p:Le,d(n){n&&h(e),r[6](null)}}}function qt(r){let e,t,n,l,o,s=r[2]&&ct(r);return{c(){e=w("input"),t=D(),n=w("div"),s&&s.c(),this.h()},l(i){e=k(i,"INPUT",{type:!0}),t=L(i),n=k(i,"DIV",{class:!0,id:!0});var a=S(n);s&&s.l(a),a.forEach(h),this.h()},h(){_(e,"type","file"),_(n,"class","image-preview-container svelte-cj21gd"),_(n,"id","image-preview-container")},m(i,a){O(i,e,a),r[5](e),O(i,t,a),O(i,n,a),s&&s.m(n,null),l||(o=R(e,"change",r[3]),l=!0)},p(i,[a]){i[2]?s?s.p(i,a):(s=ct(i),s.c(),s.m(n,null)):s&&(s.d(1),s=null)},i:Le,o:Le,d(i){i&&h(e),r[5](null),i&&h(t),i&&h(n),s&&s.d(),l=!1,o()}}}function Jt(r,e,t){let{imageUrl:n}=e,l,o,s=!1;function i(){const u=l.files[0];if(u){t(2,s=!0);const f=new FileReader;f.addEventListener("load",function(){t(4,n=f.result),o.setAttribute("src",f.result)}),f.readAsDataURL(u);return}t(2,s=!1)}function a(u){ge[u?"unshift":"push"](()=>{l=u,t(0,l)})}function c(u){ge[u?"unshift":"push"](()=>{o=u,t(1,o)})}return r.$$set=u=>{"imageUrl"in u&&t(4,n=u.imageUrl)},[l,o,s,i,n,a,c]}class Xt extends Te{constructor(e){super(),Ce(this,e,Jt,qt,Oe,{imageUrl:4})}}function Yt(r){let e,t,n,l,o,s,i,a,c,u,f,d,p,m,I,j,X,v,N,z,V,B,ee,se,x,ie,A,Y,Z,Q,M,te,oe,W,ue,le;function re(T){r[8](T)}let K={};r[0]!==void 0&&(K.toggle=r[0]),e=new We({props:K}),ge.push(()=>we(e,"toggle",re));function P(T){r[11](T)}let ne={};return r[3]!==void 0&&(ne.imageUrl=r[3]),Y=new Xt({props:ne}),ge.push(()=>we(Y,"imageUrl",P)),{c(){me(e.$$.fragment),n=D(),l=w("div"),o=w("h1"),s=q(r[1]),i=D(),a=w("div"),c=w("h2"),u=q("Texto"),f=D(),d=w("textarea"),p=D(),m=w("div"),I=w("h2"),j=q("Imagen (opcional)"),X=D(),v=w("div"),N=w("label"),z=q("Url:"),V=D(),B=w("input"),ee=q(`
    o
    `),se=w("div"),x=w("span"),ie=q("Archivo:"),A=D(),me(Y.$$.fragment),Q=D(),M=w("div"),te=w("button"),oe=q("Aceptar"),this.h()},l(T){_e(e.$$.fragment,T),n=L(T),l=k(T,"DIV",{});var y=S(l);o=k(y,"H1",{class:!0});var E=S(o);s=J(E,r[1]),E.forEach(h),y.forEach(h),i=L(T),a=k(T,"DIV",{});var C=S(a);c=k(C,"H2",{class:!0});var F=S(c);u=J(F,"Texto"),F.forEach(h),f=L(C),d=k(C,"TEXTAREA",{class:!0}),S(d).forEach(h),C.forEach(h),p=L(T),m=k(T,"DIV",{});var U=S(m);I=k(U,"H2",{class:!0});var pe=S(I);j=J(pe,"Imagen (opcional)"),pe.forEach(h),X=L(U),v=k(U,"DIV",{});var be=S(v);N=k(be,"LABEL",{for:!0});var ce=S(N);z=J(ce,"Url:"),ce.forEach(h),V=L(be),B=k(be,"INPUT",{id:!0,type:!0}),be.forEach(h),ee=J(U,`
    o
    `),se=k(U,"DIV",{});var fe=S(se);x=k(fe,"SPAN",{});var b=S(x);ie=J(b,"Archivo:"),b.forEach(h),A=L(fe),_e(Y.$$.fragment,fe),fe.forEach(h),Q=L(U),M=k(U,"DIV",{class:!0});var G=S(M);te=k(G,"BUTTON",{});var de=S(te);oe=J(de,"Aceptar"),de.forEach(h),G.forEach(h),U.forEach(h),this.h()},h(){_(o,"class","svelte-2p34te"),_(c,"class","no-select svelte-2p34te"),_(d,"class","svelte-2p34te"),_(I,"class","no-select svelte-2p34te"),_(N,"for","inp"),_(B,"id","inp"),_(B,"type","text"),_(M,"class","bar svelte-2p34te")},m(T,y){ve(e,T,y),O(T,n,y),O(T,l,y),g(l,o),g(o,s),O(T,i,y),O(T,a,y),g(a,c),g(c,u),g(a,f),g(a,d),Ee(d,r[4]),O(T,p,y),O(T,m,y),g(m,I),g(I,j),g(m,X),g(m,v),g(v,N),g(N,z),g(v,V),g(v,B),Ee(B,r[3]),g(m,ee),g(m,se),g(se,x),g(x,ie),g(se,A),ve(Y,se,null),g(m,Q),g(m,M),g(M,te),g(te,oe),W=!0,ue||(le=[R(d,"input",r[9]),R(d,"mousedown",Se(r[7])),R(B,"input",r[10]),R(B,"mousedown",Se(r[6])),R(te,"click",r[5])],ue=!0)},p(T,y){const E={};!t&&y&1&&(t=!0,E.toggle=T[0],ke(()=>t=!1)),e.$set(E),(!W||y&2)&&Ge(s,T[1]),y&16&&Ee(d,T[4]),y&8&&B.value!==T[3]&&Ee(B,T[3]);const C={};!Z&&y&8&&(Z=!0,C.imageUrl=T[3],ke(()=>Z=!1)),Y.$set(C)},i(T){W||(H(e.$$.fragment,T),H(Y.$$.fragment,T),W=!0)},o(T){$(e.$$.fragment,T),$(Y.$$.fragment,T),W=!1},d(T){ye(e,T),T&&h(n),T&&h(l),T&&h(i),T&&h(a),T&&h(p),T&&h(m),ye(Y),ue=!1,De(le)}}}function Zt(r){let e,t;return e=new He({props:{pos:r[2],$$slots:{default:[Yt]},$$scope:{ctx:r}}}),{c(){me(e.$$.fragment)},l(n){_e(e.$$.fragment,n)},m(n,l){ve(e,n,l),t=!0},p(n,[l]){const o={};l&4&&(o.pos=n[2]),l&32795&&(o.$$scope={dirty:l,ctx:n}),e.$set(o)},i(n){t||(H(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){ye(e,n)}}}function Qt(r,e,t){let n,l;he(r,ae,v=>t(12,l=v));let{key:o}=e,{pos:s}=e,{showEditor:i}=e,a=null,c=l[o];const u=c.text===void 0&&c.texto!==void 0?"texto":"text";function f(){Ie(ae,l[o][u]=n,l),a!==null&&Ie(ae,l[o].image=a,l),t(0,i=!1)}function d(v){Ne.call(this,r,v)}function p(v){Ne.call(this,r,v)}function m(v){i=v,t(0,i)}function I(){n=this.value,t(4,n),t(13,c)}function j(){a=this.value,t(3,a)}function X(v){a=v,t(3,a)}return r.$$set=v=>{"key"in v&&t(1,o=v.key),"pos"in v&&t(2,s=v.pos),"showEditor"in v&&t(0,i=v.showEditor)},r.$$.update=()=>{r.$$.dirty&2&&Ie(ae,l[o]=c,l)},t(4,n=c[u]),[i,o,s,a,n,f,d,p,m,I,j,X]}class xt extends Te{constructor(e){super(),Ce(this,e,Qt,Zt,Oe,{key:1,pos:2,showEditor:0})}}function $t(r){let e,t,n,l,o,s,i,a,c,u,f,d,p,m,I;function j(v){r[6](v)}let X={};return r[0]!==void 0&&(X.toggle=r[0]),e=new We({props:X}),ge.push(()=>we(e,"toggle",j)),{c(){me(e.$$.fragment),n=D(),l=w("div"),o=w("label"),s=q("Btn:"),i=D(),a=w("input"),c=D(),u=w("div"),f=w("button"),d=q("Aceptar"),this.h()},l(v){_e(e.$$.fragment,v),n=L(v),l=k(v,"DIV",{});var N=S(l);o=k(N,"LABEL",{for:!0});var z=S(o);s=J(z,"Btn:"),z.forEach(h),i=L(N),a=k(N,"INPUT",{id:!0,type:!0}),N.forEach(h),c=L(v),u=k(v,"DIV",{class:!0});var V=S(u);f=k(V,"BUTTON",{});var B=S(f);d=J(B,"Aceptar"),B.forEach(h),V.forEach(h),this.h()},h(){_(o,"for","inp"),_(a,"id","inp"),_(a,"type","text"),_(u,"class","bar svelte-1bhrmvp")},m(v,N){ve(e,v,N),O(v,n,N),O(v,l,N),g(l,o),g(o,s),g(l,i),g(l,a),Ee(a,r[2]),O(v,c,N),O(v,u,N),g(u,f),g(f,d),p=!0,m||(I=[R(a,"input",r[7]),R(a,"mousedown",Se(r[5])),R(f,"click",r[3])],m=!0)},p(v,N){const z={};!t&&N&1&&(t=!0,z.toggle=v[0],ke(()=>t=!1)),e.$set(z),N&4&&a.value!==v[2]&&Ee(a,v[2])},i(v){p||(H(e.$$.fragment,v),p=!0)},o(v){$(e.$$.fragment,v),p=!1},d(v){ye(e,v),v&&h(n),v&&h(l),v&&h(c),v&&h(u),m=!1,De(I)}}}function en(r){let e,t;return e=new He({props:{pos:r[1],$$slots:{default:[$t]},$$scope:{ctx:r}}}),{c(){me(e.$$.fragment)},l(n){_e(e.$$.fragment,n)},m(n,l){ve(e,n,l),t=!0},p(n,[l]){const o={};l&2&&(o.pos=n[1]),l&2053&&(o.$$scope={dirty:l,ctx:n}),e.$set(o)},i(n){t||(H(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){ye(e,n)}}}function tn(r,e,t){let n,l,o;he(r,ae,m=>t(8,l=m)),he(r,ot,m=>t(9,o=m));let{key:s}=e,{pos:i}=e,{showNewOutput:a}=e;const c=o(l[s]);function u(){l[s][c]===void 0&&Ie(ae,l[s][c]=[],l),l[s][c].push({btn:n}),ae.set(l),t(0,a=!1)}function f(m){Ne.call(this,r,m)}function d(m){a=m,t(0,a)}function p(){n=this.value,t(2,n)}return r.$$set=m=>{"key"in m&&t(4,s=m.key),"pos"in m&&t(1,i=m.pos),"showNewOutput"in m&&t(0,a=m.showNewOutput)},t(2,n=""),[a,i,n,u,s,f,d,p]}class nn extends Te{constructor(e){super(),Ce(this,e,tn,en,Oe,{key:4,pos:1,showNewOutput:0})}}function sn(r){let e,t,n,l;const o=r[5].default,s=et(o,r,r[4],null);return{c(){e=w("div"),s&&s.c(),this.h()},l(i){e=k(i,"DIV",{class:!0});var a=S(e);s&&s.l(a),a.forEach(h),this.h()},h(){_(e,"class","scene-node-container svelte-14kdql5")},m(i,a){O(i,e,a),s&&s.m(e,null),t=!0,n||(l=Ae(r[0].call(null,e)),n=!0)},p(i,[a]){s&&s.p&&(!t||a&16)&&tt(s,o,i,i[4],t?st(o,i[4],a,null):nt(i[4]),null)},i(i){t||(H(s,i),t=!0)},o(i){$(s,i),t=!1},d(i){i&&h(e),s&&s.d(i),n=!1,l()}}}function on(r,e,t){let n;he(r,ae,u=>t(3,n=u));let{$$slots:l={},$$scope:o}=e,{key:s}=e,{movingNode:i=!1}=e,a=n[s];a.display===void 0&&(a.display={x:0,y:0,ops:[]});function c(u){let f=!1;u.style.left=`${a.display.x}px`,u.style.top=`${a.display.y}px`,u.addEventListener("mousedown",()=>{f=!0,t(1,i=!0)}),window.addEventListener("mousemove",d=>{f&&(a.display.x+=d.movementX,a.display.y+=d.movementY,u.style.left=`${a.display.x}px`,u.style.top=`${a.display.y}px`,Ie(ae,n[s]=a,n))}),window.addEventListener("mouseup",()=>{f=!1,t(1,i=!1)})}return r.$$set=u=>{"key"in u&&t(2,s=u.key),"movingNode"in u&&t(1,i=u.movingNode),"$$scope"in u&&t(4,o=u.$$scope)},r.$$.update=()=>{r.$$.dirty&12&&(a=n[s])},[c,i,s,n,o,l]}class rn extends Te{constructor(e){super(),Ce(this,e,on,sn,Oe,{key:2,movingNode:1})}}function dt(r){let e,t,n,l;return{c(){e=w("div"),t=q(r[8]),this.h()},l(o){e=k(o,"DIV",{class:!0});var s=S(e);t=J(s,r[8]),s.forEach(h),this.h()},h(){_(e,"class","area svelte-kpdqfb")},m(o,s){O(o,e,s),g(e,t),r[23](e),n||(l=R(e,"mousedown",Se(r[14])),n=!0)},p(o,s){s&256&&Ge(t,o[8])},d(o){o&&h(e),r[23](null),n=!1,l()}}}function ln(r){let e,t,n,l,o,s,i,a,c,u,f,d,p,m,I,j,X,v,N,z,V,B,ee,se,x,ie,A,Y,Z,Q,M,te,oe,W,ue,le,re,K,P;function ne(E){r[18](E)}let T={};r[0]!==void 0&&(T.toggle=r[0]),e=new We({props:T}),ge.push(()=>we(e,"toggle",ne));let y=r[5]&&dt(r);return{c(){me(e.$$.fragment),n=D(),l=w("div"),o=w("h1"),s=q(r[1]),i=D(),a=w("div"),c=w("div"),u=w("h2"),f=q("Nombre de referencia"),d=D(),p=w("input"),m=D(),I=w("div"),j=w("h2"),X=q("Btn"),v=D(),N=w("input"),z=D(),V=w("div"),B=w("h2"),ee=q("Tooltip"),se=D(),x=w("input"),ie=D(),A=w("div"),Y=w("div"),Z=w("div"),Q=w("img"),te=D(),y&&y.c(),oe=D(),W=w("div"),ue=w("button"),le=q("Aceptar"),this.h()},l(E){_e(e.$$.fragment,E),n=L(E),l=k(E,"DIV",{});var C=S(l);o=k(C,"H1",{class:!0});var F=S(o);s=J(F,r[1]),F.forEach(h),C.forEach(h),i=L(E),a=k(E,"DIV",{class:!0});var U=S(a);c=k(U,"DIV",{class:!0});var pe=S(c);u=k(pe,"H2",{class:!0});var be=S(u);f=J(be,"Nombre de referencia"),be.forEach(h),d=L(pe),p=k(pe,"INPUT",{}),pe.forEach(h),m=L(U),I=k(U,"DIV",{class:!0});var ce=S(I);j=k(ce,"H2",{class:!0});var fe=S(j);X=J(fe,"Btn"),fe.forEach(h),v=L(ce),N=k(ce,"INPUT",{}),ce.forEach(h),z=L(U),V=k(U,"DIV",{class:!0});var b=S(V);B=k(b,"H2",{class:!0});var G=S(B);ee=J(G,"Tooltip"),G.forEach(h),se=L(b),x=k(b,"INPUT",{}),b.forEach(h),U.forEach(h),ie=L(E),A=k(E,"DIV",{class:!0});var de=S(A);Y=k(de,"DIV",{class:!0});var Ke=S(Y);Z=k(Ke,"DIV",{class:!0});var Me=S(Z);Q=k(Me,"IMG",{src:!0,alt:!0,class:!0}),te=L(Me),y&&y.l(Me),Me.forEach(h),Ke.forEach(h),de.forEach(h),oe=L(E),W=k(E,"DIV",{class:!0});var Be=S(W);ue=k(Be,"BUTTON",{});var Fe=S(ue);le=J(Fe,"Aceptar"),Fe.forEach(h),Be.forEach(h),this.h()},h(){_(o,"class","svelte-kpdqfb"),_(u,"class","svelte-kpdqfb"),_(c,"class","input"),_(j,"class","svelte-kpdqfb"),_(I,"class","input"),_(B,"class","svelte-kpdqfb"),_(V,"class","input"),_(a,"class","inputs svelte-kpdqfb"),Ze(Q.src,M=r[9][r[10]])||_(Q,"src",M),_(Q,"alt","Preview"),_(Q,"class","img-preview svelte-kpdqfb"),_(Z,"class","area-container"),_(Y,"class","area-absolute-container svelte-kpdqfb"),_(A,"class","area-normal-container svelte-kpdqfb"),_(W,"class","bar svelte-kpdqfb")},m(E,C){ve(e,E,C),O(E,n,C),O(E,l,C),g(l,o),g(o,s),O(E,i,C),O(E,a,C),g(a,c),g(c,u),g(u,f),g(c,d),g(c,p),Ee(p,r[6]),g(a,m),g(a,I),g(I,j),g(j,X),g(I,v),g(I,N),Ee(N,r[8]),g(a,z),g(a,V),g(V,B),g(B,ee),g(V,se),g(V,x),Ee(x,r[7]),O(E,ie,C),O(E,A,C),g(A,Y),g(Y,Z),g(Z,Q),r[22](Q),g(Z,te),y&&y.m(Z,null),O(E,oe,C),O(E,W,C),g(W,ue),g(ue,le),re=!0,K||(P=[R(p,"input",r[19]),R(p,"mousedown",Se(r[17])),R(N,"input",r[20]),R(N,"mousedown",Se(r[16])),R(x,"input",r[21]),R(x,"mousedown",Se(r[15])),Ae(r[11].call(null,Q)),R(Y,"mousedown",Se(r[13])),R(ue,"click",r[12])],K=!0)},p(E,C){const F={};!t&&C&1&&(t=!0,F.toggle=E[0],ke(()=>t=!1)),e.$set(F),(!re||C&2)&&Ge(s,E[1]),C&64&&p.value!==E[6]&&Ee(p,E[6]),C&256&&N.value!==E[8]&&Ee(N,E[8]),C&128&&x.value!==E[7]&&Ee(x,E[7]),E[5]?y?y.p(E,C):(y=dt(E),y.c(),y.m(Z,null)):y&&(y.d(1),y=null)},i(E){re||(H(e.$$.fragment,E),re=!0)},o(E){$(e.$$.fragment,E),re=!1},d(E){ye(e,E),E&&h(n),E&&h(l),E&&h(i),E&&h(a),E&&h(ie),E&&h(A),r[22](null),y&&y.d(),E&&h(oe),E&&h(W),K=!1,De(P)}}}function an(r){let e,t;return e=new He({props:{pos:r[2],$$slots:{default:[ln]},$$scope:{ctx:r}}}),{c(){me(e.$$.fragment)},l(n){_e(e.$$.fragment,n)},m(n,l){ve(e,n,l),t=!0},p(n,[l]){const o={};l&4&&(o.pos=n[2]),l&268435963&&(o.$$scope={dirty:l,ctx:n}),e.$set(o)},i(n){t||(H(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){ye(e,n)}}}function un(r,e,t){let n,l,o,s,i;he(r,ae,M=>t(25,s=M)),he(r,Lt,M=>t(26,i=M));let{key:a}=e,{pos:c}=e,{showNewArea:u}=e,f,d=s[a];const p=i(d);let m={},I,j;function X(M){let te=!1;M.addEventListener("mousedown",W=>{W.preventDefault(),te=!0,t(5,j={x1:W.offsetX,y1:W.offsetY,x2:W.offsetX,y2:W.offsetY})}),M.addEventListener("mousemove",W=>{te&&v(W)}),M.addEventListener("mouseup",W=>{oe(W)}),M.addEventListener("mouseout",W=>{oe(W)});function oe(W){if(j===void 0||!te)return;te=!1;const ue=v(W),le={};for(let re of Object.keys(ue))le[re]=Math.floor(ue[re]*f.naturalWidth/f.width);Object.assign(m,{...le}),m.x=Math.floor(le.x+le.w/2),m.y=Math.floor(le.y+le.h/2)}}function v(M){t(5,j.x2=M.offsetX,j),t(5,j.y2=M.offsetY,j);const te=Math.min(j.x1,j.x2),oe=Math.max(j.x1,j.x2),W=Math.min(j.y1,j.y2),ue=Math.max(j.y1,j.y2),le={x:te,y:W,w:oe-te,h:ue-W};return t(4,I.style.width=`${le.w}px`,I),t(4,I.style.height=`${le.h}px`,I),t(4,I.style.top=`${le.y}px`,I),t(4,I.style.left=`${le.x}px`,I),le}function N(){if(m===void 0){alert("debes escoger un area / you must choose an area");return}Object.assign(m,{btn:n,tooltip:l,name:o}),s[a].areas===void 0&&Ie(ae,s[a].areas=[],s),s[a].areas.push(m),ae.set(s),t(0,u=!1)}function z(M){Ne.call(this,r,M)}function V(M){Ne.call(this,r,M)}function B(M){Ne.call(this,r,M)}function ee(M){Ne.call(this,r,M)}function se(M){Ne.call(this,r,M)}function x(M){u=M,t(0,u)}function ie(){o=this.value,t(6,o)}function A(){n=this.value,t(8,n)}function Y(){l=this.value,t(7,l)}function Z(M){ge[M?"unshift":"push"](()=>{f=M,t(3,f)})}function Q(M){ge[M?"unshift":"push"](()=>{I=M,t(4,I)})}return r.$$set=M=>{"key"in M&&t(1,a=M.key),"pos"in M&&t(2,c=M.pos),"showNewArea"in M&&t(0,u=M.showNewArea)},t(8,n=""),t(7,l=""),t(6,o="area"),[u,a,c,f,I,j,o,l,n,d,p,X,N,z,V,B,ee,se,x,ie,A,Y,Z,Q]}class fn extends Te{constructor(e){super(),Ce(this,e,un,an,Oe,{key:1,pos:2,showNewArea:0})}}function pt(r,e,t){const n=r.slice();return n[39]=e[t],n[41]=t,n}function ht(r,e,t){const n=r.slice();return n[42]=e[t],n[41]=t,n}function gt(r){let e,t,n,l,o;return{c(){e=w("div"),t=w("img"),this.h()},l(s){e=k(s,"DIV",{class:!0});var i=S(e);t=k(i,"IMG",{src:!0,alt:!0,class:!0}),i.forEach(h),this.h()},h(){Ze(t.src,n=r[2][r[8]])||_(t,"src",n),_(t,"alt","Preview"),_(t,"class","img-preview svelte-ank1gn"),_(e,"class","img-preview-container svelte-ank1gn")},m(s,i){O(s,e,i),g(e,t),l||(o=R(t,"load",r[14]),l=!0)},p(s,i){i[0]&4&&!Ze(t.src,n=s[2][s[8]])&&_(t,"src",n)},d(s){s&&h(e),l=!1,o()}}}function mt(r){let e,t,n,l,o,s,i,a,c,u,f,d;return{c(){e=w("div"),t=w("span"),n=q("\xE1rea"),l=D(),o=w("div"),s=w("button"),i=q("-"),a=D(),c=w("button"),u=q("+"),this.h()},l(p){e=k(p,"DIV",{});var m=S(e);t=k(m,"SPAN",{class:!0});var I=S(t);n=J(I,"\xE1rea"),I.forEach(h),l=L(m),o=k(m,"DIV",{class:!0});var j=S(o);s=k(j,"BUTTON",{class:!0});var X=S(s);i=J(X,"-"),X.forEach(h),a=L(j),c=k(j,"BUTTON",{class:!0});var v=S(c);u=J(v,"+"),v.forEach(h),j.forEach(h),m.forEach(h),this.h()},h(){_(t,"class","btns-name svelte-ank1gn"),_(s,"class","svelte-ank1gn"),_(c,"class","svelte-ank1gn"),_(o,"class","node-btns-div svelte-ank1gn")},m(p,m){O(p,e,m),g(e,t),g(t,n),g(e,l),g(e,o),g(o,s),g(s,i),g(o,a),g(o,c),g(c,u),f||(d=[R(s,"click",r[18]),R(c,"click",r[22])],f=!0)},p:Le,d(p){p&&h(e),f=!1,De(d)}}}function _t(r,e){let t,n,l,o,s,i,a,c,u;return{key:r,first:null,c(){t=w("div"),n=w("input"),s=D(),i=w("div"),this.h()},l(f){t=k(f,"DIV",{class:!0});var d=S(t);n=k(d,"INPUT",{type:!0,class:!0,i:!0}),s=L(d),i=k(d,"DIV",{type:!0,class:!0,i:!0}),S(i).forEach(h),d.forEach(h),this.h()},h(){_(n,"type","text"),_(n,"class","output-text svelte-ank1gn"),n.value=l=e[42].btn,_(n,"i",o=e[41]),_(i,"type","ops"),_(i,"class","connection output option-connection svelte-ank1gn"),_(i,"i",a=e[41]),_(t,"class","output-container svelte-ank1gn"),this.first=t},m(f,d){O(f,t,d),g(t,n),g(t,s),g(t,i),c||(u=[Ae(e[11].call(null,n)),R(n,"change",e[10]),R(n,"mousedown",Se(e[26])),Ae(e[12].call(null,i)),Ae(e[15].call(null,i)),R(i,"mousedown",Se(e[25]))],c=!0)},p(f,d){e=f,d[0]&4&&l!==(l=e[42].btn)&&n.value!==l&&(n.value=l),d[0]&4&&o!==(o=e[41])&&_(n,"i",o),d[0]&4&&a!==(a=e[41])&&_(i,"i",a)},d(f){f&&h(t),c=!1,De(u)}}}function vt(r,e){let t,n,l=e[39].name+"",o,s,i,a,c,u,f;return{key:r,first:null,c(){t=w("div"),n=w("span"),o=q(l),s=D(),i=w("div"),c=D(),this.h()},l(d){t=k(d,"DIV",{class:!0});var p=S(t);n=k(p,"SPAN",{class:!0});var m=S(n);o=J(m,l),m.forEach(h),s=L(p),i=k(p,"DIV",{type:!0,class:!0,i:!0}),S(i).forEach(h),c=L(p),p.forEach(h),this.h()},h(){_(n,"class","output-text svelte-ank1gn"),_(i,"type","areas"),_(i,"class","connection output area-connection svelte-ank1gn"),_(i,"i",a=e[41]),_(t,"class","output-container svelte-ank1gn"),this.first=t},m(d,p){O(d,t,p),g(t,n),g(n,o),g(t,s),g(t,i),g(t,c),u||(f=[Ae(e[13].call(null,i)),Ae(e[15].call(null,i)),R(i,"mousedown",Se(e[24]))],u=!0)},p(d,p){e=d,p[0]&4&&l!==(l=e[39].name+"")&&Ge(o,l),p[0]&4&&a!==(a=e[41])&&_(i,"i",a)},d(d){d&&h(t),u=!1,De(f)}}}function cn(r){let e,t,n,l,o,s,i,a,c,u=(r[2][r[9]].length<210?r[2][r[9]]:r[2][r[9]].slice(0,210)+"...")+"",f,d,p,m,I,j,X,v,N,z,V,B,ee,se,x,ie,A,Y,Z,Q,M,te,oe,W,ue,le,re,K=[],P=new Map,ne,T=[],y=new Map,E,C,F=r[2][r[8]]!==void 0&&r[2][r[8]]!==null&&gt(r),U=r[2][r[8]]!==void 0&&r[2][r[8]]!==null&&mt(r),pe=r[2][r[7]]||[];const be=b=>"op"+b[41];for(let b=0;b<pe.length;b+=1){let G=ht(r,pe,b),de=be(G);P.set(de,K[b]=_t(de,G))}let ce=r[2].areas||[];const fe=b=>"a"+b[41];for(let b=0;b<ce.length;b+=1){let G=pt(r,ce,b),de=fe(G);y.set(de,T[b]=vt(de,G))}return{c(){e=w("div"),t=D(),n=w("h1"),l=q("Escena: "),o=q(r[1]),s=D(),F&&F.c(),i=D(),a=w("div"),c=w("p"),f=q(u),d=D(),p=w("div"),m=w("div"),I=w("span"),j=q("escena"),X=D(),v=w("div"),N=w("button"),z=q("editar"),V=D(),B=w("button"),ee=q("x"),se=D(),x=w("div"),ie=w("span"),A=q("btn"),Y=D(),Z=w("div"),Q=w("button"),M=q("-"),te=D(),oe=w("button"),W=q("+"),ue=D(),U&&U.c(),le=D(),re=w("div");for(let b=0;b<K.length;b+=1)K[b].c();ne=D();for(let b=0;b<T.length;b+=1)T[b].c();this.h()},l(b){e=k(b,"DIV",{class:!0}),S(e).forEach(h),t=L(b),n=k(b,"H1",{class:!0});var G=S(n);l=J(G,"Escena: "),o=J(G,r[1]),G.forEach(h),s=L(b),F&&F.l(b),i=L(b),a=k(b,"DIV",{class:!0});var de=S(a);c=k(de,"P",{class:!0});var Ke=S(c);f=J(Ke,u),Ke.forEach(h),de.forEach(h),d=L(b),p=k(b,"DIV",{class:!0});var Me=S(p);m=k(Me,"DIV",{});var Be=S(m);I=k(Be,"SPAN",{class:!0});var Fe=S(I);j=J(Fe,"escena"),Fe.forEach(h),X=L(Be),v=k(Be,"DIV",{class:!0});var qe=S(v);N=k(qe,"BUTTON",{class:!0});var rt=S(N);z=J(rt,"editar"),rt.forEach(h),V=L(qe),B=k(qe,"BUTTON",{class:!0});var it=S(B);ee=J(it,"x"),it.forEach(h),qe.forEach(h),Be.forEach(h),se=L(Me),x=k(Me,"DIV",{});var Je=S(x);ie=k(Je,"SPAN",{class:!0});var lt=S(ie);A=J(lt,"btn"),lt.forEach(h),Y=L(Je),Z=k(Je,"DIV",{class:!0});var Xe=S(Z);Q=k(Xe,"BUTTON",{class:!0});var at=S(Q);M=J(at,"-"),at.forEach(h),te=L(Xe),oe=k(Xe,"BUTTON",{class:!0});var ut=S(oe);W=J(ut,"+"),ut.forEach(h),Xe.forEach(h),Je.forEach(h),ue=L(Me),U&&U.l(Me),Me.forEach(h),le=L(b),re=k(b,"DIV",{class:!0});var Ye=S(re);for(let Pe=0;Pe<K.length;Pe+=1)K[Pe].l(Ye);ne=L(Ye);for(let Pe=0;Pe<T.length;Pe+=1)T[Pe].l(Ye);Ye.forEach(h),this.h()},h(){_(e,"class","connection input svelte-ank1gn"),_(n,"class","svelte-ank1gn"),_(c,"class","text-p svelte-ank1gn"),_(a,"class","p-container svelte-ank1gn"),_(I,"class","btns-name svelte-ank1gn"),_(N,"class","svelte-ank1gn"),_(B,"class","svelte-ank1gn"),_(v,"class","node-btns-div svelte-ank1gn"),_(ie,"class","btns-name svelte-ank1gn"),_(Q,"class","svelte-ank1gn"),_(oe,"class","svelte-ank1gn"),_(Z,"class","node-btns-div svelte-ank1gn"),_(p,"class","node-btns svelte-ank1gn"),_(re,"class","node-outputs svelte-ank1gn")},m(b,G){O(b,e,G),O(b,t,G),O(b,n,G),g(n,l),g(n,o),O(b,s,G),F&&F.m(b,G),O(b,i,G),O(b,a,G),g(a,c),g(c,f),O(b,d,G),O(b,p,G),g(p,m),g(m,I),g(I,j),g(m,X),g(m,v),g(v,N),g(N,z),g(v,V),g(v,B),g(B,ee),g(p,se),g(p,x),g(x,ie),g(ie,A),g(x,Y),g(x,Z),g(Z,Q),g(Q,M),g(Z,te),g(Z,oe),g(oe,W),g(p,ue),U&&U.m(p,null),O(b,le,G),O(b,re,G);for(let de=0;de<K.length;de+=1)K[de].m(re,null);g(re,ne);for(let de=0;de<T.length;de+=1)T[de].m(re,null);r[28](re),E||(C=[R(e,"mousedown",Se(r[27])),R(e,"click",r[16]),R(N,"click",r[20]),R(B,"click",r[19]),R(Q,"click",r[17]),R(oe,"click",r[21])],E=!0)},p(b,G){G[0]&2&&Ge(o,b[1]),b[2][b[8]]!==void 0&&b[2][b[8]]!==null?F?F.p(b,G):(F=gt(b),F.c(),F.m(i.parentNode,i)):F&&(F.d(1),F=null),G[0]&4&&u!==(u=(b[2][b[9]].length<210?b[2][b[9]]:b[2][b[9]].slice(0,210)+"...")+"")&&Ge(f,u),b[2][b[8]]!==void 0&&b[2][b[8]]!==null?U?U.p(b,G):(U=mt(b),U.c(),U.m(p,null)):U&&(U.d(1),U=null),G[0]&1156&&(pe=b[2][b[7]]||[],K=ze(K,G,be,1,b,pe,P,re,Qe,_t,ne,ht)),G[0]&4&&(ce=b[2].areas||[],T=ze(T,G,fe,1,b,ce,y,re,Qe,vt,null,pt))},d(b){b&&h(e),b&&h(t),b&&h(n),b&&h(s),F&&F.d(b),b&&h(i),b&&h(a),b&&h(d),b&&h(p),U&&U.d(),b&&h(le),b&&h(re);for(let G=0;G<K.length;G+=1)K[G].d();for(let G=0;G<T.length;G+=1)T[G].d();r[28](null),E=!1,De(C)}}}function yt(r){let e,t,n;function l(s){r[30](s)}let o={key:r[1],pos:r[2].display};return r[4]!==void 0&&(o.showEditor=r[4]),e=new xt({props:o}),ge.push(()=>we(e,"showEditor",l)),{c(){me(e.$$.fragment)},l(s){_e(e.$$.fragment,s)},m(s,i){ve(e,s,i),n=!0},p(s,i){const a={};i[0]&2&&(a.key=s[1]),i[0]&4&&(a.pos=s[2].display),!t&&i[0]&16&&(t=!0,a.showEditor=s[4],ke(()=>t=!1)),e.$set(a)},i(s){n||(H(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function bt(r){let e,t,n;function l(s){r[31](s)}let o={key:r[1],pos:r[2].display};return r[5]!==void 0&&(o.showNewOutput=r[5]),e=new nn({props:o}),ge.push(()=>we(e,"showNewOutput",l)),{c(){me(e.$$.fragment)},l(s){_e(e.$$.fragment,s)},m(s,i){ve(e,s,i),n=!0},p(s,i){const a={};i[0]&2&&(a.key=s[1]),i[0]&4&&(a.pos=s[2].display),!t&&i[0]&32&&(t=!0,a.showNewOutput=s[5],ke(()=>t=!1)),e.$set(a)},i(s){n||(H(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function wt(r){let e,t,n;function l(s){r[32](s)}let o={key:r[1],pos:r[2].display};return r[6]!==void 0&&(o.showNewArea=r[6]),e=new fn({props:o}),ge.push(()=>we(e,"showNewArea",l)),{c(){me(e.$$.fragment)},l(s){_e(e.$$.fragment,s)},m(s,i){ve(e,s,i),n=!0},p(s,i){const a={};i[0]&2&&(a.key=s[1]),i[0]&4&&(a.pos=s[2].display),!t&&i[0]&64&&(t=!0,a.showNewArea=s[6],ke(()=>t=!1)),e.$set(a)},i(s){n||(H(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function dn(r){let e,t,n,l,o,s,i;function a(p){r[29](p)}let c={key:r[1],$$slots:{default:[cn]},$$scope:{ctx:r}};r[0]!==void 0&&(c.movingNode=r[0]),e=new rn({props:c}),ge.push(()=>we(e,"movingNode",a));let u=r[4]&&yt(r),f=r[5]&&bt(r),d=r[6]&&wt(r);return{c(){me(e.$$.fragment),n=D(),u&&u.c(),l=D(),f&&f.c(),o=D(),d&&d.c(),s=Ue()},l(p){_e(e.$$.fragment,p),n=L(p),u&&u.l(p),l=L(p),f&&f.l(p),o=L(p),d&&d.l(p),s=Ue()},m(p,m){ve(e,p,m),O(p,n,m),u&&u.m(p,m),O(p,l,m),f&&f.m(p,m),O(p,o,m),d&&d.m(p,m),O(p,s,m),i=!0},p(p,m){const I={};m[0]&2&&(I.key=p[1]),m[0]&14|m[1]&8192&&(I.$$scope={dirty:m,ctx:p}),!t&&m[0]&1&&(t=!0,I.movingNode=p[0],ke(()=>t=!1)),e.$set(I),p[4]?u?(u.p(p,m),m[0]&16&&H(u,1)):(u=yt(p),u.c(),H(u,1),u.m(l.parentNode,l)):u&&(Ve(),$(u,1,1,()=>{u=null}),Re()),p[5]?f?(f.p(p,m),m[0]&32&&H(f,1)):(f=bt(p),f.c(),H(f,1),f.m(o.parentNode,o)):f&&(Ve(),$(f,1,1,()=>{f=null}),Re()),p[6]?d?(d.p(p,m),m[0]&64&&H(d,1)):(d=wt(p),d.c(),H(d,1),d.m(s.parentNode,s)):d&&(Ve(),$(d,1,1,()=>{d=null}),Re())},i(p){i||(H(e.$$.fragment,p),H(u),H(f),H(d),i=!0)},o(p){$(e.$$.fragment,p),$(u),$(f),$(d),i=!1},d(p){ye(e,p),p&&h(n),u&&u.d(p),p&&h(l),f&&f.d(p),p&&h(o),d&&d.d(p),p&&h(s)}}}function pn(r,e,t){let n,l,o,s,i;he(r,ae,y=>t(23,n=y)),he(r,Dt,y=>t(33,l=y)),he(r,ot,y=>t(34,o=y)),he(r,Pt,y=>t(35,s=y)),he(r,Lt,y=>t(36,i=y));let{key:a}=e,{movingNode:c=!1}=e,u=n[a];const f=o(u),d=i(u),p=s(u);let m,I=!1,j=!1,X=!1;u.display===void 0&&(u.display={x:0,y:0,ops:[],areas:[]}),u.display.areas===void 0&&(u.display.areas=[]);function v(){N(this)}function N(y){const E=+y.getAttribute("i");y.style.width=y.value.length*6.1+"px",t(2,u[f][E].btn=y.value,u),ee()}function z(y){B(y,"ops")}function V(y){B(y,"areas")}function B(y,E){const C=+y.getAttribute("i");u.display[E][C]===void 0?t(2,u.display[E][C]={x:y.offsetLeft,y:y.offsetTop,rewiring:!1},u):Object.assign(u.display[E][C],{x:y.offsetLeft,y:y.offsetTop}),Ie(ae,n[a]=u,n)}function ee(){if(m===void 0)return;const y=m.getElementsByClassName("output");for(let E of y)B(E,E.getAttribute("type"))}function se(){const y=Object.keys(n);for(let E of y){const C=n[E],F=o(C);for(let U=0;U<C.display.ops.length;U++){const pe=l(C[F][U]);C.display.ops[U].rewiring&&(C.display.ops[U].rewiring=!1,C[F][U][pe]=C.display.ops[U].prevWiring)}for(let U=0;U<C.display.areas.length;U++){const pe=l(C.areas[U]);C.display.areas[U].rewiring&&(C.display.areas[U].rewiring=!1,C.areas[U][pe]=C.display.areas[U].prevWiring)}Ie(ae,n[E]=C,n)}}function x(y){const E=+y.getAttribute("i"),C=y.getAttribute("type"),F=C==="ops"?f:"areas";y.addEventListener("click",()=>{se();const U=l(u[F][E]);u.display[C][E].rewiring||(t(2,u.display[C][E].prevWiring=u[F][E][U],u),t(2,u.display[C][E].rewiring=!0,u),t(2,u[F][E][U]=void 0,u))})}function ie(){const y=Object.keys(n);let E,C;for(let be of y){const ce=n[be];for(let fe=0;fe<ce.display.ops.length;fe++){const b=ce.display.ops[fe];b.rewiring&&(b.rewiring=!1,E={scene:ce,i:fe},C="ops")}for(let fe=0;fe<ce.display.areas.length;fe++){const b=ce.display.areas[fe];b.rewiring&&(b.rewiring=!1,E={scene:ce,i:fe},C="areas")}}if(E===void 0)return;const F=o(E.scene),U=C==="ops"?F:"areas",pe=l(E.scene[U][E.i]);E.scene[U][E.i][pe]=a}function A(){u[f]!==void 0&&(u[f].pop(),u.display.ops.pop(),ae.set(n))}function Y(){u.areas!==void 0&&(u.areas.pop(),u.display.areas.pop(),ae.set(n))}function Z(){for(let y of Object.keys(n)){const E=o(n[y]);if(n[y][E]!==void 0)for(let C of n[y][E]){const F=l(C);C[F]===a&&(C[F]=void 0)}}delete n[a],ae.set(n)}function Q(){t(4,I=!0)}function M(){t(5,j=!0)}function te(){t(6,X=!0)}function oe(y){Ne.call(this,r,y)}function W(y){Ne.call(this,r,y)}function ue(y){Ne.call(this,r,y)}function le(y){Ne.call(this,r,y)}function re(y){ge[y?"unshift":"push"](()=>{m=y,t(3,m)})}function K(y){c=y,t(0,c)}function P(y){I=y,t(4,I)}function ne(y){j=y,t(5,j)}function T(y){X=y,t(6,X)}return r.$$set=y=>{"key"in y&&t(1,a=y.key),"movingNode"in y&&t(0,c=y.movingNode)},r.$$.update=()=>{r.$$.dirty[0]&8388610&&t(2,u=n[a])},[c,a,u,m,I,j,X,f,d,p,v,N,z,V,ee,x,ie,A,Y,Z,Q,M,te,n,oe,W,ue,le,re,K,P,ne,T]}class hn extends Te{constructor(e){super(),Ce(this,e,pn,dn,Oe,{key:1,movingNode:0},null,[-1,-1])}}function kt(r,e,t){const n=r.slice();return n[6]=e[t],n[8]=t,n}function Et(r,e,t){const n=r.slice();return n[6]=e[t],n[8]=t,n}function Nt(r,e){let t,n,l,o,s;return{key:r,first:null,c(){t=xe("line"),this.h()},l(i){t=$e(i,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0}),S(t).forEach(h),this.h()},h(){_(t,"class","op-connection svelte-1lsc27u"),_(t,"x1",n=e[0].display.x+e[6].x+7),_(t,"y1",l=e[0].display.y+e[6].y+10),_(t,"x2",o=e[2][e[8]].x+5),_(t,"y2",s=e[2][e[8]].y+5),this.first=t},m(i,a){O(i,t,a)},p(i,a){e=i,a&1&&n!==(n=e[0].display.x+e[6].x+7)&&_(t,"x1",n),a&1&&l!==(l=e[0].display.y+e[6].y+10)&&_(t,"y1",l),a&5&&o!==(o=e[2][e[8]].x+5)&&_(t,"x2",o),a&5&&s!==(s=e[2][e[8]].y+5)&&_(t,"y2",s)},d(i){i&&h(t)}}}function St(r,e){let t,n,l,o,s;return{key:r,first:null,c(){t=xe("line"),this.h()},l(i){t=$e(i,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0}),S(t).forEach(h),this.h()},h(){_(t,"class","a-connection svelte-1lsc27u"),_(t,"x1",n=e[0].display.x+e[6].x+7),_(t,"y1",l=e[0].display.y+e[6].y+10),_(t,"x2",o=e[1][e[8]].x+5),_(t,"y2",s=e[1][e[8]].y+5),this.first=t},m(i,a){O(i,t,a)},p(i,a){e=i,a&1&&n!==(n=e[0].display.x+e[6].x+7)&&_(t,"x1",n),a&1&&l!==(l=e[0].display.y+e[6].y+10)&&_(t,"y1",l),a&3&&o!==(o=e[1][e[8]].x+5)&&_(t,"x2",o),a&3&&s!==(s=e[1][e[8]].y+5)&&_(t,"y2",s)},d(i){i&&h(t)}}}function gn(r){let e,t=[],n=new Map,l,o=[],s=new Map,i=r[0].display.ops||[];const a=f=>"op"+f[8];for(let f=0;f<i.length;f+=1){let d=Et(r,i,f),p=a(d);n.set(p,t[f]=Nt(p,d))}let c=r[0].display.areas||[];const u=f=>"a"+f[8];for(let f=0;f<c.length;f+=1){let d=kt(r,c,f),p=u(d);s.set(p,o[f]=St(p,d))}return{c(){e=xe("g");for(let f=0;f<t.length;f+=1)t[f].c();l=Ue();for(let f=0;f<o.length;f+=1)o[f].c()},l(f){e=$e(f,"g",{});var d=S(e);for(let p=0;p<t.length;p+=1)t[p].l(d);l=Ue();for(let p=0;p<o.length;p+=1)o[p].l(d);d.forEach(h)},m(f,d){O(f,e,d);for(let p=0;p<t.length;p+=1)t[p].m(e,null);g(e,l);for(let p=0;p<o.length;p+=1)o[p].m(e,null)},p(f,[d]){d&5&&(i=f[0].display.ops||[],t=ze(t,d,a,1,f,i,n,e,Qe,Nt,l,Et)),d&3&&(c=f[0].display.areas||[],o=ze(o,d,u,1,f,c,s,e,Qe,St,null,kt))},i:Le,o:Le,d(f){f&&h(e);for(let d=0;d<t.length;d+=1)t[d].d();for(let d=0;d<o.length;d+=1)o[d].d()}}}function mn(r,e,t){let n,l,o;he(r,ae,c=>t(5,o=c));let{key:s}=e,{mouse:i}=e,a=o[s];return r.$$set=c=>{"key"in c&&t(3,s=c.key),"mouse"in c&&t(4,i=c.mouse)},r.$$.update=()=>{r.$$.dirty&40&&t(0,a=o[s]),r.$$.dirty&49&&t(2,n=(a.options||a.opciones||[]).map((c,u)=>{const f=c.escena||c.scene;return f===void 0?a.display.ops[u].rewiring?i:a.display:o[f].display})),r.$$.dirty&49&&t(1,l=(a.areas||[]).map((c,u)=>{const f=c.escena||c.scene;return f===void 0?a.display.areas[u].rewiring?i:a.display:o[f].display}))},[a,l,n,s,i,o]}class _n extends Te{constructor(e){super(),Ce(this,e,mn,gn,Oe,{key:3,mouse:4})}}function vn(r){let e,t,n,l,o,s,i,a,c,u,f,d,p,m,I;function j(v){r[7](v)}let X={};return r[0]!==void 0&&(X.toggle=r[0]),e=new We({props:X}),ge.push(()=>we(e,"toggle",j)),{c(){me(e.$$.fragment),n=D(),l=w("div"),o=w("label"),s=q("Escena:"),i=D(),a=w("input"),c=D(),u=w("div"),f=w("button"),d=q("Aceptar"),this.h()},l(v){_e(e.$$.fragment,v),n=L(v),l=k(v,"DIV",{});var N=S(l);o=k(N,"LABEL",{for:!0});var z=S(o);s=J(z,"Escena:"),z.forEach(h),i=L(N),a=k(N,"INPUT",{id:!0,type:!0}),N.forEach(h),c=L(v),u=k(v,"DIV",{class:!0});var V=S(u);f=k(V,"BUTTON",{});var B=S(f);d=J(B,"Aceptar"),B.forEach(h),V.forEach(h),this.h()},h(){_(o,"for","inp"),_(a,"id","inp"),_(a,"type","text"),_(u,"class","bar svelte-1bhrmvp")},m(v,N){ve(e,v,N),O(v,n,N),O(v,l,N),g(l,o),g(o,s),g(l,i),g(l,a),Ee(a,r[2]),O(v,c,N),O(v,u,N),g(u,f),g(f,d),p=!0,m||(I=[R(a,"input",r[8]),R(a,"mousedown",Se(r[6])),R(f,"click",r[4])],m=!0)},p(v,N){const z={};!t&&N&1&&(t=!0,z.toggle=v[0],ke(()=>t=!1)),e.$set(z),N&4&&a.value!==v[2]&&Ee(a,v[2])},i(v){p||(H(e.$$.fragment,v),p=!0)},o(v){$(e.$$.fragment,v),p=!1},d(v){ye(e,v),v&&h(n),v&&h(l),v&&h(c),v&&h(u),m=!1,De(I)}}}function yn(r){let e,t,n;function l(s){r[9](s)}let o={pos:r[3],$$slots:{default:[vn]},$$scope:{ctx:r}};return r[1]!==void 0&&(o.displace=r[1]),e=new He({props:o}),ge.push(()=>we(e,"displace",l)),{c(){me(e.$$.fragment)},l(s){_e(e.$$.fragment,s)},m(s,i){ve(e,s,i),n=!0},p(s,[i]){const a={};i&4101&&(a.$$scope={dirty:i,ctx:s}),!t&&i&2&&(t=!0,a.displace=s[1],ke(()=>t=!1)),e.$set(a)},i(s){n||(H(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function bn(r){const e=["\xE1","\xE9","\xED","\xF3","\xFA","\xFC","\xF1"],t=["a","e","i","o","u","u","n"],n=r.toLowerCase();let l="";for(let o=0;o<r.length;o++){const s=n.charAt(o),i=r.charAt(o);if(e.includes(s)){let a;for(let c=0;c<e.length;c++)if(e[c]===s){a=c;break}i===i.toUpperCase()?l+=t[a].toUpperCase():l+=t[a]}else l+=i}return l}function wn(r,e,t){let n,l;he(r,ae,I=>t(11,l=I));let{showNewScene:o}=e,{offset:s}=e,i=l,a={x:s.x*-1+20,y:s.y*-1+20},c;function u(){if(/^\d/.test(n)===!0){alert(`El nombre de la escena no puede empezar con un n\xFAmero /
The name of the scene cannot start with a number`);return}let I=n.replace(/\s/gi,"_").replace(/\W/,"").replace(/[;.,:{}()<>$%&!¡?¿"'/\\#@&*+-]/gi,"");I=bn(I),i[I]={text:"",display:{x:a.x,y:a.y,ops:[],areas:[]}},Ie(ae,l[I]=i[I],l),t(0,o=!1)}function f(I){Ne.call(this,r,I)}function d(I){o=I,t(0,o)}function p(){n=this.value,t(2,n)}function m(I){c=I,t(1,c)}return r.$$set=I=>{"showNewScene"in I&&t(0,o=I.showNewScene),"offset"in I&&t(5,s=I.offset)},t(2,n=""),[o,c,n,a,u,s,f,d,p,m]}class kn extends Te{constructor(e){super(),Ce(this,e,wn,yn,Oe,{showNewScene:0,offset:5})}}function It(r){let e,t,n;function l(s){r[10](s)}let o={offset:r[1]};return r[0]!==void 0&&(o.showNewScene=r[0]),e=new kn({props:o}),ge.push(()=>we(e,"showNewScene",l)),{c(){me(e.$$.fragment)},l(s){_e(e.$$.fragment,s)},m(s,i){ve(e,s,i),n=!0},p(s,i){const a={};i&2&&(a.offset=s[1]),!t&&i&1&&(t=!0,a.showNewScene=s[0],ke(()=>t=!1)),e.$set(a)},i(s){n||(H(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function En(r){let e,t,n,l,o;const s=r[9].default,i=et(s,r,r[8],null);let a=r[0]&&It(r);return{c(){e=w("div"),i&&i.c(),t=D(),a&&a.c(),this.h()},l(c){e=k(c,"DIV",{class:!0});var u=S(e);i&&i.l(u),t=L(u),a&&a.l(u),u.forEach(h),this.h()},h(){_(e,"class","node-page svelte-1e9gr7d")},m(c,u){O(c,e,u),i&&i.m(e,null),g(e,t),a&&a.m(e,null),n=!0,l||(o=[Ae(r[2].call(null,e)),R(e,"mousedown",r[3]),R(e,"mouseup",r[4]),R(e,"mousemove",r[5])],l=!0)},p(c,[u]){i&&i.p&&(!n||u&256)&&tt(i,s,c,c[8],n?st(s,c[8],u,null):nt(c[8]),null),c[0]?a?(a.p(c,u),u&1&&H(a,1)):(a=It(c),a.c(),H(a,1),a.m(e,null)):a&&(Ve(),$(a,1,1,()=>{a=null}),Re())},i(c){n||(H(i,c),H(a),n=!0)},o(c){$(i,c),$(a),n=!1},d(c){c&&h(e),i&&i.d(c),a&&a.d(),l=!1,De(o)}}}function Nn(r,e,t){let n,l,o;he(r,ae,N=>t(12,n=N)),he(r,Dt,N=>t(13,l=N)),he(r,ot,N=>t(14,o=N));let{$$slots:s={},$$scope:i}=e,{movingNode:a}=e,{mouse:c}=e,{showNewScene:u}=e,f=!1;const d={x:0,y:0};function p(N){N.style.left=`${d.x}px`,N.style.top=`${d.y}px`}function m(){const N=Object.keys(n);for(let z of N){const V=n[z],B=o(V);for(let ee=0;ee<V.display.ops.length;ee++){const se=l(V[B][ee]);V.display.ops[ee].rewiring&&(V.display.ops[ee].rewiring=!1,V[B][ee][se]=V.display.ops[ee].prevWiring)}Ie(ae,n[z]=V,n)}}function I(){f=!0,this.style.cursor="grabbing",m()}function j(){f=!1,this.style.cursor="grab"}function X(N){if(f&&!a){const V=+getComputedStyle(this.offsetParent).width.replace("px",""),B=+getComputedStyle(this).width.replace("px",""),ee=+getComputedStyle(this.offsetParent).height.replace("px",""),se=+getComputedStyle(this).height.replace("px","");t(1,d.x+=N.movementX,d),t(1,d.y+=N.movementY,d),t(1,d.x=d.x>0?0:V-d.x>B?V-B:d.x,d),t(1,d.y=d.y>0?0:ee-d.y>se?ee-se:d.y,d),this.style.left=`${d.x}px`,this.style.top=`${d.y}px`}t(6,c={x:N.offsetX,y:N.offsetY});let z=N.target;for(;z!==this;)t(6,c.x+=z.offsetLeft,c),t(6,c.y+=z.offsetTop,c),z=z.offsetParent}function v(N){u=N,t(0,u)}return r.$$set=N=>{"movingNode"in N&&t(7,a=N.movingNode),"mouse"in N&&t(6,c=N.mouse),"showNewScene"in N&&t(0,u=N.showNewScene),"$$scope"in N&&t(8,i=N.$$scope)},[u,d,p,I,j,X,c,a,i,s,v]}class Sn extends Te{constructor(e){super(),Ce(this,e,Nn,En,Oe,{movingNode:7,mouse:6,showNewScene:0})}}class In{constructor(e="en",t){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,igramaFormat:"png",minigifOptions:{},sceneCallback:n=>n},t&&(this.options=Object.assign(this.options,t)),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[t,n]of Object.entries(e.grammar));return this}setScenes(e){this.scenes=e;for(let t of Object.keys(e)){this.scenes[t].key=t;const n=this.scenes[t].image||this.scenes[t].imagen;n!==void 0&&this.storyPreload[n]===void 0&&(this.storyPreload[n]=new Image,this.storyPreload[n].src=n,this.storyPreload[n].className="storyimage")}return this}setMarkov(e){return this.markov=e,this}expandGrammar(e){const t=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(t)}expandIgrama(e){const t=this.igrama.grammar,n=this.selectGrammarRule(t[e]);return this.grammarRuleRecursion(n,t).split("|").map(o=>this.decodeDrawing(o))}grammarRuleRecursion(e,t){let n=t||this.grammar,l=this.setNewRules(e);const o=l.match(/<[\w\d.,/#]+>/gi);if(!o)return l;for(let s of o){const i=this.defineTransformations(s);l=l.replace(s,()=>{s=s.replace(/[<>]/gi,""),s=s.replace(/#[\w\d.,/]+#/g,"");const a=s.search(/[.]/)>-1?this.getNestedObject(n,s.match(/[\w\d]+/g)):n[s];if(!a){const u=this.lang==="es"?`Se intent\xF3 expandir desde la regla "${s}", pero no se pudo encontrar`:`Tried to expand from rule "${s}", but couldn't find it`;console.error(u)}const c=this.selectGrammarRule(a);return this.transformString(c,i)})}return this.grammarRuleRecursion(l,n)}setNewRules(e,t){let n;t===void 0?n=this.grammar:n=t;let l=e;const o=l.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(o)for(;o.length;){const s=o.pop();l=l.replace(s,"");const{symbol:i,pairsString:a}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(s).groups,c=a.match(/[-]?[\w\d]+:[\w\d]+/gi).map(u=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(u).groups);if(c){n[i]=n[i]||{};for(let u of c){const f=n[u.value];if(!f){const m=this.lang==="es"?`Se intent\xF3 crear la nueva regla "${i}", pero no se pudo encontrar "${u.value}" para producir la subregla "${u.key}"`:`Tried to create new rule: "${i}", but couldn't find "${u.value}" to produce "${u.key}" subrule`;console.error(m)}const d=u.remove==="-",p=this.selectGrammarRule(f);if(d){const m=f.indexOf(p);n[u.value]=[...f.slice(0,m),...f.slice(m+1)]}n[i][u.key]=[p]}}}return l}startAdventure(e){this.options.defaultCSS&&this.setCSS();const t=document.createElement("div");return t.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(t),this.goToScene(this.scenes[e]),this}goToScene(e){const t=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(a=>a.remove()),[...document.getElementsByClassName("storyimage-area")].map(i=>i.remove());const l=document.createElement("div");if(l.className="storydiv",t.appendChild(l),e.image||e.imagen){const i=document.createElement("div");i.className="storyimage-container",l.appendChild(i);const a=e.image||e.imagen,c=this.options.adventureScroll?this.storyPreload[a].cloneNode():this.storyPreload[a];i.appendChild(c),e.areas&&(c.complete?this.setAreas(c,i,e.areas):c.onload=()=>{this.setAreas(c,i,e.areas)})}else if(e.igrama!==void 0){const i=document.createElement("div");i.className="storyimage-container",l.appendChild(i);const a=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(a),this.igramaDataUrl(a,this.options.igramaFormat).then(c=>{const u=new Image;u.src=c,u.className="storyimage",i.appendChild(u)})}const o=document.createElement("div");o.className="storyp-container",(e.text||e.texto||e.igramaText)&&l.appendChild(o);const s=document.createElement("p");s.className="storyp",s.innerHTML="",o.appendChild(s),document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(s,e),this.options.sceneCallback(e)}setAreas(e,t,n){const l=e.getBoundingClientRect(),o=t.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,t,n)},[...document.getElementsByClassName("storyimage-area")].map(i=>i.remove());for(let i of n){let a=document.createElement("div");a.className="storyimage-area";const c=(i.x-Math.floor(i.w/2))*l.width/e.naturalWidth;a.style.left=`${l.left-o.left+c}px`;const u=(i.y-Math.floor(i.h/2))*l.height/e.naturalHeight;a.style.top=`${l.top-o.top+u}px`,a.style.width=`${i.w*l.width/e.naturalWidth}px`,a.style.height=`${i.h*l.height/e.naturalHeight}px`,a.innerHTML=i.btn||"",t.appendChild(a),a.style.fontSize=`${18*l.height/e.naturalHeight}px`,a.onclick=()=>{const f=i.scene||i.escena;this.goToScene(this.scenes[f])},i.tooltip!==void 0&&(a.onmouseover=()=>{a.innerHTML=i.tooltip||"",a.style.zIndex="100"},a.onmouseout=()=>{a.innerHTML=i.btn||"",a.style.zIndex="0"})}}typewriter(e,t){const n=t.text||t.texto||t.igramaText||"";let l=this.grammar?this.grammarRuleRecursion(n):n;if(l=l.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let o=0;const s=setInterval(()=>{const i=l.substring(0,o);e.innerHTML=i,o++,o>l.length&&(clearInterval(s),this.optionButtons(t))},Math.floor(this.options.typewriterSpeed))}else e.innerHTML=l,this.optionButtons(t)}optionButtons(e){const t=[...document.getElementsByClassName("storydiv")],n=t[t.length-1];[...document.getElementsByClassName("storybutton-container")].map(s=>s.remove());const o=document.createElement("div");if(o.className="storybutton-container",n.appendChild(o),e.options||e.opciones){const s=e.options||e.opciones;for(let i of s){const a=document.createElement("button");a.className="storybutton",a.innerHTML=i.btn,o.appendChild(a),a.addEventListener("click",()=>{if((i.text||i.texto)===void 0){const u=i.scene||i.escena;this.goToScene(this.scenes[u])}else this.goToScene(i)})}}else if(e.scene||e.escena){const s=e.scene||e.escena,i=document.createElement("button");i.className="storybutton",i.innerHTML=this.lang==="en"?"Continue":"Continuar",o.appendChild(i),i.addEventListener("click",()=>{this.goToScene(this.scenes[s])})}document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const l=Math.random()*e.prob.reduce((s,i)=>s+i);let o=0;for(let s=0;s<e.prob.length;s++){if(o<=l&&l<o+e.prob[s])return e[s];o+=e.prob[s]}}const t=Math.floor(Math.random()*e.length);return e[t]}getNestedObject(e,t){return t.reduce((n,l)=>n&&n[l]!==void 0?n[l]:void 0,e)}defineTransformations(e){let t={};const n=/#(?<trans>[\w\d,]+)#/gi.exec(e),l=n?n.groups.trans.match(/[\w]+/gi):[];for(let o of l)t[o]=!0;return t}transformString(e,t){let n=e;return t.CAPITALIZE&&(n=n.charAt(0).toUpperCase()+n.slice(1)),t.ALLCAPS&&(n=n.toUpperCase()),n}decodeDrawing(e){if(e==="")return[];const[t,n,l]=e.split("%%");let o={};return t==="vector"?o.content=n.split("**").map(s=>{const[i,a,c]=s.split("&"),u=[];if(u.color=i,u.weight=a,c===void 0)return u;const f=c.split(",");for(let d=0;d<f.length;d+=2)u.push([+f[d],+f[d+1]]);return u}):o.content=n,o.attribute=l,o.type=t,o}async getMarkovModel(e,t=1,n=!1){let l=await(await fetch(`./${e}`)).text();l=l.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const o=l.split(this.markovSeparator),s={};for(let a=0;a<o.length-t;a++){let c="";for(let f=0;f<t;f++)c+=f===0?o[a+f]:" "+o[a+f];s[c]===void 0&&(s[c]={});const u=o[a+t];s[c][u]===void 0?s[c][u]=1:s[c][u]++}const i={};for(let a of Object.keys(s)){const c=Object.keys(s[a]);i[a]={probs:[],grams:c};let u=0;for(let f=0;f<c.length;f++)u+=s[a][c[f]];for(let f=0;f<c.length;f++)i[a].probs[f]=s[a][c[f]]/u}if(n){const a=e.split("/");this.saveJSON(i,`${a[a.length-1]}_markovModel_${t}N.json`)}return i}markovChain(e,t,n=.1){let l=t===void 0||this.markov[t]===void 0?this.randomMarkovWord():t,o=l;for(let i=0;i<e-1;i++){let a=this.getNextMarkov(this.markov[o]);a===void 0&&(a=this.getNextMarkov(this.randomMarkovWord()));let c=o.split(this.markovSeparator);c.push(a),c=c.slice(1).join(" "),o=c,l+=` ${a}`}return this.formatMarkov(l,n)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const t=Math.random();let n=0;if(e!==void 0)for(let l=0;l<e.probs.length;l++){if(n<=t&&t<n+e.probs[l])return e.grams[l];n+=e.probs[l]}}formatMarkov(e,t=.1){let n=e.replace(/ ([,:.;])/g,"$1");return n=n.replaceAll(/([.]) ([\wáéíóú])/ig,(l,o,s,i,a)=>Math.random()<t?`.
${s.toUpperCase()}`:`. ${s.toUpperCase()}`),n.charAt(0).toUpperCase()+n.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),n.setAttribute("download",`${t.includes(".json")?t:t+".json"}`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}testScenes(e){const t=e||this.scenes;if(!t){const l=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(l)}let n=[];for(let l of Object.keys(t)){const o=t[l];if(o.options||o.opciones){const i=(o.options||o.opciones).filter(a=>!t[a.scene||a.escena]);n=[...n,...i.map(a=>`${l} => ${a.btn} => ${a.scene||a.escena}`)]}else{if(o.deadEnd||o.sinSalida)continue;t[o.scene||o.escena]||n.push(`${l} => ${o.scene||o.escena}`)}}if(n.length>0){const l=this.lang==="es"?`Las siguientes escenas no llevan a ning\xFAn lado: ${n.join(", ")}`:`The following scenes are dead ends: ${n.join(", ")}`;console.error(l),this.scenesError=!0}return this}testGrammar(e){const t=e||this.grammar;if(!t){const n=this.lang==="es"?"No hay gram\xE1tica para probar":"There is not grammar to test";console.error(n)}for(let n of Object.keys(t)){const l=t[n];for(let o of l){const s=o.match(/<([\w\d]+)>/gi),i=s?s.map(f=>f.replace(/[<>]/g,"")):[],a=o.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),c=a?a.map(f=>f.match(/([ ]?:[\w\d]+)/g).map(d=>/[ ]?:(?<key>[\w\d]+)/.exec(d).groups.key)).reduce((f,d)=>[...f,...d],[]):[],u=[...i,...c].filter(f=>!t[f]);if(u.length>0){const f=this.lang==="es"?`Las siguientes reglas, que se referencian en "${n}", no existen: ${u.join(", ")}`:`The following rules, referenced in "${n}", do not exist: ${u.join(", ")}`;this.grammarError=!0,console.error(f)}}}return this}testDistribution(e){const t=e||this.markov;if(t===void 0){const c=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(c)}const n={},l={};let o=0;const s=Object.values(t);for(let c of s)for(let u of c.probs){const f=(Math.round(u/.05)*.05).toFixed(2);l[o]=f,o++,n[f]===void 0?n[f]=1:n[f]++}console.log("------------------------------------ DIST ------------------------------------");const i=Math.max(...Object.values(n)),a=Object.entries(n).sort((c,u)=>c[0]>u[0]?1:c[0]<u[0]?-1:0);for(let c of a)console.log(`${c[0]}... ${"|".repeat(Math.ceil(c[1]*100/i))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,t="png",n){const l=await this.igramaDataUrl(e,t),o=new Image;o.src=l,n==null?document.body.appendChild(o):document.getElementById(n).appendChild(o)}async igramaDataUrl(e,t="png"){const n=this.igrama.metadata.width,l=this.igrama.metadata.height;let o=document.createElement("canvas");o.width=n,o.height=l;const s=o.getContext("2d");s.lineJoin="round",s.lineCap="round",s.fillStyle=this.igrama.metadata.bg||"#FFFFFF",s.fillRect(0,0,n,l),await this.drawLayers(e,s);let i;if(t==="png")i=o.toDataURL();else if(t==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener tambi\xE9n la librer\xEDa MiniGif":"To create Gifs you must have also the MiniGif library"),"";const a={colorResolution:7,dither:!1,delay:50};Object.assign(a,this.minigifOptions);const c=new MiniGif(a);c.addFrame(o);const u=this.getLayerWiggle(e);s.fillStyle=this.igrama.metadata.bg||"#FFFFFF",s.fillRect(0,0,n,l),await this.drawLayers(u,s),c.addFrame(o);const f=c.makeGif(),d=await this.base64_arraybuffer(f);i="data:image/gif;base64,"+d}return o.remove(),i}async base64_arraybuffer(e){return(await new Promise(n=>{const l=new FileReader;l.onload=()=>n(l.result),l.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const n=JSON.parse(JSON.stringify(e)),l=(o,s)=>Math.floor(o+Math.random()*(s-o));for(let[o,s]of n.entries())if(s.type==="vector")for(let[i,a]of s.content.entries()){for(let[c,u]of a.entries())Math.random()<.5?u[0]+=l(-3,3):u[1]+=l(-3,3);a.color=e[o].content[i].color,a.weight=e[o].content[i].weight}return n}getIgramaText(e){return e.map(n=>n.attribute).reverse().join(" ").trim()}async drawLayers(e,t){for(let[n,l]of e.entries())if(l.type==="url"){const{w:o,h:s,x:i,y:a}=this.igrama.sections[n];if(this.imgsMemo[l.content]===void 0){const c=new Image;c.src=l.content,this.imgsMemo[l.content]=await new Promise(u=>{c.addEventListener("load",()=>{u(c)},!1)})}t.drawImage(this.imgsMemo[l.content],i,a,o,s)}else if(l.type=="vector")for(let o of l.content){if(o.length===0)continue;const s=this.getSpline(o);this.drawSpline(s,t,o.color,o.weight)}}drawSpline(e,t,n,l){t.lineWidth=l,t.strokeStyle=n,t.fillStyle="rgba(0,0,0,0)",t.beginPath();for(let o=0;o<e.length;o++)o===0?t.moveTo(...e[0]):t.lineTo(...e[o]);t.stroke()}getSpline(e){let t=[];for(let n=0;n<e.length-1;n++){const l=[];l[0]=n>0?e[n-1]:e[0],l[1]=e[n],l[2]=e[n+1],l[3]=n<e.length-2?e[n+2]:e[e.length-1];for(let o=0;o<1;o+=.05){const s=this.getSplinePoint(o,l);t.push(s)}}return t}getSplinePoint(e,t){const n=Math.floor(e)+1,l=n+1,o=l+1,s=n-1,i=e*e,a=i*e,c=-a+2*i-e,u=3*a-5*i+2,f=-3*a+4*i+e,d=a-i,p=.5*(t[s][0]*c+t[n][0]*u+t[l][0]*f+t[o][0]*d),m=.5*(t[s][1]*c+t[n][1]*u+t[l][1]*f+t[o][1]*d);return[p,m]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=Tn,document.getElementsByTagName("head")[0].appendChild(e)}}const Tn=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 10px;
  flex-direction: column;
  box-sizing: border-box;
}

.storyp {
  font-size: 18px;
  min-height: 25px;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  font-size: 14px;
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: #ffffff00;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: #ffffff33;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,Cn=je(In);function Tt(r,e,t){const n=r.slice();return n[25]=e[t],n}function Ct(r,e,t){const n=r.slice();return n[25]=e[t],n}function Ot(r,e){let t,n,l,o,s,i;function a(u){e[16](u)}let c={key:e[25]};return e[0]!==void 0&&(c.movingNode=e[0]),n=new hn({props:c}),ge.push(()=>we(n,"movingNode",a)),{key:r,first:null,c(){t=w("div"),me(n.$$.fragment),this.h()},l(u){t=k(u,"DIV",{class:!0});var f=S(t);_e(n.$$.fragment,f),f.forEach(h),this.h()},h(){_(t,"class","scene-node-container"),this.first=t},m(u,f){O(u,t,f),ve(n,t,null),o=!0,s||(i=R(t,"mouseenter",Dn),s=!0)},p(u,f){e=u;const d={};f&16&&(d.key=e[25]),!l&&f&1&&(l=!0,d.movingNode=e[0],ke(()=>l=!1)),n.$set(d)},i(u){o||(H(n.$$.fragment,u),o=!0)},o(u){$(n.$$.fragment,u),o=!1},d(u){u&&h(t),ye(n),s=!1,i()}}}function Mt(r,e){let t,n,l;return n=new _n({props:{key:e[25],mouse:e[5]}}),{key:r,first:null,c(){t=Ue(),me(n.$$.fragment),this.h()},l(o){t=Ue(),_e(n.$$.fragment,o),this.h()},h(){this.first=t},m(o,s){O(o,t,s),ve(n,o,s),l=!0},p(o,s){e=o;const i={};s&16&&(i.key=e[25]),s&32&&(i.mouse=e[5]),n.$set(i)},i(o){l||(H(n.$$.fragment,o),l=!0)},o(o){$(n.$$.fragment,o),l=!1},d(o){o&&h(t),ye(n,o)}}}function On(r){let e=[],t=new Map,n,l,o=[],s=new Map,i,a=r[4];const c=d=>d[25];for(let d=0;d<a.length;d+=1){let p=Ct(r,a,d),m=c(p);t.set(m,e[d]=Ot(m,p))}let u=r[4];const f=d=>d[25];for(let d=0;d<u.length;d+=1){let p=Tt(r,u,d),m=f(p);s.set(m,o[d]=Mt(m,p))}return{c(){for(let d=0;d<e.length;d+=1)e[d].c();n=D(),l=xe("svg");for(let d=0;d<o.length;d+=1)o[d].c();this.h()},l(d){for(let m=0;m<e.length;m+=1)e[m].l(d);n=L(d),l=$e(d,"svg",{class:!0});var p=S(l);for(let m=0;m<o.length;m+=1)o[m].l(p);p.forEach(h),this.h()},h(){_(l,"class","connections-container svelte-1htln5w")},m(d,p){for(let m=0;m<e.length;m+=1)e[m].m(d,p);O(d,n,p),O(d,l,p);for(let m=0;m<o.length;m+=1)o[m].m(l,null);i=!0},p(d,p){p&17&&(a=d[4],Ve(),e=ze(e,p,c,1,d,a,t,n.parentNode,ft,Ot,n,Ct),Re()),p&48&&(u=d[4],Ve(),o=ze(o,p,f,1,d,u,s,l,ft,Mt,null,Tt),Re())},i(d){if(!i){for(let p=0;p<a.length;p+=1)H(e[p]);for(let p=0;p<u.length;p+=1)H(o[p]);i=!0}},o(d){for(let p=0;p<e.length;p+=1)$(e[p]);for(let p=0;p<o.length;p+=1)$(o[p]);i=!1},d(d){for(let p=0;p<e.length;p+=1)e[p].d(d);d&&h(n),d&&h(l);for(let p=0;p<o.length;p+=1)o[p].d()}}}function At(r){let e,t;return e=new He({props:{pos:r[6],$$slots:{default:[Mn]},$$scope:{ctx:r}}}),{c(){me(e.$$.fragment)},l(n){_e(e.$$.fragment,n)},m(n,l){ve(e,n,l),t=!0},p(n,l){const o={};l&1073741828&&(o.$$scope={dirty:l,ctx:n}),e.$set(o)},i(n){t||(H(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){ye(e,n)}}}function Mn(r){let e,t,n,l,o,s,i;function a(u){r[19](u)}let c={};return r[2]!==void 0&&(c.toggle=r[2]),e=new We({props:c}),ge.push(()=>we(e,"toggle",a)),{c(){me(e.$$.fragment),n=D(),l=w("div"),this.h()},l(u){_e(e.$$.fragment,u),n=L(u),l=k(u,"DIV",{class:!0,id:!0}),S(l).forEach(h),this.h()},h(){_(l,"class","test-story-container svelte-1htln5w"),_(l,"id","test-story-container")},m(u,f){ve(e,u,f),O(u,n,f),O(u,l,f),o=!0,s||(i=Ae(r[11].call(null,l)),s=!0)},p(u,f){const d={};!t&&f&4&&(t=!0,d.toggle=u[2],ke(()=>t=!1)),e.$set(d)},i(u){o||(H(e.$$.fragment,u),o=!0)},o(u){$(e.$$.fragment,u),o=!1},d(u){ye(e,u),u&&h(n),u&&h(l),s=!1,i()}}}function An(r){let e,t,n,l,o,s,i,a,c,u,f,d,p,m,I,j,X,v,N,z,V,B,ee,se,x,ie,A,Y,Z,Q,M,te,oe,W;function ue(P){r[17](P)}function le(P){r[18](P)}let re={movingNode:r[0],$$slots:{default:[On,({offset:P})=>({24:P}),({offset:P})=>P?16777216:0]},$$scope:{ctx:r}};r[1]!==void 0&&(re.showNewScene=r[1]),r[5]!==void 0&&(re.mouse=r[5]),A=new Sn({props:re}),ge.push(()=>we(A,"showNewScene",ue)),ge.push(()=>we(A,"mouse",le));let K=r[2]&&At(r);return{c(){e=w("input"),t=D(),n=w("div"),l=w("div"),o=w("div"),s=w("button"),i=q("Nuevo proyecto"),a=D(),c=w("label"),u=q("Importar"),f=D(),d=w("button"),p=q("Exportar"),m=D(),I=w("button"),j=q("Previsualizar"),X=D(),v=w("button"),N=q("Generar interactivo final"),z=D(),V=w("div"),B=w("button"),ee=q("Nueva escena"),se=D(),x=w("div"),ie=w("div"),me(A.$$.fragment),Q=D(),K&&K.c(),M=Ue(),this.h()},l(P){e=k(P,"INPUT",{type:!0,id:!0}),t=L(P),n=k(P,"DIV",{class:!0});var ne=S(n);l=k(ne,"DIV",{class:!0});var T=S(l);o=k(T,"DIV",{class:!0});var y=S(o);s=k(y,"BUTTON",{class:!0});var E=S(s);i=J(E,"Nuevo proyecto"),E.forEach(h),a=L(y),c=k(y,"LABEL",{class:!0,for:!0});var C=S(c);u=J(C,"Importar"),C.forEach(h),f=L(y),d=k(y,"BUTTON",{class:!0});var F=S(d);p=J(F,"Exportar"),F.forEach(h),m=L(y),I=k(y,"BUTTON",{class:!0});var U=S(I);j=J(U,"Previsualizar"),U.forEach(h),X=L(y),v=k(y,"BUTTON",{class:!0});var pe=S(v);N=J(pe,"Generar interactivo final"),pe.forEach(h),y.forEach(h),z=L(T),V=k(T,"DIV",{class:!0});var be=S(V);B=k(be,"BUTTON",{class:!0});var ce=S(B);ee=J(ce,"Nueva escena"),ce.forEach(h),be.forEach(h),T.forEach(h),se=L(ne),x=k(ne,"DIV",{class:!0});var fe=S(x);ie=k(fe,"DIV",{class:!0});var b=S(ie);_e(A.$$.fragment,b),b.forEach(h),fe.forEach(h),ne.forEach(h),Q=L(P),K&&K.l(P),M=Ue(),this.h()},h(){_(e,"type","file"),_(e,"id","load-input"),e.hidden=!0,_(s,"class","toolbar-button svelte-1htln5w"),_(c,"class","toolbar-button svelte-1htln5w"),_(c,"for","load-input"),_(d,"class","toolbar-button svelte-1htln5w"),_(I,"class","toolbar-button svelte-1htln5w"),_(v,"class","toolbar-button svelte-1htln5w"),_(o,"class","project-toolbar"),_(B,"class","toolbar-button svelte-1htln5w"),_(V,"class","scene-toolbar svelte-1htln5w"),_(l,"class","toolbar svelte-1htln5w"),_(ie,"class","page-container svelte-1htln5w"),_(x,"class","static-page-container svelte-1htln5w"),_(n,"class","design-window-container svelte-1htln5w")},m(P,ne){O(P,e,ne),r[15](e),O(P,t,ne),O(P,n,ne),g(n,l),g(l,o),g(o,s),g(s,i),g(o,a),g(o,c),g(c,u),g(o,f),g(o,d),g(d,p),g(o,m),g(o,I),g(I,j),g(o,X),g(o,v),g(v,N),g(l,z),g(l,V),g(V,B),g(B,ee),g(n,se),g(n,x),g(x,ie),ve(A,ie,null),O(P,Q,ne),K&&K.m(P,ne),O(P,M,ne),te=!0,oe||(W=[R(e,"change",r[7]),R(s,"click",r[10]),R(d,"click",r[12]),R(I,"click",r[9]),R(v,"click",r[13]),R(B,"click",r[8])],oe=!0)},p(P,[ne]){const T={};ne&1&&(T.movingNode=P[0]),ne&1073741873&&(T.$$scope={dirty:ne,ctx:P}),!Y&&ne&2&&(Y=!0,T.showNewScene=P[1],ke(()=>Y=!1)),!Z&&ne&32&&(Z=!0,T.mouse=P[5],ke(()=>Z=!1)),A.$set(T),P[2]?K?(K.p(P,ne),ne&4&&H(K,1)):(K=At(P),K.c(),H(K,1),K.m(M.parentNode,M)):K&&(Ve(),$(K,1,1,()=>{K=null}),Re())},i(P){te||(H(A.$$.fragment,P),H(K),te=!0)},o(P){$(A.$$.fragment,P),$(K),te=!1},d(P){P&&h(e),r[15](null),P&&h(t),P&&h(n),ye(A),P&&h(Q),K&&K.d(P),P&&h(M),oe=!1,De(W)}}}function Dn(r){[...document.getElementsByClassName("scene-node-container")].forEach(e=>e.style.zIndex="0"),r.target.firstChild.style.zIndex="1"}function Ln(r,e,t){let n,l,o,s,i,a,c;he(r,Rt,A=>t(20,o=A)),he(r,zt,A=>t(21,s=A)),he(r,ae,A=>t(14,i=A)),he(r,Cn,A=>t(22,a=A)),he(r,Vt,A=>t(23,c=A)),jt(()=>{d&&scrollTo(0,0)});let u=!1,f=!1,d=!1,p={x:40,y:40},m;function I(){const A=m.files[0];if(A.type==="application/json"){Ie(ae,i={},i);const Y=new FileReader;Y.addEventListener("load",function(){const Z=Y.result,Q=JSON.parse(Z);Ie(ae,i=Q,i)}),this.value=null,Y.readAsText(A);return}else alert("Formato de archivo incorrecto / incorrect file format")}function j(){t(1,f=!0)}function X(){t(2,d=!0)}function v(){Ie(ae,i={},i)}function N(){console.log(i);const A=document.getElementById("storygeneraldiv");A&&A.remove();const Y=new a("es",{typewriterSpeed:20}),Z=Object.entries(i).sort((te,oe)=>te[1].display.y-oe[1].display.y);if(Z.length===0){alert("No hay escenas / There are no scenes");return}Y.setScenes(i).startAdventure(Z[0][0]);const Q=document.getElementById("test-story-container"),M=document.getElementById("storygeneraldiv");Q.appendChild(M)}function z(){c(i,"aventuraInteractiva")}function V(){const A=Object.entries(i).sort((M,te)=>M[1].display.y-te[1].display.y);if(A.length===0){alert("No hay escenas / There are no scenes");return}const Y=a.toString(),Z=JSON.stringify(i),Q=s(Y,Z,A[0][0]);o(Q)}function B(A){ge[A?"unshift":"push"](()=>{m=A,t(3,m)})}function ee(A){u=A,t(0,u)}function se(A){f=A,t(1,f)}function x(A){n=A,t(5,n)}function ie(A){d=A,t(2,d)}return r.$$.update=()=>{r.$$.dirty&16384&&t(4,l=Object.keys(i))},t(5,n={x:0,y:0}),[u,f,d,m,l,n,p,I,j,X,v,N,z,V,i,B,ee,se,x,ie]}class Un extends Te{constructor(e){super(),Ce(this,e,Ln,An,Oe,{})}}function jn(r){let e,t,n,l,o,s,i,a,c;return o=new Un({}),{c(){e=w("section"),t=w("h1"),n=q("Aventura interactiva (beta)"),l=D(),me(o.$$.fragment),s=D(),i=w("footer"),a=q("Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.2b"),this.h()},l(u){e=k(u,"SECTION",{class:!0});var f=S(e);t=k(f,"H1",{class:!0});var d=S(t);n=J(d,"Aventura interactiva (beta)"),d.forEach(h),l=L(f),_e(o.$$.fragment,f),s=L(f),i=k(f,"FOOTER",{class:!0});var p=S(i);a=J(p,"Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.2b"),p.forEach(h),f.forEach(h),this.h()},h(){_(t,"class","svelte-1fid4at"),_(i,"class","no-select svelte-1fid4at"),_(e,"class","general no-select svelte-1fid4at")},m(u,f){O(u,e,f),g(e,t),g(t,n),g(e,l),ve(o,e,null),g(e,s),g(e,i),g(i,a),c=!0},p:Le,i(u){c||(H(o.$$.fragment,u),c=!0)},o(u){$(o.$$.fragment,u),c=!1},d(u){u&&h(e),ye(o)}}}class Vn extends Te{constructor(e){super(),Ce(this,e,null,jn,Oe,{})}}export{Vn as default};
