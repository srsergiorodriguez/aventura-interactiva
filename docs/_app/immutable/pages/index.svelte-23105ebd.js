import{S as pe,i as me,s as he,F as Ae,l as k,m as N,n as E,h as p,p as b,b as T,K as we,L as R,M as Ne,G as Be,H as Re,I as Pe,f as G,t as q,N as Ee,O as ke,r as x,u as J,J as y,E as ve,a as U,c as j,P as Ue,Q as ne,w as oe,x as ie,y as re,B as le,R as se,T as ce,U as fe,V as be,W as de,v as je,e as Se,g as Te,d as Ce,k as ct,X as ft,Y as Ve,Z as Ge,_ as De,$ as dt,a0 as Xe}from"../chunks/index-f02839e3.js";import{w as pt,r as Oe}from"../chunks/index-9b6a96ee.js";const Y=pt({inicio:{texto:"\xC9rase una vez un c\xEDrculo...",display:{ops:[],x:40,y:40},opciones:[{btn:"dejar tranquilo",escena:"final1"},{btn:"aplastar",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{ops:[],x:40,y:270}},final2:{texto:"Parece que la historia form\xF3 una elipsis",sinSalida:!0,display:{ops:[],x:220,y:270}}}),ut=Oe(a=>a.scene===void 0&&a.escena!==void 0?"escena":"scene"),Ke=Oe(a=>a.options===void 0&&a.opciones!==void 0?"opciones":"options"),mt=Oe(a=>a.text===void 0&&a.texto!==void 0?"texto":"text"),ht=Oe(a=>a.image===void 0&&a.imagen!==void 0?"imagen":"image");function gt(a){let e,t,s,l;const i=a[5].default,n=Ae(i,a,a[4],null);return{c(){e=k("div"),n&&n.c(),this.h()},l(r){e=N(r,"DIV",{class:!0});var o=E(e);n&&n.l(o),o.forEach(p),this.h()},h(){b(e,"class","draggui svelte-11g4b1g")},m(r,o){T(r,e,o),n&&n.m(e,null),t=!0,s||(l=[we(a[0].call(null,e)),we(a[1].call(null,e)),R(e,"mousedown",Ne(a[6]))],s=!0)},p(r,[o]){n&&n.p&&(!t||o&16)&&Be(n,i,r,r[4],t?Pe(i,r[4],o,null):Re(r[4]),null)},i(r){t||(G(n,r),t=!0)},o(r){q(n,r),t=!1},d(r){r&&p(e),n&&n.d(r),s=!1,Ee(l)}}}function _t(a,e,t){let{$$slots:s={},$$scope:l}=e,{pos:i}=e,{displace:n={x:i.x,y:i.y}}=e;function r(u){u.style.left=`${n.x}px`,u.style.top=`${n.y}px`}function o(u){let f=!1;u.style.left=`${n.x}px`,u.style.top=`${n.y}px`,u.addEventListener("mousedown",()=>{f=!0}),window.addEventListener("mousemove",d=>{f&&(t(2,n.x+=d.movementX,n),t(2,n.y+=d.movementY,n),u.style.left=`${n.x}px`,u.style.top=`${n.y}px`,u.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{f=!1,u.style.cursor="grab"})}function c(u){ke.call(this,a,u)}return a.$$set=u=>{"pos"in u&&t(3,i=u.pos),"displace"in u&&t(2,n=u.displace),"$$scope"in u&&t(4,l=u.$$scope)},[r,o,n,i,l,s,c]}class Fe extends pe{constructor(e){super(),me(this,e,_t,gt,he,{pos:3,displace:2})}}function vt(a){let e,t,s,l,i;return{c(){e=k("div"),t=k("button"),s=x("X"),this.h()},l(n){e=N(n,"DIV",{class:!0});var r=E(e);t=N(r,"BUTTON",{class:!0});var o=E(t);s=J(o,"X"),o.forEach(p),r.forEach(p),this.h()},h(){b(t,"class","x-button"),b(e,"class","top-bar svelte-15bdkib")},m(n,r){T(n,e,r),y(e,t),y(t,s),l||(i=R(t,"click",a[0]),l=!0)},p:ve,i:ve,o:ve,d(n){n&&p(e),l=!1,i()}}}function yt(a,e,t){let{toggle:s}=e;function l(){t(1,s=!1)}return a.$$set=i=>{"toggle"in i&&t(1,s=i.toggle)},[l,s]}class We extends pe{constructor(e){super(),me(this,e,yt,vt,he,{toggle:1})}}function Ye(a){let e,t;return{c(){e=k("img"),this.h()},l(s){e=N(s,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Ue(e.src,t="")||b(e,"src",t),b(e,"alt","Preview"),b(e,"class","img-preview svelte-ekr4m4")},m(s,l){T(s,e,l),a[6](e)},p:ve,d(s){s&&p(e),a[6](null)}}}function bt(a){let e,t,s,l,i,n=a[2]&&Ye(a);return{c(){e=k("input"),t=U(),s=k("div"),n&&n.c(),this.h()},l(r){e=N(r,"INPUT",{type:!0}),t=j(r),s=N(r,"DIV",{class:!0,id:!0});var o=E(s);n&&n.l(o),o.forEach(p),this.h()},h(){b(e,"type","file"),b(s,"class","image-preview-container svelte-ekr4m4"),b(s,"id","image-preview-container")},m(r,o){T(r,e,o),a[5](e),T(r,t,o),T(r,s,o),n&&n.m(s,null),l||(i=R(e,"change",a[3]),l=!0)},p(r,[o]){r[2]?n?n.p(r,o):(n=Ye(r),n.c(),n.m(s,null)):n&&(n.d(1),n=null)},i:ve,o:ve,d(r){r&&p(e),a[5](null),r&&p(t),r&&p(s),n&&n.d(),l=!1,i()}}}function wt(a,e,t){let{imageUrl:s}=e,l,i,n=!1;function r(){const u=l.files[0];if(u){t(2,n=!0);const f=new FileReader;f.addEventListener("load",function(){t(4,s=f.result),i.setAttribute("src",f.result)}),f.readAsDataURL(u);return}t(2,n=!1)}function o(u){ne[u?"unshift":"push"](()=>{l=u,t(0,l)})}function c(u){ne[u?"unshift":"push"](()=>{i=u,t(1,i)})}return a.$$set=u=>{"imageUrl"in u&&t(4,s=u.imageUrl)},[l,i,n,r,s,o,c]}class kt extends pe{constructor(e){super(),me(this,e,wt,bt,he,{imageUrl:4})}}function Nt(a){let e,t,s,l,i,n,r,o,c,u,f,d,_,v,I,P,V,h,m,O,M,L,F,K,z,$,ue,A,ee,H,w,B,W,X,g,S;function D(C){a[8](C)}let Z={};a[0]!==void 0&&(Z.toggle=a[0]),e=new We({props:Z}),ne.push(()=>fe(e,"toggle",D));function te(C){a[11](C)}let ae={};return a[3]!==void 0&&(ae.imageUrl=a[3]),A=new kt({props:ae}),ne.push(()=>fe(A,"imageUrl",te)),{c(){oe(e.$$.fragment),s=U(),l=k("div"),i=k("h1"),n=x(a[1]),r=U(),o=k("div"),c=k("h2"),u=x("Texto"),f=U(),d=k("textarea"),_=U(),v=k("div"),I=k("h2"),P=x("Imagen (opcional)"),V=U(),h=k("div"),m=k("label"),O=x("Url:"),M=U(),L=k("input"),F=x(`
    o
    `),K=k("div"),z=k("span"),$=x("Archivo:"),ue=U(),oe(A.$$.fragment),H=U(),w=k("div"),B=k("button"),W=x("Aceptar"),this.h()},l(C){ie(e.$$.fragment,C),s=j(C),l=N(C,"DIV",{});var Q=E(l);i=N(Q,"H1",{class:!0});var ye=E(i);n=J(ye,a[1]),ye.forEach(p),Q.forEach(p),r=j(C),o=N(C,"DIV",{});var _e=E(o);c=N(_e,"H2",{class:!0});var Ie=E(c);u=J(Ie,"Texto"),Ie.forEach(p),f=j(_e),d=N(_e,"TEXTAREA",{class:!0}),E(d).forEach(p),_e.forEach(p),_=j(C),v=N(C,"DIV",{});var ge=E(v);I=N(ge,"H2",{class:!0});var ze=E(I);P=J(ze,"Imagen (opcional)"),ze.forEach(p),V=j(ge),h=N(ge,"DIV",{});var Me=E(h);m=N(Me,"LABEL",{for:!0});var He=E(m);O=J(He,"Url:"),He.forEach(p),M=j(Me),L=N(Me,"INPUT",{id:!0,type:!0}),Me.forEach(p),F=J(ge,`
    o
    `),K=N(ge,"DIV",{});var Le=E(K);z=N(Le,"SPAN",{});var xe=E(z);$=J(xe,"Archivo:"),xe.forEach(p),ue=j(Le),ie(A.$$.fragment,Le),Le.forEach(p),H=j(ge),w=N(ge,"DIV",{class:!0});var Je=E(w);B=N(Je,"BUTTON",{});var qe=E(B);W=J(qe,"Aceptar"),qe.forEach(p),Je.forEach(p),ge.forEach(p),this.h()},h(){b(i,"class","svelte-2p34te"),b(c,"class","svelte-2p34te"),b(d,"class","svelte-2p34te"),b(I,"class","svelte-2p34te"),b(m,"for","inp"),b(L,"id","inp"),b(L,"type","text"),b(w,"class","bar svelte-2p34te")},m(C,Q){re(e,C,Q),T(C,s,Q),T(C,l,Q),y(l,i),y(i,n),T(C,r,Q),T(C,o,Q),y(o,c),y(c,u),y(o,f),y(o,d),be(d,a[4]),T(C,_,Q),T(C,v,Q),y(v,I),y(I,P),y(v,V),y(v,h),y(h,m),y(m,O),y(h,M),y(h,L),be(L,a[3]),y(v,F),y(v,K),y(K,z),y(z,$),y(K,ue),re(A,K,null),y(v,H),y(v,w),y(w,B),y(B,W),X=!0,g||(S=[R(d,"input",a[9]),R(d,"mousedown",Ne(a[7])),R(L,"input",a[10]),R(L,"mousedown",Ne(a[6])),R(B,"click",a[5])],g=!0)},p(C,Q){const ye={};!t&&Q&1&&(t=!0,ye.toggle=C[0],de(()=>t=!1)),e.$set(ye),(!X||Q&2)&&je(n,C[1]),Q&16&&be(d,C[4]),Q&8&&L.value!==C[3]&&be(L,C[3]);const _e={};!ee&&Q&8&&(ee=!0,_e.imageUrl=C[3],de(()=>ee=!1)),A.$set(_e)},i(C){X||(G(e.$$.fragment,C),G(A.$$.fragment,C),X=!0)},o(C){q(e.$$.fragment,C),q(A.$$.fragment,C),X=!1},d(C){le(e,C),C&&p(s),C&&p(l),C&&p(r),C&&p(o),C&&p(_),C&&p(v),le(A),g=!1,Ee(S)}}}function Et(a){let e,t;return e=new Fe({props:{pos:a[2],$$slots:{default:[Nt]},$$scope:{ctx:a}}}),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,l){re(e,s,l),t=!0},p(s,[l]){const i={};l&4&&(i.pos=s[2]),l&32795&&(i.$$scope={dirty:l,ctx:s}),e.$set(i)},i(s){t||(G(e.$$.fragment,s),t=!0)},o(s){q(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function St(a,e,t){let s,l;se(a,Y,h=>t(12,l=h));let{key:i}=e,{pos:n}=e,{showEditor:r}=e,o=null,c=l[i];const u=c.text===void 0&&c.texto!==void 0?"texto":"text";function f(){ce(Y,l[i][u]=s,l),o!==null&&ce(Y,l[i].image=o,l),t(0,r=!1)}function d(h){ke.call(this,a,h)}function _(h){ke.call(this,a,h)}function v(h){r=h,t(0,r)}function I(){s=this.value,t(4,s),t(13,c)}function P(){o=this.value,t(3,o)}function V(h){o=h,t(3,o)}return a.$$set=h=>{"key"in h&&t(1,i=h.key),"pos"in h&&t(2,n=h.pos),"showEditor"in h&&t(0,r=h.showEditor)},a.$$.update=()=>{a.$$.dirty&2&&ce(Y,l[i]=c,l)},t(4,s=c[u]),[r,i,n,o,s,f,d,_,v,I,P,V]}class It extends pe{constructor(e){super(),me(this,e,St,Et,he,{key:1,pos:2,showEditor:0})}}function Tt(a){let e,t,s,l,i,n,r,o,c,u,f,d,_,v,I;function P(h){a[6](h)}let V={};return a[0]!==void 0&&(V.toggle=a[0]),e=new We({props:V}),ne.push(()=>fe(e,"toggle",P)),{c(){oe(e.$$.fragment),s=U(),l=k("div"),i=k("label"),n=x("Btn:"),r=U(),o=k("input"),c=U(),u=k("div"),f=k("button"),d=x("Aceptar"),this.h()},l(h){ie(e.$$.fragment,h),s=j(h),l=N(h,"DIV",{});var m=E(l);i=N(m,"LABEL",{for:!0});var O=E(i);n=J(O,"Btn:"),O.forEach(p),r=j(m),o=N(m,"INPUT",{id:!0,type:!0}),m.forEach(p),c=j(h),u=N(h,"DIV",{class:!0});var M=E(u);f=N(M,"BUTTON",{});var L=E(f);d=J(L,"Aceptar"),L.forEach(p),M.forEach(p),this.h()},h(){b(i,"for","inp"),b(o,"id","inp"),b(o,"type","text"),b(u,"class","bar svelte-1bhrmvp")},m(h,m){re(e,h,m),T(h,s,m),T(h,l,m),y(l,i),y(i,n),y(l,r),y(l,o),be(o,a[2]),T(h,c,m),T(h,u,m),y(u,f),y(f,d),_=!0,v||(I=[R(o,"input",a[7]),R(o,"mousedown",Ne(a[5])),R(f,"click",a[3])],v=!0)},p(h,m){const O={};!t&&m&1&&(t=!0,O.toggle=h[0],de(()=>t=!1)),e.$set(O),m&4&&o.value!==h[2]&&be(o,h[2])},i(h){_||(G(e.$$.fragment,h),_=!0)},o(h){q(e.$$.fragment,h),_=!1},d(h){le(e,h),h&&p(s),h&&p(l),h&&p(c),h&&p(u),v=!1,Ee(I)}}}function Ct(a){let e,t;return e=new Fe({props:{pos:a[1],$$slots:{default:[Tt]},$$scope:{ctx:a}}}),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,l){re(e,s,l),t=!0},p(s,[l]){const i={};l&2&&(i.pos=s[1]),l&2053&&(i.$$scope={dirty:l,ctx:s}),e.$set(i)},i(s){t||(G(e.$$.fragment,s),t=!0)},o(s){q(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function Ot(a,e,t){let s,l,i;se(a,Y,v=>t(8,l=v)),se(a,Ke,v=>t(9,i=v));let{key:n}=e,{pos:r}=e,{showNewOutput:o}=e;const c=i(l[n]);function u(){l[n][c]===void 0&&ce(Y,l[n][c]=[],l),l[n][c].push({btn:s}),Y.set(l),t(0,o=!1)}function f(v){ke.call(this,a,v)}function d(v){o=v,t(0,o)}function _(){s=this.value,t(2,s)}return a.$$set=v=>{"key"in v&&t(4,n=v.key),"pos"in v&&t(1,r=v.pos),"showNewOutput"in v&&t(0,o=v.showNewOutput)},t(2,s=""),[o,r,s,u,n,f,d,_]}class Mt extends pe{constructor(e){super(),me(this,e,Ot,Ct,he,{key:4,pos:1,showNewOutput:0})}}function Lt(a){let e,t,s,l;const i=a[5].default,n=Ae(i,a,a[4],null);return{c(){e=k("div"),n&&n.c(),this.h()},l(r){e=N(r,"DIV",{class:!0});var o=E(e);n&&n.l(o),o.forEach(p),this.h()},h(){b(e,"class","scene-node-container svelte-14kdql5")},m(r,o){T(r,e,o),n&&n.m(e,null),t=!0,s||(l=we(a[0].call(null,e)),s=!0)},p(r,[o]){n&&n.p&&(!t||o&16)&&Be(n,i,r,r[4],t?Pe(i,r[4],o,null):Re(r[4]),null)},i(r){t||(G(n,r),t=!0)},o(r){q(n,r),t=!1},d(r){r&&p(e),n&&n.d(r),s=!1,l()}}}function Ut(a,e,t){let s;se(a,Y,u=>t(3,s=u));let{$$slots:l={},$$scope:i}=e,{key:n}=e,{movingNode:r=!1}=e,o=s[n];o.display===void 0&&(o.display={x:0,y:0,ops:[]});function c(u){let f=!1;u.style.left=`${o.display.x}px`,u.style.top=`${o.display.y}px`,u.addEventListener("mousedown",()=>{f=!0,t(1,r=!0)}),window.addEventListener("mousemove",d=>{f&&(o.display.x+=d.movementX,o.display.y+=d.movementY,u.style.left=`${o.display.x}px`,u.style.top=`${o.display.y}px`,ce(Y,s[n]=o,s))}),window.addEventListener("mouseup",()=>{f=!1,t(1,r=!1)})}return a.$$set=u=>{"key"in u&&t(2,n=u.key),"movingNode"in u&&t(1,r=u.movingNode),"$$scope"in u&&t(4,i=u.$$scope)},a.$$.update=()=>{a.$$.dirty&12&&(o=s[n])},[c,r,n,s,i,l]}class jt extends pe{constructor(e){super(),me(this,e,Ut,Lt,he,{key:2,movingNode:1})}}function Ze(a,e,t){const s=a.slice();return s[32]=e[t],s[34]=t,s}function Qe(a){let e,t,s,l,i;return{c(){e=k("div"),t=k("img"),this.h()},l(n){e=N(n,"DIV",{class:!0});var r=E(e);t=N(r,"IMG",{src:!0,alt:!0,class:!0}),r.forEach(p),this.h()},h(){Ue(t.src,s=a[2][a[7]])||b(t,"src",s),b(t,"alt","Preview"),b(t,"class","img-preview svelte-1tde7cb"),b(e,"class","img-preview-container svelte-1tde7cb")},m(n,r){T(n,e,r),y(e,t),l||(i=we(a[12].call(null,t)),l=!0)},p(n,r){r[0]&4&&!Ue(t.src,s=n[2][n[7]])&&b(t,"src",s)},d(n){n&&p(e),l=!1,i()}}}function $e(a){let e,t,s,l,i,n,r,o;return{c(){e=k("div"),t=k("input"),l=U(),i=k("div"),n=U(),this.h()},l(c){e=N(c,"DIV",{class:!0});var u=E(e);t=N(u,"INPUT",{type:!0,class:!0,i:!0}),l=j(u),i=N(u,"DIV",{class:!0,i:!0}),E(i).forEach(p),n=j(u),u.forEach(p),this.h()},h(){b(t,"type","text"),b(t,"class","output-text svelte-1tde7cb"),t.value=s=a[32].btn,b(t,"i",a[34]),b(i,"class","connection output svelte-1tde7cb"),b(i,"i",a[34]),b(e,"class","output-container svelte-1tde7cb")},m(c,u){T(c,e,u),y(e,t),y(e,l),y(e,i),y(e,n),r||(o=[we(a[10].call(null,t)),R(t,"change",a[9]),R(t,"mousedown",Ne(a[21])),we(a[11].call(null,i)),we(a[13].call(null,i)),R(i,"mousedown",Ne(a[20]))],r=!0)},p(c,u){u[0]&4&&s!==(s=c[32].btn)&&t.value!==s&&(t.value=s)},d(c){c&&p(e),r=!1,Ee(o)}}}function Dt(a){let e,t,s,l,i,n,r,o,c=a[2][a[8]].slice(0,30)+"...",u,f,d,_,v,I,P,V,h,m,O,M,L,F,K,z,$,ue,A=a[2][a[7]]!==void 0&&a[2][a[7]]!==null&&Qe(a),ee=a[2][a[6]]||[],H=[];for(let w=0;w<ee.length;w+=1)H[w]=$e(Ze(a,ee,w));return{c(){e=k("div"),t=U(),s=k("h1"),l=x("Escena: "),i=x(a[1]),n=U(),A&&A.c(),r=U(),o=k("p"),u=x(c),f=U(),d=k("div"),_=k("button"),v=x("editar"),I=U(),P=k("button"),V=x("x"),h=U(),m=k("button"),O=x("-"),M=U(),L=k("button"),F=x("+"),K=U(),z=k("div");for(let w=0;w<H.length;w+=1)H[w].c();this.h()},l(w){e=N(w,"DIV",{class:!0}),E(e).forEach(p),t=j(w),s=N(w,"H1",{class:!0});var B=E(s);l=J(B,"Escena: "),i=J(B,a[1]),B.forEach(p),n=j(w),A&&A.l(w),r=j(w),o=N(w,"P",{class:!0});var W=E(o);u=J(W,c),W.forEach(p),f=j(w),d=N(w,"DIV",{class:!0});var X=E(d);_=N(X,"BUTTON",{class:!0});var g=E(_);v=J(g,"editar"),g.forEach(p),I=j(X),P=N(X,"BUTTON",{class:!0});var S=E(P);V=J(S,"x"),S.forEach(p),h=j(X),m=N(X,"BUTTON",{class:!0});var D=E(m);O=J(D,"-"),D.forEach(p),M=j(X),L=N(X,"BUTTON",{class:!0});var Z=E(L);F=J(Z,"+"),Z.forEach(p),X.forEach(p),K=j(w),z=N(w,"DIV",{class:!0});var te=E(z);for(let ae=0;ae<H.length;ae+=1)H[ae].l(te);te.forEach(p),this.h()},h(){b(e,"class","connection input svelte-1tde7cb"),b(s,"class","svelte-1tde7cb"),b(o,"class","text-p svelte-1tde7cb"),b(_,"class","svelte-1tde7cb"),b(P,"class","svelte-1tde7cb"),b(m,"class","svelte-1tde7cb"),b(L,"class","svelte-1tde7cb"),b(d,"class","node-btns svelte-1tde7cb"),b(z,"class","node-outputs svelte-1tde7cb")},m(w,B){T(w,e,B),T(w,t,B),T(w,s,B),y(s,l),y(s,i),T(w,n,B),A&&A.m(w,B),T(w,r,B),T(w,o,B),y(o,u),T(w,f,B),T(w,d,B),y(d,_),y(_,v),y(d,I),y(d,P),y(P,V),y(d,h),y(d,m),y(m,O),y(d,M),y(d,L),y(L,F),T(w,K,B),T(w,z,B);for(let W=0;W<H.length;W+=1)H[W].m(z,null);a[23](z),$||(ue=[R(e,"mousedown",Ne(a[22])),R(e,"click",a[14]),R(_,"click",a[17]),R(P,"click",a[16]),R(m,"click",a[15]),R(L,"click",a[18])],$=!0)},p(w,B){if(B[0]&2&&je(i,w[1]),w[2][w[7]]!==void 0&&w[2][w[7]]!==null?A?A.p(w,B):(A=Qe(w),A.c(),A.m(r.parentNode,r)):A&&(A.d(1),A=null),B[0]&4&&c!==(c=w[2][w[8]].slice(0,30)+"...")&&je(u,c),B[0]&580){ee=w[2][w[6]]||[];let W;for(W=0;W<ee.length;W+=1){const X=Ze(w,ee,W);H[W]?H[W].p(X,B):(H[W]=$e(X),H[W].c(),H[W].m(z,null))}for(;W<H.length;W+=1)H[W].d(1);H.length=ee.length}},d(w){w&&p(e),w&&p(t),w&&p(s),w&&p(n),A&&A.d(w),w&&p(r),w&&p(o),w&&p(f),w&&p(d),w&&p(K),w&&p(z),ft(H,w),a[23](null),$=!1,Ee(ue)}}}function et(a){let e,t,s;function l(n){a[25](n)}let i={key:a[1],pos:a[2].display};return a[4]!==void 0&&(i.showEditor=a[4]),e=new It({props:i}),ne.push(()=>fe(e,"showEditor",l)),{c(){oe(e.$$.fragment)},l(n){ie(e.$$.fragment,n)},m(n,r){re(e,n,r),s=!0},p(n,r){const o={};r[0]&2&&(o.key=n[1]),r[0]&4&&(o.pos=n[2].display),!t&&r[0]&16&&(t=!0,o.showEditor=n[4],de(()=>t=!1)),e.$set(o)},i(n){s||(G(e.$$.fragment,n),s=!0)},o(n){q(e.$$.fragment,n),s=!1},d(n){le(e,n)}}}function tt(a){let e,t,s;function l(n){a[26](n)}let i={key:a[1],pos:a[2].display};return a[5]!==void 0&&(i.showNewOutput=a[5]),e=new Mt({props:i}),ne.push(()=>fe(e,"showNewOutput",l)),{c(){oe(e.$$.fragment)},l(n){ie(e.$$.fragment,n)},m(n,r){re(e,n,r),s=!0},p(n,r){const o={};r[0]&2&&(o.key=n[1]),r[0]&4&&(o.pos=n[2].display),!t&&r[0]&32&&(t=!0,o.showNewOutput=n[5],de(()=>t=!1)),e.$set(o)},i(n){s||(G(e.$$.fragment,n),s=!0)},o(n){q(e.$$.fragment,n),s=!1},d(n){le(e,n)}}}function At(a){let e,t,s,l,i,n;function r(f){a[24](f)}let o={key:a[1],$$slots:{default:[Dt]},$$scope:{ctx:a}};a[0]!==void 0&&(o.movingNode=a[0]),e=new jt({props:o}),ne.push(()=>fe(e,"movingNode",r));let c=a[4]&&et(a),u=a[5]&&tt(a);return{c(){oe(e.$$.fragment),s=U(),c&&c.c(),l=U(),u&&u.c(),i=Se()},l(f){ie(e.$$.fragment,f),s=j(f),c&&c.l(f),l=j(f),u&&u.l(f),i=Se()},m(f,d){re(e,f,d),T(f,s,d),c&&c.m(f,d),T(f,l,d),u&&u.m(f,d),T(f,i,d),n=!0},p(f,d){const _={};d[0]&2&&(_.key=f[1]),d[0]&14|d[1]&16&&(_.$$scope={dirty:d,ctx:f}),!t&&d[0]&1&&(t=!0,_.movingNode=f[0],de(()=>t=!1)),e.$set(_),f[4]?c?(c.p(f,d),d[0]&16&&G(c,1)):(c=et(f),c.c(),G(c,1),c.m(l.parentNode,l)):c&&(Te(),q(c,1,1,()=>{c=null}),Ce()),f[5]?u?(u.p(f,d),d[0]&32&&G(u,1)):(u=tt(f),u.c(),G(u,1),u.m(i.parentNode,i)):u&&(Te(),q(u,1,1,()=>{u=null}),Ce())},i(f){n||(G(e.$$.fragment,f),G(c),G(u),n=!0)},o(f){q(e.$$.fragment,f),q(c),q(u),n=!1},d(f){le(e,f),f&&p(s),c&&c.d(f),f&&p(l),u&&u.d(f),f&&p(i)}}}function Bt(a,e,t){let s,l,i,n,r;se(a,Y,g=>t(19,s=g)),se(a,ut,g=>t(27,l=g)),se(a,Ke,g=>t(28,i=g)),se(a,mt,g=>t(29,n=g)),se(a,ht,g=>t(30,r=g));let{key:o}=e,{movingNode:c=!1}=e,u=s[o];const f=i(u),d=r(u),_=n(u);let v,I=!1,P=!1;ct(()=>{O()}),u.display===void 0&&(u.display={x:0,y:0,ops:[]});function V(){h(this)}function h(g){const S=+g.getAttribute("i");g.style.width=g.value.length*6.1+"px",t(2,u[f][S].btn=g.value,u),O()}function m(g){const S=+g.getAttribute("i");u.display.ops[S]===void 0?t(2,u.display.ops[S]={x:g.offsetLeft,y:g.offsetTop,rewiring:!1},u):Object.assign(u.display.ops[S],{x:g.offsetLeft,y:g.offsetTop}),ce(Y,s[o]=u,s)}function O(){if(v===void 0)return;const g=v.getElementsByClassName("output");for(let S of g)m(S)}function M(){const g=Object.keys(s);for(let S of g){const D=s[S],Z=i(D);for(let te=0;te<D.display.ops.length;te++){const ae=l(D[Z][te]);D.display.ops[te].rewiring&&(D.display.ops[te].rewiring=!1,D[Z][te][ae]=D.display.ops[te].prevWiring)}ce(Y,s[S]=D,s)}}function L(g){const S=+g.getAttribute("i");g.addEventListener("click",()=>{M();const D=l(u[f][S]);u.display.ops[S].rewiring||(t(2,u.display.ops[S].prevWiring=u[f][S][D],u),t(2,u.display.ops[S].rewiring=!0,u),t(2,u[f][S][D]=void 0,u))})}function F(){const g=Object.keys(s);let S;for(let te of g){const ae=s[te];let C=0;for(let Q of ae.display.ops)Q.rewiring&&(Q.rewiring=!1,S={scene:ae,i:C}),C++}if(S===void 0)return;const D=i(S.scene),Z=l(S.scene[D][S.i]);S.scene[D][S.i][Z]=o}function K(){u[f]!==void 0&&(u[f].pop(),u.display.ops.pop(),Y.set(s))}function z(){for(let g of Object.keys(s)){const S=i(s[g]);if(s[g][S]!==void 0)for(let D of s[g][S]){const Z=l(D);D[Z]===o&&(D[Z]=void 0)}}delete s[o],Y.set(s)}function $(){t(4,I=!0)}function ue(){t(5,P=!0)}function A(g){ke.call(this,a,g)}function ee(g){ke.call(this,a,g)}function H(g){ke.call(this,a,g)}function w(g){ne[g?"unshift":"push"](()=>{v=g,t(3,v)})}function B(g){c=g,t(0,c)}function W(g){I=g,t(4,I)}function X(g){P=g,t(5,P)}return a.$$set=g=>{"key"in g&&t(1,o=g.key),"movingNode"in g&&t(0,c=g.movingNode)},a.$$.update=()=>{a.$$.dirty[0]&524290&&t(2,u=s[o])},[c,o,u,v,I,P,f,d,_,V,h,m,O,L,F,K,z,$,ue,s,A,ee,H,w,B,W,X]}class Rt extends pe{constructor(e){super(),me(this,e,Bt,At,he,{key:1,movingNode:0},null,[-1,-1])}}function st(a,e,t){const s=a.slice();return s[5]=e[t],s[7]=t,s}function nt(a,e){let t,s,l,i,n;return{key:a,first:null,c(){t=Ve("line"),this.h()},l(r){t=Ge(r,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0}),E(t).forEach(p),this.h()},h(){b(t,"class","node-connection svelte-nz6q29"),b(t,"x1",s=e[0].display.x+e[5].x+5),b(t,"y1",l=e[0].display.y+e[5].y+10),b(t,"x2",i=e[1][e[7]].x+5),b(t,"y2",n=e[1][e[7]].y+5),this.first=t},m(r,o){T(r,t,o)},p(r,o){e=r,o&1&&s!==(s=e[0].display.x+e[5].x+5)&&b(t,"x1",s),o&1&&l!==(l=e[0].display.y+e[5].y+10)&&b(t,"y1",l),o&3&&i!==(i=e[1][e[7]].x+5)&&b(t,"x2",i),o&3&&n!==(n=e[1][e[7]].y+5)&&b(t,"y2",n)},d(r){r&&p(t)}}}function Pt(a){let e,t=[],s=new Map,l=a[0].display.ops||[];const i=n=>n[7];for(let n=0;n<l.length;n+=1){let r=st(a,l,n),o=i(r);s.set(o,t[n]=nt(o,r))}return{c(){e=Ve("g");for(let n=0;n<t.length;n+=1)t[n].c()},l(n){e=Ge(n,"g",{});var r=E(e);for(let o=0;o<t.length;o+=1)t[o].l(r);r.forEach(p)},m(n,r){T(n,e,r);for(let o=0;o<t.length;o+=1)t[o].m(e,null)},p(n,[r]){r&3&&(l=n[0].display.ops||[],t=De(t,r,i,1,n,l,s,e,dt,nt,null,st))},i:ve,o:ve,d(n){n&&p(e);for(let r=0;r<t.length;r+=1)t[r].d()}}}function Vt(a,e,t){let s,l;se(a,Y,o=>t(4,l=o));let{key:i}=e,{mouse:n}=e,r=l[i];return a.$$set=o=>{"key"in o&&t(2,i=o.key),"mouse"in o&&t(3,n=o.mouse)},a.$$.update=()=>{a.$$.dirty&20&&t(0,r=l[i]),a.$$.dirty&25&&t(1,s=(r.options||r.opciones||[]).map((o,c)=>{const u=o.escena||o.scene;return u===void 0?r.display.ops[c].rewiring?n:r.display:l[u].display}))},[r,s,i,n,l]}class Gt extends pe{constructor(e){super(),me(this,e,Vt,Pt,he,{key:2,mouse:3})}}function Kt(a){let e,t,s,l,i,n,r,o,c,u,f,d,_,v,I;function P(h){a[7](h)}let V={};return a[0]!==void 0&&(V.toggle=a[0]),e=new We({props:V}),ne.push(()=>fe(e,"toggle",P)),{c(){oe(e.$$.fragment),s=U(),l=k("div"),i=k("label"),n=x("Escena:"),r=U(),o=k("input"),c=U(),u=k("div"),f=k("button"),d=x("Aceptar"),this.h()},l(h){ie(e.$$.fragment,h),s=j(h),l=N(h,"DIV",{});var m=E(l);i=N(m,"LABEL",{for:!0});var O=E(i);n=J(O,"Escena:"),O.forEach(p),r=j(m),o=N(m,"INPUT",{id:!0,type:!0}),m.forEach(p),c=j(h),u=N(h,"DIV",{class:!0});var M=E(u);f=N(M,"BUTTON",{});var L=E(f);d=J(L,"Aceptar"),L.forEach(p),M.forEach(p),this.h()},h(){b(i,"for","inp"),b(o,"id","inp"),b(o,"type","text"),b(u,"class","bar svelte-1bhrmvp")},m(h,m){re(e,h,m),T(h,s,m),T(h,l,m),y(l,i),y(i,n),y(l,r),y(l,o),be(o,a[2]),T(h,c,m),T(h,u,m),y(u,f),y(f,d),_=!0,v||(I=[R(o,"input",a[8]),R(o,"mousedown",Ne(a[6])),R(f,"click",a[4])],v=!0)},p(h,m){const O={};!t&&m&1&&(t=!0,O.toggle=h[0],de(()=>t=!1)),e.$set(O),m&4&&o.value!==h[2]&&be(o,h[2])},i(h){_||(G(e.$$.fragment,h),_=!0)},o(h){q(e.$$.fragment,h),_=!1},d(h){le(e,h),h&&p(s),h&&p(l),h&&p(c),h&&p(u),v=!1,Ee(I)}}}function Ft(a){let e,t,s;function l(n){a[9](n)}let i={pos:a[3],$$slots:{default:[Kt]},$$scope:{ctx:a}};return a[1]!==void 0&&(i.displace=a[1]),e=new Fe({props:i}),ne.push(()=>fe(e,"displace",l)),{c(){oe(e.$$.fragment)},l(n){ie(e.$$.fragment,n)},m(n,r){re(e,n,r),s=!0},p(n,[r]){const o={};r&4101&&(o.$$scope={dirty:r,ctx:n}),!t&&r&2&&(t=!0,o.displace=n[1],de(()=>t=!1)),e.$set(o)},i(n){s||(G(e.$$.fragment,n),s=!0)},o(n){q(e.$$.fragment,n),s=!1},d(n){le(e,n)}}}function Wt(a){const e=["\xE1","\xE9","\xED","\xF3","\xFA","\xFC","\xF1"],t=["a","e","i","o","u","u","n"],s=a.toLowerCase();let l="";for(let i=0;i<a.length;i++){const n=s.charAt(i),r=a.charAt(i);if(e.includes(n)){let o;for(let c=0;c<e.length;c++)if(e[c]===n){o=c;break}r===r.toUpperCase()?l+=t[o].toUpperCase():l+=t[o]}else l+=r}return l}function zt(a,e,t){let s,l;se(a,Y,I=>t(11,l=I));let{showNewScene:i}=e,{offset:n}=e,r=l,o={x:n.x*-1+20,y:n.y*-1+20},c;function u(){if(/^\d/.test(s)===!0){alert(`El nombre de la escena no puede empezar con un n\xFAmero /
The name of the scene cannot start with a number`);return}let I=s.replace(/\s/gi,"_").replace(/\W/,"").replace(/[;.,:{}()<>$%&!¡?¿"'/\\#@&*+-]/gi,"");I=Wt(I),r[I]={text:"",display:{x:o.x,y:o.y,ops:[]}},ce(Y,l[I]=r[I],l),t(0,i=!1)}function f(I){ke.call(this,a,I)}function d(I){i=I,t(0,i)}function _(){s=this.value,t(2,s)}function v(I){c=I,t(1,c)}return a.$$set=I=>{"showNewScene"in I&&t(0,i=I.showNewScene),"offset"in I&&t(5,n=I.offset)},t(2,s=""),[i,c,s,o,u,n,f,d,_,v]}class Ht extends pe{constructor(e){super(),me(this,e,zt,Ft,he,{showNewScene:0,offset:5})}}function ot(a){let e,t,s;function l(n){a[10](n)}let i={offset:a[1]};return a[0]!==void 0&&(i.showNewScene=a[0]),e=new Ht({props:i}),ne.push(()=>fe(e,"showNewScene",l)),{c(){oe(e.$$.fragment)},l(n){ie(e.$$.fragment,n)},m(n,r){re(e,n,r),s=!0},p(n,r){const o={};r&2&&(o.offset=n[1]),!t&&r&1&&(t=!0,o.showNewScene=n[0],de(()=>t=!1)),e.$set(o)},i(n){s||(G(e.$$.fragment,n),s=!0)},o(n){q(e.$$.fragment,n),s=!1},d(n){le(e,n)}}}function xt(a){let e,t,s,l,i;const n=a[9].default,r=Ae(n,a,a[8],null);let o=a[0]&&ot(a);return{c(){e=k("div"),r&&r.c(),t=U(),o&&o.c(),this.h()},l(c){e=N(c,"DIV",{class:!0});var u=E(e);r&&r.l(u),t=j(u),o&&o.l(u),u.forEach(p),this.h()},h(){b(e,"class","node-page svelte-1hh9dms")},m(c,u){T(c,e,u),r&&r.m(e,null),y(e,t),o&&o.m(e,null),s=!0,l||(i=[we(a[2].call(null,e)),R(e,"mousedown",a[3]),R(e,"mouseup",a[4]),R(e,"mousemove",a[5])],l=!0)},p(c,[u]){r&&r.p&&(!s||u&256)&&Be(r,n,c,c[8],s?Pe(n,c[8],u,null):Re(c[8]),null),c[0]?o?(o.p(c,u),u&1&&G(o,1)):(o=ot(c),o.c(),G(o,1),o.m(e,null)):o&&(Te(),q(o,1,1,()=>{o=null}),Ce())},i(c){s||(G(r,c),G(o),s=!0)},o(c){q(r,c),q(o),s=!1},d(c){c&&p(e),r&&r.d(c),o&&o.d(),l=!1,Ee(i)}}}function Jt(a,e,t){let s,l,i;se(a,Y,m=>t(12,s=m)),se(a,ut,m=>t(13,l=m)),se(a,Ke,m=>t(14,i=m));let{$$slots:n={},$$scope:r}=e,{movingNode:o}=e,{mouse:c}=e,{showNewScene:u}=e,f=!1;const d={x:0,y:0};function _(m){m.style.left=`${d.x}px`,m.style.top=`${d.y}px`}function v(){const m=Object.keys(s);for(let O of m){const M=s[O],L=i(M);for(let F=0;F<M.display.ops.length;F++){const K=l(M[L][F]);M.display.ops[F].rewiring&&(M.display.ops[F].rewiring=!1,M[L][F][K]=M.display.ops[F].prevWiring)}ce(Y,s[O]=M,s)}}function I(){f=!0,this.style.cursor="grabbing",v()}function P(){f=!1,this.style.cursor="grab"}function V(m){if(f&&!o){const M=+getComputedStyle(this.offsetParent).width.replace("px",""),L=+getComputedStyle(this).width.replace("px",""),F=+getComputedStyle(this.offsetParent).height.replace("px",""),K=+getComputedStyle(this).height.replace("px","");t(1,d.x+=m.movementX,d),t(1,d.y+=m.movementY,d),t(1,d.x=d.x>0?0:M-d.x>L?M-L:d.x,d),t(1,d.y=d.y>0?0:F-d.y>K?F-K:d.y,d),this.style.left=`${d.x}px`,this.style.top=`${d.y}px`}t(6,c={x:m.offsetX,y:m.offsetY});let O=m.target;for(;O!==this;)t(6,c.x+=O.offsetLeft,c),t(6,c.y+=O.offsetTop,c),O=O.offsetParent}function h(m){u=m,t(0,u)}return a.$$set=m=>{"movingNode"in m&&t(7,o=m.movingNode),"mouse"in m&&t(6,c=m.mouse),"showNewScene"in m&&t(0,u=m.showNewScene),"$$scope"in m&&t(8,r=m.$$scope)},[u,d,_,I,P,V,c,o,r,n,h]}class qt extends pe{constructor(e){super(),me(this,e,Jt,xt,he,{movingNode:7,mouse:6,showNewScene:0})}}class Xt{constructor(e="en",t){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,igramaFormat:"png",minigifOptions:{},sceneCallback:s=>s},t&&(this.options=Object.assign(this.options,t)),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[t,s]of Object.entries(e.grammar));return this}setScenes(e){this.scenes=e;for(let t of Object.keys(e)){this.scenes[t].key=t;const s=this.scenes[t].image||this.scenes[t].imagen;s!==void 0&&this.storyPreload[s]===void 0&&(this.storyPreload[s]=new Image,this.storyPreload[s].src=s,this.storyPreload[s].className="storyimage")}return this}setMarkov(e){return this.markov=e,this}expandGrammar(e){const t=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(t)}expandIgrama(e){const t=this.igrama.grammar,s=this.selectGrammarRule(t[e]);return this.grammarRuleRecursion(s,t).split("|").map(i=>this.decodeDrawing(i))}grammarRuleRecursion(e,t){let s=t||this.grammar,l=this.setNewRules(e);const i=l.match(/<[\w\d.,/#]+>/gi);if(!i)return l;for(let n of i){const r=this.defineTransformations(n);l=l.replace(n,()=>{n=n.replace(/[<>]/gi,""),n=n.replace(/#[\w\d.,/]+#/g,"");const o=n.search(/[.]/)>-1?this.getNestedObject(s,n.match(/[\w\d]+/g)):s[n];if(!o){const u=this.lang==="es"?`Se intent\xF3 expandir desde la regla "${n}", pero no se pudo encontrar`:`Tried to expand from rule "${n}", but couldn't find it`;console.error(u)}const c=this.selectGrammarRule(o);return this.transformString(c,r)})}return this.grammarRuleRecursion(l,s)}setNewRules(e,t){let s;t===void 0?s=this.grammar:s=t;let l=e;const i=l.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(i)for(;i.length;){const n=i.pop();l=l.replace(n,"");const{symbol:r,pairsString:o}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(n).groups,c=o.match(/[-]?[\w\d]+:[\w\d]+/gi).map(u=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(u).groups);if(c){s[r]=s[r]||{};for(let u of c){const f=s[u.value];if(!f){const v=this.lang==="es"?`Se intent\xF3 crear la nueva regla "${r}", pero no se pudo encontrar "${u.value}" para producir la subregla "${u.key}"`:`Tried to create new rule: "${r}", but couldn't find "${u.value}" to produce "${u.key}" subrule`;console.error(v)}const d=u.remove==="-",_=this.selectGrammarRule(f);if(d){const v=f.indexOf(_);s[u.value]=[...f.slice(0,v),...f.slice(v+1)]}s[r][u.key]=[_]}}}return l}startAdventure(e){this.options.defaultCSS&&this.setCSS();const t=document.createElement("div");return t.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(t),this.goToScene(this.scenes[e]),this}goToScene(e){const t=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(o=>o.remove()),[...document.getElementsByClassName("storyimage-area")].map(r=>r.remove());const l=document.createElement("div");if(l.className="storydiv",t.appendChild(l),e.image||e.imagen){const r=document.createElement("div");r.className="storyimage-container",l.appendChild(r);const o=e.image||e.imagen,c=this.options.adventureScroll?this.storyPreload[o].cloneNode():this.storyPreload[o];r.appendChild(c),e.areas&&(c.complete?this.setAreas(c,r,e.areas):c.onload=()=>{this.setAreas(c,r,e.areas)})}else if(e.igrama!==void 0){const r=document.createElement("div");r.className="storyimage-container",l.appendChild(r);const o=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(o),this.igramaDataUrl(o,this.options.igramaFormat).then(c=>{const u=new Image;u.src=c,u.className="storyimage",r.appendChild(u)})}const i=document.createElement("div");i.className="storyp-container",(e.text||e.texto||e.igramaText)&&l.appendChild(i);const n=document.createElement("p");n.className="storyp",n.innerHTML="",i.appendChild(n),document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(n,e),this.options.sceneCallback(e)}setAreas(e,t,s){const l=e.getBoundingClientRect(),i=t.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,t,s)},[...document.getElementsByClassName("storyimage-area")].map(r=>r.remove());for(let r of s){let o=document.createElement("div");o.className="storyimage-area";const c=(r.x-Math.floor(r.w/2))*l.width/e.naturalWidth;o.style.left=`${l.left-i.left+c}px`;const u=(r.y-Math.floor(r.h/2))*l.height/e.naturalHeight;o.style.top=`${l.top-i.top+u}px`,o.style.width=`${r.w*l.width/e.naturalWidth}px`,o.style.height=`${r.h*l.height/e.naturalHeight}px`,o.innerHTML=r.btn||"",t.appendChild(o),o.style.fontSize=`${18*l.height/e.naturalHeight}px`,o.onclick=()=>{const f=r.scene||r.escena;this.goToScene(this.scenes[f])},r.tooltip!==void 0&&(o.onmouseover=()=>{o.innerHTML=r.tooltip||"",o.style.zIndex="100"},o.onmouseout=()=>{o.innerHTML=r.btn||"",o.style.zIndex="0"})}}typewriter(e,t){const s=t.text||t.texto||t.igramaText||"";let l=this.grammar?this.grammarRuleRecursion(s):s;if(l=l.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let i=0;const n=setInterval(()=>{const r=l.substring(0,i);e.innerHTML=r,i++,i>l.length&&(clearInterval(n),this.optionButtons(t))},Math.floor(this.options.typewriterSpeed))}else e.innerHTML=l,this.optionButtons(t)}optionButtons(e){const t=[...document.getElementsByClassName("storydiv")],s=t[t.length-1];[...document.getElementsByClassName("storybutton-container")].map(n=>n.remove());const i=document.createElement("div");if(i.className="storybutton-container",s.appendChild(i),e.options||e.opciones){const n=e.options||e.opciones;for(let r of n){const o=document.createElement("button");o.className="storybutton",o.innerHTML=r.btn,i.appendChild(o),o.addEventListener("click",()=>{if((r.text||r.texto)===void 0){const u=r.scene||r.escena;this.goToScene(this.scenes[u])}else this.goToScene(r)})}}else if(e.scene||e.escena){const n=e.scene||e.escena,r=document.createElement("button");r.className="storybutton",r.innerHTML=this.lang==="en"?"Continue":"Continuar",i.appendChild(r),r.addEventListener("click",()=>{this.goToScene(this.scenes[n])})}document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const l=Math.random()*e.prob.reduce((n,r)=>n+r);let i=0;for(let n=0;n<e.prob.length;n++){if(i<=l&&l<i+e.prob[n])return e[n];i+=e.prob[n]}}const t=Math.floor(Math.random()*e.length);return e[t]}getNestedObject(e,t){return t.reduce((s,l)=>s&&s[l]!==void 0?s[l]:void 0,e)}defineTransformations(e){let t={};const s=/#(?<trans>[\w\d,]+)#/gi.exec(e),l=s?s.groups.trans.match(/[\w]+/gi):[];for(let i of l)t[i]=!0;return t}transformString(e,t){let s=e;return t.CAPITALIZE&&(s=s.charAt(0).toUpperCase()+s.slice(1)),t.ALLCAPS&&(s=s.toUpperCase()),s}decodeDrawing(e){if(e==="")return[];const[t,s,l]=e.split("%%");let i={};return t==="vector"?i.content=s.split("**").map(n=>{const[r,o,c]=n.split("&"),u=[];if(u.color=r,u.weight=o,c===void 0)return u;const f=c.split(",");for(let d=0;d<f.length;d+=2)u.push([+f[d],+f[d+1]]);return u}):i.content=s,i.attribute=l,i.type=t,i}async getMarkovModel(e,t=1,s=!1){let l=await(await fetch(`./${e}`)).text();l=l.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const i=l.split(this.markovSeparator),n={};for(let o=0;o<i.length-t;o++){let c="";for(let f=0;f<t;f++)c+=f===0?i[o+f]:" "+i[o+f];n[c]===void 0&&(n[c]={});const u=i[o+t];n[c][u]===void 0?n[c][u]=1:n[c][u]++}const r={};for(let o of Object.keys(n)){const c=Object.keys(n[o]);r[o]={probs:[],grams:c};let u=0;for(let f=0;f<c.length;f++)u+=n[o][c[f]];for(let f=0;f<c.length;f++)r[o].probs[f]=n[o][c[f]]/u}if(s){const o=e.split("/");this.saveJSON(r,`${o[o.length-1]}_markovModel_${t}N.json`)}return r}markovChain(e,t,s=.1){let l=t===void 0||this.markov[t]===void 0?this.randomMarkovWord():t,i=l;for(let r=0;r<e-1;r++){let o=this.getNextMarkov(this.markov[i]);o===void 0&&(o=this.getNextMarkov(this.randomMarkovWord()));let c=i.split(this.markovSeparator);c.push(o),c=c.slice(1).join(" "),i=c,l+=` ${o}`}return this.formatMarkov(l,s)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const t=Math.random();let s=0;if(e!==void 0)for(let l=0;l<e.probs.length;l++){if(s<=t&&t<s+e.probs[l])return e.grams[l];s+=e.probs[l]}}formatMarkov(e,t=.1){let s=e.replace(/ ([,:.;])/g,"$1");return s=s.replaceAll(/([.]) ([\wáéíóú])/ig,(l,i,n,r,o)=>Math.random()<t?`.
${n.toUpperCase()}`:`. ${n.toUpperCase()}`),s.charAt(0).toUpperCase()+s.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,t){const s=document.createElement("a");s.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),s.setAttribute("download",`${t.includes(".json")?t:t+".json"}`),document.body.appendChild(s),s.click(),document.body.removeChild(s)}testScenes(e){const t=e||this.scenes;if(!t){const l=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(l)}let s=[];for(let l of Object.keys(t)){const i=t[l];if(i.options||i.opciones){const r=(i.options||i.opciones).filter(o=>!t[o.scene||o.escena]);s=[...s,...r.map(o=>`${l} => ${o.btn} => ${o.scene||o.escena}`)]}else{if(i.deadEnd||i.sinSalida)continue;t[i.scene||i.escena]||s.push(`${l} => ${i.scene||i.escena}`)}}if(s.length>0){const l=this.lang==="es"?`Las siguientes escenas no llevan a ning\xFAn lado: ${s.join(", ")}`:`The following scenes are dead ends: ${s.join(", ")}`;console.error(l),this.scenesError=!0}return this}testGrammar(e){const t=e||this.grammar;if(!t){const s=this.lang==="es"?"No hay gram\xE1tica para probar":"There is not grammar to test";console.error(s)}for(let s of Object.keys(t)){const l=t[s];for(let i of l){const n=i.match(/<([\w\d]+)>/gi),r=n?n.map(f=>f.replace(/[<>]/g,"")):[],o=i.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),c=o?o.map(f=>f.match(/([ ]?:[\w\d]+)/g).map(d=>/[ ]?:(?<key>[\w\d]+)/.exec(d).groups.key)).reduce((f,d)=>[...f,...d],[]):[],u=[...r,...c].filter(f=>!t[f]);if(u.length>0){const f=this.lang==="es"?`Las siguientes reglas, que se referencian en "${s}", no existen: ${u.join(", ")}`:`The following rules, referenced in "${s}", do not exist: ${u.join(", ")}`;this.grammarError=!0,console.error(f)}}}return this}testDistribution(e){const t=e||this.markov;if(t===void 0){const c=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(c)}const s={},l={};let i=0;const n=Object.values(t);for(let c of n)for(let u of c.probs){const f=(Math.round(u/.05)*.05).toFixed(2);l[i]=f,i++,s[f]===void 0?s[f]=1:s[f]++}console.log("------------------------------------ DIST ------------------------------------");const r=Math.max(...Object.values(s)),o=Object.entries(s).sort((c,u)=>c[0]>u[0]?1:c[0]<u[0]?-1:0);for(let c of o)console.log(`${c[0]}... ${"|".repeat(Math.ceil(c[1]*100/r))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,t="png",s){const l=await this.igramaDataUrl(e,t),i=new Image;i.src=l,s==null?document.body.appendChild(i):document.getElementById(s).appendChild(i)}async igramaDataUrl(e,t="png"){const s=this.igrama.metadata.width,l=this.igrama.metadata.height;let i=document.createElement("canvas");i.width=s,i.height=l;const n=i.getContext("2d");n.lineJoin="round",n.lineCap="round",n.fillStyle=this.igrama.metadata.bg||"#FFFFFF",n.fillRect(0,0,s,l),await this.drawLayers(e,n);let r;if(t==="png")r=i.toDataURL();else if(t==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener tambi\xE9n la librer\xEDa MiniGif":"To create Gifs you must have also the MiniGif library"),"";const o={colorResolution:7,dither:!1,delay:50};Object.assign(o,this.minigifOptions);const c=new MiniGif(o);c.addFrame(i);const u=this.getLayerWiggle(e);n.fillStyle=this.igrama.metadata.bg||"#FFFFFF",n.fillRect(0,0,s,l),await this.drawLayers(u,n),c.addFrame(i);const f=c.makeGif(),d=await this.base64_arraybuffer(f);r="data:image/gif;base64,"+d}return i.remove(),r}async base64_arraybuffer(e){return(await new Promise(s=>{const l=new FileReader;l.onload=()=>s(l.result),l.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const s=JSON.parse(JSON.stringify(e)),l=(i,n)=>Math.floor(i+Math.random()*(n-i));for(let[i,n]of s.entries())if(n.type==="vector")for(let[r,o]of n.content.entries()){for(let[c,u]of o.entries())Math.random()<.5?u[0]+=l(-3,3):u[1]+=l(-3,3);o.color=e[i].content[r].color,o.weight=e[i].content[r].weight}return s}getIgramaText(e){return e.map(s=>s.attribute).reverse().join(" ").trim()}async drawLayers(e,t){for(let[s,l]of e.entries())if(l.type==="url"){const{w:i,h:n,x:r,y:o}=this.igrama.sections[s];if(this.imgsMemo[l.content]===void 0){const c=new Image;c.src=l.content,this.imgsMemo[l.content]=await new Promise(u=>{c.addEventListener("load",()=>{u(c)},!1)})}t.drawImage(this.imgsMemo[l.content],r,o,i,n)}else if(l.type=="vector")for(let i of l.content){if(i.length===0)continue;const n=this.getSpline(i);this.drawSpline(n,t,i.color,i.weight)}}drawSpline(e,t,s,l){t.lineWidth=l,t.strokeStyle=s,t.fillStyle="rgba(0,0,0,0)",t.beginPath();for(let i=0;i<e.length;i++)i===0?t.moveTo(...e[0]):t.lineTo(...e[i]);t.stroke()}getSpline(e){let t=[];for(let s=0;s<e.length-1;s++){const l=[];l[0]=s>0?e[s-1]:e[0],l[1]=e[s],l[2]=e[s+1],l[3]=s<e.length-2?e[s+2]:e[e.length-1];for(let i=0;i<1;i+=.05){const n=this.getSplinePoint(i,l);t.push(n)}}return t}getSplinePoint(e,t){const s=Math.floor(e)+1,l=s+1,i=l+1,n=s-1,r=e*e,o=r*e,c=-o+2*r-e,u=3*o-5*r+2,f=-3*o+4*r+e,d=o-r,_=.5*(t[n][0]*c+t[s][0]*u+t[l][0]*f+t[i][0]*d),v=.5*(t[n][1]*c+t[s][1]*u+t[l][1]*f+t[i][1]*d);return[_,v]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=Yt,document.getElementsByTagName("head")[0].appendChild(e)}}const Yt=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 10px;
  flex-direction: column;
  box-sizing: border-box;
}

.storyp {
  font-size: 18px;
  min-height: 25px;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: white;
  border-radius: 4px;
  padding: 10px;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: black;
  color: white;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,Zt=Oe(Xt);function it(a,e,t){const s=a.slice();return s[17]=e[t],s}function rt(a,e,t){const s=a.slice();return s[17]=e[t],s}function lt(a,e){let t,s,l,i;function n(o){e[12](o)}let r={key:e[17]};return e[0]!==void 0&&(r.movingNode=e[0]),s=new Rt({props:r}),ne.push(()=>fe(s,"movingNode",n)),{key:a,first:null,c(){t=Se(),oe(s.$$.fragment),this.h()},l(o){t=Se(),ie(s.$$.fragment,o),this.h()},h(){this.first=t},m(o,c){T(o,t,c),re(s,o,c),i=!0},p(o,c){e=o;const u={};c&8&&(u.key=e[17]),!l&&c&1&&(l=!0,u.movingNode=e[0],de(()=>l=!1)),s.$set(u)},i(o){i||(G(s.$$.fragment,o),i=!0)},o(o){q(s.$$.fragment,o),i=!1},d(o){o&&p(t),le(s,o)}}}function at(a,e){let t,s,l;return s=new Gt({props:{key:e[17],mouse:e[4]}}),{key:a,first:null,c(){t=Se(),oe(s.$$.fragment),this.h()},l(i){t=Se(),ie(s.$$.fragment,i),this.h()},h(){this.first=t},m(i,n){T(i,t,n),re(s,i,n),l=!0},p(i,n){e=i;const r={};n&8&&(r.key=e[17]),n&16&&(r.mouse=e[4]),s.$set(r)},i(i){l||(G(s.$$.fragment,i),l=!0)},o(i){q(s.$$.fragment,i),l=!1},d(i){i&&p(t),le(s,i)}}}function Qt(a){let e=[],t=new Map,s,l,i=[],n=new Map,r,o=a[3];const c=d=>d[17];for(let d=0;d<o.length;d+=1){let _=rt(a,o,d),v=c(_);t.set(v,e[d]=lt(v,_))}let u=a[3];const f=d=>d[17];for(let d=0;d<u.length;d+=1){let _=it(a,u,d),v=f(_);n.set(v,i[d]=at(v,_))}return{c(){for(let d=0;d<e.length;d+=1)e[d].c();s=U(),l=Ve("svg");for(let d=0;d<i.length;d+=1)i[d].c();this.h()},l(d){for(let v=0;v<e.length;v+=1)e[v].l(d);s=j(d),l=Ge(d,"svg",{class:!0});var _=E(l);for(let v=0;v<i.length;v+=1)i[v].l(_);_.forEach(p),this.h()},h(){b(l,"class","connections-container svelte-4kbf32")},m(d,_){for(let v=0;v<e.length;v+=1)e[v].m(d,_);T(d,s,_),T(d,l,_);for(let v=0;v<i.length;v+=1)i[v].m(l,null);r=!0},p(d,_){_&9&&(o=d[3],Te(),e=De(e,_,c,1,d,o,t,s.parentNode,Xe,lt,s,rt),Ce()),_&24&&(u=d[3],Te(),i=De(i,_,f,1,d,u,n,l,Xe,at,null,it),Ce())},i(d){if(!r){for(let _=0;_<o.length;_+=1)G(e[_]);for(let _=0;_<u.length;_+=1)G(i[_]);r=!0}},o(d){for(let _=0;_<e.length;_+=1)q(e[_]);for(let _=0;_<i.length;_+=1)q(i[_]);r=!1},d(d){for(let _=0;_<e.length;_+=1)e[_].d(d);d&&p(s),d&&p(l);for(let _=0;_<i.length;_+=1)i[_].d()}}}function $t(a){let e,t,s,l,i,n,r,o,c,u,f,d,_,v,I,P,V,h,m,O,M,L,F,K,z,$,ue,A,ee,H,w;function B(g){a[13](g)}function W(g){a[14](g)}let X={movingNode:a[0],$$slots:{default:[Qt,({offset:g})=>({16:g}),({offset:g})=>g?65536:0]},$$scope:{ctx:a}};return a[1]!==void 0&&(X.showNewScene=a[1]),a[4]!==void 0&&(X.mouse=a[4]),$=new qt({props:X}),ne.push(()=>fe($,"showNewScene",B)),ne.push(()=>fe($,"mouse",W)),{c(){e=k("input"),t=U(),s=k("div"),l=U(),i=k("div"),n=k("div"),r=k("div"),o=k("button"),c=x("Nuevo proyecto"),u=U(),f=k("label"),d=x("Importar"),_=U(),v=k("button"),I=x("Exportar"),P=U(),V=k("button"),h=x("Previsualizar"),m=U(),O=k("div"),M=k("button"),L=x("Nueva escena"),F=U(),K=k("div"),z=k("div"),oe($.$$.fragment),this.h()},l(g){e=N(g,"INPUT",{type:!0,id:!0}),t=j(g),s=N(g,"DIV",{class:!0,id:!0}),E(s).forEach(p),l=j(g),i=N(g,"DIV",{class:!0});var S=E(i);n=N(S,"DIV",{class:!0});var D=E(n);r=N(D,"DIV",{class:!0});var Z=E(r);o=N(Z,"BUTTON",{class:!0});var te=E(o);c=J(te,"Nuevo proyecto"),te.forEach(p),u=j(Z),f=N(Z,"LABEL",{class:!0,for:!0});var ae=E(f);d=J(ae,"Importar"),ae.forEach(p),_=j(Z),v=N(Z,"BUTTON",{class:!0});var C=E(v);I=J(C,"Exportar"),C.forEach(p),P=j(Z),V=N(Z,"BUTTON",{class:!0});var Q=E(V);h=J(Q,"Previsualizar"),Q.forEach(p),Z.forEach(p),m=j(D),O=N(D,"DIV",{class:!0});var ye=E(O);M=N(ye,"BUTTON",{class:!0});var _e=E(M);L=J(_e,"Nueva escena"),_e.forEach(p),ye.forEach(p),D.forEach(p),F=j(S),K=N(S,"DIV",{class:!0});var Ie=E(K);z=N(Ie,"DIV",{class:!0});var ge=E(z);ie($.$$.fragment,ge),ge.forEach(p),Ie.forEach(p),S.forEach(p),this.h()},h(){b(e,"type","file"),b(e,"id","load-input"),e.hidden=!0,b(s,"class","test-story-container svelte-4kbf32"),b(s,"id","test-story-container"),b(o,"class","toolbar-button svelte-4kbf32"),b(f,"class","toolbar-button svelte-4kbf32"),b(f,"for","load-input"),b(v,"class","toolbar-button svelte-4kbf32"),b(V,"class","toolbar-button svelte-4kbf32"),b(r,"class","project-toolbar svelte-4kbf32"),b(M,"class","toolbar-button svelte-4kbf32"),b(O,"class","scene-toolbar svelte-4kbf32"),b(n,"class","toolbar svelte-4kbf32"),b(z,"class","page-container svelte-4kbf32"),b(K,"class","static-page-container svelte-4kbf32"),b(i,"class","design-window-container svelte-4kbf32")},m(g,S){T(g,e,S),a[11](e),T(g,t,S),T(g,s,S),T(g,l,S),T(g,i,S),y(i,n),y(n,r),y(r,o),y(o,c),y(r,u),y(r,f),y(f,d),y(r,_),y(r,v),y(v,I),y(r,P),y(r,V),y(V,h),y(n,m),y(n,O),y(O,M),y(M,L),y(i,F),y(i,K),y(K,z),re($,z,null),ee=!0,H||(w=[R(e,"change",a[5]),R(o,"click",a[7]),R(v,"click",a[9]),R(V,"click",a[8]),R(M,"click",a[6])],H=!0)},p(g,[S]){const D={};S&1&&(D.movingNode=g[0]),S&4194329&&(D.$$scope={dirty:S,ctx:g}),!ue&&S&2&&(ue=!0,D.showNewScene=g[1],de(()=>ue=!1)),!A&&S&16&&(A=!0,D.mouse=g[4],de(()=>A=!1)),$.$set(D)},i(g){ee||(G($.$$.fragment,g),ee=!0)},o(g){q($.$$.fragment,g),ee=!1},d(g){g&&p(e),a[11](null),g&&p(t),g&&p(s),g&&p(l),g&&p(i),le($),H=!1,Ee(w)}}}function es(a){a.scrollIntoView({block:"start"})}function ts(a,e){const t=document.createElement("a");t.href=URL.createObjectURL(new Blob([JSON.stringify(a,null,2)],{type:"application/json"})),t.setAttribute("download",`${e.includes(".json")?e:e+".json"}`),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function ss(a,e,t){let s,l,i,n;se(a,Y,m=>t(10,i=m)),se(a,Zt,m=>t(15,n=m));let r=!1,o=!1,c;function u(){const m=c.files[0];if(m.type==="application/json"){ce(Y,i={},i);const O=new FileReader;O.addEventListener("load",function(){const M=O.result,L=JSON.parse(M);ce(Y,i=L,i)}),this.value=null,O.readAsText(m);return}else alert("Formato de archivo incorrecto / incorrect file format")}function f(){t(1,o=!0)}function d(){ce(Y,i={},i)}function _(){console.log(i);const m=document.getElementById("storygeneraldiv");m&&m.remove();const O=new n("es"),M=Object.entries(i).sort((K,z)=>K[1].display.y-z[1].display.y);if(M.length===0){alert("No hay escenas / There are no scenes");return}O.setScenes(i).startAdventure(M[0][0]);const L=document.getElementById("test-story-container"),F=document.getElementById("storygeneraldiv");L.appendChild(F),es(F)}function v(){ts(i,"aventuraInteractiva")}function I(m){ne[m?"unshift":"push"](()=>{c=m,t(2,c)})}function P(m){r=m,t(0,r)}function V(m){o=m,t(1,o)}function h(m){s=m,t(4,s)}return a.$$.update=()=>{a.$$.dirty&1024&&t(3,l=Object.keys(i))},t(4,s={x:0,y:0}),[r,o,c,l,s,u,f,d,_,v,i,I,P,V,h]}class ns extends pe{constructor(e){super(),me(this,e,ss,$t,he,{})}}function os(a){let e,t,s,l,i,n,r,o,c;return i=new ns({}),{c(){e=k("section"),t=k("h1"),s=x("Aventura interactiva (beta)"),l=U(),oe(i.$$.fragment),n=U(),r=k("footer"),o=x("Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.1b"),this.h()},l(u){e=N(u,"SECTION",{class:!0});var f=E(e);t=N(f,"H1",{class:!0});var d=E(t);s=J(d,"Aventura interactiva (beta)"),d.forEach(p),l=j(f),ie(i.$$.fragment,f),n=j(f),r=N(f,"FOOTER",{class:!0});var _=E(r);o=J(_,"Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.1b"),_.forEach(p),f.forEach(p),this.h()},h(){b(t,"class","svelte-aiip2m"),b(r,"class","svelte-aiip2m"),b(e,"class","svelte-aiip2m")},m(u,f){T(u,e,f),y(e,t),y(t,s),y(e,l),re(i,e,null),y(e,n),y(e,r),y(r,o),c=!0},p:ve,i(u){c||(G(i.$$.fragment,u),c=!0)},o(u){q(i.$$.fragment,u),c=!1},d(u){u&&p(e),le(i)}}}class ls extends pe{constructor(e){super(),me(this,e,null,os,he,{})}}export{ls as default};
