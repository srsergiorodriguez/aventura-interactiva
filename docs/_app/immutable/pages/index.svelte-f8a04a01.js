import{S as pe,i as me,s as he,F as De,l as k,m as N,n as E,h as p,p as b,b as T,K as we,L as R,M as Ne,G as Ae,H as Be,I as Re,f as G,t as q,N as Ee,O as ke,r as H,u as J,J as y,E as ve,a as U,c as j,P as Ue,Q as ne,w as oe,x as ie,y as re,B as le,R as se,T as ue,U as fe,V as be,W as de,v as je,e as Se,g as Te,d as Ce,X as at,Y as Pe,Z as Ve,_ as Je,$ as qe}from"../chunks/index-5968fb5e.js";import{w as ft,r as Oe}from"../chunks/index-57b615c3.js";const Y=ft({inicio:{texto:"\xC9rase una vez un c\xEDrculo...",display:{ops:[],x:346,y:110},opciones:[{btn:"dejar tranquilo",texto:"dejas al c\xEDrculo en paz",escena:"final1"},{btn:"aplastar",text:"...aplastamiento activado...",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{ops:[],x:263,y:289}},final2:{texto:"Parece que la historia form\xF3 una elipsis",sinSalida:!0,display:{ops:[],x:518,y:289}}}),ut=Oe(a=>a.scene===void 0&&a.escena!==void 0?"escena":"scene"),ct=Oe(a=>a.options===void 0&&a.opciones!==void 0?"opciones":"options"),dt=Oe(a=>a.text===void 0&&a.texto!==void 0?"texto":"text"),pt=Oe(a=>a.image===void 0&&a.imagen!==void 0?"imagen":"image");function mt(a){let e,n,t,r;const o=a[5].default,s=De(o,a,a[4],null);return{c(){e=k("div"),s&&s.c(),this.h()},l(l){e=N(l,"DIV",{class:!0});var i=E(e);s&&s.l(i),i.forEach(p),this.h()},h(){b(e,"class","draggui svelte-11g4b1g")},m(l,i){T(l,e,i),s&&s.m(e,null),n=!0,t||(r=[we(a[0].call(null,e)),we(a[1].call(null,e)),R(e,"mousedown",Ne(a[6]))],t=!0)},p(l,[i]){s&&s.p&&(!n||i&16)&&Ae(s,o,l,l[4],n?Re(o,l[4],i,null):Be(l[4]),null)},i(l){n||(G(s,l),n=!0)},o(l){q(s,l),n=!1},d(l){l&&p(e),s&&s.d(l),t=!1,Ee(r)}}}function ht(a,e,n){let{$$slots:t={},$$scope:r}=e,{pos:o}=e,{displace:s={x:o.x,y:o.y}}=e;function l(u){u.style.left=`${s.x}px`,u.style.top=`${s.y}px`}function i(u){let f=!1;u.style.left=`${s.x}px`,u.style.top=`${s.y}px`,u.addEventListener("mousedown",()=>{f=!0}),window.addEventListener("mousemove",d=>{f&&(n(2,s.x+=d.movementX,s),n(2,s.y+=d.movementY,s),u.style.left=`${s.x}px`,u.style.top=`${s.y}px`,u.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{f=!1,u.style.cursor="grab"})}function c(u){ke.call(this,a,u)}return a.$$set=u=>{"pos"in u&&n(3,o=u.pos),"displace"in u&&n(2,s=u.displace),"$$scope"in u&&n(4,r=u.$$scope)},[l,i,s,o,r,t,c]}class Ge extends pe{constructor(e){super(),me(this,e,ht,mt,he,{pos:3,displace:2})}}function gt(a){let e,n,t,r,o;return{c(){e=k("div"),n=k("button"),t=H("X"),this.h()},l(s){e=N(s,"DIV",{class:!0});var l=E(e);n=N(l,"BUTTON",{class:!0});var i=E(n);t=J(i,"X"),i.forEach(p),l.forEach(p),this.h()},h(){b(n,"class","x-button"),b(e,"class","top-bar svelte-15bdkib")},m(s,l){T(s,e,l),y(e,n),y(n,t),r||(o=R(n,"click",a[0]),r=!0)},p:ve,i:ve,o:ve,d(s){s&&p(e),r=!1,o()}}}function _t(a,e,n){let{toggle:t}=e;function r(){n(1,t=!1)}return a.$$set=o=>{"toggle"in o&&n(1,t=o.toggle)},[r,t]}class Ke extends pe{constructor(e){super(),me(this,e,_t,gt,he,{toggle:1})}}function Xe(a){let e,n;return{c(){e=k("img"),this.h()},l(t){e=N(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Ue(e.src,n="")||b(e,"src",n),b(e,"alt","Preview"),b(e,"class","img-preview svelte-ekr4m4")},m(t,r){T(t,e,r),a[6](e)},p:ve,d(t){t&&p(e),a[6](null)}}}function vt(a){let e,n,t,r,o,s=a[2]&&Xe(a);return{c(){e=k("input"),n=U(),t=k("div"),s&&s.c(),this.h()},l(l){e=N(l,"INPUT",{type:!0}),n=j(l),t=N(l,"DIV",{class:!0,id:!0});var i=E(t);s&&s.l(i),i.forEach(p),this.h()},h(){b(e,"type","file"),b(t,"class","image-preview-container svelte-ekr4m4"),b(t,"id","image-preview-container")},m(l,i){T(l,e,i),a[5](e),T(l,n,i),T(l,t,i),s&&s.m(t,null),r||(o=R(e,"change",a[3]),r=!0)},p(l,[i]){l[2]?s?s.p(l,i):(s=Xe(l),s.c(),s.m(t,null)):s&&(s.d(1),s=null)},i:ve,o:ve,d(l){l&&p(e),a[5](null),l&&p(n),l&&p(t),s&&s.d(),r=!1,o()}}}function yt(a,e,n){let{imageUrl:t}=e,r,o,s=!1;function l(){const u=r.files[0];if(u){n(2,s=!0);const f=new FileReader;f.addEventListener("load",function(){n(4,t=f.result),o.setAttribute("src",f.result)}),f.readAsDataURL(u);return}n(2,s=!1)}function i(u){ne[u?"unshift":"push"](()=>{r=u,n(0,r)})}function c(u){ne[u?"unshift":"push"](()=>{o=u,n(1,o)})}return a.$$set=u=>{"imageUrl"in u&&n(4,t=u.imageUrl)},[r,o,s,l,t,i,c]}class bt extends pe{constructor(e){super(),me(this,e,yt,vt,he,{imageUrl:4})}}function wt(a){let e,n,t,r,o,s,l,i,c,u,f,d,_,v,I,P,V,h,m,O,M,L,z,K,W,$,ce,A,ee,x,w,B,F,X,g,S;function D(C){a[8](C)}let Z={};a[0]!==void 0&&(Z.toggle=a[0]),e=new Ke({props:Z}),ne.push(()=>fe(e,"toggle",D));function te(C){a[11](C)}let ae={};return a[3]!==void 0&&(ae.imageUrl=a[3]),A=new bt({props:ae}),ne.push(()=>fe(A,"imageUrl",te)),{c(){oe(e.$$.fragment),t=U(),r=k("div"),o=k("h1"),s=H(a[1]),l=U(),i=k("div"),c=k("h2"),u=H("Texto"),f=U(),d=k("textarea"),_=U(),v=k("div"),I=k("h2"),P=H("Imagen (opcional)"),V=U(),h=k("div"),m=k("label"),O=H("Url:"),M=U(),L=k("input"),z=H(`
    o
    `),K=k("div"),W=k("span"),$=H("Archivo:"),ce=U(),oe(A.$$.fragment),x=U(),w=k("div"),B=k("button"),F=H("Aceptar"),this.h()},l(C){ie(e.$$.fragment,C),t=j(C),r=N(C,"DIV",{});var Q=E(r);o=N(Q,"H1",{class:!0});var ye=E(o);s=J(ye,a[1]),ye.forEach(p),Q.forEach(p),l=j(C),i=N(C,"DIV",{});var _e=E(i);c=N(_e,"H2",{class:!0});var Ie=E(c);u=J(Ie,"Texto"),Ie.forEach(p),f=j(_e),d=N(_e,"TEXTAREA",{class:!0}),E(d).forEach(p),_e.forEach(p),_=j(C),v=N(C,"DIV",{});var ge=E(v);I=N(ge,"H2",{class:!0});var ze=E(I);P=J(ze,"Imagen (opcional)"),ze.forEach(p),V=j(ge),h=N(ge,"DIV",{});var Me=E(h);m=N(Me,"LABEL",{for:!0});var Fe=E(m);O=J(Fe,"Url:"),Fe.forEach(p),M=j(Me),L=N(Me,"INPUT",{id:!0,type:!0}),Me.forEach(p),z=J(ge,`
    o
    `),K=N(ge,"DIV",{});var Le=E(K);W=N(Le,"SPAN",{});var We=E(W);$=J(We,"Archivo:"),We.forEach(p),ce=j(Le),ie(A.$$.fragment,Le),Le.forEach(p),x=j(ge),w=N(ge,"DIV",{class:!0});var xe=E(w);B=N(xe,"BUTTON",{});var He=E(B);F=J(He,"Aceptar"),He.forEach(p),xe.forEach(p),ge.forEach(p),this.h()},h(){b(o,"class","svelte-2p34te"),b(c,"class","svelte-2p34te"),b(d,"class","svelte-2p34te"),b(I,"class","svelte-2p34te"),b(m,"for","inp"),b(L,"id","inp"),b(L,"type","text"),b(w,"class","bar svelte-2p34te")},m(C,Q){re(e,C,Q),T(C,t,Q),T(C,r,Q),y(r,o),y(o,s),T(C,l,Q),T(C,i,Q),y(i,c),y(c,u),y(i,f),y(i,d),be(d,a[4]),T(C,_,Q),T(C,v,Q),y(v,I),y(I,P),y(v,V),y(v,h),y(h,m),y(m,O),y(h,M),y(h,L),be(L,a[3]),y(v,z),y(v,K),y(K,W),y(W,$),y(K,ce),re(A,K,null),y(v,x),y(v,w),y(w,B),y(B,F),X=!0,g||(S=[R(d,"input",a[9]),R(d,"mousedown",Ne(a[7])),R(L,"input",a[10]),R(L,"mousedown",Ne(a[6])),R(B,"click",a[5])],g=!0)},p(C,Q){const ye={};!n&&Q&1&&(n=!0,ye.toggle=C[0],de(()=>n=!1)),e.$set(ye),(!X||Q&2)&&je(s,C[1]),Q&16&&be(d,C[4]),Q&8&&L.value!==C[3]&&be(L,C[3]);const _e={};!ee&&Q&8&&(ee=!0,_e.imageUrl=C[3],de(()=>ee=!1)),A.$set(_e)},i(C){X||(G(e.$$.fragment,C),G(A.$$.fragment,C),X=!0)},o(C){q(e.$$.fragment,C),q(A.$$.fragment,C),X=!1},d(C){le(e,C),C&&p(t),C&&p(r),C&&p(l),C&&p(i),C&&p(_),C&&p(v),le(A),g=!1,Ee(S)}}}function kt(a){let e,n;return e=new Ge({props:{pos:a[2],$$slots:{default:[wt]},$$scope:{ctx:a}}}),{c(){oe(e.$$.fragment)},l(t){ie(e.$$.fragment,t)},m(t,r){re(e,t,r),n=!0},p(t,[r]){const o={};r&4&&(o.pos=t[2]),r&32795&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){n||(G(e.$$.fragment,t),n=!0)},o(t){q(e.$$.fragment,t),n=!1},d(t){le(e,t)}}}function Nt(a,e,n){let t,r;se(a,Y,h=>n(12,r=h));let{key:o}=e,{pos:s}=e,{showEditor:l}=e,i=null,c=r[o];const u=c.text===void 0&&c.texto!==void 0?"texto":"text";function f(){ue(Y,r[o][u]=t,r),i!==null&&ue(Y,r[o].image=i,r),n(0,l=!1)}function d(h){ke.call(this,a,h)}function _(h){ke.call(this,a,h)}function v(h){l=h,n(0,l)}function I(){t=this.value,n(4,t),n(13,c)}function P(){i=this.value,n(3,i)}function V(h){i=h,n(3,i)}return a.$$set=h=>{"key"in h&&n(1,o=h.key),"pos"in h&&n(2,s=h.pos),"showEditor"in h&&n(0,l=h.showEditor)},a.$$.update=()=>{a.$$.dirty&2&&ue(Y,r[o]=c,r)},n(4,t=c[u]),[l,o,s,i,t,f,d,_,v,I,P,V]}class Et extends pe{constructor(e){super(),me(this,e,Nt,kt,he,{key:1,pos:2,showEditor:0})}}function St(a){let e,n,t,r,o,s,l,i,c,u,f,d,_,v,I;function P(h){a[7](h)}let V={};return a[0]!==void 0&&(V.toggle=a[0]),e=new Ke({props:V}),ne.push(()=>fe(e,"toggle",P)),{c(){oe(e.$$.fragment),t=U(),r=k("div"),o=k("label"),s=H("Btn:"),l=U(),i=k("input"),c=U(),u=k("div"),f=k("button"),d=H("Aceptar"),this.h()},l(h){ie(e.$$.fragment,h),t=j(h),r=N(h,"DIV",{});var m=E(r);o=N(m,"LABEL",{for:!0});var O=E(o);s=J(O,"Btn:"),O.forEach(p),l=j(m),i=N(m,"INPUT",{id:!0,type:!0}),m.forEach(p),c=j(h),u=N(h,"DIV",{class:!0});var M=E(u);f=N(M,"BUTTON",{});var L=E(f);d=J(L,"Aceptar"),L.forEach(p),M.forEach(p),this.h()},h(){b(o,"for","inp"),b(i,"id","inp"),b(i,"type","text"),b(u,"class","bar svelte-1bhrmvp")},m(h,m){re(e,h,m),T(h,t,m),T(h,r,m),y(r,o),y(o,s),y(r,l),y(r,i),be(i,a[2]),T(h,c,m),T(h,u,m),y(u,f),y(f,d),_=!0,v||(I=[R(i,"input",a[8]),R(i,"mousedown",Ne(a[6])),R(f,"click",a[3])],v=!0)},p(h,m){const O={};!n&&m&1&&(n=!0,O.toggle=h[0],de(()=>n=!1)),e.$set(O),m&4&&i.value!==h[2]&&be(i,h[2])},i(h){_||(G(e.$$.fragment,h),_=!0)},o(h){q(e.$$.fragment,h),_=!1},d(h){le(e,h),h&&p(t),h&&p(r),h&&p(c),h&&p(u),v=!1,Ee(I)}}}function It(a){let e,n;return e=new Ge({props:{pos:a[1],$$slots:{default:[St]},$$scope:{ctx:a}}}),{c(){oe(e.$$.fragment)},l(t){ie(e.$$.fragment,t)},m(t,r){re(e,t,r),n=!0},p(t,[r]){const o={};r&2&&(o.pos=t[1]),r&2053&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){n||(G(e.$$.fragment,t),n=!0)},o(t){q(e.$$.fragment,t),n=!1},d(t){le(e,t)}}}function Tt(a,e,n){let t,r;se(a,Y,v=>n(9,r=v));let{key:o}=e,{pos:s}=e,{showNewOutput:l}=e,i=r[o];const c=i.options===void 0&&i.opciones!==void 0?"opciones":"options";function u(){i[c]===void 0&&n(5,i[c]=[],i),i[c].push({btn:t}),n(0,l=!1),ue(Y,r[o][c]=i[c],r)}function f(v){ke.call(this,a,v)}function d(v){l=v,n(0,l)}function _(){t=this.value,n(2,t)}return a.$$set=v=>{"key"in v&&n(4,o=v.key),"pos"in v&&n(1,s=v.pos),"showNewOutput"in v&&n(0,l=v.showNewOutput)},a.$$.update=()=>{a.$$.dirty&48&&ue(Y,r[o]=i,r)},n(2,t=""),[l,s,t,u,o,i,f,d,_]}class Ct extends pe{constructor(e){super(),me(this,e,Tt,It,he,{key:4,pos:1,showNewOutput:0})}}function Ot(a){let e,n,t,r;const o=a[5].default,s=De(o,a,a[4],null);return{c(){e=k("div"),s&&s.c(),this.h()},l(l){e=N(l,"DIV",{class:!0});var i=E(e);s&&s.l(i),i.forEach(p),this.h()},h(){b(e,"class","scene-node-container svelte-14kdql5")},m(l,i){T(l,e,i),s&&s.m(e,null),n=!0,t||(r=we(a[0].call(null,e)),t=!0)},p(l,[i]){s&&s.p&&(!n||i&16)&&Ae(s,o,l,l[4],n?Re(o,l[4],i,null):Be(l[4]),null)},i(l){n||(G(s,l),n=!0)},o(l){q(s,l),n=!1},d(l){l&&p(e),s&&s.d(l),t=!1,r()}}}function Mt(a,e,n){let t;se(a,Y,u=>n(3,t=u));let{$$slots:r={},$$scope:o}=e,{key:s}=e,{movingNode:l=!1}=e,i=t[s];i.display===void 0&&(i.display={x:0,y:0,ops:[]});function c(u){let f=!1;u.style.left=`${i.display.x}px`,u.style.top=`${i.display.y}px`,u.addEventListener("mousedown",()=>{f=!0,n(1,l=!0)}),window.addEventListener("mousemove",d=>{f&&(i.display.x+=d.movementX,i.display.y+=d.movementY,u.style.left=`${i.display.x}px`,u.style.top=`${i.display.y}px`,ue(Y,t[s]=i,t))}),window.addEventListener("mouseup",()=>{f=!1,n(1,l=!1)})}return a.$$set=u=>{"key"in u&&n(2,s=u.key),"movingNode"in u&&n(1,l=u.movingNode),"$$scope"in u&&n(4,o=u.$$scope)},a.$$.update=()=>{a.$$.dirty&12&&(i=t[s])},[c,l,s,t,o,r]}class Lt extends pe{constructor(e){super(),me(this,e,Mt,Ot,he,{key:2,movingNode:1})}}function Ye(a,e,n){const t=a.slice();return t[32]=e[n],t[34]=n,t}function Ze(a){let e,n,t,r,o;return{c(){e=k("div"),n=k("img"),this.h()},l(s){e=N(s,"DIV",{class:!0});var l=E(e);n=N(l,"IMG",{src:!0,alt:!0,class:!0}),l.forEach(p),this.h()},h(){Ue(n.src,t=a[2][a[7]])||b(n,"src",t),b(n,"alt","Preview"),b(n,"class","img-preview svelte-1tde7cb"),b(e,"class","img-preview-container svelte-1tde7cb")},m(s,l){T(s,e,l),y(e,n),r||(o=we(a[12].call(null,n)),r=!0)},p(s,l){l[0]&4&&!Ue(n.src,t=s[2][s[7]])&&b(n,"src",t)},d(s){s&&p(e),r=!1,o()}}}function Qe(a){let e,n,t,r,o,s,l,i;return{c(){e=k("div"),n=k("input"),r=U(),o=k("div"),s=U(),this.h()},l(c){e=N(c,"DIV",{class:!0});var u=E(e);n=N(u,"INPUT",{type:!0,class:!0,i:!0}),r=j(u),o=N(u,"DIV",{class:!0,i:!0}),E(o).forEach(p),s=j(u),u.forEach(p),this.h()},h(){b(n,"type","text"),b(n,"class","output-text svelte-1tde7cb"),n.value=t=a[32].btn,b(n,"i",a[34]),b(o,"class","connection output svelte-1tde7cb"),b(o,"i",a[34]),b(e,"class","output-container svelte-1tde7cb")},m(c,u){T(c,e,u),y(e,n),y(e,r),y(e,o),y(e,s),l||(i=[we(a[10].call(null,n)),R(n,"change",a[9]),R(n,"mousedown",Ne(a[21])),we(a[11].call(null,o)),we(a[13].call(null,o)),R(o,"mousedown",Ne(a[20]))],l=!0)},p(c,u){u[0]&4&&t!==(t=c[32].btn)&&n.value!==t&&(n.value=t)},d(c){c&&p(e),l=!1,Ee(i)}}}function Ut(a){let e,n,t,r,o,s,l,i,c=a[2][a[8]].slice(0,30)+"...",u,f,d,_,v,I,P,V,h,m,O,M,L,z,K,W,$,ce,A=a[2][a[7]]!==void 0&&a[2][a[7]]!==null&&Ze(a),ee=a[2][a[6]]||[],x=[];for(let w=0;w<ee.length;w+=1)x[w]=Qe(Ye(a,ee,w));return{c(){e=k("div"),n=U(),t=k("h1"),r=H("Escena: "),o=H(a[1]),s=U(),A&&A.c(),l=U(),i=k("p"),u=H(c),f=U(),d=k("div"),_=k("button"),v=H("editar"),I=U(),P=k("button"),V=H("x"),h=U(),m=k("button"),O=H("-"),M=U(),L=k("button"),z=H("+"),K=U(),W=k("div");for(let w=0;w<x.length;w+=1)x[w].c();this.h()},l(w){e=N(w,"DIV",{class:!0}),E(e).forEach(p),n=j(w),t=N(w,"H1",{class:!0});var B=E(t);r=J(B,"Escena: "),o=J(B,a[1]),B.forEach(p),s=j(w),A&&A.l(w),l=j(w),i=N(w,"P",{class:!0});var F=E(i);u=J(F,c),F.forEach(p),f=j(w),d=N(w,"DIV",{class:!0});var X=E(d);_=N(X,"BUTTON",{class:!0});var g=E(_);v=J(g,"editar"),g.forEach(p),I=j(X),P=N(X,"BUTTON",{class:!0});var S=E(P);V=J(S,"x"),S.forEach(p),h=j(X),m=N(X,"BUTTON",{class:!0});var D=E(m);O=J(D,"-"),D.forEach(p),M=j(X),L=N(X,"BUTTON",{class:!0});var Z=E(L);z=J(Z,"+"),Z.forEach(p),X.forEach(p),K=j(w),W=N(w,"DIV",{class:!0});var te=E(W);for(let ae=0;ae<x.length;ae+=1)x[ae].l(te);te.forEach(p),this.h()},h(){b(e,"class","connection input svelte-1tde7cb"),b(t,"class","svelte-1tde7cb"),b(i,"class","text-p svelte-1tde7cb"),b(_,"class","svelte-1tde7cb"),b(P,"class","svelte-1tde7cb"),b(m,"class","svelte-1tde7cb"),b(L,"class","svelte-1tde7cb"),b(d,"class","node-btns svelte-1tde7cb"),b(W,"class","node-outputs svelte-1tde7cb")},m(w,B){T(w,e,B),T(w,n,B),T(w,t,B),y(t,r),y(t,o),T(w,s,B),A&&A.m(w,B),T(w,l,B),T(w,i,B),y(i,u),T(w,f,B),T(w,d,B),y(d,_),y(_,v),y(d,I),y(d,P),y(P,V),y(d,h),y(d,m),y(m,O),y(d,M),y(d,L),y(L,z),T(w,K,B),T(w,W,B);for(let F=0;F<x.length;F+=1)x[F].m(W,null);a[23](W),$||(ce=[R(e,"mousedown",Ne(a[22])),R(e,"click",a[14]),R(_,"click",a[17]),R(P,"click",a[16]),R(m,"click",a[15]),R(L,"click",a[18])],$=!0)},p(w,B){if(B[0]&2&&je(o,w[1]),w[2][w[7]]!==void 0&&w[2][w[7]]!==null?A?A.p(w,B):(A=Ze(w),A.c(),A.m(l.parentNode,l)):A&&(A.d(1),A=null),B[0]&4&&c!==(c=w[2][w[8]].slice(0,30)+"...")&&je(u,c),B[0]&580){ee=w[2][w[6]]||[];let F;for(F=0;F<ee.length;F+=1){const X=Ye(w,ee,F);x[F]?x[F].p(X,B):(x[F]=Qe(X),x[F].c(),x[F].m(W,null))}for(;F<x.length;F+=1)x[F].d(1);x.length=ee.length}},d(w){w&&p(e),w&&p(n),w&&p(t),w&&p(s),A&&A.d(w),w&&p(l),w&&p(i),w&&p(f),w&&p(d),w&&p(K),w&&p(W),at(x,w),a[23](null),$=!1,Ee(ce)}}}function $e(a){let e,n,t;function r(s){a[25](s)}let o={key:a[1],pos:a[2].display};return a[4]!==void 0&&(o.showEditor=a[4]),e=new Et({props:o}),ne.push(()=>fe(e,"showEditor",r)),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,l){re(e,s,l),t=!0},p(s,l){const i={};l[0]&2&&(i.key=s[1]),l[0]&4&&(i.pos=s[2].display),!n&&l[0]&16&&(n=!0,i.showEditor=s[4],de(()=>n=!1)),e.$set(i)},i(s){t||(G(e.$$.fragment,s),t=!0)},o(s){q(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function et(a){let e,n,t;function r(s){a[26](s)}let o={key:a[1],pos:a[2].display};return a[5]!==void 0&&(o.showNewOutput=a[5]),e=new Ct({props:o}),ne.push(()=>fe(e,"showNewOutput",r)),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,l){re(e,s,l),t=!0},p(s,l){const i={};l[0]&2&&(i.key=s[1]),l[0]&4&&(i.pos=s[2].display),!n&&l[0]&32&&(n=!0,i.showNewOutput=s[5],de(()=>n=!1)),e.$set(i)},i(s){t||(G(e.$$.fragment,s),t=!0)},o(s){q(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function jt(a){let e,n,t,r,o,s;function l(f){a[24](f)}let i={key:a[1],$$slots:{default:[Ut]},$$scope:{ctx:a}};a[0]!==void 0&&(i.movingNode=a[0]),e=new Lt({props:i}),ne.push(()=>fe(e,"movingNode",l));let c=a[4]&&$e(a),u=a[5]&&et(a);return{c(){oe(e.$$.fragment),t=U(),c&&c.c(),r=U(),u&&u.c(),o=Se()},l(f){ie(e.$$.fragment,f),t=j(f),c&&c.l(f),r=j(f),u&&u.l(f),o=Se()},m(f,d){re(e,f,d),T(f,t,d),c&&c.m(f,d),T(f,r,d),u&&u.m(f,d),T(f,o,d),s=!0},p(f,d){const _={};d[0]&2&&(_.key=f[1]),d[0]&14|d[1]&16&&(_.$$scope={dirty:d,ctx:f}),!n&&d[0]&1&&(n=!0,_.movingNode=f[0],de(()=>n=!1)),e.$set(_),f[4]?c?(c.p(f,d),d[0]&16&&G(c,1)):(c=$e(f),c.c(),G(c,1),c.m(r.parentNode,r)):c&&(Te(),q(c,1,1,()=>{c=null}),Ce()),f[5]?u?(u.p(f,d),d[0]&32&&G(u,1)):(u=et(f),u.c(),G(u,1),u.m(o.parentNode,o)):u&&(Te(),q(u,1,1,()=>{u=null}),Ce())},i(f){s||(G(e.$$.fragment,f),G(c),G(u),s=!0)},o(f){q(e.$$.fragment,f),q(c),q(u),s=!1},d(f){le(e,f),f&&p(t),c&&c.d(f),f&&p(r),u&&u.d(f),f&&p(o)}}}function Dt(a,e,n){let t,r,o,s,l;se(a,Y,g=>n(19,t=g)),se(a,ut,g=>n(27,r=g)),se(a,ct,g=>n(28,o=g)),se(a,dt,g=>n(29,s=g)),se(a,pt,g=>n(30,l=g));let{key:i}=e,{movingNode:c=!1}=e,u=t[i];const f=o(u),d=l(u),_=s(u);let v,I=!1,P=!1;u.display===void 0&&(u.display={x:0,y:0,ops:[]});function V(){h(this)}function h(g){const S=+g.getAttribute("i");g.style.width=g.value.length*6.1+"px",n(2,u[f][S].btn=g.value,u),O()}function m(g){const S=+g.getAttribute("i");u.display.ops[S]===void 0?n(2,u.display.ops[S]={x:g.offsetLeft,y:g.offsetTop,rewiring:!1},u):Object.assign(u.display.ops[S],{x:g.offsetLeft,y:g.offsetTop}),ue(Y,t[i]=u,t)}function O(){if(v===void 0)return;const g=v.getElementsByClassName("output");for(let S of g)m(S)}function M(){const g=Object.keys(t);for(let S of g){const D=t[S],Z=o(D);for(let te=0;te<D.display.ops.length;te++){const ae=r(D[Z][te]);D.display.ops[te].rewiring&&(D.display.ops[te].rewiring=!1,D[Z][te][ae]=D.display.ops[te].prevWiring)}ue(Y,t[S]=D,t)}}function L(g){const S=+g.getAttribute("i");g.addEventListener("click",()=>{M();const D=r(u[f][S]);u.display.ops[S].rewiring||(n(2,u.display.ops[S].prevWiring=u[f][S][D],u),n(2,u.display.ops[S].rewiring=!0,u),n(2,u[f][S][D]=void 0,u))})}function z(){const g=Object.keys(t);let S;for(let te of g){const ae=t[te];let C=0;for(let Q of ae.display.ops)Q.rewiring&&(Q.rewiring=!1,S={scene:ae,i:C}),C++}if(S===void 0)return;const D=o(S.scene),Z=r(S.scene[D][S.i]);S.scene[D][S.i][Z]=i}function K(){u[f]!==void 0&&(u[f].pop(),u.display.ops.pop(),ue(Y,t[i][f]=u[f],t))}function W(){for(let g of Object.keys(t)){const S=o(t[g]);if(t[g][S]!==void 0)for(let D of t[g][S]){const Z=r(D);D[Z]===i&&(D[Z]=void 0)}}delete t[i],Y.set(t)}function $(){n(4,I=!0)}function ce(){n(5,P=!0)}function A(g){ke.call(this,a,g)}function ee(g){ke.call(this,a,g)}function x(g){ke.call(this,a,g)}function w(g){ne[g?"unshift":"push"](()=>{v=g,n(3,v)})}function B(g){c=g,n(0,c)}function F(g){I=g,n(4,I)}function X(g){P=g,n(5,P)}return a.$$set=g=>{"key"in g&&n(1,i=g.key),"movingNode"in g&&n(0,c=g.movingNode)},a.$$.update=()=>{a.$$.dirty[0]&524290&&n(2,u=t[i]),a.$$.dirty[0]&4&&O(u[d])},[c,i,u,v,I,P,f,d,_,V,h,m,O,L,z,K,W,$,ce,t,A,ee,x,w,B,F,X]}class At extends pe{constructor(e){super(),me(this,e,Dt,jt,he,{key:1,movingNode:0},null,[-1,-1])}}function tt(a,e,n){const t=a.slice();return t[5]=e[n],t[7]=n,t}function nt(a){let e,n,t,r,o;return{c(){e=Pe("line"),this.h()},l(s){e=Ve(s,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0}),E(e).forEach(p),this.h()},h(){b(e,"class","node-connection svelte-nz6q29"),b(e,"x1",n=a[0].display.x+a[5].x+5),b(e,"y1",t=a[0].display.y+a[5].y+10),b(e,"x2",r=a[1][a[7]].x+5),b(e,"y2",o=a[1][a[7]].y+5)},m(s,l){T(s,e,l)},p(s,l){l&1&&n!==(n=s[0].display.x+s[5].x+5)&&b(e,"x1",n),l&1&&t!==(t=s[0].display.y+s[5].y+10)&&b(e,"y1",t),l&2&&r!==(r=s[1][s[7]].x+5)&&b(e,"x2",r),l&2&&o!==(o=s[1][s[7]].y+5)&&b(e,"y2",o)},d(s){s&&p(e)}}}function Bt(a){let e,n=a[0].display.ops||[],t=[];for(let r=0;r<n.length;r+=1)t[r]=nt(tt(a,n,r));return{c(){e=Pe("g");for(let r=0;r<t.length;r+=1)t[r].c()},l(r){e=Ve(r,"g",{});var o=E(e);for(let s=0;s<t.length;s+=1)t[s].l(o);o.forEach(p)},m(r,o){T(r,e,o);for(let s=0;s<t.length;s+=1)t[s].m(e,null)},p(r,[o]){if(o&3){n=r[0].display.ops||[];let s;for(s=0;s<n.length;s+=1){const l=tt(r,n,s);t[s]?t[s].p(l,o):(t[s]=nt(l),t[s].c(),t[s].m(e,null))}for(;s<t.length;s+=1)t[s].d(1);t.length=n.length}},i:ve,o:ve,d(r){r&&p(e),at(t,r)}}}function Rt(a,e,n){let t,r;se(a,Y,i=>n(4,r=i));let{key:o}=e,{mouse:s}=e,l=r[o];return a.$$set=i=>{"key"in i&&n(2,o=i.key),"mouse"in i&&n(3,s=i.mouse)},a.$$.update=()=>{a.$$.dirty&20&&n(0,l=r[o]),a.$$.dirty&25&&n(1,t=(l.options||l.opciones||[]).map((i,c)=>{const u=i.escena||i.scene;return u===void 0?l.display.ops[c].rewiring?s:l.display:r[u].display}))},[l,t,o,s,r]}class Pt extends pe{constructor(e){super(),me(this,e,Rt,Bt,he,{key:2,mouse:3})}}function Vt(a){let e,n,t,r,o,s,l,i,c,u,f,d,_,v,I;function P(h){a[7](h)}let V={};return a[0]!==void 0&&(V.toggle=a[0]),e=new Ke({props:V}),ne.push(()=>fe(e,"toggle",P)),{c(){oe(e.$$.fragment),t=U(),r=k("div"),o=k("label"),s=H("Escena:"),l=U(),i=k("input"),c=U(),u=k("div"),f=k("button"),d=H("Aceptar"),this.h()},l(h){ie(e.$$.fragment,h),t=j(h),r=N(h,"DIV",{});var m=E(r);o=N(m,"LABEL",{for:!0});var O=E(o);s=J(O,"Escena:"),O.forEach(p),l=j(m),i=N(m,"INPUT",{id:!0,type:!0}),m.forEach(p),c=j(h),u=N(h,"DIV",{class:!0});var M=E(u);f=N(M,"BUTTON",{});var L=E(f);d=J(L,"Aceptar"),L.forEach(p),M.forEach(p),this.h()},h(){b(o,"for","inp"),b(i,"id","inp"),b(i,"type","text"),b(u,"class","bar svelte-1bhrmvp")},m(h,m){re(e,h,m),T(h,t,m),T(h,r,m),y(r,o),y(o,s),y(r,l),y(r,i),be(i,a[2]),T(h,c,m),T(h,u,m),y(u,f),y(f,d),_=!0,v||(I=[R(i,"input",a[8]),R(i,"mousedown",Ne(a[6])),R(f,"click",a[4])],v=!0)},p(h,m){const O={};!n&&m&1&&(n=!0,O.toggle=h[0],de(()=>n=!1)),e.$set(O),m&4&&i.value!==h[2]&&be(i,h[2])},i(h){_||(G(e.$$.fragment,h),_=!0)},o(h){q(e.$$.fragment,h),_=!1},d(h){le(e,h),h&&p(t),h&&p(r),h&&p(c),h&&p(u),v=!1,Ee(I)}}}function Gt(a){let e,n,t;function r(s){a[9](s)}let o={pos:a[3],$$slots:{default:[Vt]},$$scope:{ctx:a}};return a[1]!==void 0&&(o.displace=a[1]),e=new Ge({props:o}),ne.push(()=>fe(e,"displace",r)),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,l){re(e,s,l),t=!0},p(s,[l]){const i={};l&4101&&(i.$$scope={dirty:l,ctx:s}),!n&&l&2&&(n=!0,i.displace=s[1],de(()=>n=!1)),e.$set(i)},i(s){t||(G(e.$$.fragment,s),t=!0)},o(s){q(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function Kt(a){const e=["\xE1","\xE9","\xED","\xF3","\xFA","\xFC","\xF1"],n=["a","e","i","o","u","u","n"],t=a.toLowerCase();let r="";for(let o=0;o<a.length;o++){const s=t.charAt(o),l=a.charAt(o);if(e.includes(s)){let i;for(let c=0;c<e.length;c++)if(e[c]===s){i=c;break}l===l.toUpperCase()?r+=n[i].toUpperCase():r+=n[i]}else r+=l}return r}function zt(a,e,n){let t,r;se(a,Y,I=>n(11,r=I));let{showNewScene:o}=e,{offset:s}=e,l=r,i={x:s.x*-1+20,y:s.y*-1+20},c;function u(){if(/^\d/.test(t)===!0){alert(`El nombre de la escena no puede empezar con un n\xFAmero /
The name of the scene cannot start with a number`);return}let I=t.replace(/\s/gi,"_").replace(/\W/,"").replace(/[;.,:{}()<>$%&!¡?¿"'/\\#@&*+-=~^]/gi,"");I=Kt(I),l[I]={text:"",display:{x:i.x,y:i.y,ops:[]}},ue(Y,r[I]=l[I],r),n(0,o=!1)}function f(I){ke.call(this,a,I)}function d(I){o=I,n(0,o)}function _(){t=this.value,n(2,t)}function v(I){c=I,n(1,c)}return a.$$set=I=>{"showNewScene"in I&&n(0,o=I.showNewScene),"offset"in I&&n(5,s=I.offset)},n(2,t=""),[o,c,t,i,u,s,f,d,_,v]}class Ft extends pe{constructor(e){super(),me(this,e,zt,Gt,he,{showNewScene:0,offset:5})}}function st(a){let e,n,t;function r(s){a[10](s)}let o={offset:a[1]};return a[0]!==void 0&&(o.showNewScene=a[0]),e=new Ft({props:o}),ne.push(()=>fe(e,"showNewScene",r)),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,l){re(e,s,l),t=!0},p(s,l){const i={};l&2&&(i.offset=s[1]),!n&&l&1&&(n=!0,i.showNewScene=s[0],de(()=>n=!1)),e.$set(i)},i(s){t||(G(e.$$.fragment,s),t=!0)},o(s){q(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function Wt(a){let e,n,t,r,o;const s=a[9].default,l=De(s,a,a[8],null);let i=a[0]&&st(a);return{c(){e=k("div"),l&&l.c(),n=U(),i&&i.c(),this.h()},l(c){e=N(c,"DIV",{class:!0});var u=E(e);l&&l.l(u),n=j(u),i&&i.l(u),u.forEach(p),this.h()},h(){b(e,"class","node-page svelte-147bzl")},m(c,u){T(c,e,u),l&&l.m(e,null),y(e,n),i&&i.m(e,null),t=!0,r||(o=[we(a[2].call(null,e)),R(e,"mousedown",a[3]),R(e,"mouseup",a[4]),R(e,"mousemove",a[5])],r=!0)},p(c,[u]){l&&l.p&&(!t||u&256)&&Ae(l,s,c,c[8],t?Re(s,c[8],u,null):Be(c[8]),null),c[0]?i?(i.p(c,u),u&1&&G(i,1)):(i=st(c),i.c(),G(i,1),i.m(e,null)):i&&(Te(),q(i,1,1,()=>{i=null}),Ce())},i(c){t||(G(l,c),G(i),t=!0)},o(c){q(l,c),q(i),t=!1},d(c){c&&p(e),l&&l.d(c),i&&i.d(),r=!1,Ee(o)}}}function xt(a,e,n){let t,r,o;se(a,Y,m=>n(12,t=m)),se(a,ut,m=>n(13,r=m)),se(a,ct,m=>n(14,o=m));let{$$slots:s={},$$scope:l}=e,{movingNode:i}=e,{mouse:c}=e,{showNewScene:u}=e,f=!1;const d={x:0,y:0};function _(m){m.style.left=`${d.x}px`,m.style.top=`${d.y}px`}function v(){const m=Object.keys(t);for(let O of m){const M=t[O],L=o(M);for(let z=0;z<M.display.ops.length;z++){const K=r(M[L][z]);M.display.ops[z].rewiring&&(M.display.ops[z].rewiring=!1,M[L][z][K]=M.display.ops[z].prevWiring)}ue(Y,t[O]=M,t)}}function I(){f=!0,this.style.cursor="grabbing",v()}function P(){f=!1,this.style.cursor="grab"}function V(m){if(f&&!i){const M=+getComputedStyle(this.offsetParent).width.replace("px",""),L=+getComputedStyle(this).width.replace("px",""),z=+getComputedStyle(this.offsetParent).height.replace("px",""),K=+getComputedStyle(this).height.replace("px","");n(1,d.x+=m.movementX,d),n(1,d.y+=m.movementY,d),n(1,d.x=d.x>0?0:M-d.x>L?M-L:d.x,d),n(1,d.y=d.y>0?0:z-d.y>K?z-K:d.y,d),this.style.left=`${d.x}px`,this.style.top=`${d.y}px`}n(6,c={x:m.offsetX,y:m.offsetY});let O=m.target;for(;O!==this;)n(6,c.x+=O.offsetLeft,c),n(6,c.y+=O.offsetTop,c),O=O.offsetParent}function h(m){u=m,n(0,u)}return a.$$set=m=>{"movingNode"in m&&n(7,i=m.movingNode),"mouse"in m&&n(6,c=m.mouse),"showNewScene"in m&&n(0,u=m.showNewScene),"$$scope"in m&&n(8,l=m.$$scope)},[u,d,_,I,P,V,c,i,l,s,h]}class Ht extends pe{constructor(e){super(),me(this,e,xt,Wt,he,{movingNode:7,mouse:6,showNewScene:0})}}class Jt{constructor(e="en",n){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,igramaFormat:"png",minigifOptions:{},sceneCallback:t=>t},n&&(this.options=Object.assign(this.options,n)),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[n,t]of Object.entries(e.grammar));return this}setScenes(e){this.scenes=e;for(let n of Object.keys(e)){this.scenes[n].key=n;const t=this.scenes[n].image||this.scenes[n].imagen;t!==void 0&&this.storyPreload[t]===void 0&&(this.storyPreload[t]=new Image,this.storyPreload[t].src=t,this.storyPreload[t].className="storyimage")}return this}setMarkov(e){return this.markov=e,this}expandGrammar(e){const n=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(n)}expandIgrama(e){const n=this.igrama.grammar,t=this.selectGrammarRule(n[e]);return this.grammarRuleRecursion(t,n).split("|").map(o=>this.decodeDrawing(o))}grammarRuleRecursion(e,n){let t=n||this.grammar,r=this.setNewRules(e);const o=r.match(/<[\w\d.,/#]+>/gi);if(!o)return r;for(let s of o){const l=this.defineTransformations(s);r=r.replace(s,()=>{s=s.replace(/[<>]/gi,""),s=s.replace(/#[\w\d.,/]+#/g,"");const i=s.search(/[.]/)>-1?this.getNestedObject(t,s.match(/[\w\d]+/g)):t[s];if(!i){const u=this.lang==="es"?`Se intent\xF3 expandir desde la regla "${s}", pero no se pudo encontrar`:`Tried to expand from rule "${s}", but couldn't find it`;console.error(u)}const c=this.selectGrammarRule(i);return this.transformString(c,l)})}return this.grammarRuleRecursion(r,t)}setNewRules(e,n){let t;n===void 0?t=this.grammar:t=n;let r=e;const o=r.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(o)for(;o.length;){const s=o.pop();r=r.replace(s,"");const{symbol:l,pairsString:i}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(s).groups,c=i.match(/[-]?[\w\d]+:[\w\d]+/gi).map(u=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(u).groups);if(c){t[l]=t[l]||{};for(let u of c){const f=t[u.value];if(!f){const v=this.lang==="es"?`Se intent\xF3 crear la nueva regla "${l}", pero no se pudo encontrar "${u.value}" para producir la subregla "${u.key}"`:`Tried to create new rule: "${l}", but couldn't find "${u.value}" to produce "${u.key}" subrule`;console.error(v)}const d=u.remove==="-",_=this.selectGrammarRule(f);if(d){const v=f.indexOf(_);t[u.value]=[...f.slice(0,v),...f.slice(v+1)]}t[l][u.key]=[_]}}}return r}startAdventure(e){this.options.defaultCSS&&this.setCSS();const n=document.createElement("div");return n.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(n),this.goToScene(this.scenes[e]),this}goToScene(e){const n=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(i=>i.remove()),[...document.getElementsByClassName("storyimage-area")].map(l=>l.remove());const r=document.createElement("div");if(r.className="storydiv",n.appendChild(r),e.image||e.imagen){const l=document.createElement("div");l.className="storyimage-container",r.appendChild(l);const i=e.image||e.imagen,c=this.options.adventureScroll?this.storyPreload[i].cloneNode():this.storyPreload[i];l.appendChild(c),e.areas&&(c.complete?this.setAreas(c,l,e.areas):c.onload=()=>{this.setAreas(c,l,e.areas)})}else if(e.igrama!==void 0){const l=document.createElement("div");l.className="storyimage-container",r.appendChild(l);const i=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(i),this.igramaDataUrl(i,this.options.igramaFormat).then(c=>{const u=new Image;u.src=c,u.className="storyimage",l.appendChild(u)})}const o=document.createElement("div");o.className="storyp-container",(e.text||e.texto||e.igramaText)&&r.appendChild(o);const s=document.createElement("p");s.className="storyp",s.innerHTML="",o.appendChild(s),document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(s,e),this.options.sceneCallback(e)}setAreas(e,n,t){const r=e.getBoundingClientRect(),o=n.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,n,t)},[...document.getElementsByClassName("storyimage-area")].map(l=>l.remove());for(let l of t){let i=document.createElement("div");i.className="storyimage-area";const c=(l.x-Math.floor(l.w/2))*r.width/e.naturalWidth;i.style.left=`${r.left-o.left+c}px`;const u=(l.y-Math.floor(l.h/2))*r.height/e.naturalHeight;i.style.top=`${r.top-o.top+u}px`,i.style.width=`${l.w*r.width/e.naturalWidth}px`,i.style.height=`${l.h*r.height/e.naturalHeight}px`,i.innerHTML=l.btn||"",n.appendChild(i),i.style.fontSize=`${18*r.height/e.naturalHeight}px`,i.onclick=()=>{const f=l.scene||l.escena;this.goToScene(this.scenes[f])},l.tooltip!==void 0&&(i.onmouseover=()=>{i.innerHTML=l.tooltip||"",i.style.zIndex="100"},i.onmouseout=()=>{i.innerHTML=l.btn||"",i.style.zIndex="0"})}}typewriter(e,n){const t=n.text||n.texto||n.igramaText||"";let r=this.grammar?this.grammarRuleRecursion(t):t;if(r=r.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let o=0;const s=setInterval(()=>{const l=r.substring(0,o);e.innerHTML=l,o++,o>r.length&&(clearInterval(s),this.optionButtons(n))},Math.floor(this.options.typewriterSpeed))}else e.innerHTML=r,this.optionButtons(n)}optionButtons(e){const n=[...document.getElementsByClassName("storydiv")],t=n[n.length-1];[...document.getElementsByClassName("storybutton-container")].map(s=>s.remove());const o=document.createElement("div");if(o.className="storybutton-container",t.appendChild(o),e.options||e.opciones){const s=e.options||e.opciones;for(let l of s){const i=document.createElement("button");i.className="storybutton",i.innerHTML=l.btn,o.appendChild(i),i.addEventListener("click",()=>{if((l.text||l.texto)===void 0){const u=l.scene||l.escena;this.goToScene(this.scenes[u])}else this.goToScene(l)})}}else if(e.scene||e.escena){const s=e.scene||e.escena,l=document.createElement("button");l.className="storybutton",l.innerHTML=this.lang==="en"?"Continue":"Continuar",o.appendChild(l),l.addEventListener("click",()=>{this.goToScene(this.scenes[s])})}document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const r=Math.random()*e.prob.reduce((s,l)=>s+l);let o=0;for(let s=0;s<e.prob.length;s++){if(o<=r&&r<o+e.prob[s])return e[s];o+=e.prob[s]}}const n=Math.floor(Math.random()*e.length);return e[n]}getNestedObject(e,n){return n.reduce((t,r)=>t&&t[r]!==void 0?t[r]:void 0,e)}defineTransformations(e){let n={};const t=/#(?<trans>[\w\d,]+)#/gi.exec(e),r=t?t.groups.trans.match(/[\w]+/gi):[];for(let o of r)n[o]=!0;return n}transformString(e,n){let t=e;return n.CAPITALIZE&&(t=t.charAt(0).toUpperCase()+t.slice(1)),n.ALLCAPS&&(t=t.toUpperCase()),t}decodeDrawing(e){if(e==="")return[];const[n,t,r]=e.split("%%");let o={};return n==="vector"?o.content=t.split("**").map(s=>{const[l,i,c]=s.split("&"),u=[];if(u.color=l,u.weight=i,c===void 0)return u;const f=c.split(",");for(let d=0;d<f.length;d+=2)u.push([+f[d],+f[d+1]]);return u}):o.content=t,o.attribute=r,o.type=n,o}async getMarkovModel(e,n=1,t=!1){let r=await(await fetch(`./${e}`)).text();r=r.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const o=r.split(this.markovSeparator),s={};for(let i=0;i<o.length-n;i++){let c="";for(let f=0;f<n;f++)c+=f===0?o[i+f]:" "+o[i+f];s[c]===void 0&&(s[c]={});const u=o[i+n];s[c][u]===void 0?s[c][u]=1:s[c][u]++}const l={};for(let i of Object.keys(s)){const c=Object.keys(s[i]);l[i]={probs:[],grams:c};let u=0;for(let f=0;f<c.length;f++)u+=s[i][c[f]];for(let f=0;f<c.length;f++)l[i].probs[f]=s[i][c[f]]/u}if(t){const i=e.split("/");this.saveJSON(l,`${i[i.length-1]}_markovModel_${n}N.json`)}return l}markovChain(e,n,t=.1){let r=n===void 0||this.markov[n]===void 0?this.randomMarkovWord():n,o=r;for(let l=0;l<e-1;l++){let i=this.getNextMarkov(this.markov[o]);i===void 0&&(i=this.getNextMarkov(this.randomMarkovWord()));let c=o.split(this.markovSeparator);c.push(i),c=c.slice(1).join(" "),o=c,r+=` ${i}`}return this.formatMarkov(r,t)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const n=Math.random();let t=0;if(e!==void 0)for(let r=0;r<e.probs.length;r++){if(t<=n&&n<t+e.probs[r])return e.grams[r];t+=e.probs[r]}}formatMarkov(e,n=.1){let t=e.replace(/ ([,:.;])/g,"$1");return t=t.replaceAll(/([.]) ([\wáéíóú])/ig,(r,o,s,l,i)=>Math.random()<n?`.
${s.toUpperCase()}`:`. ${s.toUpperCase()}`),t.charAt(0).toUpperCase()+t.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,n){const t=document.createElement("a");t.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),t.setAttribute("download",`${n.includes(".json")?n:n+".json"}`),document.body.appendChild(t),t.click(),document.body.removeChild(t)}testScenes(e){const n=e||this.scenes;if(!n){const r=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(r)}let t=[];for(let r of Object.keys(n)){const o=n[r];if(o.options||o.opciones){const l=(o.options||o.opciones).filter(i=>!n[i.scene||i.escena]);t=[...t,...l.map(i=>`${r} => ${i.btn} => ${i.scene||i.escena}`)]}else{if(o.deadEnd||o.sinSalida)continue;n[o.scene||o.escena]||t.push(`${r} => ${o.scene||o.escena}`)}}if(t.length>0){const r=this.lang==="es"?`Las siguientes escenas no llevan a ning\xFAn lado: ${t.join(", ")}`:`The following scenes are dead ends: ${t.join(", ")}`;console.error(r),this.scenesError=!0}return this}testGrammar(e){const n=e||this.grammar;if(!n){const t=this.lang==="es"?"No hay gram\xE1tica para probar":"There is not grammar to test";console.error(t)}for(let t of Object.keys(n)){const r=n[t];for(let o of r){const s=o.match(/<([\w\d]+)>/gi),l=s?s.map(f=>f.replace(/[<>]/g,"")):[],i=o.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),c=i?i.map(f=>f.match(/([ ]?:[\w\d]+)/g).map(d=>/[ ]?:(?<key>[\w\d]+)/.exec(d).groups.key)).reduce((f,d)=>[...f,...d],[]):[],u=[...l,...c].filter(f=>!n[f]);if(u.length>0){const f=this.lang==="es"?`Las siguientes reglas, que se referencian en "${t}", no existen: ${u.join(", ")}`:`The following rules, referenced in "${t}", do not exist: ${u.join(", ")}`;this.grammarError=!0,console.error(f)}}}return this}testDistribution(e){const n=e||this.markov;if(n===void 0){const c=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(c)}const t={},r={};let o=0;const s=Object.values(n);for(let c of s)for(let u of c.probs){const f=(Math.round(u/.05)*.05).toFixed(2);r[o]=f,o++,t[f]===void 0?t[f]=1:t[f]++}console.log("------------------------------------ DIST ------------------------------------");const l=Math.max(...Object.values(t)),i=Object.entries(t).sort((c,u)=>c[0]>u[0]?1:c[0]<u[0]?-1:0);for(let c of i)console.log(`${c[0]}... ${"|".repeat(Math.ceil(c[1]*100/l))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,n="png",t){const r=await this.igramaDataUrl(e,n),o=new Image;o.src=r,t==null?document.body.appendChild(o):document.getElementById(t).appendChild(o)}async igramaDataUrl(e,n="png"){const t=this.igrama.metadata.width,r=this.igrama.metadata.height;let o=document.createElement("canvas");o.width=t,o.height=r;const s=o.getContext("2d");s.lineJoin="round",s.lineCap="round",s.fillStyle=this.igrama.metadata.bg||"#FFFFFF",s.fillRect(0,0,t,r),await this.drawLayers(e,s);let l;if(n==="png")l=o.toDataURL();else if(n==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener tambi\xE9n la librer\xEDa MiniGif":"To create Gifs you must have also the MiniGif library"),"";const i={colorResolution:7,dither:!1,delay:50};Object.assign(i,this.minigifOptions);const c=new MiniGif(i);c.addFrame(o);const u=this.getLayerWiggle(e);s.fillStyle=this.igrama.metadata.bg||"#FFFFFF",s.fillRect(0,0,t,r),await this.drawLayers(u,s),c.addFrame(o);const f=c.makeGif(),d=await this.base64_arraybuffer(f);l="data:image/gif;base64,"+d}return o.remove(),l}async base64_arraybuffer(e){return(await new Promise(t=>{const r=new FileReader;r.onload=()=>t(r.result),r.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const t=JSON.parse(JSON.stringify(e)),r=(o,s)=>Math.floor(o+Math.random()*(s-o));for(let[o,s]of t.entries())if(s.type==="vector")for(let[l,i]of s.content.entries()){for(let[c,u]of i.entries())Math.random()<.5?u[0]+=r(-3,3):u[1]+=r(-3,3);i.color=e[o].content[l].color,i.weight=e[o].content[l].weight}return t}getIgramaText(e){return e.map(t=>t.attribute).reverse().join(" ").trim()}async drawLayers(e,n){for(let[t,r]of e.entries())if(r.type==="url"){const{w:o,h:s,x:l,y:i}=this.igrama.sections[t];if(this.imgsMemo[r.content]===void 0){const c=new Image;c.src=r.content,this.imgsMemo[r.content]=await new Promise(u=>{c.addEventListener("load",()=>{u(c)},!1)})}n.drawImage(this.imgsMemo[r.content],l,i,o,s)}else if(r.type=="vector")for(let o of r.content){if(o.length===0)continue;const s=this.getSpline(o);this.drawSpline(s,n,o.color,o.weight)}}drawSpline(e,n,t,r){n.lineWidth=r,n.strokeStyle=t,n.fillStyle="rgba(0,0,0,0)",n.beginPath();for(let o=0;o<e.length;o++)o===0?n.moveTo(...e[0]):n.lineTo(...e[o]);n.stroke()}getSpline(e){let n=[];for(let t=0;t<e.length-1;t++){const r=[];r[0]=t>0?e[t-1]:e[0],r[1]=e[t],r[2]=e[t+1],r[3]=t<e.length-2?e[t+2]:e[e.length-1];for(let o=0;o<1;o+=.05){const s=this.getSplinePoint(o,r);n.push(s)}}return n}getSplinePoint(e,n){const t=Math.floor(e)+1,r=t+1,o=r+1,s=t-1,l=e*e,i=l*e,c=-i+2*l-e,u=3*i-5*l+2,f=-3*i+4*l+e,d=i-l,_=.5*(n[s][0]*c+n[t][0]*u+n[r][0]*f+n[o][0]*d),v=.5*(n[s][1]*c+n[t][1]*u+n[r][1]*f+n[o][1]*d);return[_,v]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=qt,document.getElementsByTagName("head")[0].appendChild(e)}}const qt=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 10px;
  flex-direction: column;
  box-sizing: border-box;
}

.storyp {
  font-size: 18px;
  min-height: 25px;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: white;
  border-radius: 4px;
  padding: 10px;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: black;
  color: white;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,Xt=Oe(Jt);function ot(a,e,n){const t=a.slice();return t[17]=e[n],t}function it(a,e,n){const t=a.slice();return t[17]=e[n],t}function rt(a,e){let n,t,r,o;function s(i){e[12](i)}let l={key:e[17]};return e[0]!==void 0&&(l.movingNode=e[0]),t=new At({props:l}),ne.push(()=>fe(t,"movingNode",s)),{key:a,first:null,c(){n=Se(),oe(t.$$.fragment),this.h()},l(i){n=Se(),ie(t.$$.fragment,i),this.h()},h(){this.first=n},m(i,c){T(i,n,c),re(t,i,c),o=!0},p(i,c){e=i;const u={};c&8&&(u.key=e[17]),!r&&c&1&&(r=!0,u.movingNode=e[0],de(()=>r=!1)),t.$set(u)},i(i){o||(G(t.$$.fragment,i),o=!0)},o(i){q(t.$$.fragment,i),o=!1},d(i){i&&p(n),le(t,i)}}}function lt(a,e){let n,t,r;return t=new Pt({props:{key:e[17],mouse:e[4]}}),{key:a,first:null,c(){n=Se(),oe(t.$$.fragment),this.h()},l(o){n=Se(),ie(t.$$.fragment,o),this.h()},h(){this.first=n},m(o,s){T(o,n,s),re(t,o,s),r=!0},p(o,s){e=o;const l={};s&8&&(l.key=e[17]),s&16&&(l.mouse=e[4]),t.$set(l)},i(o){r||(G(t.$$.fragment,o),r=!0)},o(o){q(t.$$.fragment,o),r=!1},d(o){o&&p(n),le(t,o)}}}function Yt(a){let e=[],n=new Map,t,r,o=[],s=new Map,l,i=a[3];const c=d=>d[17];for(let d=0;d<i.length;d+=1){let _=it(a,i,d),v=c(_);n.set(v,e[d]=rt(v,_))}let u=a[3];const f=d=>d[17];for(let d=0;d<u.length;d+=1){let _=ot(a,u,d),v=f(_);s.set(v,o[d]=lt(v,_))}return{c(){for(let d=0;d<e.length;d+=1)e[d].c();t=U(),r=Pe("svg");for(let d=0;d<o.length;d+=1)o[d].c();this.h()},l(d){for(let v=0;v<e.length;v+=1)e[v].l(d);t=j(d),r=Ve(d,"svg",{class:!0});var _=E(r);for(let v=0;v<o.length;v+=1)o[v].l(_);_.forEach(p),this.h()},h(){b(r,"class","connections-container svelte-4kbf32")},m(d,_){for(let v=0;v<e.length;v+=1)e[v].m(d,_);T(d,t,_),T(d,r,_);for(let v=0;v<o.length;v+=1)o[v].m(r,null);l=!0},p(d,_){_&9&&(i=d[3],Te(),e=Je(e,_,c,1,d,i,n,t.parentNode,qe,rt,t,it),Ce()),_&24&&(u=d[3],Te(),o=Je(o,_,f,1,d,u,s,r,qe,lt,null,ot),Ce())},i(d){if(!l){for(let _=0;_<i.length;_+=1)G(e[_]);for(let _=0;_<u.length;_+=1)G(o[_]);l=!0}},o(d){for(let _=0;_<e.length;_+=1)q(e[_]);for(let _=0;_<o.length;_+=1)q(o[_]);l=!1},d(d){for(let _=0;_<e.length;_+=1)e[_].d(d);d&&p(t),d&&p(r);for(let _=0;_<o.length;_+=1)o[_].d()}}}function Zt(a){let e,n,t,r,o,s,l,i,c,u,f,d,_,v,I,P,V,h,m,O,M,L,z,K,W,$,ce,A,ee,x,w;function B(g){a[13](g)}function F(g){a[14](g)}let X={movingNode:a[0],$$slots:{default:[Yt,({offset:g})=>({16:g}),({offset:g})=>g?65536:0]},$$scope:{ctx:a}};return a[1]!==void 0&&(X.showNewScene=a[1]),a[4]!==void 0&&(X.mouse=a[4]),$=new Ht({props:X}),ne.push(()=>fe($,"showNewScene",B)),ne.push(()=>fe($,"mouse",F)),{c(){e=k("input"),n=U(),t=k("div"),r=U(),o=k("div"),s=k("div"),l=k("div"),i=k("button"),c=H("Nuevo proyecto"),u=U(),f=k("label"),d=H("Importar"),_=U(),v=k("button"),I=H("Exportar"),P=U(),V=k("button"),h=H("Previsualizar"),m=U(),O=k("div"),M=k("button"),L=H("Nueva escena"),z=U(),K=k("div"),W=k("div"),oe($.$$.fragment),this.h()},l(g){e=N(g,"INPUT",{type:!0,id:!0}),n=j(g),t=N(g,"DIV",{class:!0,id:!0}),E(t).forEach(p),r=j(g),o=N(g,"DIV",{class:!0});var S=E(o);s=N(S,"DIV",{class:!0});var D=E(s);l=N(D,"DIV",{class:!0});var Z=E(l);i=N(Z,"BUTTON",{class:!0});var te=E(i);c=J(te,"Nuevo proyecto"),te.forEach(p),u=j(Z),f=N(Z,"LABEL",{class:!0,for:!0});var ae=E(f);d=J(ae,"Importar"),ae.forEach(p),_=j(Z),v=N(Z,"BUTTON",{class:!0});var C=E(v);I=J(C,"Exportar"),C.forEach(p),P=j(Z),V=N(Z,"BUTTON",{class:!0});var Q=E(V);h=J(Q,"Previsualizar"),Q.forEach(p),Z.forEach(p),m=j(D),O=N(D,"DIV",{class:!0});var ye=E(O);M=N(ye,"BUTTON",{class:!0});var _e=E(M);L=J(_e,"Nueva escena"),_e.forEach(p),ye.forEach(p),D.forEach(p),z=j(S),K=N(S,"DIV",{class:!0});var Ie=E(K);W=N(Ie,"DIV",{class:!0});var ge=E(W);ie($.$$.fragment,ge),ge.forEach(p),Ie.forEach(p),S.forEach(p),this.h()},h(){b(e,"type","file"),b(e,"id","load-input"),e.hidden=!0,b(t,"class","test-story-container svelte-4kbf32"),b(t,"id","test-story-container"),b(i,"class","toolbar-button svelte-4kbf32"),b(f,"class","toolbar-button svelte-4kbf32"),b(f,"for","load-input"),b(v,"class","toolbar-button svelte-4kbf32"),b(V,"class","toolbar-button svelte-4kbf32"),b(l,"class","project-toolbar svelte-4kbf32"),b(M,"class","toolbar-button svelte-4kbf32"),b(O,"class","scene-toolbar svelte-4kbf32"),b(s,"class","toolbar svelte-4kbf32"),b(W,"class","page-container svelte-4kbf32"),b(K,"class","static-page-container svelte-4kbf32"),b(o,"class","design-window-container svelte-4kbf32")},m(g,S){T(g,e,S),a[11](e),T(g,n,S),T(g,t,S),T(g,r,S),T(g,o,S),y(o,s),y(s,l),y(l,i),y(i,c),y(l,u),y(l,f),y(f,d),y(l,_),y(l,v),y(v,I),y(l,P),y(l,V),y(V,h),y(s,m),y(s,O),y(O,M),y(M,L),y(o,z),y(o,K),y(K,W),re($,W,null),ee=!0,x||(w=[R(e,"change",a[5]),R(i,"click",a[7]),R(v,"click",a[9]),R(V,"click",a[8]),R(M,"click",a[6])],x=!0)},p(g,[S]){const D={};S&1&&(D.movingNode=g[0]),S&4194329&&(D.$$scope={dirty:S,ctx:g}),!ce&&S&2&&(ce=!0,D.showNewScene=g[1],de(()=>ce=!1)),!A&&S&16&&(A=!0,D.mouse=g[4],de(()=>A=!1)),$.$set(D)},i(g){ee||(G($.$$.fragment,g),ee=!0)},o(g){q($.$$.fragment,g),ee=!1},d(g){g&&p(e),a[11](null),g&&p(n),g&&p(t),g&&p(r),g&&p(o),le($),x=!1,Ee(w)}}}function Qt(a){a.scrollIntoView({block:"start"})}function $t(a,e){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([JSON.stringify(a,null,2)],{type:"application/json"})),n.setAttribute("download",`${e.includes(".json")?e:e+".json"}`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function en(a,e,n){let t,r,o,s;se(a,Y,m=>n(10,o=m)),se(a,Xt,m=>n(15,s=m));let l=!1,i=!1,c;function u(){const m=c.files[0];if(m.type==="application/json"){ue(Y,o={},o);const O=new FileReader;O.addEventListener("load",function(){const M=O.result,L=JSON.parse(M);ue(Y,o=L,o)}),this.value=null,O.readAsText(m);return}else alert("Formato de archivo incorrecto / incorrect file format")}function f(){n(1,i=!0)}function d(){ue(Y,o={},o)}function _(){console.log(o);const m=document.getElementById("storygeneraldiv");m&&m.remove();const O=new s("es"),M=Object.entries(o).sort((K,W)=>K[1].display.y-W[1].display.y);if(M.length===0){alert("No hay escenas / There are no scenes");return}O.setScenes(o).startAdventure(M[0][0]);const L=document.getElementById("test-story-container"),z=document.getElementById("storygeneraldiv");L.appendChild(z),Qt(z)}function v(){$t(o,"aventuraInteractiva")}function I(m){ne[m?"unshift":"push"](()=>{c=m,n(2,c)})}function P(m){l=m,n(0,l)}function V(m){i=m,n(1,i)}function h(m){t=m,n(4,t)}return a.$$.update=()=>{a.$$.dirty&1024&&n(3,r=Object.keys(o))},n(4,t={x:0,y:0}),[l,i,c,r,t,u,f,d,_,v,o,I,P,V,h]}class tn extends pe{constructor(e){super(),me(this,e,en,Zt,he,{})}}function nn(a){let e,n,t,r,o,s,l,i,c;return o=new tn({}),{c(){e=k("section"),n=k("h1"),t=H("Aventura interactiva (beta)"),r=U(),oe(o.$$.fragment),s=U(),l=k("footer"),i=H("Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.1b"),this.h()},l(u){e=N(u,"SECTION",{class:!0});var f=E(e);n=N(f,"H1",{class:!0});var d=E(n);t=J(d,"Aventura interactiva (beta)"),d.forEach(p),r=j(f),ie(o.$$.fragment,f),s=j(f),l=N(f,"FOOTER",{class:!0});var _=E(l);i=J(_,"Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.1b"),_.forEach(p),f.forEach(p),this.h()},h(){b(n,"class","svelte-aiip2m"),b(l,"class","svelte-aiip2m"),b(e,"class","svelte-aiip2m")},m(u,f){T(u,e,f),y(e,n),y(n,t),y(e,r),re(o,e,null),y(e,s),y(e,l),y(l,i),c=!0},p:ve,i(u){c||(G(o.$$.fragment,u),c=!0)},o(u){q(o.$$.fragment,u),c=!1},d(u){u&&p(e),le(o)}}}class rn extends pe{constructor(e){super(),me(this,e,null,nn,he,{})}}export{rn as default};
