import{S as pe,i as me,s as he,F as Ae,l as k,m as E,n as N,h as p,p as b,b as O,K as we,L as P,M as Ee,G as Be,H as Re,I as Pe,f as G,t as X,N as Ne,O as ke,r as q,u as x,J as y,E as ve,a as L,c as U,P as Ue,Q as se,w as oe,x as ie,y as re,B as le,R as ne,T as ce,U as fe,V as be,W as de,v as De,e as Se,g as Te,d as Ce,k as ct,X as ft,Y as Ve,Z as Ge,_ as je,$ as dt,a0 as Xe}from"../chunks/index-f02839e3.js";import{w as pt,r as Oe}from"../chunks/index-9b6a96ee.js";const Y=pt({inicio:{texto:"\xC9rase una vez un c\xEDrculo...",display:{ops:[],x:40,y:40},opciones:[{btn:"dejar tranquilo",escena:"final1"},{btn:"aplastar",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{ops:[],x:40,y:270}},final2:{texto:"Parece que la historia form\xF3 una elipsis",sinSalida:!0,display:{ops:[],x:220,y:270}}}),ut=Oe(a=>a.scene===void 0&&a.escena!==void 0?"escena":"scene"),Ke=Oe(a=>a.options===void 0&&a.opciones!==void 0?"opciones":"options"),mt=Oe(a=>a.text===void 0&&a.texto!==void 0?"texto":"text"),ht=Oe(a=>a.image===void 0&&a.imagen!==void 0?"imagen":"image");function gt(a){let e,t,n,l;const i=a[5].default,s=Ae(i,a,a[4],null);return{c(){e=k("div"),s&&s.c(),this.h()},l(r){e=E(r,"DIV",{class:!0});var o=N(e);s&&s.l(o),o.forEach(p),this.h()},h(){b(e,"class","draggui svelte-11g4b1g")},m(r,o){O(r,e,o),s&&s.m(e,null),t=!0,n||(l=[we(a[0].call(null,e)),we(a[1].call(null,e)),P(e,"mousedown",Ee(a[6]))],n=!0)},p(r,[o]){s&&s.p&&(!t||o&16)&&Be(s,i,r,r[4],t?Pe(i,r[4],o,null):Re(r[4]),null)},i(r){t||(G(s,r),t=!0)},o(r){X(s,r),t=!1},d(r){r&&p(e),s&&s.d(r),n=!1,Ne(l)}}}function _t(a,e,t){let{$$slots:n={},$$scope:l}=e,{pos:i}=e,{displace:s={x:i.x,y:i.y}}=e;function r(u){u.style.left=`${s.x}px`,u.style.top=`${s.y}px`}function o(u){let f=!1;u.style.left=`${s.x}px`,u.style.top=`${s.y}px`,u.addEventListener("mousedown",()=>{f=!0}),window.addEventListener("mousemove",d=>{f&&(t(2,s.x+=d.movementX,s),t(2,s.y+=d.movementY,s),u.style.left=`${s.x}px`,u.style.top=`${s.y}px`,u.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{f=!1,u.style.cursor="grab"})}function c(u){ke.call(this,a,u)}return a.$$set=u=>{"pos"in u&&t(3,i=u.pos),"displace"in u&&t(2,s=u.displace),"$$scope"in u&&t(4,l=u.$$scope)},[r,o,s,i,l,n,c]}class Fe extends pe{constructor(e){super(),me(this,e,_t,gt,he,{pos:3,displace:2})}}function vt(a){let e,t,n,l,i;return{c(){e=k("div"),t=k("button"),n=q("X"),this.h()},l(s){e=E(s,"DIV",{class:!0});var r=N(e);t=E(r,"BUTTON",{class:!0});var o=N(t);n=x(o,"X"),o.forEach(p),r.forEach(p),this.h()},h(){b(t,"class","x-button"),b(e,"class","top-bar svelte-15bdkib")},m(s,r){O(s,e,r),y(e,t),y(t,n),l||(i=P(t,"click",a[0]),l=!0)},p:ve,i:ve,o:ve,d(s){s&&p(e),l=!1,i()}}}function yt(a,e,t){let{toggle:n}=e;function l(){t(1,n=!1)}return a.$$set=i=>{"toggle"in i&&t(1,n=i.toggle)},[l,n]}class We extends pe{constructor(e){super(),me(this,e,yt,vt,he,{toggle:1})}}function Ye(a){let e,t;return{c(){e=k("img"),this.h()},l(n){e=E(n,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Ue(e.src,t="")||b(e,"src",t),b(e,"alt","Preview"),b(e,"class","img-preview svelte-ekr4m4")},m(n,l){O(n,e,l),a[6](e)},p:ve,d(n){n&&p(e),a[6](null)}}}function bt(a){let e,t,n,l,i,s=a[2]&&Ye(a);return{c(){e=k("input"),t=L(),n=k("div"),s&&s.c(),this.h()},l(r){e=E(r,"INPUT",{type:!0}),t=U(r),n=E(r,"DIV",{class:!0,id:!0});var o=N(n);s&&s.l(o),o.forEach(p),this.h()},h(){b(e,"type","file"),b(n,"class","image-preview-container svelte-ekr4m4"),b(n,"id","image-preview-container")},m(r,o){O(r,e,o),a[5](e),O(r,t,o),O(r,n,o),s&&s.m(n,null),l||(i=P(e,"change",a[3]),l=!0)},p(r,[o]){r[2]?s?s.p(r,o):(s=Ye(r),s.c(),s.m(n,null)):s&&(s.d(1),s=null)},i:ve,o:ve,d(r){r&&p(e),a[5](null),r&&p(t),r&&p(n),s&&s.d(),l=!1,i()}}}function wt(a,e,t){let{imageUrl:n}=e,l,i,s=!1;function r(){const u=l.files[0];if(u){t(2,s=!0);const f=new FileReader;f.addEventListener("load",function(){t(4,n=f.result),i.setAttribute("src",f.result)}),f.readAsDataURL(u);return}t(2,s=!1)}function o(u){se[u?"unshift":"push"](()=>{l=u,t(0,l)})}function c(u){se[u?"unshift":"push"](()=>{i=u,t(1,i)})}return a.$$set=u=>{"imageUrl"in u&&t(4,n=u.imageUrl)},[l,i,s,r,n,o,c]}class kt extends pe{constructor(e){super(),me(this,e,wt,bt,he,{imageUrl:4})}}function Et(a){let e,t,n,l,i,s,r,o,c,u,f,d,m,_,I,z,A,g,v,T,M,D,B,F,Q,H,ae,$,W,te,K,w,V,R,h,S;function j(C){a[8](C)}let Z={};a[0]!==void 0&&(Z.toggle=a[0]),e=new We({props:Z}),se.push(()=>fe(e,"toggle",j));function ee(C){a[11](C)}let ue={};return a[3]!==void 0&&(ue.imageUrl=a[3]),$=new kt({props:ue}),se.push(()=>fe($,"imageUrl",ee)),{c(){oe(e.$$.fragment),n=L(),l=k("div"),i=k("h1"),s=q(a[1]),r=L(),o=k("div"),c=k("h2"),u=q("Texto"),f=L(),d=k("textarea"),m=L(),_=k("div"),I=k("h2"),z=q("Imagen (opcional)"),A=L(),g=k("div"),v=k("label"),T=q("Url:"),M=L(),D=k("input"),B=q(`
    o
    `),F=k("div"),Q=k("span"),H=q("Archivo:"),ae=L(),oe($.$$.fragment),te=L(),K=k("div"),w=k("button"),V=q("Aceptar"),this.h()},l(C){ie(e.$$.fragment,C),n=U(C),l=E(C,"DIV",{});var J=N(l);i=E(J,"H1",{class:!0});var ye=N(i);s=x(ye,a[1]),ye.forEach(p),J.forEach(p),r=U(C),o=E(C,"DIV",{});var _e=N(o);c=E(_e,"H2",{class:!0});var Ie=N(c);u=x(Ie,"Texto"),Ie.forEach(p),f=U(_e),d=E(_e,"TEXTAREA",{class:!0}),N(d).forEach(p),_e.forEach(p),m=U(C),_=E(C,"DIV",{});var ge=N(_);I=E(ge,"H2",{class:!0});var ze=N(I);z=x(ze,"Imagen (opcional)"),ze.forEach(p),A=U(ge),g=E(ge,"DIV",{});var Me=N(g);v=E(Me,"LABEL",{for:!0});var He=N(v);T=x(He,"Url:"),He.forEach(p),M=U(Me),D=E(Me,"INPUT",{id:!0,type:!0}),Me.forEach(p),B=x(ge,`
    o
    `),F=E(ge,"DIV",{});var Le=N(F);Q=E(Le,"SPAN",{});var Je=N(Q);H=x(Je,"Archivo:"),Je.forEach(p),ae=U(Le),ie($.$$.fragment,Le),Le.forEach(p),te=U(ge),K=E(ge,"DIV",{class:!0});var qe=N(K);w=E(qe,"BUTTON",{});var xe=N(w);V=x(xe,"Aceptar"),xe.forEach(p),qe.forEach(p),ge.forEach(p),this.h()},h(){b(i,"class","svelte-2p34te"),b(c,"class","svelte-2p34te"),b(d,"class","svelte-2p34te"),b(I,"class","svelte-2p34te"),b(v,"for","inp"),b(D,"id","inp"),b(D,"type","text"),b(K,"class","bar svelte-2p34te")},m(C,J){re(e,C,J),O(C,n,J),O(C,l,J),y(l,i),y(i,s),O(C,r,J),O(C,o,J),y(o,c),y(c,u),y(o,f),y(o,d),be(d,a[4]),O(C,m,J),O(C,_,J),y(_,I),y(I,z),y(_,A),y(_,g),y(g,v),y(v,T),y(g,M),y(g,D),be(D,a[3]),y(_,B),y(_,F),y(F,Q),y(Q,H),y(F,ae),re($,F,null),y(_,te),y(_,K),y(K,w),y(w,V),R=!0,h||(S=[P(d,"input",a[9]),P(d,"mousedown",Ee(a[7])),P(D,"input",a[10]),P(D,"mousedown",Ee(a[6])),P(w,"click",a[5])],h=!0)},p(C,J){const ye={};!t&&J&1&&(t=!0,ye.toggle=C[0],de(()=>t=!1)),e.$set(ye),(!R||J&2)&&De(s,C[1]),J&16&&be(d,C[4]),J&8&&D.value!==C[3]&&be(D,C[3]);const _e={};!W&&J&8&&(W=!0,_e.imageUrl=C[3],de(()=>W=!1)),$.$set(_e)},i(C){R||(G(e.$$.fragment,C),G($.$$.fragment,C),R=!0)},o(C){X(e.$$.fragment,C),X($.$$.fragment,C),R=!1},d(C){le(e,C),C&&p(n),C&&p(l),C&&p(r),C&&p(o),C&&p(m),C&&p(_),le($),h=!1,Ne(S)}}}function Nt(a){let e,t;return e=new Fe({props:{pos:a[2],$$slots:{default:[Et]},$$scope:{ctx:a}}}),{c(){oe(e.$$.fragment)},l(n){ie(e.$$.fragment,n)},m(n,l){re(e,n,l),t=!0},p(n,[l]){const i={};l&4&&(i.pos=n[2]),l&32795&&(i.$$scope={dirty:l,ctx:n}),e.$set(i)},i(n){t||(G(e.$$.fragment,n),t=!0)},o(n){X(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function St(a,e,t){let n,l;ne(a,Y,g=>t(12,l=g));let{key:i}=e,{pos:s}=e,{showEditor:r}=e,o=null,c=l[i];const u=c.text===void 0&&c.texto!==void 0?"texto":"text";function f(){ce(Y,l[i][u]=n,l),o!==null&&ce(Y,l[i].image=o,l),t(0,r=!1)}function d(g){ke.call(this,a,g)}function m(g){ke.call(this,a,g)}function _(g){r=g,t(0,r)}function I(){n=this.value,t(4,n),t(13,c)}function z(){o=this.value,t(3,o)}function A(g){o=g,t(3,o)}return a.$$set=g=>{"key"in g&&t(1,i=g.key),"pos"in g&&t(2,s=g.pos),"showEditor"in g&&t(0,r=g.showEditor)},a.$$.update=()=>{a.$$.dirty&2&&ce(Y,l[i]=c,l)},t(4,n=c[u]),[r,i,s,o,n,f,d,m,_,I,z,A]}class It extends pe{constructor(e){super(),me(this,e,St,Nt,he,{key:1,pos:2,showEditor:0})}}function Tt(a){let e,t,n,l,i,s,r,o,c,u,f,d,m,_,I;function z(g){a[6](g)}let A={};return a[0]!==void 0&&(A.toggle=a[0]),e=new We({props:A}),se.push(()=>fe(e,"toggle",z)),{c(){oe(e.$$.fragment),n=L(),l=k("div"),i=k("label"),s=q("Btn:"),r=L(),o=k("input"),c=L(),u=k("div"),f=k("button"),d=q("Aceptar"),this.h()},l(g){ie(e.$$.fragment,g),n=U(g),l=E(g,"DIV",{});var v=N(l);i=E(v,"LABEL",{for:!0});var T=N(i);s=x(T,"Btn:"),T.forEach(p),r=U(v),o=E(v,"INPUT",{id:!0,type:!0}),v.forEach(p),c=U(g),u=E(g,"DIV",{class:!0});var M=N(u);f=E(M,"BUTTON",{});var D=N(f);d=x(D,"Aceptar"),D.forEach(p),M.forEach(p),this.h()},h(){b(i,"for","inp"),b(o,"id","inp"),b(o,"type","text"),b(u,"class","bar svelte-1bhrmvp")},m(g,v){re(e,g,v),O(g,n,v),O(g,l,v),y(l,i),y(i,s),y(l,r),y(l,o),be(o,a[2]),O(g,c,v),O(g,u,v),y(u,f),y(f,d),m=!0,_||(I=[P(o,"input",a[7]),P(o,"mousedown",Ee(a[5])),P(f,"click",a[3])],_=!0)},p(g,v){const T={};!t&&v&1&&(t=!0,T.toggle=g[0],de(()=>t=!1)),e.$set(T),v&4&&o.value!==g[2]&&be(o,g[2])},i(g){m||(G(e.$$.fragment,g),m=!0)},o(g){X(e.$$.fragment,g),m=!1},d(g){le(e,g),g&&p(n),g&&p(l),g&&p(c),g&&p(u),_=!1,Ne(I)}}}function Ct(a){let e,t;return e=new Fe({props:{pos:a[1],$$slots:{default:[Tt]},$$scope:{ctx:a}}}),{c(){oe(e.$$.fragment)},l(n){ie(e.$$.fragment,n)},m(n,l){re(e,n,l),t=!0},p(n,[l]){const i={};l&2&&(i.pos=n[1]),l&2053&&(i.$$scope={dirty:l,ctx:n}),e.$set(i)},i(n){t||(G(e.$$.fragment,n),t=!0)},o(n){X(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Ot(a,e,t){let n,l,i;ne(a,Y,_=>t(8,l=_)),ne(a,Ke,_=>t(9,i=_));let{key:s}=e,{pos:r}=e,{showNewOutput:o}=e;const c=i(l[s]);function u(){l[s][c]===void 0&&ce(Y,l[s][c]=[],l),l[s][c].push({btn:n}),Y.set(l),t(0,o=!1)}function f(_){ke.call(this,a,_)}function d(_){o=_,t(0,o)}function m(){n=this.value,t(2,n)}return a.$$set=_=>{"key"in _&&t(4,s=_.key),"pos"in _&&t(1,r=_.pos),"showNewOutput"in _&&t(0,o=_.showNewOutput)},t(2,n=""),[o,r,n,u,s,f,d,m]}class Mt extends pe{constructor(e){super(),me(this,e,Ot,Ct,he,{key:4,pos:1,showNewOutput:0})}}function Lt(a){let e,t,n,l;const i=a[5].default,s=Ae(i,a,a[4],null);return{c(){e=k("div"),s&&s.c(),this.h()},l(r){e=E(r,"DIV",{class:!0});var o=N(e);s&&s.l(o),o.forEach(p),this.h()},h(){b(e,"class","scene-node-container svelte-14kdql5")},m(r,o){O(r,e,o),s&&s.m(e,null),t=!0,n||(l=we(a[0].call(null,e)),n=!0)},p(r,[o]){s&&s.p&&(!t||o&16)&&Be(s,i,r,r[4],t?Pe(i,r[4],o,null):Re(r[4]),null)},i(r){t||(G(s,r),t=!0)},o(r){X(s,r),t=!1},d(r){r&&p(e),s&&s.d(r),n=!1,l()}}}function Ut(a,e,t){let n;ne(a,Y,u=>t(3,n=u));let{$$slots:l={},$$scope:i}=e,{key:s}=e,{movingNode:r=!1}=e,o=n[s];o.display===void 0&&(o.display={x:0,y:0,ops:[]});function c(u){let f=!1;u.style.left=`${o.display.x}px`,u.style.top=`${o.display.y}px`,u.addEventListener("mousedown",()=>{f=!0,t(1,r=!0)}),window.addEventListener("mousemove",d=>{f&&(o.display.x+=d.movementX,o.display.y+=d.movementY,u.style.left=`${o.display.x}px`,u.style.top=`${o.display.y}px`,ce(Y,n[s]=o,n))}),window.addEventListener("mouseup",()=>{f=!1,t(1,r=!1)})}return a.$$set=u=>{"key"in u&&t(2,s=u.key),"movingNode"in u&&t(1,r=u.movingNode),"$$scope"in u&&t(4,i=u.$$scope)},a.$$.update=()=>{a.$$.dirty&12&&(o=n[s])},[c,r,s,n,i,l]}class Dt extends pe{constructor(e){super(),me(this,e,Ut,Lt,he,{key:2,movingNode:1})}}function Ze(a,e,t){const n=a.slice();return n[32]=e[t],n[34]=t,n}function Qe(a){let e,t,n,l,i;return{c(){e=k("div"),t=k("img"),this.h()},l(s){e=E(s,"DIV",{class:!0});var r=N(e);t=E(r,"IMG",{src:!0,alt:!0,class:!0}),r.forEach(p),this.h()},h(){Ue(t.src,n=a[2][a[7]])||b(t,"src",n),b(t,"alt","Preview"),b(t,"class","img-preview svelte-1mnnlm2"),b(e,"class","img-preview-container svelte-1mnnlm2")},m(s,r){O(s,e,r),y(e,t),l||(i=we(a[12].call(null,t)),l=!0)},p(s,r){r[0]&4&&!Ue(t.src,n=s[2][s[7]])&&b(t,"src",n)},d(s){s&&p(e),l=!1,i()}}}function $e(a){let e,t,n,l,i,s,r,o;return{c(){e=k("div"),t=k("input"),l=L(),i=k("div"),s=L(),this.h()},l(c){e=E(c,"DIV",{class:!0});var u=N(e);t=E(u,"INPUT",{type:!0,class:!0,i:!0}),l=U(u),i=E(u,"DIV",{class:!0,i:!0}),N(i).forEach(p),s=U(u),u.forEach(p),this.h()},h(){b(t,"type","text"),b(t,"class","output-text svelte-1mnnlm2"),t.value=n=a[32].btn,b(t,"i",a[34]),b(i,"class","connection output svelte-1mnnlm2"),b(i,"i",a[34]),b(e,"class","output-container svelte-1mnnlm2")},m(c,u){O(c,e,u),y(e,t),y(e,l),y(e,i),y(e,s),r||(o=[we(a[10].call(null,t)),P(t,"change",a[9]),P(t,"mousedown",Ee(a[21])),we(a[11].call(null,i)),we(a[13].call(null,i)),P(i,"mousedown",Ee(a[20]))],r=!0)},p(c,u){u[0]&4&&n!==(n=c[32].btn)&&t.value!==n&&(t.value=n)},d(c){c&&p(e),r=!1,Ne(o)}}}function jt(a){let e,t,n,l,i,s,r,o,c,u=(a[2][a[8]].length<210?a[2][a[8]]:a[2][a[8]].slice(0,210)+"...")+"",f,d,m,_,I,z,A,g,v,T,M,D,B,F,Q,H,ae,$,W=a[2][a[7]]!==void 0&&a[2][a[7]]!==null&&Qe(a),te=a[2][a[6]]||[],K=[];for(let w=0;w<te.length;w+=1)K[w]=$e(Ze(a,te,w));return{c(){e=k("div"),t=L(),n=k("h1"),l=q("Escena: "),i=q(a[1]),s=L(),W&&W.c(),r=L(),o=k("div"),c=k("p"),f=q(u),d=L(),m=k("div"),_=k("button"),I=q("editar"),z=L(),A=k("button"),g=q("x"),v=L(),T=k("button"),M=q("-"),D=L(),B=k("button"),F=q("+"),Q=L(),H=k("div");for(let w=0;w<K.length;w+=1)K[w].c();this.h()},l(w){e=E(w,"DIV",{class:!0}),N(e).forEach(p),t=U(w),n=E(w,"H1",{class:!0});var V=N(n);l=x(V,"Escena: "),i=x(V,a[1]),V.forEach(p),s=U(w),W&&W.l(w),r=U(w),o=E(w,"DIV",{class:!0});var R=N(o);c=E(R,"P",{class:!0});var h=N(c);f=x(h,u),h.forEach(p),R.forEach(p),d=U(w),m=E(w,"DIV",{class:!0});var S=N(m);_=E(S,"BUTTON",{class:!0});var j=N(_);I=x(j,"editar"),j.forEach(p),z=U(S),A=E(S,"BUTTON",{class:!0});var Z=N(A);g=x(Z,"x"),Z.forEach(p),v=U(S),T=E(S,"BUTTON",{class:!0});var ee=N(T);M=x(ee,"-"),ee.forEach(p),D=U(S),B=E(S,"BUTTON",{class:!0});var ue=N(B);F=x(ue,"+"),ue.forEach(p),S.forEach(p),Q=U(w),H=E(w,"DIV",{class:!0});var C=N(H);for(let J=0;J<K.length;J+=1)K[J].l(C);C.forEach(p),this.h()},h(){b(e,"class","connection input svelte-1mnnlm2"),b(n,"class","svelte-1mnnlm2"),b(c,"class","text-p svelte-1mnnlm2"),b(o,"class","p-container svelte-1mnnlm2"),b(_,"class","svelte-1mnnlm2"),b(A,"class","svelte-1mnnlm2"),b(T,"class","svelte-1mnnlm2"),b(B,"class","svelte-1mnnlm2"),b(m,"class","node-btns svelte-1mnnlm2"),b(H,"class","node-outputs svelte-1mnnlm2")},m(w,V){O(w,e,V),O(w,t,V),O(w,n,V),y(n,l),y(n,i),O(w,s,V),W&&W.m(w,V),O(w,r,V),O(w,o,V),y(o,c),y(c,f),O(w,d,V),O(w,m,V),y(m,_),y(_,I),y(m,z),y(m,A),y(A,g),y(m,v),y(m,T),y(T,M),y(m,D),y(m,B),y(B,F),O(w,Q,V),O(w,H,V);for(let R=0;R<K.length;R+=1)K[R].m(H,null);a[23](H),ae||($=[P(e,"mousedown",Ee(a[22])),P(e,"click",a[14]),P(_,"click",a[17]),P(A,"click",a[16]),P(T,"click",a[15]),P(B,"click",a[18])],ae=!0)},p(w,V){if(V[0]&2&&De(i,w[1]),w[2][w[7]]!==void 0&&w[2][w[7]]!==null?W?W.p(w,V):(W=Qe(w),W.c(),W.m(r.parentNode,r)):W&&(W.d(1),W=null),V[0]&4&&u!==(u=(w[2][w[8]].length<210?w[2][w[8]]:w[2][w[8]].slice(0,210)+"...")+"")&&De(f,u),V[0]&580){te=w[2][w[6]]||[];let R;for(R=0;R<te.length;R+=1){const h=Ze(w,te,R);K[R]?K[R].p(h,V):(K[R]=$e(h),K[R].c(),K[R].m(H,null))}for(;R<K.length;R+=1)K[R].d(1);K.length=te.length}},d(w){w&&p(e),w&&p(t),w&&p(n),w&&p(s),W&&W.d(w),w&&p(r),w&&p(o),w&&p(d),w&&p(m),w&&p(Q),w&&p(H),ft(K,w),a[23](null),ae=!1,Ne($)}}}function et(a){let e,t,n;function l(s){a[25](s)}let i={key:a[1],pos:a[2].display};return a[4]!==void 0&&(i.showEditor=a[4]),e=new It({props:i}),se.push(()=>fe(e,"showEditor",l)),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,r){re(e,s,r),n=!0},p(s,r){const o={};r[0]&2&&(o.key=s[1]),r[0]&4&&(o.pos=s[2].display),!t&&r[0]&16&&(t=!0,o.showEditor=s[4],de(()=>t=!1)),e.$set(o)},i(s){n||(G(e.$$.fragment,s),n=!0)},o(s){X(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function tt(a){let e,t,n;function l(s){a[26](s)}let i={key:a[1],pos:a[2].display};return a[5]!==void 0&&(i.showNewOutput=a[5]),e=new Mt({props:i}),se.push(()=>fe(e,"showNewOutput",l)),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,r){re(e,s,r),n=!0},p(s,r){const o={};r[0]&2&&(o.key=s[1]),r[0]&4&&(o.pos=s[2].display),!t&&r[0]&32&&(t=!0,o.showNewOutput=s[5],de(()=>t=!1)),e.$set(o)},i(s){n||(G(e.$$.fragment,s),n=!0)},o(s){X(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function At(a){let e,t,n,l,i,s;function r(f){a[24](f)}let o={key:a[1],$$slots:{default:[jt]},$$scope:{ctx:a}};a[0]!==void 0&&(o.movingNode=a[0]),e=new Dt({props:o}),se.push(()=>fe(e,"movingNode",r));let c=a[4]&&et(a),u=a[5]&&tt(a);return{c(){oe(e.$$.fragment),n=L(),c&&c.c(),l=L(),u&&u.c(),i=Se()},l(f){ie(e.$$.fragment,f),n=U(f),c&&c.l(f),l=U(f),u&&u.l(f),i=Se()},m(f,d){re(e,f,d),O(f,n,d),c&&c.m(f,d),O(f,l,d),u&&u.m(f,d),O(f,i,d),s=!0},p(f,d){const m={};d[0]&2&&(m.key=f[1]),d[0]&14|d[1]&16&&(m.$$scope={dirty:d,ctx:f}),!t&&d[0]&1&&(t=!0,m.movingNode=f[0],de(()=>t=!1)),e.$set(m),f[4]?c?(c.p(f,d),d[0]&16&&G(c,1)):(c=et(f),c.c(),G(c,1),c.m(l.parentNode,l)):c&&(Te(),X(c,1,1,()=>{c=null}),Ce()),f[5]?u?(u.p(f,d),d[0]&32&&G(u,1)):(u=tt(f),u.c(),G(u,1),u.m(i.parentNode,i)):u&&(Te(),X(u,1,1,()=>{u=null}),Ce())},i(f){s||(G(e.$$.fragment,f),G(c),G(u),s=!0)},o(f){X(e.$$.fragment,f),X(c),X(u),s=!1},d(f){le(e,f),f&&p(n),c&&c.d(f),f&&p(l),u&&u.d(f),f&&p(i)}}}function Bt(a,e,t){let n,l,i,s,r;ne(a,Y,h=>t(19,n=h)),ne(a,ut,h=>t(27,l=h)),ne(a,Ke,h=>t(28,i=h)),ne(a,mt,h=>t(29,s=h)),ne(a,ht,h=>t(30,r=h));let{key:o}=e,{movingNode:c=!1}=e,u=n[o];const f=i(u),d=r(u),m=s(u);let _,I=!1,z=!1;ct(()=>{T()}),u.display===void 0&&(u.display={x:0,y:0,ops:[]});function A(){g(this)}function g(h){const S=+h.getAttribute("i");h.style.width=h.value.length*6.1+"px",t(2,u[f][S].btn=h.value,u),T()}function v(h){const S=+h.getAttribute("i");u.display.ops[S]===void 0?t(2,u.display.ops[S]={x:h.offsetLeft,y:h.offsetTop,rewiring:!1},u):Object.assign(u.display.ops[S],{x:h.offsetLeft,y:h.offsetTop}),ce(Y,n[o]=u,n)}function T(){if(_===void 0)return;const h=_.getElementsByClassName("output");for(let S of h)v(S)}function M(){const h=Object.keys(n);for(let S of h){const j=n[S],Z=i(j);for(let ee=0;ee<j.display.ops.length;ee++){const ue=l(j[Z][ee]);j.display.ops[ee].rewiring&&(j.display.ops[ee].rewiring=!1,j[Z][ee][ue]=j.display.ops[ee].prevWiring)}ce(Y,n[S]=j,n)}}function D(h){const S=+h.getAttribute("i");h.addEventListener("click",()=>{M();const j=l(u[f][S]);u.display.ops[S].rewiring||(t(2,u.display.ops[S].prevWiring=u[f][S][j],u),t(2,u.display.ops[S].rewiring=!0,u),t(2,u[f][S][j]=void 0,u))})}function B(){const h=Object.keys(n);let S;for(let ee of h){const ue=n[ee];let C=0;for(let J of ue.display.ops)J.rewiring&&(J.rewiring=!1,S={scene:ue,i:C}),C++}if(S===void 0)return;const j=i(S.scene),Z=l(S.scene[j][S.i]);S.scene[j][S.i][Z]=o}function F(){u[f]!==void 0&&(u[f].pop(),u.display.ops.pop(),Y.set(n))}function Q(){for(let h of Object.keys(n)){const S=i(n[h]);if(n[h][S]!==void 0)for(let j of n[h][S]){const Z=l(j);j[Z]===o&&(j[Z]=void 0)}}delete n[o],Y.set(n)}function H(){t(4,I=!0)}function ae(){t(5,z=!0)}function $(h){ke.call(this,a,h)}function W(h){ke.call(this,a,h)}function te(h){ke.call(this,a,h)}function K(h){se[h?"unshift":"push"](()=>{_=h,t(3,_)})}function w(h){c=h,t(0,c)}function V(h){I=h,t(4,I)}function R(h){z=h,t(5,z)}return a.$$set=h=>{"key"in h&&t(1,o=h.key),"movingNode"in h&&t(0,c=h.movingNode)},a.$$.update=()=>{a.$$.dirty[0]&524290&&t(2,u=n[o])},[c,o,u,_,I,z,f,d,m,A,g,v,T,D,B,F,Q,H,ae,n,$,W,te,K,w,V,R]}class Rt extends pe{constructor(e){super(),me(this,e,Bt,At,he,{key:1,movingNode:0},null,[-1,-1])}}function nt(a,e,t){const n=a.slice();return n[5]=e[t],n[7]=t,n}function st(a,e){let t,n,l,i,s;return{key:a,first:null,c(){t=Ve("line"),this.h()},l(r){t=Ge(r,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0}),N(t).forEach(p),this.h()},h(){b(t,"class","node-connection svelte-nz6q29"),b(t,"x1",n=e[0].display.x+e[5].x+5),b(t,"y1",l=e[0].display.y+e[5].y+10),b(t,"x2",i=e[1][e[7]].x+5),b(t,"y2",s=e[1][e[7]].y+5),this.first=t},m(r,o){O(r,t,o)},p(r,o){e=r,o&1&&n!==(n=e[0].display.x+e[5].x+5)&&b(t,"x1",n),o&1&&l!==(l=e[0].display.y+e[5].y+10)&&b(t,"y1",l),o&3&&i!==(i=e[1][e[7]].x+5)&&b(t,"x2",i),o&3&&s!==(s=e[1][e[7]].y+5)&&b(t,"y2",s)},d(r){r&&p(t)}}}function Pt(a){let e,t=[],n=new Map,l=a[0].display.ops||[];const i=s=>s[7];for(let s=0;s<l.length;s+=1){let r=nt(a,l,s),o=i(r);n.set(o,t[s]=st(o,r))}return{c(){e=Ve("g");for(let s=0;s<t.length;s+=1)t[s].c()},l(s){e=Ge(s,"g",{});var r=N(e);for(let o=0;o<t.length;o+=1)t[o].l(r);r.forEach(p)},m(s,r){O(s,e,r);for(let o=0;o<t.length;o+=1)t[o].m(e,null)},p(s,[r]){r&3&&(l=s[0].display.ops||[],t=je(t,r,i,1,s,l,n,e,dt,st,null,nt))},i:ve,o:ve,d(s){s&&p(e);for(let r=0;r<t.length;r+=1)t[r].d()}}}function Vt(a,e,t){let n,l;ne(a,Y,o=>t(4,l=o));let{key:i}=e,{mouse:s}=e,r=l[i];return a.$$set=o=>{"key"in o&&t(2,i=o.key),"mouse"in o&&t(3,s=o.mouse)},a.$$.update=()=>{a.$$.dirty&20&&t(0,r=l[i]),a.$$.dirty&25&&t(1,n=(r.options||r.opciones||[]).map((o,c)=>{const u=o.escena||o.scene;return u===void 0?r.display.ops[c].rewiring?s:r.display:l[u].display}))},[r,n,i,s,l]}class Gt extends pe{constructor(e){super(),me(this,e,Vt,Pt,he,{key:2,mouse:3})}}function Kt(a){let e,t,n,l,i,s,r,o,c,u,f,d,m,_,I;function z(g){a[7](g)}let A={};return a[0]!==void 0&&(A.toggle=a[0]),e=new We({props:A}),se.push(()=>fe(e,"toggle",z)),{c(){oe(e.$$.fragment),n=L(),l=k("div"),i=k("label"),s=q("Escena:"),r=L(),o=k("input"),c=L(),u=k("div"),f=k("button"),d=q("Aceptar"),this.h()},l(g){ie(e.$$.fragment,g),n=U(g),l=E(g,"DIV",{});var v=N(l);i=E(v,"LABEL",{for:!0});var T=N(i);s=x(T,"Escena:"),T.forEach(p),r=U(v),o=E(v,"INPUT",{id:!0,type:!0}),v.forEach(p),c=U(g),u=E(g,"DIV",{class:!0});var M=N(u);f=E(M,"BUTTON",{});var D=N(f);d=x(D,"Aceptar"),D.forEach(p),M.forEach(p),this.h()},h(){b(i,"for","inp"),b(o,"id","inp"),b(o,"type","text"),b(u,"class","bar svelte-1bhrmvp")},m(g,v){re(e,g,v),O(g,n,v),O(g,l,v),y(l,i),y(i,s),y(l,r),y(l,o),be(o,a[2]),O(g,c,v),O(g,u,v),y(u,f),y(f,d),m=!0,_||(I=[P(o,"input",a[8]),P(o,"mousedown",Ee(a[6])),P(f,"click",a[4])],_=!0)},p(g,v){const T={};!t&&v&1&&(t=!0,T.toggle=g[0],de(()=>t=!1)),e.$set(T),v&4&&o.value!==g[2]&&be(o,g[2])},i(g){m||(G(e.$$.fragment,g),m=!0)},o(g){X(e.$$.fragment,g),m=!1},d(g){le(e,g),g&&p(n),g&&p(l),g&&p(c),g&&p(u),_=!1,Ne(I)}}}function Ft(a){let e,t,n;function l(s){a[9](s)}let i={pos:a[3],$$slots:{default:[Kt]},$$scope:{ctx:a}};return a[1]!==void 0&&(i.displace=a[1]),e=new Fe({props:i}),se.push(()=>fe(e,"displace",l)),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,r){re(e,s,r),n=!0},p(s,[r]){const o={};r&4101&&(o.$$scope={dirty:r,ctx:s}),!t&&r&2&&(t=!0,o.displace=s[1],de(()=>t=!1)),e.$set(o)},i(s){n||(G(e.$$.fragment,s),n=!0)},o(s){X(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function Wt(a){const e=["\xE1","\xE9","\xED","\xF3","\xFA","\xFC","\xF1"],t=["a","e","i","o","u","u","n"],n=a.toLowerCase();let l="";for(let i=0;i<a.length;i++){const s=n.charAt(i),r=a.charAt(i);if(e.includes(s)){let o;for(let c=0;c<e.length;c++)if(e[c]===s){o=c;break}r===r.toUpperCase()?l+=t[o].toUpperCase():l+=t[o]}else l+=r}return l}function zt(a,e,t){let n,l;ne(a,Y,I=>t(11,l=I));let{showNewScene:i}=e,{offset:s}=e,r=l,o={x:s.x*-1+20,y:s.y*-1+20},c;function u(){if(/^\d/.test(n)===!0){alert(`El nombre de la escena no puede empezar con un n\xFAmero /
The name of the scene cannot start with a number`);return}let I=n.replace(/\s/gi,"_").replace(/\W/,"").replace(/[;.,:{}()<>$%&!¡?¿"'/\\#@&*+-]/gi,"");I=Wt(I),r[I]={text:"",display:{x:o.x,y:o.y,ops:[]}},ce(Y,l[I]=r[I],l),t(0,i=!1)}function f(I){ke.call(this,a,I)}function d(I){i=I,t(0,i)}function m(){n=this.value,t(2,n)}function _(I){c=I,t(1,c)}return a.$$set=I=>{"showNewScene"in I&&t(0,i=I.showNewScene),"offset"in I&&t(5,s=I.offset)},t(2,n=""),[i,c,n,o,u,s,f,d,m,_]}class Ht extends pe{constructor(e){super(),me(this,e,zt,Ft,he,{showNewScene:0,offset:5})}}function ot(a){let e,t,n;function l(s){a[10](s)}let i={offset:a[1]};return a[0]!==void 0&&(i.showNewScene=a[0]),e=new Ht({props:i}),se.push(()=>fe(e,"showNewScene",l)),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,r){re(e,s,r),n=!0},p(s,r){const o={};r&2&&(o.offset=s[1]),!t&&r&1&&(t=!0,o.showNewScene=s[0],de(()=>t=!1)),e.$set(o)},i(s){n||(G(e.$$.fragment,s),n=!0)},o(s){X(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function Jt(a){let e,t,n,l,i;const s=a[9].default,r=Ae(s,a,a[8],null);let o=a[0]&&ot(a);return{c(){e=k("div"),r&&r.c(),t=L(),o&&o.c(),this.h()},l(c){e=E(c,"DIV",{class:!0});var u=N(e);r&&r.l(u),t=U(u),o&&o.l(u),u.forEach(p),this.h()},h(){b(e,"class","node-page svelte-1hh9dms")},m(c,u){O(c,e,u),r&&r.m(e,null),y(e,t),o&&o.m(e,null),n=!0,l||(i=[we(a[2].call(null,e)),P(e,"mousedown",a[3]),P(e,"mouseup",a[4]),P(e,"mousemove",a[5])],l=!0)},p(c,[u]){r&&r.p&&(!n||u&256)&&Be(r,s,c,c[8],n?Pe(s,c[8],u,null):Re(c[8]),null),c[0]?o?(o.p(c,u),u&1&&G(o,1)):(o=ot(c),o.c(),G(o,1),o.m(e,null)):o&&(Te(),X(o,1,1,()=>{o=null}),Ce())},i(c){n||(G(r,c),G(o),n=!0)},o(c){X(r,c),X(o),n=!1},d(c){c&&p(e),r&&r.d(c),o&&o.d(),l=!1,Ne(i)}}}function qt(a,e,t){let n,l,i;ne(a,Y,v=>t(12,n=v)),ne(a,ut,v=>t(13,l=v)),ne(a,Ke,v=>t(14,i=v));let{$$slots:s={},$$scope:r}=e,{movingNode:o}=e,{mouse:c}=e,{showNewScene:u}=e,f=!1;const d={x:0,y:0};function m(v){v.style.left=`${d.x}px`,v.style.top=`${d.y}px`}function _(){const v=Object.keys(n);for(let T of v){const M=n[T],D=i(M);for(let B=0;B<M.display.ops.length;B++){const F=l(M[D][B]);M.display.ops[B].rewiring&&(M.display.ops[B].rewiring=!1,M[D][B][F]=M.display.ops[B].prevWiring)}ce(Y,n[T]=M,n)}}function I(){f=!0,this.style.cursor="grabbing",_()}function z(){f=!1,this.style.cursor="grab"}function A(v){if(f&&!o){const M=+getComputedStyle(this.offsetParent).width.replace("px",""),D=+getComputedStyle(this).width.replace("px",""),B=+getComputedStyle(this.offsetParent).height.replace("px",""),F=+getComputedStyle(this).height.replace("px","");t(1,d.x+=v.movementX,d),t(1,d.y+=v.movementY,d),t(1,d.x=d.x>0?0:M-d.x>D?M-D:d.x,d),t(1,d.y=d.y>0?0:B-d.y>F?B-F:d.y,d),this.style.left=`${d.x}px`,this.style.top=`${d.y}px`}t(6,c={x:v.offsetX,y:v.offsetY});let T=v.target;for(;T!==this;)t(6,c.x+=T.offsetLeft,c),t(6,c.y+=T.offsetTop,c),T=T.offsetParent}function g(v){u=v,t(0,u)}return a.$$set=v=>{"movingNode"in v&&t(7,o=v.movingNode),"mouse"in v&&t(6,c=v.mouse),"showNewScene"in v&&t(0,u=v.showNewScene),"$$scope"in v&&t(8,r=v.$$scope)},[u,d,m,I,z,A,c,o,r,s,g]}class xt extends pe{constructor(e){super(),me(this,e,qt,Jt,he,{movingNode:7,mouse:6,showNewScene:0})}}class Xt{constructor(e="en",t){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,igramaFormat:"png",minigifOptions:{},sceneCallback:n=>n},t&&(this.options=Object.assign(this.options,t)),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[t,n]of Object.entries(e.grammar));return this}setScenes(e){this.scenes=e;for(let t of Object.keys(e)){this.scenes[t].key=t;const n=this.scenes[t].image||this.scenes[t].imagen;n!==void 0&&this.storyPreload[n]===void 0&&(this.storyPreload[n]=new Image,this.storyPreload[n].src=n,this.storyPreload[n].className="storyimage")}return this}setMarkov(e){return this.markov=e,this}expandGrammar(e){const t=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(t)}expandIgrama(e){const t=this.igrama.grammar,n=this.selectGrammarRule(t[e]);return this.grammarRuleRecursion(n,t).split("|").map(i=>this.decodeDrawing(i))}grammarRuleRecursion(e,t){let n=t||this.grammar,l=this.setNewRules(e);const i=l.match(/<[\w\d.,/#]+>/gi);if(!i)return l;for(let s of i){const r=this.defineTransformations(s);l=l.replace(s,()=>{s=s.replace(/[<>]/gi,""),s=s.replace(/#[\w\d.,/]+#/g,"");const o=s.search(/[.]/)>-1?this.getNestedObject(n,s.match(/[\w\d]+/g)):n[s];if(!o){const u=this.lang==="es"?`Se intent\xF3 expandir desde la regla "${s}", pero no se pudo encontrar`:`Tried to expand from rule "${s}", but couldn't find it`;console.error(u)}const c=this.selectGrammarRule(o);return this.transformString(c,r)})}return this.grammarRuleRecursion(l,n)}setNewRules(e,t){let n;t===void 0?n=this.grammar:n=t;let l=e;const i=l.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(i)for(;i.length;){const s=i.pop();l=l.replace(s,"");const{symbol:r,pairsString:o}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(s).groups,c=o.match(/[-]?[\w\d]+:[\w\d]+/gi).map(u=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(u).groups);if(c){n[r]=n[r]||{};for(let u of c){const f=n[u.value];if(!f){const _=this.lang==="es"?`Se intent\xF3 crear la nueva regla "${r}", pero no se pudo encontrar "${u.value}" para producir la subregla "${u.key}"`:`Tried to create new rule: "${r}", but couldn't find "${u.value}" to produce "${u.key}" subrule`;console.error(_)}const d=u.remove==="-",m=this.selectGrammarRule(f);if(d){const _=f.indexOf(m);n[u.value]=[...f.slice(0,_),...f.slice(_+1)]}n[r][u.key]=[m]}}}return l}startAdventure(e){this.options.defaultCSS&&this.setCSS();const t=document.createElement("div");return t.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(t),this.goToScene(this.scenes[e]),this}goToScene(e){const t=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(o=>o.remove()),[...document.getElementsByClassName("storyimage-area")].map(r=>r.remove());const l=document.createElement("div");if(l.className="storydiv",t.appendChild(l),e.image||e.imagen){const r=document.createElement("div");r.className="storyimage-container",l.appendChild(r);const o=e.image||e.imagen,c=this.options.adventureScroll?this.storyPreload[o].cloneNode():this.storyPreload[o];r.appendChild(c),e.areas&&(c.complete?this.setAreas(c,r,e.areas):c.onload=()=>{this.setAreas(c,r,e.areas)})}else if(e.igrama!==void 0){const r=document.createElement("div");r.className="storyimage-container",l.appendChild(r);const o=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(o),this.igramaDataUrl(o,this.options.igramaFormat).then(c=>{const u=new Image;u.src=c,u.className="storyimage",r.appendChild(u)})}const i=document.createElement("div");i.className="storyp-container",(e.text||e.texto||e.igramaText)&&l.appendChild(i);const s=document.createElement("p");s.className="storyp",s.innerHTML="",i.appendChild(s),document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(s,e),this.options.sceneCallback(e)}setAreas(e,t,n){const l=e.getBoundingClientRect(),i=t.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,t,n)},[...document.getElementsByClassName("storyimage-area")].map(r=>r.remove());for(let r of n){let o=document.createElement("div");o.className="storyimage-area";const c=(r.x-Math.floor(r.w/2))*l.width/e.naturalWidth;o.style.left=`${l.left-i.left+c}px`;const u=(r.y-Math.floor(r.h/2))*l.height/e.naturalHeight;o.style.top=`${l.top-i.top+u}px`,o.style.width=`${r.w*l.width/e.naturalWidth}px`,o.style.height=`${r.h*l.height/e.naturalHeight}px`,o.innerHTML=r.btn||"",t.appendChild(o),o.style.fontSize=`${18*l.height/e.naturalHeight}px`,o.onclick=()=>{const f=r.scene||r.escena;this.goToScene(this.scenes[f])},r.tooltip!==void 0&&(o.onmouseover=()=>{o.innerHTML=r.tooltip||"",o.style.zIndex="100"},o.onmouseout=()=>{o.innerHTML=r.btn||"",o.style.zIndex="0"})}}typewriter(e,t){const n=t.text||t.texto||t.igramaText||"";let l=this.grammar?this.grammarRuleRecursion(n):n;if(l=l.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let i=0;const s=setInterval(()=>{const r=l.substring(0,i);e.innerHTML=r,i++,i>l.length&&(clearInterval(s),this.optionButtons(t))},Math.floor(this.options.typewriterSpeed))}else e.innerHTML=l,this.optionButtons(t)}optionButtons(e){const t=[...document.getElementsByClassName("storydiv")],n=t[t.length-1];[...document.getElementsByClassName("storybutton-container")].map(s=>s.remove());const i=document.createElement("div");if(i.className="storybutton-container",n.appendChild(i),e.options||e.opciones){const s=e.options||e.opciones;for(let r of s){const o=document.createElement("button");o.className="storybutton",o.innerHTML=r.btn,i.appendChild(o),o.addEventListener("click",()=>{if((r.text||r.texto)===void 0){const u=r.scene||r.escena;this.goToScene(this.scenes[u])}else this.goToScene(r)})}}else if(e.scene||e.escena){const s=e.scene||e.escena,r=document.createElement("button");r.className="storybutton",r.innerHTML=this.lang==="en"?"Continue":"Continuar",i.appendChild(r),r.addEventListener("click",()=>{this.goToScene(this.scenes[s])})}document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const l=Math.random()*e.prob.reduce((s,r)=>s+r);let i=0;for(let s=0;s<e.prob.length;s++){if(i<=l&&l<i+e.prob[s])return e[s];i+=e.prob[s]}}const t=Math.floor(Math.random()*e.length);return e[t]}getNestedObject(e,t){return t.reduce((n,l)=>n&&n[l]!==void 0?n[l]:void 0,e)}defineTransformations(e){let t={};const n=/#(?<trans>[\w\d,]+)#/gi.exec(e),l=n?n.groups.trans.match(/[\w]+/gi):[];for(let i of l)t[i]=!0;return t}transformString(e,t){let n=e;return t.CAPITALIZE&&(n=n.charAt(0).toUpperCase()+n.slice(1)),t.ALLCAPS&&(n=n.toUpperCase()),n}decodeDrawing(e){if(e==="")return[];const[t,n,l]=e.split("%%");let i={};return t==="vector"?i.content=n.split("**").map(s=>{const[r,o,c]=s.split("&"),u=[];if(u.color=r,u.weight=o,c===void 0)return u;const f=c.split(",");for(let d=0;d<f.length;d+=2)u.push([+f[d],+f[d+1]]);return u}):i.content=n,i.attribute=l,i.type=t,i}async getMarkovModel(e,t=1,n=!1){let l=await(await fetch(`./${e}`)).text();l=l.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const i=l.split(this.markovSeparator),s={};for(let o=0;o<i.length-t;o++){let c="";for(let f=0;f<t;f++)c+=f===0?i[o+f]:" "+i[o+f];s[c]===void 0&&(s[c]={});const u=i[o+t];s[c][u]===void 0?s[c][u]=1:s[c][u]++}const r={};for(let o of Object.keys(s)){const c=Object.keys(s[o]);r[o]={probs:[],grams:c};let u=0;for(let f=0;f<c.length;f++)u+=s[o][c[f]];for(let f=0;f<c.length;f++)r[o].probs[f]=s[o][c[f]]/u}if(n){const o=e.split("/");this.saveJSON(r,`${o[o.length-1]}_markovModel_${t}N.json`)}return r}markovChain(e,t,n=.1){let l=t===void 0||this.markov[t]===void 0?this.randomMarkovWord():t,i=l;for(let r=0;r<e-1;r++){let o=this.getNextMarkov(this.markov[i]);o===void 0&&(o=this.getNextMarkov(this.randomMarkovWord()));let c=i.split(this.markovSeparator);c.push(o),c=c.slice(1).join(" "),i=c,l+=` ${o}`}return this.formatMarkov(l,n)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const t=Math.random();let n=0;if(e!==void 0)for(let l=0;l<e.probs.length;l++){if(n<=t&&t<n+e.probs[l])return e.grams[l];n+=e.probs[l]}}formatMarkov(e,t=.1){let n=e.replace(/ ([,:.;])/g,"$1");return n=n.replaceAll(/([.]) ([\wáéíóú])/ig,(l,i,s,r,o)=>Math.random()<t?`.
${s.toUpperCase()}`:`. ${s.toUpperCase()}`),n.charAt(0).toUpperCase()+n.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),n.setAttribute("download",`${t.includes(".json")?t:t+".json"}`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}testScenes(e){const t=e||this.scenes;if(!t){const l=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(l)}let n=[];for(let l of Object.keys(t)){const i=t[l];if(i.options||i.opciones){const r=(i.options||i.opciones).filter(o=>!t[o.scene||o.escena]);n=[...n,...r.map(o=>`${l} => ${o.btn} => ${o.scene||o.escena}`)]}else{if(i.deadEnd||i.sinSalida)continue;t[i.scene||i.escena]||n.push(`${l} => ${i.scene||i.escena}`)}}if(n.length>0){const l=this.lang==="es"?`Las siguientes escenas no llevan a ning\xFAn lado: ${n.join(", ")}`:`The following scenes are dead ends: ${n.join(", ")}`;console.error(l),this.scenesError=!0}return this}testGrammar(e){const t=e||this.grammar;if(!t){const n=this.lang==="es"?"No hay gram\xE1tica para probar":"There is not grammar to test";console.error(n)}for(let n of Object.keys(t)){const l=t[n];for(let i of l){const s=i.match(/<([\w\d]+)>/gi),r=s?s.map(f=>f.replace(/[<>]/g,"")):[],o=i.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),c=o?o.map(f=>f.match(/([ ]?:[\w\d]+)/g).map(d=>/[ ]?:(?<key>[\w\d]+)/.exec(d).groups.key)).reduce((f,d)=>[...f,...d],[]):[],u=[...r,...c].filter(f=>!t[f]);if(u.length>0){const f=this.lang==="es"?`Las siguientes reglas, que se referencian en "${n}", no existen: ${u.join(", ")}`:`The following rules, referenced in "${n}", do not exist: ${u.join(", ")}`;this.grammarError=!0,console.error(f)}}}return this}testDistribution(e){const t=e||this.markov;if(t===void 0){const c=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(c)}const n={},l={};let i=0;const s=Object.values(t);for(let c of s)for(let u of c.probs){const f=(Math.round(u/.05)*.05).toFixed(2);l[i]=f,i++,n[f]===void 0?n[f]=1:n[f]++}console.log("------------------------------------ DIST ------------------------------------");const r=Math.max(...Object.values(n)),o=Object.entries(n).sort((c,u)=>c[0]>u[0]?1:c[0]<u[0]?-1:0);for(let c of o)console.log(`${c[0]}... ${"|".repeat(Math.ceil(c[1]*100/r))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,t="png",n){const l=await this.igramaDataUrl(e,t),i=new Image;i.src=l,n==null?document.body.appendChild(i):document.getElementById(n).appendChild(i)}async igramaDataUrl(e,t="png"){const n=this.igrama.metadata.width,l=this.igrama.metadata.height;let i=document.createElement("canvas");i.width=n,i.height=l;const s=i.getContext("2d");s.lineJoin="round",s.lineCap="round",s.fillStyle=this.igrama.metadata.bg||"#FFFFFF",s.fillRect(0,0,n,l),await this.drawLayers(e,s);let r;if(t==="png")r=i.toDataURL();else if(t==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener tambi\xE9n la librer\xEDa MiniGif":"To create Gifs you must have also the MiniGif library"),"";const o={colorResolution:7,dither:!1,delay:50};Object.assign(o,this.minigifOptions);const c=new MiniGif(o);c.addFrame(i);const u=this.getLayerWiggle(e);s.fillStyle=this.igrama.metadata.bg||"#FFFFFF",s.fillRect(0,0,n,l),await this.drawLayers(u,s),c.addFrame(i);const f=c.makeGif(),d=await this.base64_arraybuffer(f);r="data:image/gif;base64,"+d}return i.remove(),r}async base64_arraybuffer(e){return(await new Promise(n=>{const l=new FileReader;l.onload=()=>n(l.result),l.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const n=JSON.parse(JSON.stringify(e)),l=(i,s)=>Math.floor(i+Math.random()*(s-i));for(let[i,s]of n.entries())if(s.type==="vector")for(let[r,o]of s.content.entries()){for(let[c,u]of o.entries())Math.random()<.5?u[0]+=l(-3,3):u[1]+=l(-3,3);o.color=e[i].content[r].color,o.weight=e[i].content[r].weight}return n}getIgramaText(e){return e.map(n=>n.attribute).reverse().join(" ").trim()}async drawLayers(e,t){for(let[n,l]of e.entries())if(l.type==="url"){const{w:i,h:s,x:r,y:o}=this.igrama.sections[n];if(this.imgsMemo[l.content]===void 0){const c=new Image;c.src=l.content,this.imgsMemo[l.content]=await new Promise(u=>{c.addEventListener("load",()=>{u(c)},!1)})}t.drawImage(this.imgsMemo[l.content],r,o,i,s)}else if(l.type=="vector")for(let i of l.content){if(i.length===0)continue;const s=this.getSpline(i);this.drawSpline(s,t,i.color,i.weight)}}drawSpline(e,t,n,l){t.lineWidth=l,t.strokeStyle=n,t.fillStyle="rgba(0,0,0,0)",t.beginPath();for(let i=0;i<e.length;i++)i===0?t.moveTo(...e[0]):t.lineTo(...e[i]);t.stroke()}getSpline(e){let t=[];for(let n=0;n<e.length-1;n++){const l=[];l[0]=n>0?e[n-1]:e[0],l[1]=e[n],l[2]=e[n+1],l[3]=n<e.length-2?e[n+2]:e[e.length-1];for(let i=0;i<1;i+=.05){const s=this.getSplinePoint(i,l);t.push(s)}}return t}getSplinePoint(e,t){const n=Math.floor(e)+1,l=n+1,i=l+1,s=n-1,r=e*e,o=r*e,c=-o+2*r-e,u=3*o-5*r+2,f=-3*o+4*r+e,d=o-r,m=.5*(t[s][0]*c+t[n][0]*u+t[l][0]*f+t[i][0]*d),_=.5*(t[s][1]*c+t[n][1]*u+t[l][1]*f+t[i][1]*d);return[m,_]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=Yt,document.getElementsByTagName("head")[0].appendChild(e)}}const Yt=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 10px;
  flex-direction: column;
  box-sizing: border-box;
}

.storyp {
  font-size: 18px;
  min-height: 25px;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: white;
  border-radius: 4px;
  padding: 10px;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: black;
  color: white;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,Zt=Oe(Xt);function it(a,e,t){const n=a.slice();return n[17]=e[t],n}function rt(a,e,t){const n=a.slice();return n[17]=e[t],n}function lt(a,e){let t,n,l,i;function s(o){e[12](o)}let r={key:e[17]};return e[0]!==void 0&&(r.movingNode=e[0]),n=new Rt({props:r}),se.push(()=>fe(n,"movingNode",s)),{key:a,first:null,c(){t=Se(),oe(n.$$.fragment),this.h()},l(o){t=Se(),ie(n.$$.fragment,o),this.h()},h(){this.first=t},m(o,c){O(o,t,c),re(n,o,c),i=!0},p(o,c){e=o;const u={};c&8&&(u.key=e[17]),!l&&c&1&&(l=!0,u.movingNode=e[0],de(()=>l=!1)),n.$set(u)},i(o){i||(G(n.$$.fragment,o),i=!0)},o(o){X(n.$$.fragment,o),i=!1},d(o){o&&p(t),le(n,o)}}}function at(a,e){let t,n,l;return n=new Gt({props:{key:e[17],mouse:e[4]}}),{key:a,first:null,c(){t=Se(),oe(n.$$.fragment),this.h()},l(i){t=Se(),ie(n.$$.fragment,i),this.h()},h(){this.first=t},m(i,s){O(i,t,s),re(n,i,s),l=!0},p(i,s){e=i;const r={};s&8&&(r.key=e[17]),s&16&&(r.mouse=e[4]),n.$set(r)},i(i){l||(G(n.$$.fragment,i),l=!0)},o(i){X(n.$$.fragment,i),l=!1},d(i){i&&p(t),le(n,i)}}}function Qt(a){let e=[],t=new Map,n,l,i=[],s=new Map,r,o=a[3];const c=d=>d[17];for(let d=0;d<o.length;d+=1){let m=rt(a,o,d),_=c(m);t.set(_,e[d]=lt(_,m))}let u=a[3];const f=d=>d[17];for(let d=0;d<u.length;d+=1){let m=it(a,u,d),_=f(m);s.set(_,i[d]=at(_,m))}return{c(){for(let d=0;d<e.length;d+=1)e[d].c();n=L(),l=Ve("svg");for(let d=0;d<i.length;d+=1)i[d].c();this.h()},l(d){for(let _=0;_<e.length;_+=1)e[_].l(d);n=U(d),l=Ge(d,"svg",{class:!0});var m=N(l);for(let _=0;_<i.length;_+=1)i[_].l(m);m.forEach(p),this.h()},h(){b(l,"class","connections-container svelte-4kbf32")},m(d,m){for(let _=0;_<e.length;_+=1)e[_].m(d,m);O(d,n,m),O(d,l,m);for(let _=0;_<i.length;_+=1)i[_].m(l,null);r=!0},p(d,m){m&9&&(o=d[3],Te(),e=je(e,m,c,1,d,o,t,n.parentNode,Xe,lt,n,rt),Ce()),m&24&&(u=d[3],Te(),i=je(i,m,f,1,d,u,s,l,Xe,at,null,it),Ce())},i(d){if(!r){for(let m=0;m<o.length;m+=1)G(e[m]);for(let m=0;m<u.length;m+=1)G(i[m]);r=!0}},o(d){for(let m=0;m<e.length;m+=1)X(e[m]);for(let m=0;m<i.length;m+=1)X(i[m]);r=!1},d(d){for(let m=0;m<e.length;m+=1)e[m].d(d);d&&p(n),d&&p(l);for(let m=0;m<i.length;m+=1)i[m].d()}}}function $t(a){let e,t,n,l,i,s,r,o,c,u,f,d,m,_,I,z,A,g,v,T,M,D,B,F,Q,H,ae,$,W,te,K;function w(h){a[13](h)}function V(h){a[14](h)}let R={movingNode:a[0],$$slots:{default:[Qt,({offset:h})=>({16:h}),({offset:h})=>h?65536:0]},$$scope:{ctx:a}};return a[1]!==void 0&&(R.showNewScene=a[1]),a[4]!==void 0&&(R.mouse=a[4]),H=new xt({props:R}),se.push(()=>fe(H,"showNewScene",w)),se.push(()=>fe(H,"mouse",V)),{c(){e=k("input"),t=L(),n=k("div"),l=L(),i=k("div"),s=k("div"),r=k("div"),o=k("button"),c=q("Nuevo proyecto"),u=L(),f=k("label"),d=q("Importar"),m=L(),_=k("button"),I=q("Exportar"),z=L(),A=k("button"),g=q("Previsualizar"),v=L(),T=k("div"),M=k("button"),D=q("Nueva escena"),B=L(),F=k("div"),Q=k("div"),oe(H.$$.fragment),this.h()},l(h){e=E(h,"INPUT",{type:!0,id:!0}),t=U(h),n=E(h,"DIV",{class:!0,id:!0}),N(n).forEach(p),l=U(h),i=E(h,"DIV",{class:!0});var S=N(i);s=E(S,"DIV",{class:!0});var j=N(s);r=E(j,"DIV",{class:!0});var Z=N(r);o=E(Z,"BUTTON",{class:!0});var ee=N(o);c=x(ee,"Nuevo proyecto"),ee.forEach(p),u=U(Z),f=E(Z,"LABEL",{class:!0,for:!0});var ue=N(f);d=x(ue,"Importar"),ue.forEach(p),m=U(Z),_=E(Z,"BUTTON",{class:!0});var C=N(_);I=x(C,"Exportar"),C.forEach(p),z=U(Z),A=E(Z,"BUTTON",{class:!0});var J=N(A);g=x(J,"Previsualizar"),J.forEach(p),Z.forEach(p),v=U(j),T=E(j,"DIV",{class:!0});var ye=N(T);M=E(ye,"BUTTON",{class:!0});var _e=N(M);D=x(_e,"Nueva escena"),_e.forEach(p),ye.forEach(p),j.forEach(p),B=U(S),F=E(S,"DIV",{class:!0});var Ie=N(F);Q=E(Ie,"DIV",{class:!0});var ge=N(Q);ie(H.$$.fragment,ge),ge.forEach(p),Ie.forEach(p),S.forEach(p),this.h()},h(){b(e,"type","file"),b(e,"id","load-input"),e.hidden=!0,b(n,"class","test-story-container svelte-4kbf32"),b(n,"id","test-story-container"),b(o,"class","toolbar-button svelte-4kbf32"),b(f,"class","toolbar-button svelte-4kbf32"),b(f,"for","load-input"),b(_,"class","toolbar-button svelte-4kbf32"),b(A,"class","toolbar-button svelte-4kbf32"),b(r,"class","project-toolbar svelte-4kbf32"),b(M,"class","toolbar-button svelte-4kbf32"),b(T,"class","scene-toolbar svelte-4kbf32"),b(s,"class","toolbar svelte-4kbf32"),b(Q,"class","page-container svelte-4kbf32"),b(F,"class","static-page-container svelte-4kbf32"),b(i,"class","design-window-container svelte-4kbf32")},m(h,S){O(h,e,S),a[11](e),O(h,t,S),O(h,n,S),O(h,l,S),O(h,i,S),y(i,s),y(s,r),y(r,o),y(o,c),y(r,u),y(r,f),y(f,d),y(r,m),y(r,_),y(_,I),y(r,z),y(r,A),y(A,g),y(s,v),y(s,T),y(T,M),y(M,D),y(i,B),y(i,F),y(F,Q),re(H,Q,null),W=!0,te||(K=[P(e,"change",a[5]),P(o,"click",a[7]),P(_,"click",a[9]),P(A,"click",a[8]),P(M,"click",a[6])],te=!0)},p(h,[S]){const j={};S&1&&(j.movingNode=h[0]),S&4194329&&(j.$$scope={dirty:S,ctx:h}),!ae&&S&2&&(ae=!0,j.showNewScene=h[1],de(()=>ae=!1)),!$&&S&16&&($=!0,j.mouse=h[4],de(()=>$=!1)),H.$set(j)},i(h){W||(G(H.$$.fragment,h),W=!0)},o(h){X(H.$$.fragment,h),W=!1},d(h){h&&p(e),a[11](null),h&&p(t),h&&p(n),h&&p(l),h&&p(i),le(H),te=!1,Ne(K)}}}function en(a){a.scrollIntoView({block:"start"})}function tn(a,e){const t=document.createElement("a");t.href=URL.createObjectURL(new Blob([JSON.stringify(a,null,2)],{type:"application/json"})),t.setAttribute("download",`${e.includes(".json")?e:e+".json"}`),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function nn(a,e,t){let n,l,i,s;ne(a,Y,v=>t(10,i=v)),ne(a,Zt,v=>t(15,s=v));let r=!1,o=!1,c;function u(){const v=c.files[0];if(v.type==="application/json"){ce(Y,i={},i);const T=new FileReader;T.addEventListener("load",function(){const M=T.result,D=JSON.parse(M);ce(Y,i=D,i)}),this.value=null,T.readAsText(v);return}else alert("Formato de archivo incorrecto / incorrect file format")}function f(){t(1,o=!0)}function d(){ce(Y,i={},i)}function m(){console.log(i);const v=document.getElementById("storygeneraldiv");v&&v.remove();const T=new s("es"),M=Object.entries(i).sort((F,Q)=>F[1].display.y-Q[1].display.y);if(M.length===0){alert("No hay escenas / There are no scenes");return}T.setScenes(i).startAdventure(M[0][0]);const D=document.getElementById("test-story-container"),B=document.getElementById("storygeneraldiv");D.appendChild(B),en(B)}function _(){tn(i,"aventuraInteractiva")}function I(v){se[v?"unshift":"push"](()=>{c=v,t(2,c)})}function z(v){r=v,t(0,r)}function A(v){o=v,t(1,o)}function g(v){n=v,t(4,n)}return a.$$.update=()=>{a.$$.dirty&1024&&t(3,l=Object.keys(i))},t(4,n={x:0,y:0}),[r,o,c,l,n,u,f,d,m,_,i,I,z,A,g]}class sn extends pe{constructor(e){super(),me(this,e,nn,$t,he,{})}}function on(a){let e,t,n,l,i,s,r,o,c;return i=new sn({}),{c(){e=k("section"),t=k("h1"),n=q("Aventura interactiva (beta)"),l=L(),oe(i.$$.fragment),s=L(),r=k("footer"),o=q("Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.1b"),this.h()},l(u){e=E(u,"SECTION",{class:!0});var f=N(e);t=E(f,"H1",{class:!0});var d=N(t);n=x(d,"Aventura interactiva (beta)"),d.forEach(p),l=U(f),ie(i.$$.fragment,f),s=U(f),r=E(f,"FOOTER",{class:!0});var m=N(r);o=x(m,"Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.1b"),m.forEach(p),f.forEach(p),this.h()},h(){b(t,"class","svelte-aiip2m"),b(r,"class","svelte-aiip2m"),b(e,"class","svelte-aiip2m")},m(u,f){O(u,e,f),y(e,t),y(t,n),y(e,l),re(i,e,null),y(e,s),y(e,r),y(r,o),c=!0},p:ve,i(u){c||(G(i.$$.fragment,u),c=!0)},o(u){X(i.$$.fragment,u),c=!1},d(u){u&&p(e),le(i)}}}class an extends pe{constructor(e){super(),me(this,e,null,on,he,{})}}export{an as default};
