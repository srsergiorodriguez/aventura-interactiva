import{S as Se,i as Te,s as Oe,F as et,l as b,m as w,n as I,h,p as _,b as C,K as Ae,L as R,M as Ne,G as tt,H as st,I as nt,f as X,t as $,N as De,O as Ee,r as q,u as Y,J as g,E as Ue,a as D,c as U,P as Ze,Q as fe,w as de,x as pe,y as he,B as ge,R as ve,T as Ie,U as ye,V as ke,W as be,v as Re,e as Le,g as Pe,d as Ve,X as Ge,Y as Qe,Z as $e,_ as xe,k as Lt,$ as ft}from"../chunks/index-91fd3258.js";import{w as Bt,r as ze}from"../chunks/index-1c2f5156.js";const oe=Bt({inicio:{texto:"\xC9rase una vez un c\xEDrculo...",display:{ops:[],areas:[],x:40,y:40},opciones:[{btn:"dejar tranquilo",escena:"final1"},{btn:"aplastar",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{ops:[],areas:[],x:40,y:250}},final2:{texto:"Parece que la historia form\xF3 una elipsis",sinSalida:!0,display:{ops:[],areas:[],x:220,y:250}}}),Dt=ze(l=>l.scene===void 0&&l.escena!==void 0?"escena":"scene"),ot=ze(l=>l.options===void 0&&l.opciones!==void 0?"opciones":"options"),jt=ze(l=>l.text===void 0&&l.texto!==void 0?"texto":"text"),Ut=ze(l=>l.image===void 0&&l.imagen!==void 0?"imagen":"image");function Pt(l){let e,t,s,i;const o=l[5].default,n=et(o,l,l[4],null);return{c(){e=b("div"),n&&n.c(),this.h()},l(r){e=w(r,"DIV",{class:!0});var a=I(e);n&&n.l(a),a.forEach(h),this.h()},h(){_(e,"class","draggui svelte-1r8lyx3")},m(r,a){C(r,e,a),n&&n.m(e,null),t=!0,s||(i=[Ae(l[0].call(null,e)),Ae(l[1].call(null,e)),R(e,"mousedown",Ne(l[6]))],s=!0)},p(r,[a]){n&&n.p&&(!t||a&16)&&tt(n,o,r,r[4],t?nt(o,r[4],a,null):st(r[4]),null)},i(r){t||(X(n,r),t=!0)},o(r){$(n,r),t=!1},d(r){r&&h(e),n&&n.d(r),s=!1,De(i)}}}function Vt(l,e,t){let{$$slots:s={},$$scope:i}=e,{pos:o}=e,{displace:n={x:o.x,y:o.y}}=e;function r(u){u.style.left=`${n.x}px`,u.style.top=`${n.y}px`}function a(u){let c=!1;u.style.left=`${n.x}px`,u.style.top=`${n.y}px`,u.addEventListener("mousedown",()=>{c=!0}),window.addEventListener("mousemove",d=>{c&&(t(2,n.x+=d.movementX,n),t(2,n.y+=d.movementY,n),u.style.left=`${n.x}px`,u.style.top=`${n.y}px`,u.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{c=!1,u.style.cursor="grab"})}function f(u){Ee.call(this,l,u)}return l.$$set=u=>{"pos"in u&&t(3,o=u.pos),"displace"in u&&t(2,n=u.displace),"$$scope"in u&&t(4,i=u.$$scope)},[r,a,n,o,i,s,f]}class Fe extends Se{constructor(e){super(),Te(this,e,Vt,Pt,Oe,{pos:3,displace:2})}}function Rt(l){let e,t,s,i,o;return{c(){e=b("div"),t=b("button"),s=q("X"),this.h()},l(n){e=w(n,"DIV",{class:!0});var r=I(e);t=w(r,"BUTTON",{class:!0});var a=I(t);s=Y(a,"X"),a.forEach(h),r.forEach(h),this.h()},h(){_(t,"class","x-button"),_(e,"class","top-bar svelte-15bdkib")},m(n,r){C(n,e,r),g(e,t),g(t,s),i||(o=R(t,"click",l[0]),i=!0)},p:Ue,i:Ue,o:Ue,d(n){n&&h(e),i=!1,o()}}}function Gt(l,e,t){let{toggle:s}=e;function i(){t(1,s=!1)}return l.$$set=o=>{"toggle"in o&&t(1,s=o.toggle)},[i,s]}class He extends Se{constructor(e){super(),Te(this,e,Gt,Rt,Oe,{toggle:1})}}function ct(l){let e,t;return{c(){e=b("img"),this.h()},l(s){e=w(s,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Ze(e.src,t="")||_(e,"src",t),_(e,"alt","Preview"),_(e,"class","img-preview svelte-ekr4m4")},m(s,i){C(s,e,i),l[6](e)},p:Ue,d(s){s&&h(e),l[6](null)}}}function Kt(l){let e,t,s,i,o,n=l[2]&&ct(l);return{c(){e=b("input"),t=D(),s=b("div"),n&&n.c(),this.h()},l(r){e=w(r,"INPUT",{type:!0}),t=U(r),s=w(r,"DIV",{class:!0,id:!0});var a=I(s);n&&n.l(a),a.forEach(h),this.h()},h(){_(e,"type","file"),_(s,"class","image-preview-container svelte-ekr4m4"),_(s,"id","image-preview-container")},m(r,a){C(r,e,a),l[5](e),C(r,t,a),C(r,s,a),n&&n.m(s,null),i||(o=R(e,"change",l[3]),i=!0)},p(r,[a]){r[2]?n?n.p(r,a):(n=ct(r),n.c(),n.m(s,null)):n&&(n.d(1),n=null)},i:Ue,o:Ue,d(r){r&&h(e),l[5](null),r&&h(t),r&&h(s),n&&n.d(),i=!1,o()}}}function Wt(l,e,t){let{imageUrl:s}=e,i,o,n=!1;function r(){const u=i.files[0];if(u){t(2,n=!0);const c=new FileReader;c.addEventListener("load",function(){t(4,s=c.result),o.setAttribute("src",c.result)}),c.readAsDataURL(u);return}t(2,n=!1)}function a(u){fe[u?"unshift":"push"](()=>{i=u,t(0,i)})}function f(u){fe[u?"unshift":"push"](()=>{o=u,t(1,o)})}return l.$$set=u=>{"imageUrl"in u&&t(4,s=u.imageUrl)},[i,o,n,r,s,a,f]}class zt extends Se{constructor(e){super(),Te(this,e,Wt,Kt,Oe,{imageUrl:4})}}function Ft(l){let e,t,s,i,o,n,r,a,f,u,c,d,p,m,S,j,Z,v,E,W,G,P,L,F,Q,ne,ie,x,ee,se,B,le,re,J,z,T;function V(M){l[8](M)}let te={};l[0]!==void 0&&(te.toggle=l[0]),e=new He({props:te}),fe.push(()=>ye(e,"toggle",V));function _e(M){l[11](M)}let we={};return l[3]!==void 0&&(we.imageUrl=l[3]),x=new zt({props:we}),fe.push(()=>ye(x,"imageUrl",_e)),{c(){de(e.$$.fragment),s=D(),i=b("div"),o=b("h1"),n=q(l[1]),r=D(),a=b("div"),f=b("h2"),u=q("Texto"),c=D(),d=b("textarea"),p=D(),m=b("div"),S=b("h2"),j=q("Imagen (opcional)"),Z=D(),v=b("div"),E=b("label"),W=q("Url:"),G=D(),P=b("input"),L=q(`
    o
    `),F=b("div"),Q=b("span"),ne=q("Archivo:"),ie=D(),de(x.$$.fragment),se=D(),B=b("div"),le=b("button"),re=q("Aceptar"),this.h()},l(M){pe(e.$$.fragment,M),s=U(M),i=w(M,"DIV",{});var y=I(i);o=w(y,"H1",{class:!0});var N=I(o);n=Y(N,l[1]),N.forEach(h),y.forEach(h),r=U(M),a=w(M,"DIV",{});var O=I(a);f=w(O,"H2",{class:!0});var H=I(f);u=Y(H,"Texto"),H.forEach(h),c=U(O),d=w(O,"TEXTAREA",{class:!0}),I(d).forEach(h),O.forEach(h),p=U(M),m=w(M,"DIV",{});var A=I(m);S=w(A,"H2",{class:!0});var ue=I(S);j=Y(ue,"Imagen (opcional)"),ue.forEach(h),Z=U(A),v=w(A,"DIV",{});var Ce=I(v);E=w(Ce,"LABEL",{for:!0});var me=I(E);W=Y(me,"Url:"),me.forEach(h),G=U(Ce),P=w(Ce,"INPUT",{id:!0,type:!0}),Ce.forEach(h),L=Y(A,`
    o
    `),F=w(A,"DIV",{});var ce=I(F);Q=w(ce,"SPAN",{});var k=I(Q);ne=Y(k,"Archivo:"),k.forEach(h),ie=U(ce),pe(x.$$.fragment,ce),ce.forEach(h),se=U(A),B=w(A,"DIV",{class:!0});var K=I(B);le=w(K,"BUTTON",{});var ae=I(le);re=Y(ae,"Aceptar"),ae.forEach(h),K.forEach(h),A.forEach(h),this.h()},h(){_(o,"class","svelte-2p34te"),_(f,"class","no-select svelte-2p34te"),_(d,"class","svelte-2p34te"),_(S,"class","no-select svelte-2p34te"),_(E,"for","inp"),_(P,"id","inp"),_(P,"type","text"),_(B,"class","bar svelte-2p34te")},m(M,y){he(e,M,y),C(M,s,y),C(M,i,y),g(i,o),g(o,n),C(M,r,y),C(M,a,y),g(a,f),g(f,u),g(a,c),g(a,d),ke(d,l[4]),C(M,p,y),C(M,m,y),g(m,S),g(S,j),g(m,Z),g(m,v),g(v,E),g(E,W),g(v,G),g(v,P),ke(P,l[3]),g(m,L),g(m,F),g(F,Q),g(Q,ne),g(F,ie),he(x,F,null),g(m,se),g(m,B),g(B,le),g(le,re),J=!0,z||(T=[R(d,"input",l[9]),R(d,"mousedown",Ne(l[7])),R(P,"input",l[10]),R(P,"mousedown",Ne(l[6])),R(le,"click",l[5])],z=!0)},p(M,y){const N={};!t&&y&1&&(t=!0,N.toggle=M[0],be(()=>t=!1)),e.$set(N),(!J||y&2)&&Re(n,M[1]),y&16&&ke(d,M[4]),y&8&&P.value!==M[3]&&ke(P,M[3]);const O={};!ee&&y&8&&(ee=!0,O.imageUrl=M[3],be(()=>ee=!1)),x.$set(O)},i(M){J||(X(e.$$.fragment,M),X(x.$$.fragment,M),J=!0)},o(M){$(e.$$.fragment,M),$(x.$$.fragment,M),J=!1},d(M){ge(e,M),M&&h(s),M&&h(i),M&&h(r),M&&h(a),M&&h(p),M&&h(m),ge(x),z=!1,De(T)}}}function Ht(l){let e,t;return e=new Fe({props:{pos:l[2],$$slots:{default:[Ft]},$$scope:{ctx:l}}}),{c(){de(e.$$.fragment)},l(s){pe(e.$$.fragment,s)},m(s,i){he(e,s,i),t=!0},p(s,[i]){const o={};i&4&&(o.pos=s[2]),i&32795&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){t||(X(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){ge(e,s)}}}function Jt(l,e,t){let s,i;ve(l,oe,v=>t(12,i=v));let{key:o}=e,{pos:n}=e,{showEditor:r}=e,a=null,f=i[o];const u=f.text===void 0&&f.texto!==void 0?"texto":"text";function c(){Ie(oe,i[o][u]=s,i),a!==null&&Ie(oe,i[o].image=a,i),t(0,r=!1)}function d(v){Ee.call(this,l,v)}function p(v){Ee.call(this,l,v)}function m(v){r=v,t(0,r)}function S(){s=this.value,t(4,s),t(13,f)}function j(){a=this.value,t(3,a)}function Z(v){a=v,t(3,a)}return l.$$set=v=>{"key"in v&&t(1,o=v.key),"pos"in v&&t(2,n=v.pos),"showEditor"in v&&t(0,r=v.showEditor)},l.$$.update=()=>{l.$$.dirty&2&&Ie(oe,i[o]=f,i)},t(4,s=f[u]),[r,o,n,a,s,c,d,p,m,S,j,Z]}class Xt extends Se{constructor(e){super(),Te(this,e,Jt,Ht,Oe,{key:1,pos:2,showEditor:0})}}function qt(l){let e,t,s,i,o,n,r,a,f,u,c,d,p,m,S;function j(v){l[6](v)}let Z={};return l[0]!==void 0&&(Z.toggle=l[0]),e=new He({props:Z}),fe.push(()=>ye(e,"toggle",j)),{c(){de(e.$$.fragment),s=D(),i=b("div"),o=b("label"),n=q("Btn:"),r=D(),a=b("input"),f=D(),u=b("div"),c=b("button"),d=q("Aceptar"),this.h()},l(v){pe(e.$$.fragment,v),s=U(v),i=w(v,"DIV",{});var E=I(i);o=w(E,"LABEL",{for:!0});var W=I(o);n=Y(W,"Btn:"),W.forEach(h),r=U(E),a=w(E,"INPUT",{id:!0,type:!0}),E.forEach(h),f=U(v),u=w(v,"DIV",{class:!0});var G=I(u);c=w(G,"BUTTON",{});var P=I(c);d=Y(P,"Aceptar"),P.forEach(h),G.forEach(h),this.h()},h(){_(o,"for","inp"),_(a,"id","inp"),_(a,"type","text"),_(u,"class","bar svelte-1bhrmvp")},m(v,E){he(e,v,E),C(v,s,E),C(v,i,E),g(i,o),g(o,n),g(i,r),g(i,a),ke(a,l[2]),C(v,f,E),C(v,u,E),g(u,c),g(c,d),p=!0,m||(S=[R(a,"input",l[7]),R(a,"mousedown",Ne(l[5])),R(c,"click",l[3])],m=!0)},p(v,E){const W={};!t&&E&1&&(t=!0,W.toggle=v[0],be(()=>t=!1)),e.$set(W),E&4&&a.value!==v[2]&&ke(a,v[2])},i(v){p||(X(e.$$.fragment,v),p=!0)},o(v){$(e.$$.fragment,v),p=!1},d(v){ge(e,v),v&&h(s),v&&h(i),v&&h(f),v&&h(u),m=!1,De(S)}}}function Yt(l){let e,t;return e=new Fe({props:{pos:l[1],$$slots:{default:[qt]},$$scope:{ctx:l}}}),{c(){de(e.$$.fragment)},l(s){pe(e.$$.fragment,s)},m(s,i){he(e,s,i),t=!0},p(s,[i]){const o={};i&2&&(o.pos=s[1]),i&2053&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){t||(X(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){ge(e,s)}}}function Zt(l,e,t){let s,i,o;ve(l,oe,m=>t(8,i=m)),ve(l,ot,m=>t(9,o=m));let{key:n}=e,{pos:r}=e,{showNewOutput:a}=e;const f=o(i[n]);function u(){i[n][f]===void 0&&Ie(oe,i[n][f]=[],i),i[n][f].push({btn:s}),oe.set(i),t(0,a=!1)}function c(m){Ee.call(this,l,m)}function d(m){a=m,t(0,a)}function p(){s=this.value,t(2,s)}return l.$$set=m=>{"key"in m&&t(4,n=m.key),"pos"in m&&t(1,r=m.pos),"showNewOutput"in m&&t(0,a=m.showNewOutput)},t(2,s=""),[a,r,s,u,n,c,d,p]}class Qt extends Se{constructor(e){super(),Te(this,e,Zt,Yt,Oe,{key:4,pos:1,showNewOutput:0})}}function $t(l){let e,t,s,i;const o=l[5].default,n=et(o,l,l[4],null);return{c(){e=b("div"),n&&n.c(),this.h()},l(r){e=w(r,"DIV",{class:!0});var a=I(e);n&&n.l(a),a.forEach(h),this.h()},h(){_(e,"class","scene-node-container svelte-14kdql5")},m(r,a){C(r,e,a),n&&n.m(e,null),t=!0,s||(i=Ae(l[0].call(null,e)),s=!0)},p(r,[a]){n&&n.p&&(!t||a&16)&&tt(n,o,r,r[4],t?nt(o,r[4],a,null):st(r[4]),null)},i(r){t||(X(n,r),t=!0)},o(r){$(n,r),t=!1},d(r){r&&h(e),n&&n.d(r),s=!1,i()}}}function xt(l,e,t){let s;ve(l,oe,u=>t(3,s=u));let{$$slots:i={},$$scope:o}=e,{key:n}=e,{movingNode:r=!1}=e,a=s[n];a.display===void 0&&(a.display={x:0,y:0,ops:[]});function f(u){let c=!1;u.style.left=`${a.display.x}px`,u.style.top=`${a.display.y}px`,u.addEventListener("mousedown",()=>{c=!0,t(1,r=!0)}),window.addEventListener("mousemove",d=>{c&&(a.display.x+=d.movementX,a.display.y+=d.movementY,u.style.left=`${a.display.x}px`,u.style.top=`${a.display.y}px`,Ie(oe,s[n]=a,s))}),window.addEventListener("mouseup",()=>{c=!1,t(1,r=!1)})}return l.$$set=u=>{"key"in u&&t(2,n=u.key),"movingNode"in u&&t(1,r=u.movingNode),"$$scope"in u&&t(4,o=u.$$scope)},l.$$.update=()=>{l.$$.dirty&12&&(a=s[n])},[f,r,n,s,o,i]}class es extends Se{constructor(e){super(),Te(this,e,xt,$t,Oe,{key:2,movingNode:1})}}function dt(l){let e,t,s,i;return{c(){e=b("div"),t=q(l[8]),this.h()},l(o){e=w(o,"DIV",{class:!0});var n=I(e);t=Y(n,l[8]),n.forEach(h),this.h()},h(){_(e,"class","area svelte-ca4d4l")},m(o,n){C(o,e,n),g(e,t),l[23](e),s||(i=R(e,"mousedown",Ne(l[14])),s=!0)},p(o,n){n&256&&Re(t,o[8])},d(o){o&&h(e),l[23](null),s=!1,i()}}}function ts(l){let e,t,s,i,o,n,r,a,f,u,c,d,p,m,S,j,Z,v,E,W,G,P,L,F,Q,ne,ie,x,ee,se,B,le,re,J,z,T,V,te,_e;function we(N){l[18](N)}let M={};l[0]!==void 0&&(M.toggle=l[0]),e=new He({props:M}),fe.push(()=>ye(e,"toggle",we));let y=l[5]&&dt(l);return{c(){de(e.$$.fragment),s=D(),i=b("div"),o=b("h1"),n=q(l[1]),r=D(),a=b("div"),f=b("div"),u=b("h2"),c=q("Nombre de referencia"),d=D(),p=b("input"),m=D(),S=b("div"),j=b("h2"),Z=q("Btn"),v=D(),E=b("input"),W=D(),G=b("div"),P=b("h2"),L=q("Tooltip"),F=D(),Q=b("input"),ne=D(),ie=b("div"),x=b("div"),ee=b("div"),se=b("img"),le=D(),y&&y.c(),re=D(),J=b("div"),z=b("button"),T=q("Aceptar"),this.h()},l(N){pe(e.$$.fragment,N),s=U(N),i=w(N,"DIV",{});var O=I(i);o=w(O,"H1",{class:!0});var H=I(o);n=Y(H,l[1]),H.forEach(h),O.forEach(h),r=U(N),a=w(N,"DIV",{class:!0});var A=I(a);f=w(A,"DIV",{class:!0});var ue=I(f);u=w(ue,"H2",{class:!0});var Ce=I(u);c=Y(Ce,"Nombre de referencia"),Ce.forEach(h),d=U(ue),p=w(ue,"INPUT",{}),ue.forEach(h),m=U(A),S=w(A,"DIV",{class:!0});var me=I(S);j=w(me,"H2",{class:!0});var ce=I(j);Z=Y(ce,"Btn"),ce.forEach(h),v=U(me),E=w(me,"INPUT",{}),me.forEach(h),W=U(A),G=w(A,"DIV",{class:!0});var k=I(G);P=w(k,"H2",{class:!0});var K=I(P);L=Y(K,"Tooltip"),K.forEach(h),F=U(k),Q=w(k,"INPUT",{}),k.forEach(h),A.forEach(h),ne=U(N),ie=w(N,"DIV",{});var ae=I(ie);x=w(ae,"DIV",{class:!0});var Ke=I(x);ee=w(Ke,"DIV",{class:!0});var Me=I(ee);se=w(Me,"IMG",{src:!0,alt:!0,class:!0}),le=U(Me),y&&y.l(Me),Me.forEach(h),Ke.forEach(h),ae.forEach(h),re=U(N),J=w(N,"DIV",{class:!0});var Be=I(J);z=w(Be,"BUTTON",{});var We=I(z);T=Y(We,"Aceptar"),We.forEach(h),Be.forEach(h),this.h()},h(){_(o,"class","svelte-ca4d4l"),_(u,"class","svelte-ca4d4l"),_(f,"class","input"),_(j,"class","svelte-ca4d4l"),_(S,"class","input"),_(P,"class","svelte-ca4d4l"),_(G,"class","input"),_(a,"class","inputs svelte-ca4d4l"),Ze(se.src,B=l[9][l[10]])||_(se,"src",B),_(se,"alt","Preview"),_(se,"class","img-preview svelte-ca4d4l"),_(ee,"class","area-container svelte-ca4d4l"),_(x,"class","area-absolute-container svelte-ca4d4l"),_(J,"class","bar svelte-ca4d4l")},m(N,O){he(e,N,O),C(N,s,O),C(N,i,O),g(i,o),g(o,n),C(N,r,O),C(N,a,O),g(a,f),g(f,u),g(u,c),g(f,d),g(f,p),ke(p,l[6]),g(a,m),g(a,S),g(S,j),g(j,Z),g(S,v),g(S,E),ke(E,l[8]),g(a,W),g(a,G),g(G,P),g(P,L),g(G,F),g(G,Q),ke(Q,l[7]),C(N,ne,O),C(N,ie,O),g(ie,x),g(x,ee),g(ee,se),l[22](se),g(ee,le),y&&y.m(ee,null),C(N,re,O),C(N,J,O),g(J,z),g(z,T),V=!0,te||(_e=[R(p,"input",l[19]),R(p,"mousedown",Ne(l[17])),R(E,"input",l[20]),R(E,"mousedown",Ne(l[16])),R(Q,"input",l[21]),R(Q,"mousedown",Ne(l[15])),Ae(l[11].call(null,se)),R(x,"mousedown",Ne(l[13])),R(z,"click",l[12])],te=!0)},p(N,O){const H={};!t&&O&1&&(t=!0,H.toggle=N[0],be(()=>t=!1)),e.$set(H),(!V||O&2)&&Re(n,N[1]),O&64&&p.value!==N[6]&&ke(p,N[6]),O&256&&E.value!==N[8]&&ke(E,N[8]),O&128&&Q.value!==N[7]&&ke(Q,N[7]),N[5]?y?y.p(N,O):(y=dt(N),y.c(),y.m(ee,null)):y&&(y.d(1),y=null)},i(N){V||(X(e.$$.fragment,N),V=!0)},o(N){$(e.$$.fragment,N),V=!1},d(N){ge(e,N),N&&h(s),N&&h(i),N&&h(r),N&&h(a),N&&h(ne),N&&h(ie),l[22](null),y&&y.d(),N&&h(re),N&&h(J),te=!1,De(_e)}}}function ss(l){let e,t;return e=new Fe({props:{pos:l[2],$$slots:{default:[ts]},$$scope:{ctx:l}}}),{c(){de(e.$$.fragment)},l(s){pe(e.$$.fragment,s)},m(s,i){he(e,s,i),t=!0},p(s,[i]){const o={};i&4&&(o.pos=s[2]),i&268435963&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){t||(X(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){ge(e,s)}}}function ns(l,e,t){let s,i,o,n,r;ve(l,oe,B=>t(25,n=B)),ve(l,Ut,B=>t(26,r=B));let{key:a}=e,{pos:f}=e,{showNewArea:u}=e,c,d=n[a];const p=r(d);let m={},S,j;function Z(B){let le=!1;B.addEventListener("mousedown",J=>{J.preventDefault(),le=!0,t(5,j={x1:J.offsetX,y1:J.offsetY,x2:J.offsetX,y2:J.offsetY})}),B.addEventListener("mousemove",J=>{le&&v(J)}),B.addEventListener("mouseup",J=>{re(J)}),B.addEventListener("mouseout",J=>{re(J)});function re(J){if(j===void 0||!le)return;le=!1;const z=v(J),T={};for(let V of Object.keys(z))T[V]=Math.floor(z[V]*c.naturalWidth/c.width);Object.assign(m,{...T}),m.x=Math.floor(T.x+T.w/2),m.y=Math.floor(T.y+T.h/2)}}function v(B){t(5,j.x2=B.offsetX,j),t(5,j.y2=B.offsetY,j);const le=Math.min(j.x1,j.x2),re=Math.max(j.x1,j.x2),J=Math.min(j.y1,j.y2),z=Math.max(j.y1,j.y2),T={x:le,y:J,w:re-le,h:z-J};return t(4,S.style.width=`${T.w}px`,S),t(4,S.style.height=`${T.h}px`,S),t(4,S.style.top=`${T.y}px`,S),t(4,S.style.left=`${T.x}px`,S),T}function E(){if(m===void 0){alert("debes escoger un area / you must choose an area");return}Object.assign(m,{btn:s,tooltip:i,name:o}),n[a].areas===void 0&&Ie(oe,n[a].areas=[],n),n[a].areas.push(m),oe.set(n),t(0,u=!1)}function W(B){Ee.call(this,l,B)}function G(B){Ee.call(this,l,B)}function P(B){Ee.call(this,l,B)}function L(B){Ee.call(this,l,B)}function F(B){Ee.call(this,l,B)}function Q(B){u=B,t(0,u)}function ne(){o=this.value,t(6,o)}function ie(){s=this.value,t(8,s)}function x(){i=this.value,t(7,i)}function ee(B){fe[B?"unshift":"push"](()=>{c=B,t(3,c)})}function se(B){fe[B?"unshift":"push"](()=>{S=B,t(4,S)})}return l.$$set=B=>{"key"in B&&t(1,a=B.key),"pos"in B&&t(2,f=B.pos),"showNewArea"in B&&t(0,u=B.showNewArea)},t(8,s=""),t(7,i=""),t(6,o="area"),[u,a,f,c,S,j,o,i,s,d,p,Z,E,W,G,P,L,F,Q,ne,ie,x,ee,se]}class os extends Se{constructor(e){super(),Te(this,e,ns,ss,Oe,{key:1,pos:2,showNewArea:0})}}function pt(l,e,t){const s=l.slice();return s[39]=e[t],s[41]=t,s}function ht(l,e,t){const s=l.slice();return s[42]=e[t],s[41]=t,s}function gt(l){let e,t,s,i,o;return{c(){e=b("div"),t=b("img"),this.h()},l(n){e=w(n,"DIV",{class:!0});var r=I(e);t=w(r,"IMG",{src:!0,alt:!0,class:!0}),r.forEach(h),this.h()},h(){Ze(t.src,s=l[2][l[8]])||_(t,"src",s),_(t,"alt","Preview"),_(t,"class","img-preview svelte-ank1gn"),_(e,"class","img-preview-container svelte-ank1gn")},m(n,r){C(n,e,r),g(e,t),i||(o=R(t,"load",l[14]),i=!0)},p(n,r){r[0]&4&&!Ze(t.src,s=n[2][n[8]])&&_(t,"src",s)},d(n){n&&h(e),i=!1,o()}}}function mt(l){let e,t,s,i,o,n,r,a,f,u,c,d;return{c(){e=b("div"),t=b("span"),s=q("\xE1rea"),i=D(),o=b("div"),n=b("button"),r=q("-"),a=D(),f=b("button"),u=q("+"),this.h()},l(p){e=w(p,"DIV",{});var m=I(e);t=w(m,"SPAN",{class:!0});var S=I(t);s=Y(S,"\xE1rea"),S.forEach(h),i=U(m),o=w(m,"DIV",{class:!0});var j=I(o);n=w(j,"BUTTON",{class:!0});var Z=I(n);r=Y(Z,"-"),Z.forEach(h),a=U(j),f=w(j,"BUTTON",{class:!0});var v=I(f);u=Y(v,"+"),v.forEach(h),j.forEach(h),m.forEach(h),this.h()},h(){_(t,"class","btns-name svelte-ank1gn"),_(n,"class","svelte-ank1gn"),_(f,"class","svelte-ank1gn"),_(o,"class","node-btns-div svelte-ank1gn")},m(p,m){C(p,e,m),g(e,t),g(t,s),g(e,i),g(e,o),g(o,n),g(n,r),g(o,a),g(o,f),g(f,u),c||(d=[R(n,"click",l[18]),R(f,"click",l[22])],c=!0)},p:Ue,d(p){p&&h(e),c=!1,De(d)}}}function _t(l,e){let t,s,i,o,n,r,a,f,u;return{key:l,first:null,c(){t=b("div"),s=b("input"),n=D(),r=b("div"),this.h()},l(c){t=w(c,"DIV",{class:!0});var d=I(t);s=w(d,"INPUT",{type:!0,class:!0,i:!0}),n=U(d),r=w(d,"DIV",{type:!0,class:!0,i:!0}),I(r).forEach(h),d.forEach(h),this.h()},h(){_(s,"type","text"),_(s,"class","output-text svelte-ank1gn"),s.value=i=e[42].btn,_(s,"i",o=e[41]),_(r,"type","ops"),_(r,"class","connection output option-connection svelte-ank1gn"),_(r,"i",a=e[41]),_(t,"class","output-container svelte-ank1gn"),this.first=t},m(c,d){C(c,t,d),g(t,s),g(t,n),g(t,r),f||(u=[Ae(e[11].call(null,s)),R(s,"change",e[10]),R(s,"mousedown",Ne(e[26])),Ae(e[12].call(null,r)),Ae(e[15].call(null,r)),R(r,"mousedown",Ne(e[25]))],f=!0)},p(c,d){e=c,d[0]&4&&i!==(i=e[42].btn)&&s.value!==i&&(s.value=i),d[0]&4&&o!==(o=e[41])&&_(s,"i",o),d[0]&4&&a!==(a=e[41])&&_(r,"i",a)},d(c){c&&h(t),f=!1,De(u)}}}function vt(l,e){let t,s,i=e[39].name+"",o,n,r,a,f,u,c;return{key:l,first:null,c(){t=b("div"),s=b("span"),o=q(i),n=D(),r=b("div"),f=D(),this.h()},l(d){t=w(d,"DIV",{class:!0});var p=I(t);s=w(p,"SPAN",{class:!0});var m=I(s);o=Y(m,i),m.forEach(h),n=U(p),r=w(p,"DIV",{type:!0,class:!0,i:!0}),I(r).forEach(h),f=U(p),p.forEach(h),this.h()},h(){_(s,"class","output-text svelte-ank1gn"),_(r,"type","areas"),_(r,"class","connection output area-connection svelte-ank1gn"),_(r,"i",a=e[41]),_(t,"class","output-container svelte-ank1gn"),this.first=t},m(d,p){C(d,t,p),g(t,s),g(s,o),g(t,n),g(t,r),g(t,f),u||(c=[Ae(e[13].call(null,r)),Ae(e[15].call(null,r)),R(r,"mousedown",Ne(e[24]))],u=!0)},p(d,p){e=d,p[0]&4&&i!==(i=e[39].name+"")&&Re(o,i),p[0]&4&&a!==(a=e[41])&&_(r,"i",a)},d(d){d&&h(t),u=!1,De(c)}}}function ls(l){let e,t,s,i,o,n,r,a,f,u=(l[2][l[9]].length<210?l[2][l[9]]:l[2][l[9]].slice(0,210)+"...")+"",c,d,p,m,S,j,Z,v,E,W,G,P,L,F,Q,ne,ie,x,ee,se,B,le,re,J,z,T,V,te=[],_e=new Map,we,M=[],y=new Map,N,O,H=l[2][l[8]]!==void 0&&l[2][l[8]]!==null&&gt(l),A=l[2][l[8]]!==void 0&&l[2][l[8]]!==null&&mt(l),ue=l[2][l[7]]||[];const Ce=k=>"op"+k[41];for(let k=0;k<ue.length;k+=1){let K=ht(l,ue,k),ae=Ce(K);_e.set(ae,te[k]=_t(ae,K))}let me=l[2].areas||[];const ce=k=>"a"+k[41];for(let k=0;k<me.length;k+=1){let K=pt(l,me,k),ae=ce(K);y.set(ae,M[k]=vt(ae,K))}return{c(){e=b("div"),t=D(),s=b("h1"),i=q("Escena: "),o=q(l[1]),n=D(),H&&H.c(),r=D(),a=b("div"),f=b("p"),c=q(u),d=D(),p=b("div"),m=b("div"),S=b("span"),j=q("escena"),Z=D(),v=b("div"),E=b("button"),W=q("editar"),G=D(),P=b("button"),L=q("x"),F=D(),Q=b("div"),ne=b("span"),ie=q("btn"),x=D(),ee=b("div"),se=b("button"),B=q("-"),le=D(),re=b("button"),J=q("+"),z=D(),A&&A.c(),T=D(),V=b("div");for(let k=0;k<te.length;k+=1)te[k].c();we=D();for(let k=0;k<M.length;k+=1)M[k].c();this.h()},l(k){e=w(k,"DIV",{class:!0}),I(e).forEach(h),t=U(k),s=w(k,"H1",{class:!0});var K=I(s);i=Y(K,"Escena: "),o=Y(K,l[1]),K.forEach(h),n=U(k),H&&H.l(k),r=U(k),a=w(k,"DIV",{class:!0});var ae=I(a);f=w(ae,"P",{class:!0});var Ke=I(f);c=Y(Ke,u),Ke.forEach(h),ae.forEach(h),d=U(k),p=w(k,"DIV",{class:!0});var Me=I(p);m=w(Me,"DIV",{});var Be=I(m);S=w(Be,"SPAN",{class:!0});var We=I(S);j=Y(We,"escena"),We.forEach(h),Z=U(Be),v=w(Be,"DIV",{class:!0});var Je=I(v);E=w(Je,"BUTTON",{class:!0});var lt=I(E);W=Y(lt,"editar"),lt.forEach(h),G=U(Je),P=w(Je,"BUTTON",{class:!0});var it=I(P);L=Y(it,"x"),it.forEach(h),Je.forEach(h),Be.forEach(h),F=U(Me),Q=w(Me,"DIV",{});var Xe=I(Q);ne=w(Xe,"SPAN",{class:!0});var rt=I(ne);ie=Y(rt,"btn"),rt.forEach(h),x=U(Xe),ee=w(Xe,"DIV",{class:!0});var qe=I(ee);se=w(qe,"BUTTON",{class:!0});var at=I(se);B=Y(at,"-"),at.forEach(h),le=U(qe),re=w(qe,"BUTTON",{class:!0});var ut=I(re);J=Y(ut,"+"),ut.forEach(h),qe.forEach(h),Xe.forEach(h),z=U(Me),A&&A.l(Me),Me.forEach(h),T=U(k),V=w(k,"DIV",{class:!0});var Ye=I(V);for(let je=0;je<te.length;je+=1)te[je].l(Ye);we=U(Ye);for(let je=0;je<M.length;je+=1)M[je].l(Ye);Ye.forEach(h),this.h()},h(){_(e,"class","connection input svelte-ank1gn"),_(s,"class","svelte-ank1gn"),_(f,"class","text-p svelte-ank1gn"),_(a,"class","p-container svelte-ank1gn"),_(S,"class","btns-name svelte-ank1gn"),_(E,"class","svelte-ank1gn"),_(P,"class","svelte-ank1gn"),_(v,"class","node-btns-div svelte-ank1gn"),_(ne,"class","btns-name svelte-ank1gn"),_(se,"class","svelte-ank1gn"),_(re,"class","svelte-ank1gn"),_(ee,"class","node-btns-div svelte-ank1gn"),_(p,"class","node-btns svelte-ank1gn"),_(V,"class","node-outputs svelte-ank1gn")},m(k,K){C(k,e,K),C(k,t,K),C(k,s,K),g(s,i),g(s,o),C(k,n,K),H&&H.m(k,K),C(k,r,K),C(k,a,K),g(a,f),g(f,c),C(k,d,K),C(k,p,K),g(p,m),g(m,S),g(S,j),g(m,Z),g(m,v),g(v,E),g(E,W),g(v,G),g(v,P),g(P,L),g(p,F),g(p,Q),g(Q,ne),g(ne,ie),g(Q,x),g(Q,ee),g(ee,se),g(se,B),g(ee,le),g(ee,re),g(re,J),g(p,z),A&&A.m(p,null),C(k,T,K),C(k,V,K);for(let ae=0;ae<te.length;ae+=1)te[ae].m(V,null);g(V,we);for(let ae=0;ae<M.length;ae+=1)M[ae].m(V,null);l[28](V),N||(O=[R(e,"mousedown",Ne(l[27])),R(e,"click",l[16]),R(E,"click",l[20]),R(P,"click",l[19]),R(se,"click",l[17]),R(re,"click",l[21])],N=!0)},p(k,K){K[0]&2&&Re(o,k[1]),k[2][k[8]]!==void 0&&k[2][k[8]]!==null?H?H.p(k,K):(H=gt(k),H.c(),H.m(r.parentNode,r)):H&&(H.d(1),H=null),K[0]&4&&u!==(u=(k[2][k[9]].length<210?k[2][k[9]]:k[2][k[9]].slice(0,210)+"...")+"")&&Re(c,u),k[2][k[8]]!==void 0&&k[2][k[8]]!==null?A?A.p(k,K):(A=mt(k),A.c(),A.m(p,null)):A&&(A.d(1),A=null),K[0]&1156&&(ue=k[2][k[7]]||[],te=Ge(te,K,Ce,1,k,ue,_e,V,Qe,_t,we,ht)),K[0]&4&&(me=k[2].areas||[],M=Ge(M,K,ce,1,k,me,y,V,Qe,vt,null,pt))},d(k){k&&h(e),k&&h(t),k&&h(s),k&&h(n),H&&H.d(k),k&&h(r),k&&h(a),k&&h(d),k&&h(p),A&&A.d(),k&&h(T),k&&h(V);for(let K=0;K<te.length;K+=1)te[K].d();for(let K=0;K<M.length;K+=1)M[K].d();l[28](null),N=!1,De(O)}}}function yt(l){let e,t,s;function i(n){l[30](n)}let o={key:l[1],pos:l[2].display};return l[4]!==void 0&&(o.showEditor=l[4]),e=new Xt({props:o}),fe.push(()=>ye(e,"showEditor",i)),{c(){de(e.$$.fragment)},l(n){pe(e.$$.fragment,n)},m(n,r){he(e,n,r),s=!0},p(n,r){const a={};r[0]&2&&(a.key=n[1]),r[0]&4&&(a.pos=n[2].display),!t&&r[0]&16&&(t=!0,a.showEditor=n[4],be(()=>t=!1)),e.$set(a)},i(n){s||(X(e.$$.fragment,n),s=!0)},o(n){$(e.$$.fragment,n),s=!1},d(n){ge(e,n)}}}function bt(l){let e,t,s;function i(n){l[31](n)}let o={key:l[1],pos:l[2].display};return l[5]!==void 0&&(o.showNewOutput=l[5]),e=new Qt({props:o}),fe.push(()=>ye(e,"showNewOutput",i)),{c(){de(e.$$.fragment)},l(n){pe(e.$$.fragment,n)},m(n,r){he(e,n,r),s=!0},p(n,r){const a={};r[0]&2&&(a.key=n[1]),r[0]&4&&(a.pos=n[2].display),!t&&r[0]&32&&(t=!0,a.showNewOutput=n[5],be(()=>t=!1)),e.$set(a)},i(n){s||(X(e.$$.fragment,n),s=!0)},o(n){$(e.$$.fragment,n),s=!1},d(n){ge(e,n)}}}function wt(l){let e,t,s;function i(n){l[32](n)}let o={key:l[1],pos:l[2].display};return l[6]!==void 0&&(o.showNewArea=l[6]),e=new os({props:o}),fe.push(()=>ye(e,"showNewArea",i)),{c(){de(e.$$.fragment)},l(n){pe(e.$$.fragment,n)},m(n,r){he(e,n,r),s=!0},p(n,r){const a={};r[0]&2&&(a.key=n[1]),r[0]&4&&(a.pos=n[2].display),!t&&r[0]&64&&(t=!0,a.showNewArea=n[6],be(()=>t=!1)),e.$set(a)},i(n){s||(X(e.$$.fragment,n),s=!0)},o(n){$(e.$$.fragment,n),s=!1},d(n){ge(e,n)}}}function is(l){let e,t,s,i,o,n,r;function a(p){l[29](p)}let f={key:l[1],$$slots:{default:[ls]},$$scope:{ctx:l}};l[0]!==void 0&&(f.movingNode=l[0]),e=new es({props:f}),fe.push(()=>ye(e,"movingNode",a));let u=l[4]&&yt(l),c=l[5]&&bt(l),d=l[6]&&wt(l);return{c(){de(e.$$.fragment),s=D(),u&&u.c(),i=D(),c&&c.c(),o=D(),d&&d.c(),n=Le()},l(p){pe(e.$$.fragment,p),s=U(p),u&&u.l(p),i=U(p),c&&c.l(p),o=U(p),d&&d.l(p),n=Le()},m(p,m){he(e,p,m),C(p,s,m),u&&u.m(p,m),C(p,i,m),c&&c.m(p,m),C(p,o,m),d&&d.m(p,m),C(p,n,m),r=!0},p(p,m){const S={};m[0]&2&&(S.key=p[1]),m[0]&14|m[1]&8192&&(S.$$scope={dirty:m,ctx:p}),!t&&m[0]&1&&(t=!0,S.movingNode=p[0],be(()=>t=!1)),e.$set(S),p[4]?u?(u.p(p,m),m[0]&16&&X(u,1)):(u=yt(p),u.c(),X(u,1),u.m(i.parentNode,i)):u&&(Pe(),$(u,1,1,()=>{u=null}),Ve()),p[5]?c?(c.p(p,m),m[0]&32&&X(c,1)):(c=bt(p),c.c(),X(c,1),c.m(o.parentNode,o)):c&&(Pe(),$(c,1,1,()=>{c=null}),Ve()),p[6]?d?(d.p(p,m),m[0]&64&&X(d,1)):(d=wt(p),d.c(),X(d,1),d.m(n.parentNode,n)):d&&(Pe(),$(d,1,1,()=>{d=null}),Ve())},i(p){r||(X(e.$$.fragment,p),X(u),X(c),X(d),r=!0)},o(p){$(e.$$.fragment,p),$(u),$(c),$(d),r=!1},d(p){ge(e,p),p&&h(s),u&&u.d(p),p&&h(i),c&&c.d(p),p&&h(o),d&&d.d(p),p&&h(n)}}}function rs(l,e,t){let s,i,o,n,r;ve(l,oe,y=>t(23,s=y)),ve(l,Dt,y=>t(33,i=y)),ve(l,ot,y=>t(34,o=y)),ve(l,jt,y=>t(35,n=y)),ve(l,Ut,y=>t(36,r=y));let{key:a}=e,{movingNode:f=!1}=e,u=s[a];const c=o(u),d=r(u),p=n(u);let m,S=!1,j=!1,Z=!1;u.display===void 0&&(u.display={x:0,y:0,ops:[],areas:[]}),u.display.areas===void 0&&(u.display.areas=[]);function v(){E(this)}function E(y){const N=+y.getAttribute("i");y.style.width=y.value.length*6.1+"px",t(2,u[c][N].btn=y.value,u),L()}function W(y){P(y,"ops")}function G(y){P(y,"areas")}function P(y,N){const O=+y.getAttribute("i");u.display[N][O]===void 0?t(2,u.display[N][O]={x:y.offsetLeft,y:y.offsetTop,rewiring:!1},u):Object.assign(u.display[N][O],{x:y.offsetLeft,y:y.offsetTop}),Ie(oe,s[a]=u,s)}function L(){if(m===void 0)return;const y=m.getElementsByClassName("output");for(let N of y)P(N,N.getAttribute("type"))}function F(){const y=Object.keys(s);for(let N of y){const O=s[N],H=o(O);for(let A=0;A<O.display.ops.length;A++){const ue=i(O[H][A]);O.display.ops[A].rewiring&&(O.display.ops[A].rewiring=!1,O[H][A][ue]=O.display.ops[A].prevWiring)}for(let A=0;A<O.display.areas.length;A++){const ue=i(O[H][A]);O.display.areas[A].rewiring&&(O.display.areas[A].rewiring=!1,O.areas[A][ue]=O.display.areas[A].prevWiring)}Ie(oe,s[N]=O,s)}}function Q(y){const N=+y.getAttribute("i"),O=y.getAttribute("type"),H=O==="ops"?c:"areas";y.addEventListener("click",()=>{F();const A=i(u[H][N]);u.display[O][N].rewiring||(t(2,u.display[O][N].prevWiring=u[H][N][A],u),t(2,u.display[O][N].rewiring=!0,u),t(2,u[H][N][A]=void 0,u))})}function ne(){const y=Object.keys(s);let N,O;for(let Ce of y){const me=s[Ce];for(let ce=0;ce<me.display.ops.length;ce++){const k=me.display.ops[ce];k.rewiring&&(k.rewiring=!1,N={scene:me,i:ce},O="ops")}for(let ce=0;ce<me.display.areas.length;ce++){const k=me.display.areas[ce];k.rewiring&&(k.rewiring=!1,N={scene:me,i:ce},O="areas")}}if(N===void 0)return;const H=o(N.scene),A=O==="ops"?H:"areas",ue=i(N.scene[A][N.i]);N.scene[A][N.i][ue]=a}function ie(){u[c]!==void 0&&(u[c].pop(),u.display.ops.pop(),oe.set(s))}function x(){u.areas!==void 0&&(u.areas.pop(),u.display.areas.pop(),oe.set(s))}function ee(){for(let y of Object.keys(s)){const N=o(s[y]);if(s[y][N]!==void 0)for(let O of s[y][N]){const H=i(O);O[H]===a&&(O[H]=void 0)}}delete s[a],oe.set(s)}function se(){t(4,S=!0)}function B(){t(5,j=!0)}function le(){t(6,Z=!0)}function re(y){Ee.call(this,l,y)}function J(y){Ee.call(this,l,y)}function z(y){Ee.call(this,l,y)}function T(y){Ee.call(this,l,y)}function V(y){fe[y?"unshift":"push"](()=>{m=y,t(3,m)})}function te(y){f=y,t(0,f)}function _e(y){S=y,t(4,S)}function we(y){j=y,t(5,j)}function M(y){Z=y,t(6,Z)}return l.$$set=y=>{"key"in y&&t(1,a=y.key),"movingNode"in y&&t(0,f=y.movingNode)},l.$$.update=()=>{l.$$.dirty[0]&8388610&&t(2,u=s[a])},[f,a,u,m,S,j,Z,c,d,p,v,E,W,G,L,Q,ne,ie,x,ee,se,B,le,s,re,J,z,T,V,te,_e,we,M]}class as extends Se{constructor(e){super(),Te(this,e,rs,is,Oe,{key:1,movingNode:0},null,[-1,-1])}}function kt(l,e,t){const s=l.slice();return s[6]=e[t],s[8]=t,s}function Et(l,e,t){const s=l.slice();return s[6]=e[t],s[8]=t,s}function Nt(l,e){let t,s,i,o,n;return{key:l,first:null,c(){t=$e("line"),this.h()},l(r){t=xe(r,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0}),I(t).forEach(h),this.h()},h(){_(t,"class","op-connection svelte-1lsc27u"),_(t,"x1",s=e[0].display.x+e[6].x+7),_(t,"y1",i=e[0].display.y+e[6].y+10),_(t,"x2",o=e[2][e[8]].x+5),_(t,"y2",n=e[2][e[8]].y+5),this.first=t},m(r,a){C(r,t,a)},p(r,a){e=r,a&1&&s!==(s=e[0].display.x+e[6].x+7)&&_(t,"x1",s),a&1&&i!==(i=e[0].display.y+e[6].y+10)&&_(t,"y1",i),a&5&&o!==(o=e[2][e[8]].x+5)&&_(t,"x2",o),a&5&&n!==(n=e[2][e[8]].y+5)&&_(t,"y2",n)},d(r){r&&h(t)}}}function It(l,e){let t,s,i,o,n;return{key:l,first:null,c(){t=$e("line"),this.h()},l(r){t=xe(r,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0}),I(t).forEach(h),this.h()},h(){_(t,"class","a-connection svelte-1lsc27u"),_(t,"x1",s=e[0].display.x+e[6].x+7),_(t,"y1",i=e[0].display.y+e[6].y+10),_(t,"x2",o=e[1][e[8]].x+5),_(t,"y2",n=e[1][e[8]].y+5),this.first=t},m(r,a){C(r,t,a)},p(r,a){e=r,a&1&&s!==(s=e[0].display.x+e[6].x+7)&&_(t,"x1",s),a&1&&i!==(i=e[0].display.y+e[6].y+10)&&_(t,"y1",i),a&3&&o!==(o=e[1][e[8]].x+5)&&_(t,"x2",o),a&3&&n!==(n=e[1][e[8]].y+5)&&_(t,"y2",n)},d(r){r&&h(t)}}}function us(l){let e,t=[],s=new Map,i,o=[],n=new Map,r=l[0].display.ops||[];const a=c=>"op"+c[8];for(let c=0;c<r.length;c+=1){let d=Et(l,r,c),p=a(d);s.set(p,t[c]=Nt(p,d))}let f=l[0].display.areas||[];const u=c=>"a"+c[8];for(let c=0;c<f.length;c+=1){let d=kt(l,f,c),p=u(d);n.set(p,o[c]=It(p,d))}return{c(){e=$e("g");for(let c=0;c<t.length;c+=1)t[c].c();i=Le();for(let c=0;c<o.length;c+=1)o[c].c()},l(c){e=xe(c,"g",{});var d=I(e);for(let p=0;p<t.length;p+=1)t[p].l(d);i=Le();for(let p=0;p<o.length;p+=1)o[p].l(d);d.forEach(h)},m(c,d){C(c,e,d);for(let p=0;p<t.length;p+=1)t[p].m(e,null);g(e,i);for(let p=0;p<o.length;p+=1)o[p].m(e,null)},p(c,[d]){d&5&&(r=c[0].display.ops||[],t=Ge(t,d,a,1,c,r,s,e,Qe,Nt,i,Et)),d&3&&(f=c[0].display.areas||[],o=Ge(o,d,u,1,c,f,n,e,Qe,It,null,kt))},i:Ue,o:Ue,d(c){c&&h(e);for(let d=0;d<t.length;d+=1)t[d].d();for(let d=0;d<o.length;d+=1)o[d].d()}}}function fs(l,e,t){let s,i,o;ve(l,oe,f=>t(5,o=f));let{key:n}=e,{mouse:r}=e,a=o[n];return l.$$set=f=>{"key"in f&&t(3,n=f.key),"mouse"in f&&t(4,r=f.mouse)},l.$$.update=()=>{l.$$.dirty&40&&t(0,a=o[n]),l.$$.dirty&49&&t(2,s=(a.options||a.opciones||[]).map((f,u)=>{const c=f.escena||f.scene;return c===void 0?a.display.ops[u].rewiring?r:a.display:o[c].display})),l.$$.dirty&49&&t(1,i=(a.areas||[]).map((f,u)=>{const c=f.escena||f.scene;return c===void 0?a.display.areas[u].rewiring?r:a.display:o[c].display}))},[a,i,s,n,r,o]}class cs extends Se{constructor(e){super(),Te(this,e,fs,us,Oe,{key:3,mouse:4})}}function ds(l){let e,t,s,i,o,n,r,a,f,u,c,d,p,m,S;function j(v){l[7](v)}let Z={};return l[0]!==void 0&&(Z.toggle=l[0]),e=new He({props:Z}),fe.push(()=>ye(e,"toggle",j)),{c(){de(e.$$.fragment),s=D(),i=b("div"),o=b("label"),n=q("Escena:"),r=D(),a=b("input"),f=D(),u=b("div"),c=b("button"),d=q("Aceptar"),this.h()},l(v){pe(e.$$.fragment,v),s=U(v),i=w(v,"DIV",{});var E=I(i);o=w(E,"LABEL",{for:!0});var W=I(o);n=Y(W,"Escena:"),W.forEach(h),r=U(E),a=w(E,"INPUT",{id:!0,type:!0}),E.forEach(h),f=U(v),u=w(v,"DIV",{class:!0});var G=I(u);c=w(G,"BUTTON",{});var P=I(c);d=Y(P,"Aceptar"),P.forEach(h),G.forEach(h),this.h()},h(){_(o,"for","inp"),_(a,"id","inp"),_(a,"type","text"),_(u,"class","bar svelte-1bhrmvp")},m(v,E){he(e,v,E),C(v,s,E),C(v,i,E),g(i,o),g(o,n),g(i,r),g(i,a),ke(a,l[2]),C(v,f,E),C(v,u,E),g(u,c),g(c,d),p=!0,m||(S=[R(a,"input",l[8]),R(a,"mousedown",Ne(l[6])),R(c,"click",l[4])],m=!0)},p(v,E){const W={};!t&&E&1&&(t=!0,W.toggle=v[0],be(()=>t=!1)),e.$set(W),E&4&&a.value!==v[2]&&ke(a,v[2])},i(v){p||(X(e.$$.fragment,v),p=!0)},o(v){$(e.$$.fragment,v),p=!1},d(v){ge(e,v),v&&h(s),v&&h(i),v&&h(f),v&&h(u),m=!1,De(S)}}}function ps(l){let e,t,s;function i(n){l[9](n)}let o={pos:l[3],$$slots:{default:[ds]},$$scope:{ctx:l}};return l[1]!==void 0&&(o.displace=l[1]),e=new Fe({props:o}),fe.push(()=>ye(e,"displace",i)),{c(){de(e.$$.fragment)},l(n){pe(e.$$.fragment,n)},m(n,r){he(e,n,r),s=!0},p(n,[r]){const a={};r&4101&&(a.$$scope={dirty:r,ctx:n}),!t&&r&2&&(t=!0,a.displace=n[1],be(()=>t=!1)),e.$set(a)},i(n){s||(X(e.$$.fragment,n),s=!0)},o(n){$(e.$$.fragment,n),s=!1},d(n){ge(e,n)}}}function hs(l){const e=["\xE1","\xE9","\xED","\xF3","\xFA","\xFC","\xF1"],t=["a","e","i","o","u","u","n"],s=l.toLowerCase();let i="";for(let o=0;o<l.length;o++){const n=s.charAt(o),r=l.charAt(o);if(e.includes(n)){let a;for(let f=0;f<e.length;f++)if(e[f]===n){a=f;break}r===r.toUpperCase()?i+=t[a].toUpperCase():i+=t[a]}else i+=r}return i}function gs(l,e,t){let s,i;ve(l,oe,S=>t(11,i=S));let{showNewScene:o}=e,{offset:n}=e,r=i,a={x:n.x*-1+20,y:n.y*-1+20},f;function u(){if(/^\d/.test(s)===!0){alert(`El nombre de la escena no puede empezar con un n\xFAmero /
The name of the scene cannot start with a number`);return}let S=s.replace(/\s/gi,"_").replace(/\W/,"").replace(/[;.,:{}()<>$%&!¡?¿"'/\\#@&*+-]/gi,"");S=hs(S),r[S]={text:"",display:{x:a.x,y:a.y,ops:[],areas:[]}},Ie(oe,i[S]=r[S],i),t(0,o=!1)}function c(S){Ee.call(this,l,S)}function d(S){o=S,t(0,o)}function p(){s=this.value,t(2,s)}function m(S){f=S,t(1,f)}return l.$$set=S=>{"showNewScene"in S&&t(0,o=S.showNewScene),"offset"in S&&t(5,n=S.offset)},t(2,s=""),[o,f,s,a,u,n,c,d,p,m]}class ms extends Se{constructor(e){super(),Te(this,e,gs,ps,Oe,{showNewScene:0,offset:5})}}function St(l){let e,t,s;function i(n){l[10](n)}let o={offset:l[1]};return l[0]!==void 0&&(o.showNewScene=l[0]),e=new ms({props:o}),fe.push(()=>ye(e,"showNewScene",i)),{c(){de(e.$$.fragment)},l(n){pe(e.$$.fragment,n)},m(n,r){he(e,n,r),s=!0},p(n,r){const a={};r&2&&(a.offset=n[1]),!t&&r&1&&(t=!0,a.showNewScene=n[0],be(()=>t=!1)),e.$set(a)},i(n){s||(X(e.$$.fragment,n),s=!0)},o(n){$(e.$$.fragment,n),s=!1},d(n){ge(e,n)}}}function _s(l){let e,t,s,i,o;const n=l[9].default,r=et(n,l,l[8],null);let a=l[0]&&St(l);return{c(){e=b("div"),r&&r.c(),t=D(),a&&a.c(),this.h()},l(f){e=w(f,"DIV",{class:!0});var u=I(e);r&&r.l(u),t=U(u),a&&a.l(u),u.forEach(h),this.h()},h(){_(e,"class","node-page svelte-1e9gr7d")},m(f,u){C(f,e,u),r&&r.m(e,null),g(e,t),a&&a.m(e,null),s=!0,i||(o=[Ae(l[2].call(null,e)),R(e,"mousedown",l[3]),R(e,"mouseup",l[4]),R(e,"mousemove",l[5])],i=!0)},p(f,[u]){r&&r.p&&(!s||u&256)&&tt(r,n,f,f[8],s?nt(n,f[8],u,null):st(f[8]),null),f[0]?a?(a.p(f,u),u&1&&X(a,1)):(a=St(f),a.c(),X(a,1),a.m(e,null)):a&&(Pe(),$(a,1,1,()=>{a=null}),Ve())},i(f){s||(X(r,f),X(a),s=!0)},o(f){$(r,f),$(a),s=!1},d(f){f&&h(e),r&&r.d(f),a&&a.d(),i=!1,De(o)}}}function vs(l,e,t){let s,i,o;ve(l,oe,E=>t(12,s=E)),ve(l,Dt,E=>t(13,i=E)),ve(l,ot,E=>t(14,o=E));let{$$slots:n={},$$scope:r}=e,{movingNode:a}=e,{mouse:f}=e,{showNewScene:u}=e,c=!1;const d={x:0,y:0};function p(E){E.style.left=`${d.x}px`,E.style.top=`${d.y}px`}function m(){const E=Object.keys(s);for(let W of E){const G=s[W],P=o(G);for(let L=0;L<G.display.ops.length;L++){const F=i(G[P][L]);G.display.ops[L].rewiring&&(G.display.ops[L].rewiring=!1,G[P][L][F]=G.display.ops[L].prevWiring)}Ie(oe,s[W]=G,s)}}function S(){c=!0,this.style.cursor="grabbing",m()}function j(){c=!1,this.style.cursor="grab"}function Z(E){if(c&&!a){const G=+getComputedStyle(this.offsetParent).width.replace("px",""),P=+getComputedStyle(this).width.replace("px",""),L=+getComputedStyle(this.offsetParent).height.replace("px",""),F=+getComputedStyle(this).height.replace("px","");t(1,d.x+=E.movementX,d),t(1,d.y+=E.movementY,d),t(1,d.x=d.x>0?0:G-d.x>P?G-P:d.x,d),t(1,d.y=d.y>0?0:L-d.y>F?L-F:d.y,d),this.style.left=`${d.x}px`,this.style.top=`${d.y}px`}t(6,f={x:E.offsetX,y:E.offsetY});let W=E.target;for(;W!==this;)t(6,f.x+=W.offsetLeft,f),t(6,f.y+=W.offsetTop,f),W=W.offsetParent}function v(E){u=E,t(0,u)}return l.$$set=E=>{"movingNode"in E&&t(7,a=E.movingNode),"mouse"in E&&t(6,f=E.mouse),"showNewScene"in E&&t(0,u=E.showNewScene),"$$scope"in E&&t(8,r=E.$$scope)},[u,d,p,S,j,Z,f,a,r,n,v]}class ys extends Se{constructor(e){super(),Te(this,e,vs,_s,Oe,{movingNode:7,mouse:6,showNewScene:0})}}class bs{constructor(e="en",t){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,igramaFormat:"png",minigifOptions:{},sceneCallback:s=>s},t&&(this.options=Object.assign(this.options,t)),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[t,s]of Object.entries(e.grammar));return this}setScenes(e){this.scenes=e;for(let t of Object.keys(e)){this.scenes[t].key=t;const s=this.scenes[t].image||this.scenes[t].imagen;s!==void 0&&this.storyPreload[s]===void 0&&(this.storyPreload[s]=new Image,this.storyPreload[s].src=s,this.storyPreload[s].className="storyimage")}return this}setMarkov(e){return this.markov=e,this}expandGrammar(e){const t=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(t)}expandIgrama(e){const t=this.igrama.grammar,s=this.selectGrammarRule(t[e]);return this.grammarRuleRecursion(s,t).split("|").map(o=>this.decodeDrawing(o))}grammarRuleRecursion(e,t){let s=t||this.grammar,i=this.setNewRules(e);const o=i.match(/<[\w\d.,/#]+>/gi);if(!o)return i;for(let n of o){const r=this.defineTransformations(n);i=i.replace(n,()=>{n=n.replace(/[<>]/gi,""),n=n.replace(/#[\w\d.,/]+#/g,"");const a=n.search(/[.]/)>-1?this.getNestedObject(s,n.match(/[\w\d]+/g)):s[n];if(!a){const u=this.lang==="es"?`Se intent\xF3 expandir desde la regla "${n}", pero no se pudo encontrar`:`Tried to expand from rule "${n}", but couldn't find it`;console.error(u)}const f=this.selectGrammarRule(a);return this.transformString(f,r)})}return this.grammarRuleRecursion(i,s)}setNewRules(e,t){let s;t===void 0?s=this.grammar:s=t;let i=e;const o=i.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(o)for(;o.length;){const n=o.pop();i=i.replace(n,"");const{symbol:r,pairsString:a}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(n).groups,f=a.match(/[-]?[\w\d]+:[\w\d]+/gi).map(u=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(u).groups);if(f){s[r]=s[r]||{};for(let u of f){const c=s[u.value];if(!c){const m=this.lang==="es"?`Se intent\xF3 crear la nueva regla "${r}", pero no se pudo encontrar "${u.value}" para producir la subregla "${u.key}"`:`Tried to create new rule: "${r}", but couldn't find "${u.value}" to produce "${u.key}" subrule`;console.error(m)}const d=u.remove==="-",p=this.selectGrammarRule(c);if(d){const m=c.indexOf(p);s[u.value]=[...c.slice(0,m),...c.slice(m+1)]}s[r][u.key]=[p]}}}return i}startAdventure(e){this.options.defaultCSS&&this.setCSS();const t=document.createElement("div");return t.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(t),this.goToScene(this.scenes[e]),this}goToScene(e){const t=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(a=>a.remove()),[...document.getElementsByClassName("storyimage-area")].map(r=>r.remove());const i=document.createElement("div");if(i.className="storydiv",t.appendChild(i),e.image||e.imagen){const r=document.createElement("div");r.className="storyimage-container",i.appendChild(r);const a=e.image||e.imagen,f=this.options.adventureScroll?this.storyPreload[a].cloneNode():this.storyPreload[a];r.appendChild(f),e.areas&&(f.complete?this.setAreas(f,r,e.areas):f.onload=()=>{this.setAreas(f,r,e.areas)})}else if(e.igrama!==void 0){const r=document.createElement("div");r.className="storyimage-container",i.appendChild(r);const a=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(a),this.igramaDataUrl(a,this.options.igramaFormat).then(f=>{const u=new Image;u.src=f,u.className="storyimage",r.appendChild(u)})}const o=document.createElement("div");o.className="storyp-container",(e.text||e.texto||e.igramaText)&&i.appendChild(o);const n=document.createElement("p");n.className="storyp",n.innerHTML="",o.appendChild(n),document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(n,e),this.options.sceneCallback(e)}setAreas(e,t,s){const i=e.getBoundingClientRect(),o=t.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,t,s)},[...document.getElementsByClassName("storyimage-area")].map(r=>r.remove());for(let r of s){let a=document.createElement("div");a.className="storyimage-area";const f=(r.x-Math.floor(r.w/2))*i.width/e.naturalWidth;a.style.left=`${i.left-o.left+f}px`;const u=(r.y-Math.floor(r.h/2))*i.height/e.naturalHeight;a.style.top=`${i.top-o.top+u}px`,a.style.width=`${r.w*i.width/e.naturalWidth}px`,a.style.height=`${r.h*i.height/e.naturalHeight}px`,a.innerHTML=r.btn||"",t.appendChild(a),a.style.fontSize=`${18*i.height/e.naturalHeight}px`,a.onclick=()=>{const c=r.scene||r.escena;this.goToScene(this.scenes[c])},r.tooltip!==void 0&&(a.onmouseover=()=>{a.innerHTML=r.tooltip||"",a.style.zIndex="100"},a.onmouseout=()=>{a.innerHTML=r.btn||"",a.style.zIndex="0"})}}typewriter(e,t){const s=t.text||t.texto||t.igramaText||"";let i=this.grammar?this.grammarRuleRecursion(s):s;if(i=i.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let o=0;const n=setInterval(()=>{const r=i.substring(0,o);e.innerHTML=r,o++,o>i.length&&(clearInterval(n),this.optionButtons(t))},Math.floor(this.options.typewriterSpeed))}else e.innerHTML=i,this.optionButtons(t)}optionButtons(e){const t=[...document.getElementsByClassName("storydiv")],s=t[t.length-1];[...document.getElementsByClassName("storybutton-container")].map(n=>n.remove());const o=document.createElement("div");if(o.className="storybutton-container",s.appendChild(o),e.options||e.opciones){const n=e.options||e.opciones;for(let r of n){const a=document.createElement("button");a.className="storybutton",a.innerHTML=r.btn,o.appendChild(a),a.addEventListener("click",()=>{if((r.text||r.texto)===void 0){const u=r.scene||r.escena;this.goToScene(this.scenes[u])}else this.goToScene(r)})}}else if(e.scene||e.escena){const n=e.scene||e.escena,r=document.createElement("button");r.className="storybutton",r.innerHTML=this.lang==="en"?"Continue":"Continuar",o.appendChild(r),r.addEventListener("click",()=>{this.goToScene(this.scenes[n])})}document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const i=Math.random()*e.prob.reduce((n,r)=>n+r);let o=0;for(let n=0;n<e.prob.length;n++){if(o<=i&&i<o+e.prob[n])return e[n];o+=e.prob[n]}}const t=Math.floor(Math.random()*e.length);return e[t]}getNestedObject(e,t){return t.reduce((s,i)=>s&&s[i]!==void 0?s[i]:void 0,e)}defineTransformations(e){let t={};const s=/#(?<trans>[\w\d,]+)#/gi.exec(e),i=s?s.groups.trans.match(/[\w]+/gi):[];for(let o of i)t[o]=!0;return t}transformString(e,t){let s=e;return t.CAPITALIZE&&(s=s.charAt(0).toUpperCase()+s.slice(1)),t.ALLCAPS&&(s=s.toUpperCase()),s}decodeDrawing(e){if(e==="")return[];const[t,s,i]=e.split("%%");let o={};return t==="vector"?o.content=s.split("**").map(n=>{const[r,a,f]=n.split("&"),u=[];if(u.color=r,u.weight=a,f===void 0)return u;const c=f.split(",");for(let d=0;d<c.length;d+=2)u.push([+c[d],+c[d+1]]);return u}):o.content=s,o.attribute=i,o.type=t,o}async getMarkovModel(e,t=1,s=!1){let i=await(await fetch(`./${e}`)).text();i=i.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const o=i.split(this.markovSeparator),n={};for(let a=0;a<o.length-t;a++){let f="";for(let c=0;c<t;c++)f+=c===0?o[a+c]:" "+o[a+c];n[f]===void 0&&(n[f]={});const u=o[a+t];n[f][u]===void 0?n[f][u]=1:n[f][u]++}const r={};for(let a of Object.keys(n)){const f=Object.keys(n[a]);r[a]={probs:[],grams:f};let u=0;for(let c=0;c<f.length;c++)u+=n[a][f[c]];for(let c=0;c<f.length;c++)r[a].probs[c]=n[a][f[c]]/u}if(s){const a=e.split("/");this.saveJSON(r,`${a[a.length-1]}_markovModel_${t}N.json`)}return r}markovChain(e,t,s=.1){let i=t===void 0||this.markov[t]===void 0?this.randomMarkovWord():t,o=i;for(let r=0;r<e-1;r++){let a=this.getNextMarkov(this.markov[o]);a===void 0&&(a=this.getNextMarkov(this.randomMarkovWord()));let f=o.split(this.markovSeparator);f.push(a),f=f.slice(1).join(" "),o=f,i+=` ${a}`}return this.formatMarkov(i,s)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const t=Math.random();let s=0;if(e!==void 0)for(let i=0;i<e.probs.length;i++){if(s<=t&&t<s+e.probs[i])return e.grams[i];s+=e.probs[i]}}formatMarkov(e,t=.1){let s=e.replace(/ ([,:.;])/g,"$1");return s=s.replaceAll(/([.]) ([\wáéíóú])/ig,(i,o,n,r,a)=>Math.random()<t?`.
${n.toUpperCase()}`:`. ${n.toUpperCase()}`),s.charAt(0).toUpperCase()+s.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,t){const s=document.createElement("a");s.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),s.setAttribute("download",`${t.includes(".json")?t:t+".json"}`),document.body.appendChild(s),s.click(),document.body.removeChild(s)}testScenes(e){const t=e||this.scenes;if(!t){const i=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(i)}let s=[];for(let i of Object.keys(t)){const o=t[i];if(o.options||o.opciones){const r=(o.options||o.opciones).filter(a=>!t[a.scene||a.escena]);s=[...s,...r.map(a=>`${i} => ${a.btn} => ${a.scene||a.escena}`)]}else{if(o.deadEnd||o.sinSalida)continue;t[o.scene||o.escena]||s.push(`${i} => ${o.scene||o.escena}`)}}if(s.length>0){const i=this.lang==="es"?`Las siguientes escenas no llevan a ning\xFAn lado: ${s.join(", ")}`:`The following scenes are dead ends: ${s.join(", ")}`;console.error(i),this.scenesError=!0}return this}testGrammar(e){const t=e||this.grammar;if(!t){const s=this.lang==="es"?"No hay gram\xE1tica para probar":"There is not grammar to test";console.error(s)}for(let s of Object.keys(t)){const i=t[s];for(let o of i){const n=o.match(/<([\w\d]+)>/gi),r=n?n.map(c=>c.replace(/[<>]/g,"")):[],a=o.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),f=a?a.map(c=>c.match(/([ ]?:[\w\d]+)/g).map(d=>/[ ]?:(?<key>[\w\d]+)/.exec(d).groups.key)).reduce((c,d)=>[...c,...d],[]):[],u=[...r,...f].filter(c=>!t[c]);if(u.length>0){const c=this.lang==="es"?`Las siguientes reglas, que se referencian en "${s}", no existen: ${u.join(", ")}`:`The following rules, referenced in "${s}", do not exist: ${u.join(", ")}`;this.grammarError=!0,console.error(c)}}}return this}testDistribution(e){const t=e||this.markov;if(t===void 0){const f=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(f)}const s={},i={};let o=0;const n=Object.values(t);for(let f of n)for(let u of f.probs){const c=(Math.round(u/.05)*.05).toFixed(2);i[o]=c,o++,s[c]===void 0?s[c]=1:s[c]++}console.log("------------------------------------ DIST ------------------------------------");const r=Math.max(...Object.values(s)),a=Object.entries(s).sort((f,u)=>f[0]>u[0]?1:f[0]<u[0]?-1:0);for(let f of a)console.log(`${f[0]}... ${"|".repeat(Math.ceil(f[1]*100/r))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,t="png",s){const i=await this.igramaDataUrl(e,t),o=new Image;o.src=i,s==null?document.body.appendChild(o):document.getElementById(s).appendChild(o)}async igramaDataUrl(e,t="png"){const s=this.igrama.metadata.width,i=this.igrama.metadata.height;let o=document.createElement("canvas");o.width=s,o.height=i;const n=o.getContext("2d");n.lineJoin="round",n.lineCap="round",n.fillStyle=this.igrama.metadata.bg||"#FFFFFF",n.fillRect(0,0,s,i),await this.drawLayers(e,n);let r;if(t==="png")r=o.toDataURL();else if(t==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener tambi\xE9n la librer\xEDa MiniGif":"To create Gifs you must have also the MiniGif library"),"";const a={colorResolution:7,dither:!1,delay:50};Object.assign(a,this.minigifOptions);const f=new MiniGif(a);f.addFrame(o);const u=this.getLayerWiggle(e);n.fillStyle=this.igrama.metadata.bg||"#FFFFFF",n.fillRect(0,0,s,i),await this.drawLayers(u,n),f.addFrame(o);const c=f.makeGif(),d=await this.base64_arraybuffer(c);r="data:image/gif;base64,"+d}return o.remove(),r}async base64_arraybuffer(e){return(await new Promise(s=>{const i=new FileReader;i.onload=()=>s(i.result),i.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const s=JSON.parse(JSON.stringify(e)),i=(o,n)=>Math.floor(o+Math.random()*(n-o));for(let[o,n]of s.entries())if(n.type==="vector")for(let[r,a]of n.content.entries()){for(let[f,u]of a.entries())Math.random()<.5?u[0]+=i(-3,3):u[1]+=i(-3,3);a.color=e[o].content[r].color,a.weight=e[o].content[r].weight}return s}getIgramaText(e){return e.map(s=>s.attribute).reverse().join(" ").trim()}async drawLayers(e,t){for(let[s,i]of e.entries())if(i.type==="url"){const{w:o,h:n,x:r,y:a}=this.igrama.sections[s];if(this.imgsMemo[i.content]===void 0){const f=new Image;f.src=i.content,this.imgsMemo[i.content]=await new Promise(u=>{f.addEventListener("load",()=>{u(f)},!1)})}t.drawImage(this.imgsMemo[i.content],r,a,o,n)}else if(i.type=="vector")for(let o of i.content){if(o.length===0)continue;const n=this.getSpline(o);this.drawSpline(n,t,o.color,o.weight)}}drawSpline(e,t,s,i){t.lineWidth=i,t.strokeStyle=s,t.fillStyle="rgba(0,0,0,0)",t.beginPath();for(let o=0;o<e.length;o++)o===0?t.moveTo(...e[0]):t.lineTo(...e[o]);t.stroke()}getSpline(e){let t=[];for(let s=0;s<e.length-1;s++){const i=[];i[0]=s>0?e[s-1]:e[0],i[1]=e[s],i[2]=e[s+1],i[3]=s<e.length-2?e[s+2]:e[e.length-1];for(let o=0;o<1;o+=.05){const n=this.getSplinePoint(o,i);t.push(n)}}return t}getSplinePoint(e,t){const s=Math.floor(e)+1,i=s+1,o=i+1,n=s-1,r=e*e,a=r*e,f=-a+2*r-e,u=3*a-5*r+2,c=-3*a+4*r+e,d=a-r,p=.5*(t[n][0]*f+t[s][0]*u+t[i][0]*c+t[o][0]*d),m=.5*(t[n][1]*f+t[s][1]*u+t[i][1]*c+t[o][1]*d);return[p,m]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=ws,document.getElementsByTagName("head")[0].appendChild(e)}}const ws=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 10px;
  flex-direction: column;
  box-sizing: border-box;
}

.storyp {
  font-size: 18px;
  min-height: 25px;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  font-size: 14px;
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: #ffffff00;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: #ffffff33;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,ks=ze(bs);function Tt(l,e,t){const s=l.slice();return s[21]=e[t],s}function Ot(l,e,t){const s=l.slice();return s[21]=e[t],s}function Ct(l,e){let t,s,i,o,n,r;function a(u){e[15](u)}let f={key:e[21]};return e[0]!==void 0&&(f.movingNode=e[0]),s=new as({props:f}),fe.push(()=>ye(s,"movingNode",a)),{key:l,first:null,c(){t=b("div"),de(s.$$.fragment),this.h()},l(u){t=w(u,"DIV",{class:!0});var c=I(t);pe(s.$$.fragment,c),c.forEach(h),this.h()},h(){_(t,"class","scene-node-container"),this.first=t},m(u,c){C(u,t,c),he(s,t,null),o=!0,n||(r=R(t,"mouseenter",Ts),n=!0)},p(u,c){e=u;const d={};c&16&&(d.key=e[21]),!i&&c&1&&(i=!0,d.movingNode=e[0],be(()=>i=!1)),s.$set(d)},i(u){o||(X(s.$$.fragment,u),o=!0)},o(u){$(s.$$.fragment,u),o=!1},d(u){u&&h(t),ge(s),n=!1,r()}}}function Mt(l,e){let t,s,i;return s=new cs({props:{key:e[21],mouse:e[5]}}),{key:l,first:null,c(){t=Le(),de(s.$$.fragment),this.h()},l(o){t=Le(),pe(s.$$.fragment,o),this.h()},h(){this.first=t},m(o,n){C(o,t,n),he(s,o,n),i=!0},p(o,n){e=o;const r={};n&16&&(r.key=e[21]),n&32&&(r.mouse=e[5]),s.$set(r)},i(o){i||(X(s.$$.fragment,o),i=!0)},o(o){$(s.$$.fragment,o),i=!1},d(o){o&&h(t),ge(s,o)}}}function Es(l){let e=[],t=new Map,s,i,o=[],n=new Map,r,a=l[4];const f=d=>d[21];for(let d=0;d<a.length;d+=1){let p=Ot(l,a,d),m=f(p);t.set(m,e[d]=Ct(m,p))}let u=l[4];const c=d=>d[21];for(let d=0;d<u.length;d+=1){let p=Tt(l,u,d),m=c(p);n.set(m,o[d]=Mt(m,p))}return{c(){for(let d=0;d<e.length;d+=1)e[d].c();s=D(),i=$e("svg");for(let d=0;d<o.length;d+=1)o[d].c();this.h()},l(d){for(let m=0;m<e.length;m+=1)e[m].l(d);s=U(d),i=xe(d,"svg",{class:!0});var p=I(i);for(let m=0;m<o.length;m+=1)o[m].l(p);p.forEach(h),this.h()},h(){_(i,"class","connections-container svelte-1htln5w")},m(d,p){for(let m=0;m<e.length;m+=1)e[m].m(d,p);C(d,s,p),C(d,i,p);for(let m=0;m<o.length;m+=1)o[m].m(i,null);r=!0},p(d,p){p&17&&(a=d[4],Pe(),e=Ge(e,p,f,1,d,a,t,s.parentNode,ft,Ct,s,Ot),Ve()),p&48&&(u=d[4],Pe(),o=Ge(o,p,c,1,d,u,n,i,ft,Mt,null,Tt),Ve())},i(d){if(!r){for(let p=0;p<a.length;p+=1)X(e[p]);for(let p=0;p<u.length;p+=1)X(o[p]);r=!0}},o(d){for(let p=0;p<e.length;p+=1)$(e[p]);for(let p=0;p<o.length;p+=1)$(o[p]);r=!1},d(d){for(let p=0;p<e.length;p+=1)e[p].d(d);d&&h(s),d&&h(i);for(let p=0;p<o.length;p+=1)o[p].d()}}}function At(l){let e,t;return e=new Fe({props:{pos:l[6],$$slots:{default:[Ns]},$$scope:{ctx:l}}}),{c(){de(e.$$.fragment)},l(s){pe(e.$$.fragment,s)},m(s,i){he(e,s,i),t=!0},p(s,i){const o={};i&67108868&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){t||(X(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){ge(e,s)}}}function Ns(l){let e,t,s,i,o,n,r;function a(u){l[18](u)}let f={};return l[2]!==void 0&&(f.toggle=l[2]),e=new He({props:f}),fe.push(()=>ye(e,"toggle",a)),{c(){de(e.$$.fragment),s=D(),i=b("div"),this.h()},l(u){pe(e.$$.fragment,u),s=U(u),i=w(u,"DIV",{class:!0,id:!0}),I(i).forEach(h),this.h()},h(){_(i,"class","test-story-container svelte-1htln5w"),_(i,"id","test-story-container")},m(u,c){he(e,u,c),C(u,s,c),C(u,i,c),o=!0,n||(r=Ae(l[11].call(null,i)),n=!0)},p(u,c){const d={};!t&&c&4&&(t=!0,d.toggle=u[2],be(()=>t=!1)),e.$set(d)},i(u){o||(X(e.$$.fragment,u),o=!0)},o(u){$(e.$$.fragment,u),o=!1},d(u){ge(e,u),u&&h(s),u&&h(i),n=!1,r()}}}function Is(l){let e,t,s,i,o,n,r,a,f,u,c,d,p,m,S,j,Z,v,E,W,G,P,L,F,Q,ne,ie,x,ee,se,B;function le(T){l[16](T)}function re(T){l[17](T)}let J={movingNode:l[0],$$slots:{default:[Es,({offset:T})=>({20:T}),({offset:T})=>T?1048576:0]},$$scope:{ctx:l}};l[1]!==void 0&&(J.showNewScene=l[1]),l[5]!==void 0&&(J.mouse=l[5]),F=new ys({props:J}),fe.push(()=>ye(F,"showNewScene",le)),fe.push(()=>ye(F,"mouse",re));let z=l[2]&&At(l);return{c(){e=b("input"),t=D(),s=b("div"),i=b("div"),o=b("div"),n=b("button"),r=q("Nuevo proyecto"),a=D(),f=b("label"),u=q("Importar"),c=D(),d=b("button"),p=q("Exportar"),m=D(),S=b("button"),j=q("Previsualizar"),Z=D(),v=b("div"),E=b("button"),W=q("Nueva escena"),G=D(),P=b("div"),L=b("div"),de(F.$$.fragment),ie=D(),z&&z.c(),x=Le(),this.h()},l(T){e=w(T,"INPUT",{type:!0,id:!0}),t=U(T),s=w(T,"DIV",{class:!0});var V=I(s);i=w(V,"DIV",{class:!0});var te=I(i);o=w(te,"DIV",{class:!0});var _e=I(o);n=w(_e,"BUTTON",{class:!0});var we=I(n);r=Y(we,"Nuevo proyecto"),we.forEach(h),a=U(_e),f=w(_e,"LABEL",{class:!0,for:!0});var M=I(f);u=Y(M,"Importar"),M.forEach(h),c=U(_e),d=w(_e,"BUTTON",{class:!0});var y=I(d);p=Y(y,"Exportar"),y.forEach(h),m=U(_e),S=w(_e,"BUTTON",{class:!0});var N=I(S);j=Y(N,"Previsualizar"),N.forEach(h),_e.forEach(h),Z=U(te),v=w(te,"DIV",{class:!0});var O=I(v);E=w(O,"BUTTON",{class:!0});var H=I(E);W=Y(H,"Nueva escena"),H.forEach(h),O.forEach(h),te.forEach(h),G=U(V),P=w(V,"DIV",{class:!0});var A=I(P);L=w(A,"DIV",{class:!0});var ue=I(L);pe(F.$$.fragment,ue),ue.forEach(h),A.forEach(h),V.forEach(h),ie=U(T),z&&z.l(T),x=Le(),this.h()},h(){_(e,"type","file"),_(e,"id","load-input"),e.hidden=!0,_(n,"class","toolbar-button svelte-1htln5w"),_(f,"class","toolbar-button svelte-1htln5w"),_(f,"for","load-input"),_(d,"class","toolbar-button svelte-1htln5w"),_(S,"class","toolbar-button svelte-1htln5w"),_(o,"class","project-toolbar"),_(E,"class","toolbar-button svelte-1htln5w"),_(v,"class","scene-toolbar svelte-1htln5w"),_(i,"class","toolbar svelte-1htln5w"),_(L,"class","page-container svelte-1htln5w"),_(P,"class","static-page-container svelte-1htln5w"),_(s,"class","design-window-container svelte-1htln5w")},m(T,V){C(T,e,V),l[14](e),C(T,t,V),C(T,s,V),g(s,i),g(i,o),g(o,n),g(n,r),g(o,a),g(o,f),g(f,u),g(o,c),g(o,d),g(d,p),g(o,m),g(o,S),g(S,j),g(i,Z),g(i,v),g(v,E),g(E,W),g(s,G),g(s,P),g(P,L),he(F,L,null),C(T,ie,V),z&&z.m(T,V),C(T,x,V),ee=!0,se||(B=[R(e,"change",l[7]),R(n,"click",l[10]),R(d,"click",l[12]),R(S,"click",l[9]),R(E,"click",l[8])],se=!0)},p(T,[V]){const te={};V&1&&(te.movingNode=T[0]),V&67108913&&(te.$$scope={dirty:V,ctx:T}),!Q&&V&2&&(Q=!0,te.showNewScene=T[1],be(()=>Q=!1)),!ne&&V&32&&(ne=!0,te.mouse=T[5],be(()=>ne=!1)),F.$set(te),T[2]?z?(z.p(T,V),V&4&&X(z,1)):(z=At(T),z.c(),X(z,1),z.m(x.parentNode,x)):z&&(Pe(),$(z,1,1,()=>{z=null}),Ve())},i(T){ee||(X(F.$$.fragment,T),X(z),ee=!0)},o(T){$(F.$$.fragment,T),$(z),ee=!1},d(T){T&&h(e),l[14](null),T&&h(t),T&&h(s),ge(F),T&&h(ie),z&&z.d(T),T&&h(x),se=!1,De(B)}}}function Ss(l,e){const t=document.createElement("a");t.href=URL.createObjectURL(new Blob([JSON.stringify(l,null,2)],{type:"application/json"})),t.setAttribute("download",`${e.includes(".json")?e:e+".json"}`),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Ts(l){[...document.getElementsByClassName("scene-node-container")].forEach(e=>e.style.zIndex="0"),l.target.firstChild.style.zIndex="1"}function Os(l,e,t){let s,i,o,n;ve(l,oe,L=>t(13,o=L)),ve(l,ks,L=>t(19,n=L)),Lt(()=>{f&&scrollTo(0,0)});let r=!1,a=!1,f=!1,u={x:40,y:40},c;function d(){const L=c.files[0];if(L.type==="application/json"){Ie(oe,o={},o);const F=new FileReader;F.addEventListener("load",function(){const Q=F.result,ne=JSON.parse(Q);Ie(oe,o=ne,o)}),this.value=null,F.readAsText(L);return}else alert("Formato de archivo incorrecto / incorrect file format")}function p(){t(1,a=!0)}function m(){t(2,f=!0)}function S(){Ie(oe,o={},o)}function j(){console.log(o);const L=document.getElementById("storygeneraldiv");L&&L.remove();const F=new n("es",{typewriterSpeed:20}),Q=Object.entries(o).sort((x,ee)=>x[1].display.y-ee[1].display.y);if(Q.length===0){alert("No hay escenas / There are no scenes");return}F.setScenes(o).startAdventure(Q[0][0]);const ne=document.getElementById("test-story-container"),ie=document.getElementById("storygeneraldiv");ne.appendChild(ie)}function Z(){Ss(o,"aventuraInteractiva")}function v(L){fe[L?"unshift":"push"](()=>{c=L,t(3,c)})}function E(L){r=L,t(0,r)}function W(L){a=L,t(1,a)}function G(L){s=L,t(5,s)}function P(L){f=L,t(2,f)}return l.$$.update=()=>{l.$$.dirty&8192&&t(4,i=Object.keys(o))},t(5,s={x:0,y:0}),[r,a,f,c,i,s,u,d,p,m,S,j,Z,o,v,E,W,G,P]}class Cs extends Se{constructor(e){super(),Te(this,e,Os,Is,Oe,{})}}function Ms(l){let e,t,s,i,o,n,r,a,f;return o=new Cs({}),{c(){e=b("section"),t=b("h1"),s=q("Aventura interactiva (beta)"),i=D(),de(o.$$.fragment),n=D(),r=b("footer"),a=q("Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.1b"),this.h()},l(u){e=w(u,"SECTION",{class:!0});var c=I(e);t=w(c,"H1",{class:!0});var d=I(t);s=Y(d,"Aventura interactiva (beta)"),d.forEach(h),i=U(c),pe(o.$$.fragment,c),n=U(c),r=w(c,"FOOTER",{class:!0});var p=I(r);a=Y(p,"Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.1b"),p.forEach(h),c.forEach(h),this.h()},h(){_(t,"class","svelte-1fid4at"),_(r,"class","no-select svelte-1fid4at"),_(e,"class","general no-select svelte-1fid4at")},m(u,c){C(u,e,c),g(e,t),g(t,s),g(e,i),he(o,e,null),g(e,n),g(e,r),g(r,a),f=!0},p:Ue,i(u){f||(X(o.$$.fragment,u),f=!0)},o(u){$(o.$$.fragment,u),f=!1},d(u){u&&h(e),ge(o)}}}class Us extends Se{constructor(e){super(),Te(this,e,null,Ms,Oe,{})}}export{Us as default};
