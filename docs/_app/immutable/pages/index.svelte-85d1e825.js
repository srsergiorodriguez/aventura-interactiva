import{S as ce,i as fe,s as de,F as je,l as w,m as k,n as E,h as p,p as v,b as T,K as ye,L as P,M as we,G as Ae,H as Be,I as De,f as R,t as V,N as ke,O as be,r as W,u as H,J as h,E as ge,a as j,c as A,P as Le,Q as $,w as ne,x as se,y as oe,B as ie,R as Q,T as re,U as ae,V as ve,W as ue,v as Ue,e as Je,g as Se,d as Ie,X as Me,Y as Re,Z as ze}from"../chunks/index-17d0c594.js";import{w as lt,r as Te}from"../chunks/index-ce33dfd0.js";const J=lt({inicio:{texto:"\xC9rase una vez un c\xEDrculo...",display:{ops:[],x:346,y:110},opciones:[{btn:"dejar tranquilo",texto:"dejas al c\xEDrculo en paz",escena:"final1"},{btn:"aplastar",text:"...aplastamiento activado...",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{ops:[],x:263,y:289}},final2:{texto:"Parece que la historia form\xF3 una elipsis",sinSalida:!0,display:{ops:[],x:518,y:289}}}),ct=lt("inicio"),at=Te(a=>a.scene===void 0&&a.escena!==void 0?"escena":"scene"),ut=Te(a=>a.options===void 0&&a.opciones!==void 0?"opciones":"options"),ft=Te(a=>a.text===void 0&&a.texto!==void 0?"texto":"text"),dt=Te(a=>a.image===void 0&&a.imagen!==void 0?"imagen":"image");function pt(a){let e,t,n,l;const o=a[5].default,s=je(o,a,a[4],null);return{c(){e=w("div"),s&&s.c(),this.h()},l(r){e=k(r,"DIV",{class:!0});var i=E(e);s&&s.l(i),i.forEach(p),this.h()},h(){v(e,"class","draggui svelte-11g4b1g")},m(r,i){T(r,e,i),s&&s.m(e,null),t=!0,n||(l=[ye(a[0].call(null,e)),ye(a[1].call(null,e)),P(e,"mousedown",we(a[6]))],n=!0)},p(r,[i]){s&&s.p&&(!t||i&16)&&Ae(s,o,r,r[4],t?De(o,r[4],i,null):Be(r[4]),null)},i(r){t||(R(s,r),t=!0)},o(r){V(s,r),t=!1},d(r){r&&p(e),s&&s.d(r),n=!1,ke(l)}}}function mt(a,e,t){let{$$slots:n={},$$scope:l}=e,{pos:o}=e,{displace:s={x:o.x,y:o.y}}=e;function r(u){u.style.left=`${s.x}px`,u.style.top=`${s.y}px`}function i(u){let c=!1;u.style.left=`${s.x}px`,u.style.top=`${s.y}px`,u.addEventListener("mousedown",()=>{c=!0}),window.addEventListener("mousemove",d=>{c&&(t(2,s.x+=d.movementX,s),t(2,s.y+=d.movementY,s),u.style.left=`${s.x}px`,u.style.top=`${s.y}px`,u.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{c=!1,u.style.cursor="grab"})}function f(u){be.call(this,a,u)}return a.$$set=u=>{"pos"in u&&t(3,o=u.pos),"displace"in u&&t(2,s=u.displace),"$$scope"in u&&t(4,l=u.$$scope)},[r,i,s,o,l,n,f]}class Pe extends ce{constructor(e){super(),fe(this,e,mt,pt,de,{pos:3,displace:2})}}function gt(a){let e,t,n,l,o;return{c(){e=w("div"),t=w("button"),n=W("X"),this.h()},l(s){e=k(s,"DIV",{class:!0});var r=E(e);t=k(r,"BUTTON",{class:!0});var i=E(t);n=H(i,"X"),i.forEach(p),r.forEach(p),this.h()},h(){v(t,"class","x-button"),v(e,"class","top-bar svelte-15bdkib")},m(s,r){T(s,e,r),h(e,t),h(t,n),l||(o=P(t,"click",a[0]),l=!0)},p:ge,i:ge,o:ge,d(s){s&&p(e),l=!1,o()}}}function ht(a,e,t){let{toggle:n}=e;function l(){t(1,n=!1)}return a.$$set=o=>{"toggle"in o&&t(1,n=o.toggle)},[l,n]}class Ge extends ce{constructor(e){super(),fe(this,e,ht,gt,de,{toggle:1})}}function qe(a){let e,t;return{c(){e=w("img"),this.h()},l(n){e=k(n,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Le(e.src,t="")||v(e,"src",t),v(e,"alt","Preview"),v(e,"class","img-preview svelte-ekr4m4")},m(n,l){T(n,e,l),a[6](e)},p:ge,d(n){n&&p(e),a[6](null)}}}function _t(a){let e,t,n,l,o,s=a[2]&&qe(a);return{c(){e=w("input"),t=j(),n=w("div"),s&&s.c(),this.h()},l(r){e=k(r,"INPUT",{type:!0}),t=A(r),n=k(r,"DIV",{class:!0,id:!0});var i=E(n);s&&s.l(i),i.forEach(p),this.h()},h(){v(e,"type","file"),v(n,"class","image-preview-container svelte-ekr4m4"),v(n,"id","image-preview-container")},m(r,i){T(r,e,i),a[5](e),T(r,t,i),T(r,n,i),s&&s.m(n,null),l||(o=P(e,"change",a[3]),l=!0)},p(r,[i]){r[2]?s?s.p(r,i):(s=qe(r),s.c(),s.m(n,null)):s&&(s.d(1),s=null)},i:ge,o:ge,d(r){r&&p(e),a[5](null),r&&p(t),r&&p(n),s&&s.d(),l=!1,o()}}}function vt(a,e,t){let{imageUrl:n}=e,l,o,s=!1;function r(){const u=l.files[0];if(u){t(2,s=!0);const c=new FileReader;c.addEventListener("load",function(){t(4,n=c.result),o.setAttribute("src",c.result)}),c.readAsDataURL(u);return}t(2,s=!1)}function i(u){$[u?"unshift":"push"](()=>{l=u,t(0,l)})}function f(u){$[u?"unshift":"push"](()=>{o=u,t(1,o)})}return a.$$set=u=>{"imageUrl"in u&&t(4,n=u.imageUrl)},[l,o,s,r,n,i,f]}class yt extends ce{constructor(e){super(),fe(this,e,vt,_t,de,{imageUrl:4})}}function bt(a){let e,t,n,l,o,s,r,i,f,u,c,d,N,b,S,z,x,m,g,M,U,B,F,L,q,K,y,D,G,Z,le,ee,C,_,I,X;function pe(O){a[8](O)}let te={};a[0]!==void 0&&(te.toggle=a[0]),e=new Ge({props:te}),$.push(()=>ae(e,"toggle",pe));function me(O){a[11](O)}let he={};return a[3]!==void 0&&(he.imageUrl=a[3]),D=new yt({props:he}),$.push(()=>ae(D,"imageUrl",me)),{c(){ne(e.$$.fragment),n=j(),l=w("div"),o=w("h1"),s=W(a[1]),r=j(),i=w("div"),f=w("h2"),u=W("Texto"),c=j(),d=w("textarea"),N=j(),b=w("div"),S=w("h2"),z=W("Imagen (opcional)"),x=j(),m=w("div"),g=w("label"),M=W("Url:"),U=j(),B=w("input"),F=W(`
    o
    `),L=w("div"),q=w("span"),K=W("Archivo:"),y=j(),ne(D.$$.fragment),Z=j(),le=w("div"),ee=w("button"),C=W("Aceptar"),this.h()},l(O){se(e.$$.fragment,O),n=A(O),l=k(O,"DIV",{});var Y=E(l);o=k(Y,"H1",{class:!0});var Ee=E(o);s=H(Ee,a[1]),Ee.forEach(p),Y.forEach(p),r=A(O),i=k(O,"DIV",{});var Ne=E(i);f=k(Ne,"H2",{class:!0});var Ve=E(f);u=H(Ve,"Texto"),Ve.forEach(p),c=A(Ne),d=k(Ne,"TEXTAREA",{class:!0}),E(d).forEach(p),Ne.forEach(p),N=A(O),b=k(O,"DIV",{});var _e=E(b);S=k(_e,"H2",{class:!0});var Fe=E(S);z=H(Fe,"Imagen (opcional)"),Fe.forEach(p),x=A(_e),m=k(_e,"DIV",{});var Oe=E(m);g=k(Oe,"LABEL",{for:!0});var Ke=E(g);M=H(Ke,"Url:"),Ke.forEach(p),U=A(Oe),B=k(Oe,"INPUT",{id:!0,type:!0}),Oe.forEach(p),F=H(_e,`
    o
    `),L=k(_e,"DIV",{});var Ce=E(L);q=k(Ce,"SPAN",{});var xe=E(q);K=H(xe,"Archivo:"),xe.forEach(p),y=A(Ce),se(D.$$.fragment,Ce),Ce.forEach(p),Z=A(_e),le=k(_e,"DIV",{class:!0});var We=E(le);ee=k(We,"BUTTON",{});var He=E(ee);C=H(He,"Aceptar"),He.forEach(p),We.forEach(p),_e.forEach(p),this.h()},h(){v(o,"class","svelte-2p34te"),v(f,"class","svelte-2p34te"),v(d,"class","svelte-2p34te"),v(S,"class","svelte-2p34te"),v(g,"for","inp"),v(B,"id","inp"),v(B,"type","text"),v(le,"class","bar svelte-2p34te")},m(O,Y){oe(e,O,Y),T(O,n,Y),T(O,l,Y),h(l,o),h(o,s),T(O,r,Y),T(O,i,Y),h(i,f),h(f,u),h(i,c),h(i,d),ve(d,a[4]),T(O,N,Y),T(O,b,Y),h(b,S),h(S,z),h(b,x),h(b,m),h(m,g),h(g,M),h(m,U),h(m,B),ve(B,a[3]),h(b,F),h(b,L),h(L,q),h(q,K),h(L,y),oe(D,L,null),h(b,Z),h(b,le),h(le,ee),h(ee,C),_=!0,I||(X=[P(d,"input",a[9]),P(d,"mousedown",we(a[7])),P(B,"input",a[10]),P(B,"mousedown",we(a[6])),P(ee,"click",a[5])],I=!0)},p(O,Y){const Ee={};!t&&Y&1&&(t=!0,Ee.toggle=O[0],ue(()=>t=!1)),e.$set(Ee),(!_||Y&2)&&Ue(s,O[1]),Y&16&&ve(d,O[4]),Y&8&&B.value!==O[3]&&ve(B,O[3]);const Ne={};!G&&Y&8&&(G=!0,Ne.imageUrl=O[3],ue(()=>G=!1)),D.$set(Ne)},i(O){_||(R(e.$$.fragment,O),R(D.$$.fragment,O),_=!0)},o(O){V(e.$$.fragment,O),V(D.$$.fragment,O),_=!1},d(O){ie(e,O),O&&p(n),O&&p(l),O&&p(r),O&&p(i),O&&p(N),O&&p(b),ie(D),I=!1,ke(X)}}}function wt(a){let e,t;return e=new Pe({props:{pos:a[2],$$slots:{default:[bt]},$$scope:{ctx:a}}}),{c(){ne(e.$$.fragment)},l(n){se(e.$$.fragment,n)},m(n,l){oe(e,n,l),t=!0},p(n,[l]){const o={};l&4&&(o.pos=n[2]),l&32795&&(o.$$scope={dirty:l,ctx:n}),e.$set(o)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function kt(a,e,t){let n,l;Q(a,J,m=>t(12,l=m));let{key:o}=e,{pos:s}=e,{showEditor:r}=e,i=null,f=l[o];const u=f.text===void 0&&f.texto!==void 0?"texto":"text";function c(){re(J,l[o][u]=n,l),i!==null&&re(J,l[o].image=i,l),t(0,r=!1)}function d(m){be.call(this,a,m)}function N(m){be.call(this,a,m)}function b(m){r=m,t(0,r)}function S(){n=this.value,t(4,n),t(13,f)}function z(){i=this.value,t(3,i)}function x(m){i=m,t(3,i)}return a.$$set=m=>{"key"in m&&t(1,o=m.key),"pos"in m&&t(2,s=m.pos),"showEditor"in m&&t(0,r=m.showEditor)},a.$$.update=()=>{a.$$.dirty&2&&re(J,l[o]=f,l)},t(4,n=f[u]),[r,o,s,i,n,c,d,N,b,S,z,x]}class Nt extends ce{constructor(e){super(),fe(this,e,kt,wt,de,{key:1,pos:2,showEditor:0})}}function Et(a){let e,t,n,l,o,s,r,i,f,u,c,d,N,b,S;function z(m){a[7](m)}let x={};return a[0]!==void 0&&(x.toggle=a[0]),e=new Ge({props:x}),$.push(()=>ae(e,"toggle",z)),{c(){ne(e.$$.fragment),n=j(),l=w("div"),o=w("label"),s=W("Btn:"),r=j(),i=w("input"),f=j(),u=w("div"),c=w("button"),d=W("Aceptar"),this.h()},l(m){se(e.$$.fragment,m),n=A(m),l=k(m,"DIV",{});var g=E(l);o=k(g,"LABEL",{for:!0});var M=E(o);s=H(M,"Btn:"),M.forEach(p),r=A(g),i=k(g,"INPUT",{id:!0,type:!0}),g.forEach(p),f=A(m),u=k(m,"DIV",{class:!0});var U=E(u);c=k(U,"BUTTON",{});var B=E(c);d=H(B,"Aceptar"),B.forEach(p),U.forEach(p),this.h()},h(){v(o,"for","inp"),v(i,"id","inp"),v(i,"type","text"),v(u,"class","bar svelte-1bhrmvp")},m(m,g){oe(e,m,g),T(m,n,g),T(m,l,g),h(l,o),h(o,s),h(l,r),h(l,i),ve(i,a[2]),T(m,f,g),T(m,u,g),h(u,c),h(c,d),N=!0,b||(S=[P(i,"input",a[8]),P(i,"mousedown",we(a[6])),P(c,"click",a[3])],b=!0)},p(m,g){const M={};!t&&g&1&&(t=!0,M.toggle=m[0],ue(()=>t=!1)),e.$set(M),g&4&&i.value!==m[2]&&ve(i,m[2])},i(m){N||(R(e.$$.fragment,m),N=!0)},o(m){V(e.$$.fragment,m),N=!1},d(m){ie(e,m),m&&p(n),m&&p(l),m&&p(f),m&&p(u),b=!1,ke(S)}}}function St(a){let e,t;return e=new Pe({props:{pos:a[1],$$slots:{default:[Et]},$$scope:{ctx:a}}}),{c(){ne(e.$$.fragment)},l(n){se(e.$$.fragment,n)},m(n,l){oe(e,n,l),t=!0},p(n,[l]){const o={};l&2&&(o.pos=n[1]),l&2053&&(o.$$scope={dirty:l,ctx:n}),e.$set(o)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function It(a,e,t){let n,l;Q(a,J,b=>t(9,l=b));let{key:o}=e,{pos:s}=e,{showNewOutput:r}=e,i=l[o];const f=i.options===void 0&&i.opciones!==void 0?"opciones":"options";function u(){i[f]===void 0&&t(5,i[f]=[],i),i[f].push({btn:n}),t(0,r=!1),re(J,l[o][f]=i[f],l)}function c(b){be.call(this,a,b)}function d(b){r=b,t(0,r)}function N(){n=this.value,t(2,n)}return a.$$set=b=>{"key"in b&&t(4,o=b.key),"pos"in b&&t(1,s=b.pos),"showNewOutput"in b&&t(0,r=b.showNewOutput)},a.$$.update=()=>{a.$$.dirty&48&&re(J,l[o]=i,l)},t(2,n=""),[r,s,n,u,o,i,c,d,N]}class Tt extends ce{constructor(e){super(),fe(this,e,It,St,de,{key:4,pos:1,showNewOutput:0})}}function Ot(a){let e,t,n,l;const o=a[5].default,s=je(o,a,a[4],null);return{c(){e=w("div"),s&&s.c(),this.h()},l(r){e=k(r,"DIV",{class:!0});var i=E(e);s&&s.l(i),i.forEach(p),this.h()},h(){v(e,"class","scene-node-container svelte-1pja1sh")},m(r,i){T(r,e,i),s&&s.m(e,null),t=!0,n||(l=ye(a[0].call(null,e)),n=!0)},p(r,[i]){s&&s.p&&(!t||i&16)&&Ae(s,o,r,r[4],t?De(o,r[4],i,null):Be(r[4]),null)},i(r){t||(R(s,r),t=!0)},o(r){V(s,r),t=!1},d(r){r&&p(e),s&&s.d(r),n=!1,l()}}}function Ct(a,e,t){let n;Q(a,J,u=>t(3,n=u));let{$$slots:l={},$$scope:o}=e,{key:s}=e,{movingNode:r=!1}=e,i=n[s];i.display===void 0&&(i.display={x:0,y:0,ops:[]});function f(u){let c=!1;u.style.left=`${i.display.x}px`,u.style.top=`${i.display.y}px`,u.addEventListener("mousedown",()=>{c=!0,t(1,r=!0)}),window.addEventListener("mousemove",d=>{c&&(i.display.x+=d.movementX,i.display.y+=d.movementY,u.style.left=`${i.display.x}px`,u.style.top=`${i.display.y}px`,re(J,n[s]=i,n))}),window.addEventListener("mouseup",()=>{c=!1,t(1,r=!1)})}return a.$$set=u=>{"key"in u&&t(2,s=u.key),"movingNode"in u&&t(1,r=u.movingNode),"$$scope"in u&&t(4,o=u.$$scope)},a.$$.update=()=>{a.$$.dirty&12&&(i=n[s])},[f,r,s,n,o,l]}class Mt extends ce{constructor(e){super(),fe(this,e,Ct,Ot,de,{key:2,movingNode:1})}}function Xe(a,e,t){const n=a.slice();return n[33]=e[t],n[35]=t,n}function Ye(a){let e,t,n,l,o;return{c(){e=w("div"),t=w("img"),this.h()},l(s){e=k(s,"DIV",{class:!0});var r=E(e);t=k(r,"IMG",{src:!0,alt:!0,class:!0}),r.forEach(p),this.h()},h(){Le(t.src,n=a[2][a[7]])||v(t,"src",n),v(t,"alt","Preview"),v(t,"class","img-preview svelte-18k76u5"),v(e,"class","img-preview-container svelte-18k76u5")},m(s,r){T(s,e,r),h(e,t),l||(o=ye(a[12].call(null,t)),l=!0)},p(s,r){r[0]&4&&!Le(t.src,n=s[2][s[7]])&&v(t,"src",n)},d(s){s&&p(e),l=!1,o()}}}function Ze(a){let e,t,n,l,o,s,r,i;return{c(){e=w("div"),t=w("input"),l=j(),o=w("div"),s=j(),this.h()},l(f){e=k(f,"DIV",{class:!0});var u=E(e);t=k(u,"INPUT",{type:!0,class:!0,i:!0}),l=A(u),o=k(u,"DIV",{class:!0,i:!0}),E(o).forEach(p),s=A(u),u.forEach(p),this.h()},h(){v(t,"type","text"),v(t,"class","output-text svelte-18k76u5"),t.value=n=a[33].btn,v(t,"i",a[35]),v(o,"class","connection output svelte-18k76u5"),v(o,"i",a[35]),v(e,"class","output-container svelte-18k76u5")},m(f,u){T(f,e,u),h(e,t),h(e,l),h(e,o),h(e,s),r||(i=[ye(a[10].call(null,t)),P(t,"change",a[9]),P(t,"mousedown",we(a[20])),ye(a[11].call(null,o)),ye(a[13].call(null,o)),P(o,"mousedown",we(a[19]))],r=!0)},p(f,u){u[0]&4&&n!==(n=f[33].btn)&&t.value!==n&&(t.value=n)},d(f){f&&p(e),r=!1,ke(i)}}}function Lt(a){let e,t,n,l,o,s,r,i=a[2][a[8]].slice(0,30)+"...",f,u,c,d,N,b,S,z,x,m,g,M,U,B,F,L=a[2][a[7]]!==void 0&&a[2][a[7]]!==null&&Ye(a),q=a[2][a[6]]||[],K=[];for(let y=0;y<q.length;y+=1)K[y]=Ze(Xe(a,q,y));return{c(){e=w("div"),t=j(),n=w("h1"),l=W(a[1]),o=j(),L&&L.c(),s=j(),r=w("p"),f=W(i),u=j(),c=w("div"),d=w("button"),N=W("editar"),b=j(),S=w("button"),z=W("-"),x=j(),m=w("button"),g=W("+"),M=j(),U=w("div");for(let y=0;y<K.length;y+=1)K[y].c();this.h()},l(y){e=k(y,"DIV",{class:!0}),E(e).forEach(p),t=A(y),n=k(y,"H1",{class:!0});var D=E(n);l=H(D,a[1]),D.forEach(p),o=A(y),L&&L.l(y),s=A(y),r=k(y,"P",{class:!0});var G=E(r);f=H(G,i),G.forEach(p),u=A(y),c=k(y,"DIV",{class:!0});var Z=E(c);d=k(Z,"BUTTON",{});var le=E(d);N=H(le,"editar"),le.forEach(p),b=A(Z),S=k(Z,"BUTTON",{});var ee=E(S);z=H(ee,"-"),ee.forEach(p),x=A(Z),m=k(Z,"BUTTON",{});var C=E(m);g=H(C,"+"),C.forEach(p),Z.forEach(p),M=A(y),U=k(y,"DIV",{class:!0});var _=E(U);for(let I=0;I<K.length;I+=1)K[I].l(_);_.forEach(p),this.h()},h(){v(e,"class","connection input svelte-18k76u5"),v(n,"class","svelte-18k76u5"),v(r,"class","text-p svelte-18k76u5"),v(c,"class","node-btns svelte-18k76u5"),v(U,"class","node-outputs svelte-18k76u5")},m(y,D){T(y,e,D),T(y,t,D),T(y,n,D),h(n,l),T(y,o,D),L&&L.m(y,D),T(y,s,D),T(y,r,D),h(r,f),T(y,u,D),T(y,c,D),h(c,d),h(d,N),h(c,b),h(c,S),h(S,z),h(c,x),h(c,m),h(m,g),T(y,M,D),T(y,U,D);for(let G=0;G<K.length;G+=1)K[G].m(U,null);a[22](U),B||(F=[P(e,"mousedown",we(a[21])),P(e,"click",a[14]),P(d,"click",a[16]),P(S,"click",a[15]),P(m,"click",a[17])],B=!0)},p(y,D){if(D[0]&2&&Ue(l,y[1]),y[2][y[7]]!==void 0&&y[2][y[7]]!==null?L?L.p(y,D):(L=Ye(y),L.c(),L.m(s.parentNode,s)):L&&(L.d(1),L=null),D[0]&4&&i!==(i=y[2][y[8]].slice(0,30)+"...")&&Ue(f,i),D[0]&580){q=y[2][y[6]]||[];let G;for(G=0;G<q.length;G+=1){const Z=Xe(y,q,G);K[G]?K[G].p(Z,D):(K[G]=Ze(Z),K[G].c(),K[G].m(U,null))}for(;G<K.length;G+=1)K[G].d(1);K.length=q.length}},d(y){y&&p(e),y&&p(t),y&&p(n),y&&p(o),L&&L.d(y),y&&p(s),y&&p(r),y&&p(u),y&&p(c),y&&p(M),y&&p(U),Me(K,y),a[22](null),B=!1,ke(F)}}}function Qe(a){let e,t,n;function l(s){a[24](s)}let o={key:a[1],pos:a[2].display};return a[4]!==void 0&&(o.showEditor=a[4]),e=new Nt({props:o}),$.push(()=>ae(e,"showEditor",l)),{c(){ne(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,r){oe(e,s,r),n=!0},p(s,r){const i={};r[0]&2&&(i.key=s[1]),r[0]&4&&(i.pos=s[2].display),!t&&r[0]&16&&(t=!0,i.showEditor=s[4],ue(()=>t=!1)),e.$set(i)},i(s){n||(R(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function $e(a){let e,t,n;function l(s){a[25](s)}let o={key:a[1],pos:a[2].display};return a[5]!==void 0&&(o.showNewOutput=a[5]),e=new Tt({props:o}),$.push(()=>ae(e,"showNewOutput",l)),{c(){ne(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,r){oe(e,s,r),n=!0},p(s,r){const i={};r[0]&2&&(i.key=s[1]),r[0]&4&&(i.pos=s[2].display),!t&&r[0]&32&&(t=!0,i.showNewOutput=s[5],ue(()=>t=!1)),e.$set(i)},i(s){n||(R(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function Ut(a){let e,t,n,l,o,s;function r(c){a[23](c)}let i={key:a[1],$$slots:{default:[Lt]},$$scope:{ctx:a}};a[0]!==void 0&&(i.movingNode=a[0]),e=new Mt({props:i}),$.push(()=>ae(e,"movingNode",r));let f=a[4]&&Qe(a),u=a[5]&&$e(a);return{c(){ne(e.$$.fragment),n=j(),f&&f.c(),l=j(),u&&u.c(),o=Je()},l(c){se(e.$$.fragment,c),n=A(c),f&&f.l(c),l=A(c),u&&u.l(c),o=Je()},m(c,d){oe(e,c,d),T(c,n,d),f&&f.m(c,d),T(c,l,d),u&&u.m(c,d),T(c,o,d),s=!0},p(c,d){const N={};d[0]&2&&(N.key=c[1]),d[0]&14|d[1]&32&&(N.$$scope={dirty:d,ctx:c}),!t&&d[0]&1&&(t=!0,N.movingNode=c[0],ue(()=>t=!1)),e.$set(N),c[4]?f?(f.p(c,d),d[0]&16&&R(f,1)):(f=Qe(c),f.c(),R(f,1),f.m(l.parentNode,l)):f&&(Se(),V(f,1,1,()=>{f=null}),Ie()),c[5]?u?(u.p(c,d),d[0]&32&&R(u,1)):(u=$e(c),u.c(),R(u,1),u.m(o.parentNode,o)):u&&(Se(),V(u,1,1,()=>{u=null}),Ie())},i(c){s||(R(e.$$.fragment,c),R(f),R(u),s=!0)},o(c){V(e.$$.fragment,c),V(f),V(u),s=!1},d(c){ie(e,c),c&&p(n),f&&f.d(c),c&&p(l),u&&u.d(c),c&&p(o)}}}function jt(a,e,t){let n,l,o,s,r;Q(a,ct,_=>t(26,_)),Q(a,J,_=>t(18,n=_)),Q(a,at,_=>t(27,l=_)),Q(a,ut,_=>t(28,o=_)),Q(a,ft,_=>t(29,s=_)),Q(a,dt,_=>t(30,r=_));let{key:i}=e,{movingNode:f=!1}=e,u=n[i];const c=o(u),d=r(u),N=s(u);let b,S=!1,z=!1;u.display===void 0&&(u.display={x:0,y:0,ops:[]});function x(){m(this)}function m(_){const I=+_.getAttribute("i");_.style.width=_.value.length*6.1+"px",t(2,u[c][I].btn=_.value,u),M()}function g(_){const I=+_.getAttribute("i");t(2,u.display.ops[I]={x:_.offsetLeft,y:_.offsetTop,rewiring:!1},u),re(J,n[i]=u,n)}function M(){if(b===void 0)return;const _=b.getElementsByClassName("output");for(let I of _)g(I)}function U(){const _=Object.keys(n);for(let I of _){const X=n[I],pe=o(X);for(let te=0;te<X.display.ops.length;te++){const me=l(X[pe][te]);X.display.ops[te].rewiring&&(X.display.ops[te].rewiring=!1,X[pe][te][me]=X.display.ops[te].prevWiring)}re(J,n[I]=X,n)}}function B(_){const I=+_.getAttribute("i");_.addEventListener("click",()=>{U();const X=l(u[c][I]);u.display.ops[I].rewiring||(t(2,u.display.ops[I].prevWiring=u[c][I][X],u),t(2,u.display.ops[I].rewiring=!0,u),t(2,u[c][I][X]=void 0,u))})}function F(){const _=Object.keys(n);let I;for(let te of _){const me=n[te];let he=0;for(let O of me.display.ops)O.rewiring&&(O.rewiring=!1,I={scene:me,i:he}),he++}if(I===void 0)return;const X=o(I.scene),pe=l(I.scene[X][I.i]);I.scene[X][I.i][pe]=i}function L(){u[c]!==void 0&&(u[c].pop(),u.display.ops.pop(),re(J,n[i][c]=u[c],n))}function q(){t(4,S=!0)}function K(){t(5,z=!0)}function y(_){be.call(this,a,_)}function D(_){be.call(this,a,_)}function G(_){be.call(this,a,_)}function Z(_){$[_?"unshift":"push"](()=>{b=_,t(3,b)})}function le(_){f=_,t(0,f)}function ee(_){S=_,t(4,S)}function C(_){z=_,t(5,z)}return a.$$set=_=>{"key"in _&&t(1,i=_.key),"movingNode"in _&&t(0,f=_.movingNode)},a.$$.update=()=>{a.$$.dirty[0]&262146&&t(2,u=n[i])},[f,i,u,b,S,z,c,d,N,x,m,g,M,B,F,L,q,K,n,y,D,G,Z,le,ee,C]}class At extends ce{constructor(e){super(),fe(this,e,jt,Ut,de,{key:1,movingNode:0},null,[-1,-1])}}function et(a,e,t){const n=a.slice();return n[5]=e[t],n[7]=t,n}function tt(a){let e,t,n,l,o;return{c(){e=Re("line"),this.h()},l(s){e=ze(s,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0}),E(e).forEach(p),this.h()},h(){v(e,"class","node-connection svelte-1i9ldxq"),v(e,"x1",t=a[0].display.x+a[5].x+5),v(e,"y1",n=a[0].display.y+a[5].y+10),v(e,"x2",l=a[1][a[7]].x+5),v(e,"y2",o=a[1][a[7]].y+5)},m(s,r){T(s,e,r)},p(s,r){r&1&&t!==(t=s[0].display.x+s[5].x+5)&&v(e,"x1",t),r&1&&n!==(n=s[0].display.y+s[5].y+10)&&v(e,"y1",n),r&2&&l!==(l=s[1][s[7]].x+5)&&v(e,"x2",l),r&2&&o!==(o=s[1][s[7]].y+5)&&v(e,"y2",o)},d(s){s&&p(e)}}}function Bt(a){let e,t=a[0].display.ops||[],n=[];for(let l=0;l<t.length;l+=1)n[l]=tt(et(a,t,l));return{c(){e=Re("g");for(let l=0;l<n.length;l+=1)n[l].c()},l(l){e=ze(l,"g",{});var o=E(e);for(let s=0;s<n.length;s+=1)n[s].l(o);o.forEach(p)},m(l,o){T(l,e,o);for(let s=0;s<n.length;s+=1)n[s].m(e,null)},p(l,[o]){if(o&3){t=l[0].display.ops||[];let s;for(s=0;s<t.length;s+=1){const r=et(l,t,s);n[s]?n[s].p(r,o):(n[s]=tt(r),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},i:ge,o:ge,d(l){l&&p(e),Me(n,l)}}}function Dt(a,e,t){let n,l;Q(a,J,i=>t(4,l=i));let{key:o}=e,{mouse:s}=e,r=l[o];return a.$$set=i=>{"key"in i&&t(2,o=i.key),"mouse"in i&&t(3,s=i.mouse)},a.$$.update=()=>{a.$$.dirty&20&&t(0,r=l[o]),a.$$.dirty&25&&t(1,n=(r.options||r.opciones||[]).map((i,f)=>{const u=i.escena||i.scene;return u===void 0?r.display.ops[f].rewiring?s:r.display:l[u].display}))},[r,n,o,s,l]}class Rt extends ce{constructor(e){super(),fe(this,e,Dt,Bt,de,{key:2,mouse:3})}}function zt(a){let e,t,n,l,o,s,r,i,f,u,c,d,N,b,S;function z(m){a[7](m)}let x={};return a[0]!==void 0&&(x.toggle=a[0]),e=new Ge({props:x}),$.push(()=>ae(e,"toggle",z)),{c(){ne(e.$$.fragment),n=j(),l=w("div"),o=w("label"),s=W("Escena:"),r=j(),i=w("input"),f=j(),u=w("div"),c=w("button"),d=W("Aceptar"),this.h()},l(m){se(e.$$.fragment,m),n=A(m),l=k(m,"DIV",{});var g=E(l);o=k(g,"LABEL",{for:!0});var M=E(o);s=H(M,"Escena:"),M.forEach(p),r=A(g),i=k(g,"INPUT",{id:!0,type:!0}),g.forEach(p),f=A(m),u=k(m,"DIV",{class:!0});var U=E(u);c=k(U,"BUTTON",{});var B=E(c);d=H(B,"Aceptar"),B.forEach(p),U.forEach(p),this.h()},h(){v(o,"for","inp"),v(i,"id","inp"),v(i,"type","text"),v(u,"class","bar svelte-1bhrmvp")},m(m,g){oe(e,m,g),T(m,n,g),T(m,l,g),h(l,o),h(o,s),h(l,r),h(l,i),ve(i,a[2]),T(m,f,g),T(m,u,g),h(u,c),h(c,d),N=!0,b||(S=[P(i,"input",a[8]),P(i,"mousedown",we(a[6])),P(c,"click",a[4])],b=!0)},p(m,g){const M={};!t&&g&1&&(t=!0,M.toggle=m[0],ue(()=>t=!1)),e.$set(M),g&4&&i.value!==m[2]&&ve(i,m[2])},i(m){N||(R(e.$$.fragment,m),N=!0)},o(m){V(e.$$.fragment,m),N=!1},d(m){ie(e,m),m&&p(n),m&&p(l),m&&p(f),m&&p(u),b=!1,ke(S)}}}function Pt(a){let e,t,n;function l(s){a[9](s)}let o={pos:a[3],$$slots:{default:[zt]},$$scope:{ctx:a}};return a[1]!==void 0&&(o.displace=a[1]),e=new Pe({props:o}),$.push(()=>ae(e,"displace",l)),{c(){ne(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,r){oe(e,s,r),n=!0},p(s,[r]){const i={};r&4101&&(i.$$scope={dirty:r,ctx:s}),!t&&r&2&&(t=!0,i.displace=s[1],ue(()=>t=!1)),e.$set(i)},i(s){n||(R(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function Gt(a,e,t){let n,l;Q(a,J,S=>t(11,l=S));let{showNewScene:o}=e,{offset:s}=e,r=l,i={x:s.x*-1+20,y:s.y*-1+20},f;function u(){const S=n.replace(/\s/gi,"_");r[S]={text:"",display:{x:i.x,y:i.y,ops:[]}},re(J,l[S]=r[S],l),t(0,o=!1)}function c(S){be.call(this,a,S)}function d(S){o=S,t(0,o)}function N(){n=this.value,t(2,n)}function b(S){f=S,t(1,f)}return a.$$set=S=>{"showNewScene"in S&&t(0,o=S.showNewScene),"offset"in S&&t(5,s=S.offset)},t(2,n=""),[o,f,n,i,u,s,c,d,N,b]}class Vt extends ce{constructor(e){super(),fe(this,e,Gt,Pt,de,{showNewScene:0,offset:5})}}function nt(a){let e,t,n;function l(s){a[10](s)}let o={offset:a[1]};return a[0]!==void 0&&(o.showNewScene=a[0]),e=new Vt({props:o}),$.push(()=>ae(e,"showNewScene",l)),{c(){ne(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,r){oe(e,s,r),n=!0},p(s,r){const i={};r&2&&(i.offset=s[1]),!t&&r&1&&(t=!0,i.showNewScene=s[0],ue(()=>t=!1)),e.$set(i)},i(s){n||(R(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function Ft(a){let e,t,n,l,o;const s=a[9].default,r=je(s,a,a[8],null);let i=a[0]&&nt(a);return{c(){e=w("div"),r&&r.c(),t=j(),i&&i.c(),this.h()},l(f){e=k(f,"DIV",{class:!0});var u=E(e);r&&r.l(u),t=A(u),i&&i.l(u),u.forEach(p),this.h()},h(){v(e,"class","node-page svelte-1s2cl2m")},m(f,u){T(f,e,u),r&&r.m(e,null),h(e,t),i&&i.m(e,null),n=!0,l||(o=[ye(a[2].call(null,e)),P(e,"mousedown",a[3]),P(e,"mouseup",a[4]),P(e,"mousemove",a[5])],l=!0)},p(f,[u]){r&&r.p&&(!n||u&256)&&Ae(r,s,f,f[8],n?De(s,f[8],u,null):Be(f[8]),null),f[0]?i?(i.p(f,u),u&1&&R(i,1)):(i=nt(f),i.c(),R(i,1),i.m(e,null)):i&&(Se(),V(i,1,1,()=>{i=null}),Ie())},i(f){n||(R(r,f),R(i),n=!0)},o(f){V(r,f),V(i),n=!1},d(f){f&&p(e),r&&r.d(f),i&&i.d(),l=!1,ke(o)}}}function Kt(a,e,t){let n,l,o;Q(a,J,g=>t(12,n=g)),Q(a,at,g=>t(13,l=g)),Q(a,ut,g=>t(14,o=g));let{$$slots:s={},$$scope:r}=e,{movingNode:i}=e,{mouse:f}=e,{showNewScene:u}=e,c=!1;const d={x:0,y:0};function N(g){g.style.left=`${d.x}px`,g.style.top=`${d.y}px`}function b(){const g=Object.keys(n);for(let M of g){const U=n[M],B=o(U);for(let F=0;F<U.display.ops.length;F++){const L=l(U[B][F]);U.display.ops[F].rewiring&&(U.display.ops[F].rewiring=!1,U[B][F][L]=U.display.ops[F].prevWiring)}re(J,n[M]=U,n)}}function S(){c=!0,this.style.cursor="grabbing",b()}function z(){c=!1,this.style.cursor="grab"}function x(g){c&&!i&&(t(1,d.x+=g.movementX,d),t(1,d.y+=g.movementY,d),this.style.left=`${d.x}px`,this.style.top=`${d.y}px`),t(6,f={x:g.offsetX,y:g.offsetY});let M=g.target;for(;M!==this;)t(6,f.x+=M.offsetLeft,f),t(6,f.y+=M.offsetTop,f),M=M.offsetParent}function m(g){u=g,t(0,u)}return a.$$set=g=>{"movingNode"in g&&t(7,i=g.movingNode),"mouse"in g&&t(6,f=g.mouse),"showNewScene"in g&&t(0,u=g.showNewScene),"$$scope"in g&&t(8,r=g.$$scope)},[u,d,N,S,z,x,f,i,r,s,m]}class xt extends ce{constructor(e){super(),fe(this,e,Kt,Ft,de,{movingNode:7,mouse:6,showNewScene:0})}}class Wt{constructor(e="en",t){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,igramaFormat:"png",minigifOptions:{},sceneCallback:n=>n},t&&(this.options=Object.assign(this.options,t)),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[t,n]of Object.entries(e.grammar));return this}setScenes(e){this.scenes=e;for(let t of Object.keys(e)){this.scenes[t].key=t;const n=this.scenes[t].image||this.scenes[t].imagen;n!==void 0&&this.storyPreload[n]===void 0&&(this.storyPreload[n]=new Image,this.storyPreload[n].src=n,this.storyPreload[n].className="storyimage")}return this}setMarkov(e){return this.markov=e,this}expandGrammar(e){const t=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(t)}expandIgrama(e){const t=this.igrama.grammar,n=this.selectGrammarRule(t[e]);return this.grammarRuleRecursion(n,t).split("|").map(o=>this.decodeDrawing(o))}grammarRuleRecursion(e,t){let n=t||this.grammar,l=this.setNewRules(e);const o=l.match(/<[\w\d.,/#]+>/gi);if(!o)return l;for(let s of o){const r=this.defineTransformations(s);l=l.replace(s,()=>{s=s.replace(/[<>]/gi,""),s=s.replace(/#[\w\d.,/]+#/g,"");const i=s.search(/[.]/)>-1?this.getNestedObject(n,s.match(/[\w\d]+/g)):n[s];if(!i){const u=this.lang==="es"?`Se intent\xF3 expandir desde la regla "${s}", pero no se pudo encontrar`:`Tried to expand from rule "${s}", but couldn't find it`;console.error(u)}const f=this.selectGrammarRule(i);return this.transformString(f,r)})}return this.grammarRuleRecursion(l,n)}setNewRules(e,t){let n;t===void 0?n=this.grammar:n=t;let l=e;const o=l.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(o)for(;o.length;){const s=o.pop();l=l.replace(s,"");const{symbol:r,pairsString:i}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(s).groups,f=i.match(/[-]?[\w\d]+:[\w\d]+/gi).map(u=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(u).groups);if(f){n[r]=n[r]||{};for(let u of f){const c=n[u.value];if(!c){const b=this.lang==="es"?`Se intent\xF3 crear la nueva regla "${r}", pero no se pudo encontrar "${u.value}" para producir la subregla "${u.key}"`:`Tried to create new rule: "${r}", but couldn't find "${u.value}" to produce "${u.key}" subrule`;console.error(b)}const d=u.remove==="-",N=this.selectGrammarRule(c);if(d){const b=c.indexOf(N);n[u.value]=[...c.slice(0,b),...c.slice(b+1)]}n[r][u.key]=[N]}}}return l}startAdventure(e){this.options.defaultCSS&&this.setCSS();const t=document.createElement("div");return t.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(t),this.goToScene(this.scenes[e]),this}goToScene(e){const t=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(i=>i.remove()),[...document.getElementsByClassName("storyimage-area")].map(r=>r.remove());const l=document.createElement("div");if(l.className="storydiv",t.appendChild(l),e.image||e.imagen){const r=document.createElement("div");r.className="storyimage-container",l.appendChild(r);const i=e.image||e.imagen,f=this.options.adventureScroll?this.storyPreload[i].cloneNode():this.storyPreload[i];r.appendChild(f),e.areas&&(f.complete?this.setAreas(f,r,e.areas):f.onload=()=>{this.setAreas(f,r,e.areas)})}else if(e.igrama!==void 0){const r=document.createElement("div");r.className="storyimage-container",l.appendChild(r);const i=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(i),this.igramaDataUrl(i,this.options.igramaFormat).then(f=>{const u=new Image;u.src=f,u.className="storyimage",r.appendChild(u)})}const o=document.createElement("div");o.className="storyp-container",(e.text||e.texto||e.igramaText)&&l.appendChild(o);const s=document.createElement("p");s.className="storyp",s.innerHTML="",o.appendChild(s),document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(s,e),this.options.sceneCallback(e)}setAreas(e,t,n){const l=e.getBoundingClientRect(),o=t.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,t,n)},[...document.getElementsByClassName("storyimage-area")].map(r=>r.remove());for(let r of n){let i=document.createElement("div");i.className="storyimage-area";const f=(r.x-Math.floor(r.w/2))*l.width/e.naturalWidth;i.style.left=`${l.left-o.left+f}px`;const u=(r.y-Math.floor(r.h/2))*l.height/e.naturalHeight;i.style.top=`${l.top-o.top+u}px`,i.style.width=`${r.w*l.width/e.naturalWidth}px`,i.style.height=`${r.h*l.height/e.naturalHeight}px`,i.innerHTML=r.btn||"",t.appendChild(i),i.style.fontSize=`${18*l.height/e.naturalHeight}px`,i.onclick=()=>{const c=r.scene||r.escena;this.goToScene(this.scenes[c])},r.tooltip!==void 0&&(i.onmouseover=()=>{i.innerHTML=r.tooltip||"",i.style.zIndex="100"},i.onmouseout=()=>{i.innerHTML=r.btn||"",i.style.zIndex="0"})}}typewriter(e,t){const n=t.text||t.texto||t.igramaText||"";let l=this.grammar?this.grammarRuleRecursion(n):n;if(l=l.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let o=0;const s=setInterval(()=>{const r=l.substring(0,o);e.innerHTML=r,o++,o>l.length&&(clearInterval(s),this.optionButtons(t))},Math.floor(this.options.typewriterSpeed))}else e.innerHTML=l,this.optionButtons(t)}optionButtons(e){const t=[...document.getElementsByClassName("storydiv")],n=t[t.length-1];[...document.getElementsByClassName("storybutton-container")].map(s=>s.remove());const o=document.createElement("div");if(o.className="storybutton-container",n.appendChild(o),e.options||e.opciones){const s=e.options||e.opciones;for(let r of s){const i=document.createElement("button");i.className="storybutton",i.innerHTML=r.btn,o.appendChild(i),i.addEventListener("click",()=>{if((r.text||r.texto)===void 0){const u=r.scene||r.escena;this.goToScene(this.scenes[u])}else this.goToScene(r)})}}else if(e.scene||e.escena){const s=e.scene||e.escena,r=document.createElement("button");r.className="storybutton",r.innerHTML=this.lang==="en"?"Continue":"Continuar",o.appendChild(r),r.addEventListener("click",()=>{this.goToScene(this.scenes[s])})}document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const l=Math.random()*e.prob.reduce((s,r)=>s+r);let o=0;for(let s=0;s<e.prob.length;s++){if(o<=l&&l<o+e.prob[s])return e[s];o+=e.prob[s]}}const t=Math.floor(Math.random()*e.length);return e[t]}getNestedObject(e,t){return t.reduce((n,l)=>n&&n[l]!==void 0?n[l]:void 0,e)}defineTransformations(e){let t={};const n=/#(?<trans>[\w\d,]+)#/gi.exec(e),l=n?n.groups.trans.match(/[\w]+/gi):[];for(let o of l)t[o]=!0;return t}transformString(e,t){let n=e;return t.CAPITALIZE&&(n=n.charAt(0).toUpperCase()+n.slice(1)),t.ALLCAPS&&(n=n.toUpperCase()),n}decodeDrawing(e){if(e==="")return[];const[t,n,l]=e.split("%%");let o={};return t==="vector"?o.content=n.split("**").map(s=>{const[r,i,f]=s.split("&"),u=[];if(u.color=r,u.weight=i,f===void 0)return u;const c=f.split(",");for(let d=0;d<c.length;d+=2)u.push([+c[d],+c[d+1]]);return u}):o.content=n,o.attribute=l,o.type=t,o}async getMarkovModel(e,t=1,n=!1){let l=await(await fetch(`./${e}`)).text();l=l.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const o=l.split(this.markovSeparator),s={};for(let i=0;i<o.length-t;i++){let f="";for(let c=0;c<t;c++)f+=c===0?o[i+c]:" "+o[i+c];s[f]===void 0&&(s[f]={});const u=o[i+t];s[f][u]===void 0?s[f][u]=1:s[f][u]++}const r={};for(let i of Object.keys(s)){const f=Object.keys(s[i]);r[i]={probs:[],grams:f};let u=0;for(let c=0;c<f.length;c++)u+=s[i][f[c]];for(let c=0;c<f.length;c++)r[i].probs[c]=s[i][f[c]]/u}if(n){const i=e.split("/");this.saveJSON(r,`${i[i.length-1]}_markovModel_${t}N.json`)}return r}markovChain(e,t,n=.1){let l=t===void 0||this.markov[t]===void 0?this.randomMarkovWord():t,o=l;for(let r=0;r<e-1;r++){let i=this.getNextMarkov(this.markov[o]);i===void 0&&(i=this.getNextMarkov(this.randomMarkovWord()));let f=o.split(this.markovSeparator);f.push(i),f=f.slice(1).join(" "),o=f,l+=` ${i}`}return this.formatMarkov(l,n)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const t=Math.random();let n=0;if(e!==void 0)for(let l=0;l<e.probs.length;l++){if(n<=t&&t<n+e.probs[l])return e.grams[l];n+=e.probs[l]}}formatMarkov(e,t=.1){let n=e.replace(/ ([,:.;])/g,"$1");return n=n.replaceAll(/([.]) ([\wáéíóú])/ig,(l,o,s,r,i)=>Math.random()<t?`.
${s.toUpperCase()}`:`. ${s.toUpperCase()}`),n.charAt(0).toUpperCase()+n.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),n.setAttribute("download",`${t.includes(".json")?t:t+".json"}`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}testScenes(e){const t=e||this.scenes;if(!t){const l=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(l)}let n=[];for(let l of Object.keys(t)){const o=t[l];if(o.options||o.opciones){const r=(o.options||o.opciones).filter(i=>!t[i.scene||i.escena]);n=[...n,...r.map(i=>`${l} => ${i.btn} => ${i.scene||i.escena}`)]}else{if(o.deadEnd||o.sinSalida)continue;t[o.scene||o.escena]||n.push(`${l} => ${o.scene||o.escena}`)}}if(n.length>0){const l=this.lang==="es"?`Las siguientes escenas no llevan a ning\xFAn lado: ${n.join(", ")}`:`The following scenes are dead ends: ${n.join(", ")}`;console.error(l),this.scenesError=!0}return this}testGrammar(e){const t=e||this.grammar;if(!t){const n=this.lang==="es"?"No hay gram\xE1tica para probar":"There is not grammar to test";console.error(n)}for(let n of Object.keys(t)){const l=t[n];for(let o of l){const s=o.match(/<([\w\d]+)>/gi),r=s?s.map(c=>c.replace(/[<>]/g,"")):[],i=o.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),f=i?i.map(c=>c.match(/([ ]?:[\w\d]+)/g).map(d=>/[ ]?:(?<key>[\w\d]+)/.exec(d).groups.key)).reduce((c,d)=>[...c,...d],[]):[],u=[...r,...f].filter(c=>!t[c]);if(u.length>0){const c=this.lang==="es"?`Las siguientes reglas, que se referencian en "${n}", no existen: ${u.join(", ")}`:`The following rules, referenced in "${n}", do not exist: ${u.join(", ")}`;this.grammarError=!0,console.error(c)}}}return this}testDistribution(e){const t=e||this.markov;if(t===void 0){const f=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(f)}const n={},l={};let o=0;const s=Object.values(t);for(let f of s)for(let u of f.probs){const c=(Math.round(u/.05)*.05).toFixed(2);l[o]=c,o++,n[c]===void 0?n[c]=1:n[c]++}console.log("------------------------------------ DIST ------------------------------------");const r=Math.max(...Object.values(n)),i=Object.entries(n).sort((f,u)=>f[0]>u[0]?1:f[0]<u[0]?-1:0);for(let f of i)console.log(`${f[0]}... ${"|".repeat(Math.ceil(f[1]*100/r))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,t="png",n){const l=await this.igramaDataUrl(e,t),o=new Image;o.src=l,n==null?document.body.appendChild(o):document.getElementById(n).appendChild(o)}async igramaDataUrl(e,t="png"){const n=this.igrama.metadata.width,l=this.igrama.metadata.height;let o=document.createElement("canvas");o.width=n,o.height=l;const s=o.getContext("2d");s.lineJoin="round",s.lineCap="round",s.fillStyle=this.igrama.metadata.bg||"#FFFFFF",s.fillRect(0,0,n,l),await this.drawLayers(e,s);let r;if(t==="png")r=o.toDataURL();else if(t==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener tambi\xE9n la librer\xEDa MiniGif":"To create Gifs you must have also the MiniGif library"),"";const i={colorResolution:7,dither:!1,delay:50};Object.assign(i,this.minigifOptions);const f=new MiniGif(i);f.addFrame(o);const u=this.getLayerWiggle(e);s.fillStyle=this.igrama.metadata.bg||"#FFFFFF",s.fillRect(0,0,n,l),await this.drawLayers(u,s),f.addFrame(o);const c=f.makeGif(),d=await this.base64_arraybuffer(c);r="data:image/gif;base64,"+d}return o.remove(),r}async base64_arraybuffer(e){return(await new Promise(n=>{const l=new FileReader;l.onload=()=>n(l.result),l.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const n=JSON.parse(JSON.stringify(e)),l=(o,s)=>Math.floor(o+Math.random()*(s-o));for(let[o,s]of n.entries())if(s.type==="vector")for(let[r,i]of s.content.entries()){for(let[f,u]of i.entries())Math.random()<.5?u[0]+=l(-3,3):u[1]+=l(-3,3);i.color=e[o].content[r].color,i.weight=e[o].content[r].weight}return n}getIgramaText(e){return e.map(n=>n.attribute).reverse().join(" ").trim()}async drawLayers(e,t){for(let[n,l]of e.entries())if(l.type==="url"){const{w:o,h:s,x:r,y:i}=this.igrama.sections[n];if(this.imgsMemo[l.content]===void 0){const f=new Image;f.src=l.content,this.imgsMemo[l.content]=await new Promise(u=>{f.addEventListener("load",()=>{u(f)},!1)})}t.drawImage(this.imgsMemo[l.content],r,i,o,s)}else if(l.type=="vector")for(let o of l.content){if(o.length===0)continue;const s=this.getSpline(o);this.drawSpline(s,t,o.color,o.weight)}}drawSpline(e,t,n,l){t.lineWidth=l,t.strokeStyle=n,t.fillStyle="rgba(0,0,0,0)",t.beginPath();for(let o=0;o<e.length;o++)o===0?t.moveTo(...e[0]):t.lineTo(...e[o]);t.stroke()}getSpline(e){let t=[];for(let n=0;n<e.length-1;n++){const l=[];l[0]=n>0?e[n-1]:e[0],l[1]=e[n],l[2]=e[n+1],l[3]=n<e.length-2?e[n+2]:e[e.length-1];for(let o=0;o<1;o+=.05){const s=this.getSplinePoint(o,l);t.push(s)}}return t}getSplinePoint(e,t){const n=Math.floor(e)+1,l=n+1,o=l+1,s=n-1,r=e*e,i=r*e,f=-i+2*r-e,u=3*i-5*r+2,c=-3*i+4*r+e,d=i-r,N=.5*(t[s][0]*f+t[n][0]*u+t[l][0]*c+t[o][0]*d),b=.5*(t[s][1]*f+t[n][1]*u+t[l][1]*c+t[o][1]*d);return[N,b]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=Ht,document.getElementsByTagName("head")[0].appendChild(e)}}const Ht=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 10px;
  flex-direction: column;
  box-sizing: border-box;
}

.storyp {
  font-size: 18px;
  min-height: 25px;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: white;
  border-radius: 4px;
  padding: 10px;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: black;
  color: white;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,Jt=Te(Wt);function st(a,e,t){const n=a.slice();return n[17]=e[t],n}function ot(a,e,t){const n=a.slice();return n[17]=e[t],n}function it(a){let e,t,n;function l(s){a[12](s)}let o={key:a[17]};return a[0]!==void 0&&(o.movingNode=a[0]),e=new At({props:o}),$.push(()=>ae(e,"movingNode",l)),{c(){ne(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,r){oe(e,s,r),n=!0},p(s,r){const i={};r&8&&(i.key=s[17]),!t&&r&1&&(t=!0,i.movingNode=s[0],ue(()=>t=!1)),e.$set(i)},i(s){n||(R(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function rt(a){let e,t;return e=new Rt({props:{key:a[17],mouse:a[4]}}),{c(){ne(e.$$.fragment)},l(n){se(e.$$.fragment,n)},m(n,l){oe(e,n,l),t=!0},p(n,l){const o={};l&8&&(o.key=n[17]),l&16&&(o.mouse=n[4]),e.$set(o)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function qt(a){let e,t,n,l=a[3],o=[];for(let u=0;u<l.length;u+=1)o[u]=it(ot(a,l,u));const s=u=>V(o[u],1,1,()=>{o[u]=null});let r=a[3],i=[];for(let u=0;u<r.length;u+=1)i[u]=rt(st(a,r,u));const f=u=>V(i[u],1,1,()=>{i[u]=null});return{c(){for(let u=0;u<o.length;u+=1)o[u].c();e=j(),t=Re("svg");for(let u=0;u<i.length;u+=1)i[u].c();this.h()},l(u){for(let d=0;d<o.length;d+=1)o[d].l(u);e=A(u),t=ze(u,"svg",{class:!0});var c=E(t);for(let d=0;d<i.length;d+=1)i[d].l(c);c.forEach(p),this.h()},h(){v(t,"class","connections-container svelte-szvzme")},m(u,c){for(let d=0;d<o.length;d+=1)o[d].m(u,c);T(u,e,c),T(u,t,c);for(let d=0;d<i.length;d+=1)i[d].m(t,null);n=!0},p(u,c){if(c&9){l=u[3];let d;for(d=0;d<l.length;d+=1){const N=ot(u,l,d);o[d]?(o[d].p(N,c),R(o[d],1)):(o[d]=it(N),o[d].c(),R(o[d],1),o[d].m(e.parentNode,e))}for(Se(),d=l.length;d<o.length;d+=1)s(d);Ie()}if(c&24){r=u[3];let d;for(d=0;d<r.length;d+=1){const N=st(u,r,d);i[d]?(i[d].p(N,c),R(i[d],1)):(i[d]=rt(N),i[d].c(),R(i[d],1),i[d].m(t,null))}for(Se(),d=r.length;d<i.length;d+=1)f(d);Ie()}},i(u){if(!n){for(let c=0;c<l.length;c+=1)R(o[c]);for(let c=0;c<r.length;c+=1)R(i[c]);n=!0}},o(u){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)V(o[c]);i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)V(i[c]);n=!1},d(u){Me(o,u),u&&p(e),u&&p(t),Me(i,u)}}}function Xt(a){let e,t,n,l,o,s,r,i,f,u,c,d,N,b,S,z,x,m,g,M,U,B,F,L,q,K,y,D,G;function Z(C){a[13](C)}function le(C){a[14](C)}let ee={movingNode:a[0],$$slots:{default:[qt,({offset:C})=>({16:C}),({offset:C})=>C?65536:0]},$$scope:{ctx:a}};return a[1]!==void 0&&(ee.showNewScene=a[1]),a[4]!==void 0&&(ee.mouse=a[4]),L=new xt({props:ee}),$.push(()=>ae(L,"showNewScene",Z)),$.push(()=>ae(L,"mouse",le)),{c(){e=w("input"),t=j(),n=w("div"),l=j(),o=w("div"),s=w("div"),r=w("button"),i=W("Nueva Aventura"),f=j(),u=w("label"),c=W("Cargar Aventura"),d=j(),N=w("button"),b=W("Nueva escena"),S=j(),z=w("button"),x=W("Exportar"),m=j(),g=w("button"),M=W("Probar"),U=j(),B=w("div"),F=w("div"),ne(L.$$.fragment),this.h()},l(C){e=k(C,"INPUT",{type:!0,id:!0}),t=A(C),n=k(C,"DIV",{class:!0,id:!0}),E(n).forEach(p),l=A(C),o=k(C,"DIV",{class:!0});var _=E(o);s=k(_,"DIV",{class:!0});var I=E(s);r=k(I,"BUTTON",{class:!0});var X=E(r);i=H(X,"Nueva Aventura"),X.forEach(p),f=A(I),u=k(I,"LABEL",{class:!0,for:!0});var pe=E(u);c=H(pe,"Cargar Aventura"),pe.forEach(p),d=A(I),N=k(I,"BUTTON",{class:!0});var te=E(N);b=H(te,"Nueva escena"),te.forEach(p),S=A(I),z=k(I,"BUTTON",{class:!0});var me=E(z);x=H(me,"Exportar"),me.forEach(p),m=A(I),g=k(I,"BUTTON",{class:!0});var he=E(g);M=H(he,"Probar"),he.forEach(p),I.forEach(p),U=A(_),B=k(_,"DIV",{class:!0});var O=E(B);F=k(O,"DIV",{class:!0});var Y=E(F);se(L.$$.fragment,Y),Y.forEach(p),O.forEach(p),_.forEach(p),this.h()},h(){v(e,"type","file"),v(e,"id","load-input"),e.hidden=!0,v(n,"class","test-story-container svelte-szvzme"),v(n,"id","test-story-container"),v(r,"class","toolbar-button svelte-szvzme"),v(u,"class","toolbar-button svelte-szvzme"),v(u,"for","load-input"),v(N,"class","toolbar-button svelte-szvzme"),v(z,"class","toolbar-button svelte-szvzme"),v(g,"class","toolbar-button svelte-szvzme"),v(s,"class","toolbar svelte-szvzme"),v(F,"class","page-container svelte-szvzme"),v(B,"class","static-page-container svelte-szvzme"),v(o,"class","design-window-container svelte-szvzme")},m(C,_){T(C,e,_),a[11](e),T(C,t,_),T(C,n,_),T(C,l,_),T(C,o,_),h(o,s),h(s,r),h(r,i),h(s,f),h(s,u),h(u,c),h(s,d),h(s,N),h(N,b),h(s,S),h(s,z),h(z,x),h(s,m),h(s,g),h(g,M),h(o,U),h(o,B),h(B,F),oe(L,F,null),y=!0,D||(G=[P(e,"change",a[6]),P(r,"click",a[5]),P(N,"click",a[7]),P(z,"click",a[9]),P(g,"click",a[8])],D=!0)},p(C,[_]){const I={};_&1&&(I.movingNode=C[0]),_&4194329&&(I.$$scope={dirty:_,ctx:C}),!q&&_&2&&(q=!0,I.showNewScene=C[1],ue(()=>q=!1)),!K&&_&16&&(K=!0,I.mouse=C[4],ue(()=>K=!1)),L.$set(I)},i(C){y||(R(L.$$.fragment,C),y=!0)},o(C){V(L.$$.fragment,C),y=!1},d(C){C&&p(e),a[11](null),C&&p(t),C&&p(n),C&&p(l),C&&p(o),ie(L),D=!1,ke(G)}}}function Yt(a){a.scrollIntoView({block:"start"})}function Zt(a,e){const t=document.createElement("a");t.href=URL.createObjectURL(new Blob([JSON.stringify(a,null,2)],{type:"application/json"})),t.setAttribute("download",`${e.includes(".json")?e:e+".json"}`),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Qt(a,e,t){let n,l,o,s;Q(a,J,g=>t(10,o=g)),Q(a,Jt,g=>t(15,s=g));let r=!1,i=!1,f;function u(){re(J,o={},o)}function c(){const g=f.files[0];if(g.type==="application/json"){re(J,o={},o);const M=new FileReader;M.addEventListener("load",function(){const U=M.result,B=JSON.parse(U);re(J,o=B,o)}),this.value=null,M.readAsText(g);return}else alert("Formato de archivo incorrecto / incorrect file format")}function d(){t(1,i=!0)}function N(){const g=document.getElementById("storygeneraldiv");g&&g.remove();const M=new s("es"),U=Object.entries(o).sort((L,q)=>L[1].display.y-q[1].display.y);if(U.length===0){alert("No hay escenas / There are no scenes");return}M.setScenes(o).startAdventure(U[0][0]);const B=document.getElementById("test-story-container"),F=document.getElementById("storygeneraldiv");B.appendChild(F),Yt(F)}function b(){Zt(o,"aventuraInteractiva")}function S(g){$[g?"unshift":"push"](()=>{f=g,t(2,f)})}function z(g){r=g,t(0,r)}function x(g){i=g,t(1,i)}function m(g){n=g,t(4,n)}return a.$$.update=()=>{a.$$.dirty&1024&&t(3,l=Object.keys(o))},t(4,n={x:0,y:0}),[r,i,f,l,n,u,c,d,N,b,o,S,z,x,m]}class $t extends ce{constructor(e){super(),fe(this,e,Qt,Xt,de,{})}}function en(a){let e,t,n,l,o,s,r,i,f;return o=new $t({}),{c(){e=w("section"),t=w("h1"),n=W("Aventura interactiva (beta)"),l=j(),ne(o.$$.fragment),s=j(),r=w("footer"),i=W("Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.1b"),this.h()},l(u){e=k(u,"SECTION",{class:!0});var c=E(e);t=k(c,"H1",{class:!0});var d=E(t);n=H(d,"Aventura interactiva (beta)"),d.forEach(p),l=A(c),se(o.$$.fragment,c),s=A(c),r=k(c,"FOOTER",{class:!0});var N=E(r);i=H(N,"Sergio Rodr\xEDguez G\xF3mez \u2014 2022 \u2014 v0.0.1b"),N.forEach(p),c.forEach(p),this.h()},h(){v(t,"class","svelte-1xxwjho"),v(r,"class","svelte-1xxwjho"),v(e,"class","svelte-1xxwjho")},m(u,c){T(u,e,c),h(e,t),h(t,n),h(e,l),oe(o,e,null),h(e,s),h(e,r),h(r,i),f=!0},p:ge,i(u){f||(R(o.$$.fragment,u),f=!0)},o(u){V(o.$$.fragment,u),f=!1},d(u){u&&p(e),ie(o)}}}class sn extends ce{constructor(e){super(),fe(this,e,null,en,de,{})}}export{sn as default};
