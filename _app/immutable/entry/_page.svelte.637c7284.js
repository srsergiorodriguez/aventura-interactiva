import{S as we,i as ke,s as _e,e as I,a as A,t as G,b as C,d as z,j as U,f as W,g,A as m,l as D,k as b,K as L,n as Ee,L as Se,v as te,M as be,D as le,c as zt,N as Ae,u as Mt,m as Dt,o as jt,p as K,q as Y,O as me,P as pe,F as ae,G as ue,H as ce,I as fe,Q as ge,R as ye,T as ve,U as Ke,r as Be,V as tt,w as Ne,C as je,x as Oe,W as Ue,X as He,z as Ot,Y as Le,Z as Pe,_ as nt}from"../chunks/index.4d86df2e.js";import{w as Qe,r as Te}from"../chunks/index.9d73ec15.js";const Ze=Qe(!0),Fe=Qe(void 0),ne=Qe({inicio:{texto:"Érase una vez un círculo...",display:{x:150,y:90},opciones:[{btn:"dejar tranquilo",escena:"final1"},{btn:"aplastar",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{x:50,y:300}},final2:{texto:"Parece que la historia formó una elipsis",sinSalida:!0,display:{x:230,y:300}}}),At=Te(i=>i.scene===void 0&&i.escena!==void 0?"escena":"scene"),xe=Te(i=>i.options===void 0&&i.opciones!==void 0?"opciones":"options"),Bt=Te(i=>i.text===void 0&&i.texto!==void 0?"texto":"text"),Ut=Te(i=>i.image===void 0&&i.imagen!==void 0?"imagen":"image");function Lt(i,e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([i],{type:e})),n.setAttribute("download",t),document.body.appendChild(n),n.click(),document.body.removeChild(n)}const Rt=Te((i,e)=>{Lt(JSON.stringify(i,null,2),"application/json",`${e.includes(".json")?e:e+".json"}`)}),Vt=Te(i=>{Lt(i,"text/plain;charset=utf-8","index.html")}),Gt=function(i,e,t){return`
<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
  </head>
  <body>
  </body>
  <script>
    const lang = "es";
    const options = {typewriterSpeed: 20, defaultCSS: false};
  <\/script>
  <style>
    
  #storygeneraldiv {
    box-sizing: border-box;
    margin: auto;
    max-width: 600px;
    font-family: 'Courier New', Courier, monospace;
    background: white;
  }
  
  .storydiv {
    border: solid black 1px;
    width: 100%;
    display: flex;
    padding: 10px;
    flex-direction: column;
    box-sizing: border-box;
  }
  
  .storyp {
    font-size: 18px;
    min-height: 25px;
  }
  
  .storybutton-container {
    margin: auto;
  }
  
  .storybutton {
    background: white;
    box-shadow: none;
    border: solid 1px;
    margin: 0px 1em 0px 0px;
    font-size: 20px;
    font-family: 'Courier New', Courier, monospace;
    cursor: pointer;
  }
  
  .storybutton:hover {
    color: white;
    background: black;
  }
  
  .storyimage-container {
    box-sizing: content-box;
    position: relative;
    width: 100%;
    margin: auto;
  }
  
  .storyimage {
    justify-content: center;
    width: 100%;
    margin: auto;
    border-radius: 20px;
    display: block;
  }
  
  .storyimage-area {
    font-size: 14px;
    position: absolute;
    cursor: pointer;
    text-align: center;
    color: black;
    background: #ffffff00;
    border: solid 1px black;
  }
  
  .storyimage-area:hover {
    background: #ffffff33;
  }
  
  @media screen and (max-device-width: 500px) {
    #storygeneraldiv {
      max-width:100%;
    }
    .storyp {
      font-size: 7vw;
    }
    .storybutton {
      font-size: 10vw;
    }
  }
  
  </style>
  <script>
    const A = ${i}
  <\/script>
  <script>
    const scenes = ${e};
    const aventura = new A(lang, options);
    aventura.setScenes(scenes).startAdventure('${t}');
  <\/script>
</html>
`},Wt=Te(Gt);class Ft{constructor(e="en",t){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,adventureSlide:!0,evalTags:!1,igramaFormat:"png",urlWord:"URL",vizWidth:1e3,vizHeight:1e3,vizBg:"#313131",vizCol:"black",vizImageSize:50,vizLoading:!0,minigifOptions:{},sceneCallback:n=>n},t&&(this.options=Object.assign(this.options,this.setOptionsTranslations(t))),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.fijarDatosEscenas=this.setDataScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setOptionsTranslations(e){const t={velocidadMaquina:"typewriterSpeed",CSSporDefecto:"defaultCSS",contenedorAventura:"adventureContainer",rolloAventura:"adventureScroll",deslizarAImagen:"adventureSlide",ejecutarEtiquetas:"evalTags",formatoIgrama:"igramaFormat",palabraUrl:"urlWord",anchoVis:"vizWidth",altoVis:"vizHeight",fondoVis:"vizBg",colorVis:"vizCol",tamanoImagenVis:"visImageSize",cargandoVis:"vizLoading",opcionesMinigif:"minigifOptions",funcionEscena:"sceneCallback"};for(let[n,o]of Object.entries(e))t[n]!==void 0&&(e[t[n]]=o,delete e[n]);return e}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[t,n]of Object.entries(e.grammar));return this}setScenes(e){this.options.defaultCSS&&this.setCSS(),this.scenes=e;for(let t of Object.keys(e)){this.scenes[t].key=t;const n=this.scenes[t].image||this.scenes[t].imagen;n!==void 0&&this.storyPreload[n]===void 0&&(this.storyPreload[n]=new Image,this.storyPreload[n].src=n,this.storyPreload[n].className="storyimage")}return this}async setDataScenes(e,t=void 0,n=[]){if(this.options.defaultCSS&&this.setCSS(),typeof d3>"u"){console.error(this.lang==="es"?"Para crear visualizaciones debes tener también la librería D3":"To create visualizations you must have also the D3 library");return}return this.scenes=JSON.parse(JSON.stringify(e)),this.metaKeys=n,t!==void 0&&(this.data=JSON.parse(JSON.stringify(t)),await this.setViz(this.scenes,this.data)),this.setScenes(this.scenes),this}async setViz(e,t){const n=Object.keys(e),o={compare:Kt,scatter:Ht,pack:qt};let s=0;for(let c of n)e[c].viz!==void 0&&s++;let r=0,l;const a=this.lang==="en"?"Loading...":"Cargando...";this.options.vizLoading&&(l=document.createElement("div"),l.id="storygeneraldiv",l.className="storydiv",l.textContent=a,(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(l));function f(c,u=15){let p="";for(let d=0;d<Math.ceil(u);d++)p+=d<c*u?"|":"-";return p}for(let c of n){if(e[c].viz===void 0)continue;const{filter:u,type:p,x:d,y:w}=e[c].viz;if(o[p]===void 0||d===void 0||w===void 0){const v=this.lang==="es"?`Parámetros incorrectos de visualización en la escena "${c}"`:`Incorrect parameteres in the scene "${c}"`;console.error(v)}let N=t;for(let v of u)N=this.filterFn(v)(N);let y=r;const{viz:k,areas:h}=await o[p](this,N,d,w,v=>{r=y+v/s;const _=Math.ceil(r*100);this.options.vizLoading&&(l.textContent=`${a} ${f(r)} ${_}%`)});e[c].image=k,e[c].areas=h}for(let c of t){if(c.ID===void 0){const u=this.lang==="es"?"Todos los datos deben tener un valor único con la clave ID":"All data must have a unique value with the ID key";console.error(u),this.scenes={};break}e[`ind_${c.ID}`]={text:`${c.CONT||""}`,meta:c.ID,dataScene:!0,options:[{btn:"<<<",scene:`ind_${c.ID}`}]},c.IMGURL!==void 0&&(e[`ind_${c.ID}`].image=c.IMGURL),c.URL!==void 0&&(e[`ind_${c.ID}`].url=c.URL)}l.remove()}filterFn(e){const t=e[1];if(t==="="||t==="=="||t==="===")return o=>o.filter(s=>n(s[e[0]])==n(e[2]));return t==="<"?o=>o.filter(s=>n(s[e[0]])<n(e[2])):t===">"?o=>o.filter(s=>n(s[e[0]])>n(e[2])):o=>o;function n(o){return o==="true"?!0:o==="false"?!1:o}}setMarkov(e){return this.markov=e,this}expandGrammar(e){const t=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(t)}expandIgrama(e){const t=this.igrama.grammar,n=this.selectGrammarRule(t[e]);return this.grammarRuleRecursion(n,t).split("|").map(s=>this.decodeDrawing(s))}grammarRuleRecursion(e,t){let n=t||this.grammar,o=this.setNewRules(e);const s=o.match(/<[\w\d.,/#]+>/gi);if(!s)return o;for(let r of s){const l=this.defineTransformations(r);o=o.replace(r,()=>{r=r.replace(/[<>]/gi,""),r=r.replace(/#[\w\d.,/]+#/g,"");const a=r.search(/[.]/)>-1?this.getNestedObject(n,r.match(/[\w\d]+/g)):n[r];if(!a){const c=this.lang==="es"?`Se intentó expandir desde la regla "${r}", pero no se pudo encontrar`:`Tried to expand from rule "${r}", but couldn't find it`;console.error(c)}const f=this.selectGrammarRule(a);return this.transformString(f,l)})}return this.grammarRuleRecursion(o,n)}setNewRules(e,t){let n;t===void 0?n=this.grammar:n=t;let o=e;const s=o.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(s)for(;s.length;){const r=s.pop();o=o.replace(r,"");const{symbol:l,pairsString:a}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(r).groups,f=a.match(/[-]?[\w\d]+:[\w\d]+/gi).map(c=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(c).groups);if(f){n[l]=n[l]||{};for(let c of f){const u=n[c.value];if(!u){const w=this.lang==="es"?`Se intentó crear la nueva regla "${l}", pero no se pudo encontrar "${c.value}" para producir la subregla "${c.key}"`:`Tried to create new rule: "${l}", but couldn't find "${c.value}" to produce "${c.key}" subrule`;console.error(w)}const p=c.remove==="-",d=this.selectGrammarRule(u);if(p){const w=u.indexOf(d);n[c.value]=[...u.slice(0,w),...u.slice(w+1)]}n[l][c.key]=[d]}}}return o}startAdventure(e){const t=document.createElement("div");return t.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(t),this.prevScene=e,this.goToScene(this.scenes[e]),this}goToScene(e){const t=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(a=>a.remove()),[...document.getElementsByClassName("storyimage-area")].map(l=>l.remove());const o=document.createElement("div");if(o.className="storydiv",t.appendChild(o),e.image||e.imagen){const l=document.createElement("div");l.className="storyimage-container",o.appendChild(l);const a=e.image||e.imagen,f=this.options.adventureScroll?this.storyPreload[a].cloneNode():this.storyPreload[a];l.appendChild(f),e.areas&&(f.complete?this.setAreas(f,l,e.areas):f.onload=()=>{this.setAreas(f,l,e.areas)})}else if(e.igrama!==void 0){const l=document.createElement("div");l.className="storyimage-container",o.appendChild(l);const a=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(a),this.igramaDataUrl(a,this.options.igramaFormat).then(f=>{const c=new Image;c.src=f,c.className="storyimage",l.appendChild(c)})}if(e.title||e.titulo){const l=document.createElement("div");l.className="storytitle-container",o.appendChild(l);const a=document.createElement("h1");a.className="storytitle",a.textContent=e.title||e.titulo,l.appendChild(a)}if(e.meta!==void 0){const l=document.createElement("div");l.className="storymeta-container",o.appendChild(l);const a=this.data.find(f=>f.ID==e.meta);for(let f of this.metaKeys){if(a[f]===void 0)continue;const c=document.createElement("div");c.className="storymeta-subcontainer",l.appendChild(c);const u=document.createElement("span");u.className="storymeta-key",u.textContent=`${f}: `,c.appendChild(u);const p=document.createElement("span");p.className="storymeta-val",p.textContent=a[f],c.appendChild(p)}}const s=document.createElement("div");s.className="storyp-container",(e.text||e.texto||e.igramaText)&&o.appendChild(s);const r=document.createElement("p");if(r.className="storyp",r.textContent="",s.appendChild(r),e.url){const l=document.createElement("a");l.className="storyurl",l.href=e.url,l.target="_blank",l.textContent=this.options.urlWord,s.appendChild(l)}this.options.adventureSlide&&document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(r,e),this.data&&(e.viz!==void 0?this.prevScene=e.key:e.dataScene===!0&&(e.options[0].scene=this.prevScene)),this.options.sceneCallback(e)}setAreas(e,t,n){const o=e.getBoundingClientRect(),s=t.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,t,n)},[...document.getElementsByClassName("storyimage-area")].map(l=>l.remove());for(let l of n){let a=document.createElement("div");a.className="storyimage-area";const f=(l.x-Math.floor(l.w/2))*o.width/e.naturalWidth;a.style.left=`${o.left-s.left+f}px`;const c=(l.y-Math.floor(l.h/2))*o.height/e.naturalHeight;a.style.top=`${o.top-s.top+c}px`,a.style.width=`${l.w*o.width/e.naturalWidth}px`,a.style.height=`${l.h*o.height/e.naturalHeight}px`,a.textContent=l.btn||"",f>0&&f<o.width&&c>0&&c<o.height&&t.appendChild(a),a.style.fontSize=`${18*o.height/e.naturalHeight}px`,a.onclick=()=>{const u=l.scene||l.escena;this.goToScene(this.scenes[u])},l.tooltip!==void 0&&(a.onmouseover=()=>{a.textContent=l.tooltip||"",a.style.zIndex="100"},a.onmouseout=()=>{a.textContent=l.btn||"",a.style.zIndex="0"})}}async typewriter(e,t){const n=t.text||t.texto||t.igramaText||"";let o=this.grammar?this.grammarRuleRecursion(n):n;if(o=o.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let s=0;await new Promise(r=>{const l=setInterval(()=>{const a=o.substring(0,s);this.options.evalTags?e.innerHTML=a:e.textContent=a,s++,s>o.length&&(clearInterval(l),r(!0))},Math.floor(this.options.typewriterSpeed))}),this.optionButtons(t)}else this.options.evalTags?e.innerHTML=o:e.textContent=o,this.optionButtons(t)}optionButtons(e){const t=[...document.getElementsByClassName("storydiv")],n=t[t.length-1];[...document.getElementsByClassName("storybutton-container")].map(r=>r.remove());const s=document.createElement("div");if(s.className="storybutton-container",n.appendChild(s),e.options||e.opciones){const r=e.options||e.opciones;for(let l of r){const a=document.createElement("button");a.className="storybutton",a.textContent=l.btn,s.appendChild(a),a.addEventListener("click",()=>{if((l.text||l.texto)===void 0){const c=l.scene||l.escena;this.goToScene(this.scenes[c])}else this.goToScene(l)})}}else if(e.scene||e.escena){const r=e.scene||e.escena,l=document.createElement("button");l.className="storybutton",l.textContent=this.lang==="en"?"Continue":"Continuar",s.appendChild(l),l.addEventListener("click",()=>{this.goToScene(this.scenes[r])})}this.options.adventureSlide&&document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const o=Math.random()*e.prob.reduce((r,l)=>r+l);let s=0;for(let r=0;r<e.prob.length;r++){if(s<=o&&o<s+e.prob[r])return e[r];s+=e.prob[r]}}const t=Math.floor(Math.random()*e.length);return e[t]}getNestedObject(e,t){return t.reduce((n,o)=>n&&n[o]!==void 0?n[o]:void 0,e)}defineTransformations(e){let t={};const n=/#(?<trans>[\w\d,]+)#/gi.exec(e),o=n?n.groups.trans.match(/[\w]+/gi):[];for(let s of o)t[s]=!0;return t}transformString(e,t){let n=e;return t.CAPITALIZE&&(n=n.charAt(0).toUpperCase()+n.slice(1)),t.ALLCAPS&&(n=n.toUpperCase()),n}decodeDrawing(e){if(e==="")return[];const[t,n,o]=e.split("%%");let s={};return t==="vector"?s.content=n.split("**").map(r=>{const[l,a,f]=r.split("&"),c=[];if(c.color=l,c.weight=a,f===void 0)return c;const u=f.split(",");for(let p=0;p<u.length;p+=2)c.push([+u[p],+u[p+1]]);return c}):s.content=n,s.attribute=o,s.type=t,s}async getMarkovModel(e,t=1,n=!1){let o=await(await fetch(`./${e}`)).text();o=o.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const s=o.split(this.markovSeparator),r={};for(let a=0;a<s.length-t;a++){let f="";for(let u=0;u<t;u++)f+=u===0?s[a+u]:" "+s[a+u];r[f]===void 0&&(r[f]={});const c=s[a+t];r[f][c]===void 0?r[f][c]=1:r[f][c]++}const l={};for(let a of Object.keys(r)){const f=Object.keys(r[a]);l[a]={probs:[],grams:f};let c=0;for(let u=0;u<f.length;u++)c+=r[a][f[u]];for(let u=0;u<f.length;u++)l[a].probs[u]=r[a][f[u]]/c}if(n){const a=e.split("/");this.saveJSON(l,`${a[a.length-1]}_markovModel_${t}N.json`)}return l}markovChain(e,t,n=.1){let o=t===void 0||this.markov[t]===void 0?this.randomMarkovWord():t,s=o;for(let l=0;l<e-1;l++){let a=this.getNextMarkov(this.markov[s]);a===void 0&&(a=this.getNextMarkov(this.randomMarkovWord()));let f=s.split(this.markovSeparator);f.push(a),f=f.slice(1).join(" "),s=f,o+=` ${a}`}return this.formatMarkov(o,n)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const t=Math.random();let n=0;if(e!==void 0)for(let o=0;o<e.probs.length;o++){if(n<=t&&t<n+e.probs[o])return e.grams[o];n+=e.probs[o]}}formatMarkov(e,t=.1){let n=e.replace(/ ([,:.;])/g,"$1");return n=n.replaceAll(/([.]) ([\wáéíóú])/ig,(o,s,r,l,a)=>Math.random()<t?`.
${r.toUpperCase()}`:`. ${r.toUpperCase()}`),n.charAt(0).toUpperCase()+n.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),n.setAttribute("download",`${t.includes(".json")?t:t+".json"}`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}testScenes(e){const t=e||this.scenes;if(!t){const o=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(o)}let n=[];for(let o of Object.keys(t)){const s=t[o];if(s.options||s.opciones){const l=(s.options||s.opciones).filter(a=>!t[a.scene||a.escena]);n=[...n,...l.map(a=>`${o} => ${a.btn} => ${a.scene||a.escena}`)]}else{if(s.deadEnd||s.sinSalida)continue;t[s.scene||s.escena]||n.push(`${o} => ${s.scene||s.escena}`)}}if(n.length>0){const o=this.lang==="es"?`Las siguientes escenas no llevan a ningún lado: ${n.join(", ")}`:`The following scenes are dead ends: ${n.join(", ")}`;console.error(o),this.scenesError=!0}return this}testGrammar(e){const t=e||this.grammar;if(!t){const n=this.lang==="es"?"No hay gramática para probar":"There is not grammar to test";console.error(n)}for(let n of Object.keys(t)){const o=t[n];for(let s of o){const r=s.match(/<([\w\d]+)>/gi),l=r?r.map(u=>u.replace(/[<>]/g,"")):[],a=s.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),f=a?a.map(u=>u.match(/([ ]?:[\w\d]+)/g).map(p=>/[ ]?:(?<key>[\w\d]+)/.exec(p).groups.key)).reduce((u,p)=>[...u,...p],[]):[],c=[...l,...f].filter(u=>!t[u]);if(c.length>0){const u=this.lang==="es"?`Las siguientes reglas, que se referencian en "${n}", no existen: ${c.join(", ")}`:`The following rules, referenced in "${n}", do not exist: ${c.join(", ")}`;this.grammarError=!0,console.error(u)}}}return this}testDistribution(e){const t=e||this.markov;if(t===void 0){const f=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(f)}const n={},o={};let s=0;const r=Object.values(t);for(let f of r)for(let c of f.probs){const u=(Math.round(c/.05)*.05).toFixed(2);o[s]=u,s++,n[u]===void 0?n[u]=1:n[u]++}console.log("------------------------------------ DIST ------------------------------------");const l=Math.max(...Object.values(n)),a=Object.entries(n).sort((f,c)=>f[0]>c[0]?1:f[0]<c[0]?-1:0);for(let f of a)console.log(`${f[0]}... ${"|".repeat(Math.ceil(f[1]*100/l))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,t="png",n){const o=await this.igramaDataUrl(e,t),s=new Image;s.src=o,n==null?document.body.appendChild(s):document.getElementById(n).appendChild(s)}async igramaDataUrl(e,t="png"){const n=this.igrama.metadata.width,o=this.igrama.metadata.height;let s=document.createElement("canvas");s.width=n,s.height=o;const r=s.getContext("2d");r.lineJoin="round",r.lineCap="round",r.fillStyle=this.igrama.metadata.bg||"#FFFFFF",r.fillRect(0,0,n,o),await this.drawLayers(e,r);let l;if(t==="png")l=s.toDataURL();else if(t==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener también la librería MiniGif":"To create Gifs you must have also the MiniGif library"),"";const a={colorResolution:7,dither:!1,delay:50};Object.assign(a,this.minigifOptions);const f=new MiniGif(a);f.addFrame(s);const c=this.getLayerWiggle(e);r.fillStyle=this.igrama.metadata.bg||"#FFFFFF",r.fillRect(0,0,n,o),await this.drawLayers(c,r),f.addFrame(s);const u=f.makeGif();l="data:image/gif;base64,"+await this.base64_arraybuffer(u)}return s.remove(),l}async base64_arraybuffer(e){return(await new Promise(n=>{const o=new FileReader;o.onload=()=>n(o.result),o.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const n=JSON.parse(JSON.stringify(e)),o=(s,r)=>Math.floor(s+Math.random()*(r-s));for(let[s,r]of n.entries())if(r.type==="vector")for(let[l,a]of r.content.entries()){for(let[f,c]of a.entries())Math.random()<.5?c[0]+=o(-3,3):c[1]+=o(-3,3);a.color=e[s].content[l].color,a.weight=e[s].content[l].weight}return n}getIgramaText(e){return e.map(n=>n.attribute).reverse().join(" ").trim()}async drawLayers(e,t){for(let[n,o]of e.entries())if(o.type==="url"){const{w:s,h:r,x:l,y:a}=this.igrama.sections[n];if(this.imgsMemo[o.content]===void 0){const f=new Image;f.src=o.content,this.imgsMemo[o.content]=await new Promise(c=>{f.addEventListener("load",()=>{c(f)},!1)})}t.drawImage(this.imgsMemo[o.content],l,a,s,r)}else if(o.type=="vector")for(let s of o.content){if(s.length===0)continue;const r=this.getSpline(s);this.drawSpline(r,t,s.color,s.weight)}}drawSpline(e,t,n,o){t.lineWidth=o,t.strokeStyle=n,t.fillStyle="rgba(0,0,0,0)",t.beginPath();for(let s=0;s<e.length;s++)s===0?t.moveTo(...e[0]):t.lineTo(...e[s]);t.stroke()}getSpline(e){let t=[];for(let n=0;n<e.length-1;n++){const o=[];o[0]=n>0?e[n-1]:e[0],o[1]=e[n],o[2]=e[n+1],o[3]=n<e.length-2?e[n+2]:e[e.length-1];for(let s=0;s<1;s+=.05){const r=this.getSplinePoint(s,o);t.push(r)}}return t}getSplinePoint(e,t){const n=Math.floor(e)+1,o=n+1,s=o+1,r=n-1,l=e*e,a=l*e,f=-a+2*l-e,c=3*a-5*l+2,u=-3*a+4*l+e,p=a-l,d=.5*(t[r][0]*f+t[n][0]*c+t[o][0]*u+t[s][0]*p),w=.5*(t[r][1]*f+t[n][1]*c+t[o][1]*u+t[s][1]*p);return[d,w]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=Jt,document.getElementsByTagName("head")[0].appendChild(e)}}async function Kt(i,e,t,n,o=()=>{}){const s=[e.find(N=>N.ID==t),e.find(N=>N.ID==n)],r=i.options.vizWidth,l=i.options.vizHeight;let a=0;const f=[];for(let N of s){const y=new Image;y.setAttribute("crossorigin","anonymous"),y.src=N.IMGURL,await new Promise(k=>{y.onload=()=>{k(!0)}}),f.push({url:N.IMGURL,img:y,ID:N.ID}),o(a/s.length),a++}const c=document.createElement("canvas"),u=c.getContext("2d");c.width=r,c.height=l,u.fillStyle=i.options.vizBg,u.fillRect(0,0,r,l);const p=[];let d=0;for(let N of f){const y=parseInt(r/2)*.1,k=parseInt(r/2)-y,h=parseInt(k*N.img.height/N.img.width),v=d*(k+y)+k/2+y/2,_=l/2;u.save(),u.translate(-k/2,-h/2),u.drawImage(N.img,v,_,k,h),u.restore();const S={x:v,y:_,w:k,h,btn:"",scene:`ind_${N.ID}`,tooltip:""};p.push(S),d++}const w=c.toDataURL("image/png");return c.remove(),{viz:w,areas:p}}async function Ht(i,e,t,n,o=()=>{}){const s=i.options.vizWidth,r=i.options.vizHeight,l=i.options.vizImageSize,a={l:.2*s,r:.1*s,t:.1*r,b:.1*r},f=s-a.l-a.r,c=r-a.t-a.b,u=e,p=[...new Set(u.map(T=>T[t]))],d=[...new Set(u.map(T=>T[n]))],w=d3.scalePoint().domain(p).range([0,f]).padding(.5).round(!0),N=d3.scalePoint().domain(d).range([0,c]).padding(.5).round(!0);let y=0;const k=[];for(let T of u){if(i.imgsMemo[T.IMGURL]===void 0){const V=new Image;V.setAttribute("crossorigin","anonymous"),V.src=T.IMGURL,i.imgsMemo[T.IMGURL]=await new Promise(j=>{V.onload=()=>{j(V)}})}k.push({url:T.IMGURL,x:w(T[t]),y:N(T[n]),img:i.imgsMemo[T.IMGURL],r:l,ID:T.ID}),o(y/u.length),y++}d3.forceSimulation(k).force("charge",d3.forceManyBody().strength(5)).force("collide",d3.forceCollide(10)).tick(200);const h=document.createElement("canvas"),v=h.getContext("2d");h.width=s,h.height=r,v.fillStyle=i.options.vizBg,v.fillRect(0,0,s,r),v.strokeStyle=i.options.vizCol,v.font="14px serif",v.textBaseline="middle",v.textAlign="center";for(let T of p)v.fillStyle=i.options.vizCol,v.fillText(T,a.l+w(T),a.t+c+a.b/2);v.beginPath(),v.moveTo(a.l,a.t+c),v.lineTo(a.l+f,a.t+c),v.stroke(),v.textAlign="right";for(let T of d)v.fillStyle=i.options.vizCol,v.fillText(T,a.l-5,a.t+N(T));v.beginPath(),v.moveTo(a.l,a.t),v.lineTo(a.l,a.t+c),v.stroke(),v.strokeStyle=i.options.vizCol;const _=[];for(let T of k){const V=l,j=V*T.img.height/T.img.width,R=T.x+a.l,J=T.y+a.t;v.save(),v.translate(-V/2,-j/2),v.drawImage(T.img,R,J,V,j),v.restore();const F={x:R,y:J,w:V,h:j,btn:"",scene:`ind_${T.ID}`,tooltip:""};_.push(F)}const S=h.toDataURL("image/png");return h.remove(),{viz:S,areas:_}}async function qt(i,e,t,n,o=()=>{}){const s=i.options.vizWidth,r=i.options.vizHeight,l=e,a=d3.rollup(l,_=>_.length,_=>_[t],_=>_[n]),f=([_,S])=>S.size&&Array.from(S),c=d3.hierarchy(a,f).sum(([,_])=>_).sort((_,S)=>S.value-_.value),u=[...d3.schemeGreys[4]].reverse(),p=c.descendants(),d=_=>u[_];d3.pack(c).size([s,r]).padding(20)(c);const w=[];let N=0;for(let _ of l){for(let S of c.leaves())if(_[t]===S.parent.data[0]&&_[n]===S.data[0]){if(i.imgsMemo[_.IMGURL]===void 0){const T=new Image;T.setAttribute("crossorigin","anonymous"),T.src=_.IMGURL,i.imgsMemo[_.IMGURL]=await new Promise(V=>{T.onload=()=>{V(T)}})}w.push({url:_.IMGURL,x:S.x,y:S.y,r:i.options.vizImageSize,img:i.imgsMemo[_.IMGURL],ID:_.ID})}o(N/l.length),N++}d3.forceSimulation(w).force("collide",d3.forceCollide(20)).tick(200);const y=document.createElement("canvas"),k=y.getContext("2d");y.width=s,y.height=r,k.fillStyle=i.options.vizBg,k.fillRect(0,0,s,r),k.font="12px serif",k.textBaseline="middle",k.textAlign="center";for(let _ of p)k.save(),k.translate(_.x,_.y),k.strokeStyle=i.options.vizCol,k.fillStyle=d(_.depth),k.beginPath(),k.ellipse(0,0,_.r,_.r,0,0,Math.PI*2),k.fill(),k.stroke(),k.fillStyle=i.options.vizCol,k.fillText(_.depth===1||_.depth===2?_.data[0]:"",0,-_.r-5),k.restore();const h=[];for(let _ of w){const S=parseInt(50),T=parseInt(S*_.img.height/_.img.width),V=_.x,j=_.y;k.save(),k.translate(-S/2,-T/2),k.drawImage(_.img,V,j,S,T),k.restore();const R={x:V,y:j,w:S,h:T,btn:"",scene:`ind_${_.ID}`,tooltip:""};h.push(R)}const v=y.toDataURL("image/png");return y.remove(),{viz:v,areas:h}}const Jt=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  box-sizing: border-box;
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 1em;
  flex-direction: column;
}

.storytitle {
  font-size: 2em;
  margin: 0.1em 0;
}

.storyp {
  font-size: 1em;
}

.storymeta-container {
  margin: 0.5em 0;
}

.storymeta-key {
  font-weight: 700;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  box-sizing: border-box;
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: #ffffff00;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: #ffffff33;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,Pt=Te(Ft);function Xt(i){let e,t,n,o,s,r,l,a,f,c,u,p,d,w,N,y,k,h,v,_,S,T,V,j;return{c(){e=I("div"),t=I("input"),n=A(),o=I("div"),s=I("button"),r=G("Nuevo proyecto"),l=A(),a=I("label"),f=G("Importar"),c=A(),u=I("button"),p=G("Exportar"),d=A(),w=I("button"),N=G("Previsualizar"),y=A(),k=I("button"),h=G("Generar interactivo final"),v=A(),_=I("div"),S=I("button"),T=G("Nueva escena"),this.h()},l(R){e=C(R,"DIV",{class:!0});var J=z(e);t=C(J,"INPUT",{type:!0,id:!0}),n=U(J),o=C(J,"DIV",{class:!0});var F=z(o);s=C(F,"BUTTON",{class:!0});var Q=z(s);r=W(Q,"Nuevo proyecto"),Q.forEach(g),l=U(F),a=C(F,"LABEL",{class:!0,for:!0});var x=z(a);f=W(x,"Importar"),x.forEach(g),c=U(F),u=C(F,"BUTTON",{class:!0});var Z=z(u);p=W(Z,"Exportar"),Z.forEach(g),d=U(F),w=C(F,"BUTTON",{class:!0});var P=z(w);N=W(P,"Previsualizar"),P.forEach(g),y=U(F),k=C(F,"BUTTON",{class:!0});var $=z(k);h=W($,"Generar interactivo final"),$.forEach(g),F.forEach(g),v=U(J),_=C(J,"DIV",{class:!0});var se=z(_);S=C(se,"BUTTON",{class:!0});var X=z(S);T=W(X,"Nueva escena"),X.forEach(g),se.forEach(g),J.forEach(g),this.h()},h(){m(t,"type","file"),m(t,"id","load-input"),t.hidden=!0,m(s,"class","toolbar-button svelte-10r16uj"),m(a,"class","toolbar-button svelte-10r16uj"),m(a,"for","load-input"),m(u,"class","toolbar-button svelte-10r16uj"),m(w,"class","toolbar-button svelte-10r16uj"),m(k,"class","toolbar-button svelte-10r16uj"),m(o,"class","project-toolbar svelte-10r16uj"),m(S,"class","toolbar-button svelte-10r16uj"),m(_,"class","scene-toolbar svelte-10r16uj"),m(e,"class","toolbar svelte-10r16uj")},m(R,J){D(R,e,J),b(e,t),i[9](t),b(e,n),b(e,o),b(o,s),b(s,r),b(o,l),b(o,a),b(a,f),b(o,c),b(o,u),b(u,p),b(o,d),b(o,w),b(w,N),b(o,y),b(o,k),b(k,h),b(e,v),b(e,_),b(_,S),b(S,T),V||(j=[L(t,"change",i[3]),L(s,"click",i[2]),L(u,"click",i[4]),L(w,"click",i[5]),L(k,"click",i[6]),L(S,"click",i[1])],V=!0)},p:Ee,i:Ee,o:Ee,d(R){R&&g(e),i[9](null),V=!1,Se(j)}}}function Yt(i,e,t){let n,o,s,r,l;te(i,Vt,h=>t(10,n=h)),te(i,Wt,h=>t(11,o=h)),te(i,ne,h=>t(12,s=h)),te(i,Pt,h=>t(13,r=h)),te(i,Rt,h=>t(14,l=h));let{showNewScene:a}=e,{showTest:f}=e,c;function u(){t(7,a=!0)}function p(){be(ne,s={},s)}function d(){p();const h=c.files[0];if(h.type==="application/json"){const v=new FileReader;v.addEventListener("load",function(){be(ne,s={},s);const _=v.result,S=JSON.parse(_);be(ne,s=S,s)}),this.value=null,v.readAsText(h);return}else alert("Formato de archivo incorrecto / incorrect file format")}function w(){l(s,"aventuraInteractiva")}function N(){t(8,f=!0)}function y(){const h=Object.entries(s).sort((T,V)=>T[1].display.y-V[1].display.y);if(h.length===0){alert("No hay escenas / There are no scenes");return}const v=r.toString(),_=JSON.stringify(s),S=o(v,_,h[0][0]);n(S)}function k(h){le[h?"unshift":"push"](()=>{c=h,t(0,c)})}return i.$$set=h=>{"showNewScene"in h&&t(7,a=h.showNewScene),"showTest"in h&&t(8,f=h.showTest)},[c,u,p,d,w,N,y,a,f,k]}class Zt extends we{constructor(e){super(),ke(this,e,Yt,Xt,_e,{showNewScene:7,showTest:8})}}function Qt(i){let e,t,n,o;const s=i[5].default,r=zt(s,i,i[4],null);return{c(){e=I("div"),r&&r.c(),this.h()},l(l){e=C(l,"DIV",{class:!0,key:!0});var a=z(e);r&&r.l(a),a.forEach(g),this.h()},h(){m(e,"class","scene-node-container svelte-sua7yb"),m(e,"key",i[0])},m(l,a){D(l,e,a),r&&r.m(e,null),t=!0,n||(o=Ae(i[1].call(null,e)),n=!0)},p(l,[a]){r&&r.p&&(!t||a&16)&&Mt(r,s,l,l[4],t?jt(s,l[4],a,null):Dt(l[4]),null),(!t||a&1)&&m(e,"key",l[0])},i(l){t||(K(r,l),t=!0)},o(l){Y(r,l),t=!1},d(l){l&&g(e),r&&r.d(l),n=!1,o()}}}function xt(i,e,t){let{$$slots:n={},$$scope:o}=e,{scene:s}=e,{movingNode:r=!1}=e,{key:l}=e;function a(f){let c=!1;f.style.left=`${s.display.x}px`,f.style.top=`${s.display.y}px`,f.addEventListener("mousedown",()=>{c=!0,t(3,r=!0)}),window.addEventListener("mousemove",u=>{c&&(t(2,s.display.x+=u.movementX,s),t(2,s.display.y+=u.movementY,s),f.style.left=`${s.display.x}px`,f.style.top=`${s.display.y}px`)}),window.addEventListener("mouseup",()=>{c=!1,t(3,r=!1)})}return i.$$set=f=>{"scene"in f&&t(2,s=f.scene),"movingNode"in f&&t(3,r=f.movingNode),"key"in f&&t(0,l=f.key),"$$scope"in f&&t(4,o=f.$$scope)},[l,a,s,r,o,n]}class $t extends we{constructor(e){super(),ke(this,e,xt,Qt,_e,{scene:2,movingNode:3,key:0})}}function en(i){let e,t,n,o;const s=i[5].default,r=zt(s,i,i[4],null);return{c(){e=I("div"),r&&r.c(),this.h()},l(l){e=C(l,"DIV",{class:!0});var a=z(e);r&&r.l(a),a.forEach(g),this.h()},h(){m(e,"class","draggui svelte-lq1cua")},m(l,a){D(l,e,a),r&&r.m(e,null),t=!0,n||(o=[Ae(i[0].call(null,e)),Ae(i[1].call(null,e)),L(e,"mousedown",me(i[6]))],n=!0)},p(l,[a]){r&&r.p&&(!t||a&16)&&Mt(r,s,l,l[4],t?jt(s,l[4],a,null):Dt(l[4]),null)},i(l){t||(K(r,l),t=!0)},o(l){Y(r,l),t=!1},d(l){l&&g(e),r&&r.d(l),n=!1,Se(o)}}}function tn(i,e,t){let{$$slots:n={},$$scope:o}=e,{pos:s}=e,{displace:r={x:s.x,y:s.y}}=e;function l(c){c.style.left=`${r.x}px`,c.style.top=`${r.y}px`}function a(c){let u=!1;c.style.left=`${r.x}px`,c.style.top=`${r.y}px`,c.addEventListener("mousedown",()=>{u=!0}),window.addEventListener("mousemove",p=>{u&&(t(2,r.x+=p.movementX,r),t(2,r.y+=p.movementY,r),c.style.left=`${r.x}px`,c.style.top=`${r.y}px`,c.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{u=!1,c.style.cursor="grab"})}function f(c){pe.call(this,i,c)}return i.$$set=c=>{"pos"in c&&t(3,s=c.pos),"displace"in c&&t(2,r=c.displace),"$$scope"in c&&t(4,o=c.$$scope)},[l,a,r,s,o,n,f]}class qe extends we{constructor(e){super(),ke(this,e,tn,en,_e,{pos:3,displace:2})}}function nn(i){let e,t,n,o,s;return{c(){e=I("div"),t=I("button"),n=G("X"),this.h()},l(r){e=C(r,"DIV",{class:!0});var l=z(e);t=C(l,"BUTTON",{class:!0});var a=z(t);n=W(a,"X"),a.forEach(g),l.forEach(g),this.h()},h(){m(t,"class","x-button"),m(e,"class","top-bar svelte-15bdkib")},m(r,l){D(r,e,l),b(e,t),b(t,n),o||(s=L(t,"click",i[0]),o=!0)},p:Ee,i:Ee,o:Ee,d(r){r&&g(e),o=!1,s()}}}function sn(i,e,t){let{toggle:n}=e;function o(){t(1,n=!1)}return i.$$set=s=>{"toggle"in s&&t(1,n=s.toggle)},[o,n]}class Je extends we{constructor(e){super(),ke(this,e,sn,nn,_e,{toggle:1})}}function on(i){let e,t,n,o,s,r,l,a,f,c,u,p,d,w,N;function y(h){i[7](h)}let k={};return i[0]!==void 0&&(k.toggle=i[0]),e=new Je({props:k}),le.push(()=>ge(e,"toggle",y)),{c(){ae(e.$$.fragment),n=A(),o=I("div"),s=I("label"),r=G("Btn:"),l=A(),a=I("input"),f=A(),c=I("div"),u=I("button"),p=G("Aceptar"),this.h()},l(h){ue(e.$$.fragment,h),n=U(h),o=C(h,"DIV",{});var v=z(o);s=C(v,"LABEL",{for:!0});var _=z(s);r=W(_,"Btn:"),_.forEach(g),l=U(v),a=C(v,"INPUT",{id:!0,type:!0}),v.forEach(g),f=U(h),c=C(h,"DIV",{class:!0});var S=z(c);u=C(S,"BUTTON",{class:!0});var T=z(u);p=W(T,"Aceptar"),T.forEach(g),S.forEach(g),this.h()},h(){m(s,"for","inp"),m(a,"id","inp"),m(a,"type","text"),a.autofocus=!0,m(u,"class","gui-button"),m(c,"class","bar svelte-1bhrmvp")},m(h,v){ce(e,h,v),D(h,n,v),D(h,o,v),b(o,s),b(s,r),b(o,l),b(o,a),ye(a,i[2]),D(h,f,v),D(h,c,v),b(c,u),b(u,p),d=!0,a.focus(),w||(N=[L(a,"input",i[8]),L(a,"mousedown",me(i[6])),L(u,"click",i[3])],w=!0)},p(h,v){const _={};!t&&v&1&&(t=!0,_.toggle=h[0],ve(()=>t=!1)),e.$set(_),v&4&&a.value!==h[2]&&ye(a,h[2])},i(h){d||(K(e.$$.fragment,h),d=!0)},o(h){Y(e.$$.fragment,h),d=!1},d(h){fe(e,h),h&&g(n),h&&g(o),h&&g(f),h&&g(c),w=!1,Se(N)}}}function rn(i){let e,t,n,o;return e=new qe({props:{pos:i[1],$$slots:{default:[on]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(s){ue(e.$$.fragment,s)},m(s,r){ce(e,s,r),t=!0,n||(o=L(window,"keydown",i[4]),n=!0)},p(s,[r]){const l={};r&2&&(l.pos=s[1]),r&4101&&(l.$$scope={dirty:r,ctx:s}),e.$set(l)},i(s){t||(K(e.$$.fragment,s),t=!0)},o(s){Y(e.$$.fragment,s),t=!1},d(s){fe(e,s),n=!1,o()}}}function ln(i,e,t){let n,o,s;te(i,ne,N=>t(9,o=N)),te(i,xe,N=>t(10,s=N));let{key:r}=e,{pos:l}=e,{showNewOption:a}=e;const f=s(o[r]);function c(){o[r][f]===void 0&&be(ne,o[r][f]=[],o),o[r][f].push({btn:n}),ne.set(o),t(0,a=!1)}function u(N){N.key==="Enter"&&c(),N.key==="Escape"&&t(0,a=!1)}function p(N){pe.call(this,i,N)}function d(N){a=N,t(0,a)}function w(){n=this.value,t(2,n)}return i.$$set=N=>{"key"in N&&t(5,r=N.key),"pos"in N&&t(1,l=N.pos),"showNewOption"in N&&t(0,a=N.showNewOption)},t(2,n=""),[a,l,n,c,u,r,p,d,w]}class an extends we{constructor(e){super(),ke(this,e,ln,rn,_e,{key:5,pos:1,showNewOption:0})}}function st(i){let e,t,n,o;return{c(){e=I("div"),t=G(i[8]),this.h()},l(s){e=C(s,"DIV",{class:!0});var r=z(e);t=W(r,i[8]),r.forEach(g),this.h()},h(){m(e,"class","area svelte-nya92k")},m(s,r){D(s,e,r),b(e,t),i[23](e),n||(o=L(e,"mousedown",me(i[14])),n=!0)},p(s,r){r&256&&Be(t,s[8])},d(s){s&&g(e),i[23](null),n=!1,o()}}}function un(i){let e,t,n,o,s,r,l,a,f,c,u,p,d,w,N,y,k,h,v,_,S,T,V,j,R,J,F,Q,x,Z,P,$,se,X,ie,oe,B,H,ee;function re(M){i[18](M)}let E={};i[0]!==void 0&&(E.toggle=i[0]),e=new Je({props:E}),le.push(()=>ge(e,"toggle",re));let O=i[5]&&st(i);return{c(){ae(e.$$.fragment),n=A(),o=I("div"),s=I("h1"),r=G(i[1]),l=A(),a=I("div"),f=I("div"),c=I("h2"),u=G("Nombre de referencia"),p=A(),d=I("input"),w=A(),N=I("div"),y=I("h2"),k=G("Btn"),h=A(),v=I("input"),_=A(),S=I("div"),T=I("h2"),V=G("Tooltip"),j=A(),R=I("input"),J=A(),F=I("div"),Q=I("div"),x=I("div"),Z=I("img"),$=A(),O&&O.c(),se=A(),X=I("div"),ie=I("button"),oe=G("Aceptar"),this.h()},l(M){ue(e.$$.fragment,M),n=U(M),o=C(M,"DIV",{});var q=z(o);s=C(q,"H1",{class:!0});var de=z(s);r=W(de,i[1]),de.forEach(g),q.forEach(g),l=U(M),a=C(M,"DIV",{class:!0});var he=z(a);f=C(he,"DIV",{class:!0});var Ie=z(f);c=C(Ie,"H2",{class:!0});var ze=z(c);u=W(ze,"Nombre de referencia"),ze.forEach(g),p=U(Ie),d=C(Ie,"INPUT",{}),Ie.forEach(g),w=U(he),N=C(he,"DIV",{class:!0});var Me=z(N);y=C(Me,"H2",{class:!0});var Re=z(y);k=W(Re,"Btn"),Re.forEach(g),h=U(Me),v=C(Me,"INPUT",{}),Me.forEach(g),_=U(he),S=C(he,"DIV",{class:!0});var Ce=z(S);T=C(Ce,"H2",{class:!0});var Ve=z(T);V=W(Ve,"Tooltip"),Ve.forEach(g),j=U(Ce),R=C(Ce,"INPUT",{}),Ce.forEach(g),he.forEach(g),J=U(M),F=C(M,"DIV",{class:!0});var Ge=z(F);Q=C(Ge,"DIV",{class:!0});var We=z(Q);x=C(We,"DIV",{class:!0});var Xe=z(x);Z=C(Xe,"IMG",{src:!0,alt:!0,class:!0}),$=U(Xe),O&&O.l(Xe),Xe.forEach(g),We.forEach(g),Ge.forEach(g),se=U(M),X=C(M,"DIV",{class:!0});var $e=z(X);ie=C($e,"BUTTON",{class:!0});var et=z(ie);oe=W(et,"Aceptar"),et.forEach(g),$e.forEach(g),this.h()},h(){m(s,"class","svelte-nya92k"),m(c,"class","svelte-nya92k"),m(f,"class","input"),m(y,"class","svelte-nya92k"),m(N,"class","input"),m(T,"class","svelte-nya92k"),m(S,"class","input"),m(a,"class","inputs svelte-nya92k"),Ke(Z.src,P=i[9][i[10]])||m(Z,"src",P),m(Z,"alt","Preview"),m(Z,"class","img-preview svelte-nya92k"),m(x,"class","area-container"),m(Q,"class","area-absolute-container svelte-nya92k"),m(F,"class","area-normal-container svelte-nya92k"),m(ie,"class","gui-button"),m(X,"class","bar")},m(M,q){ce(e,M,q),D(M,n,q),D(M,o,q),b(o,s),b(s,r),D(M,l,q),D(M,a,q),b(a,f),b(f,c),b(c,u),b(f,p),b(f,d),ye(d,i[6]),b(a,w),b(a,N),b(N,y),b(y,k),b(N,h),b(N,v),ye(v,i[8]),b(a,_),b(a,S),b(S,T),b(T,V),b(S,j),b(S,R),ye(R,i[7]),D(M,J,q),D(M,F,q),b(F,Q),b(Q,x),b(x,Z),i[22](Z),b(x,$),O&&O.m(x,null),D(M,se,q),D(M,X,q),b(X,ie),b(ie,oe),B=!0,H||(ee=[L(d,"input",i[19]),L(d,"mousedown",me(i[17])),L(v,"input",i[20]),L(v,"mousedown",me(i[16])),L(R,"input",i[21]),L(R,"mousedown",me(i[15])),Ae(i[11].call(null,Z)),L(Q,"mousedown",me(i[13])),L(ie,"click",i[12])],H=!0)},p(M,q){const de={};!t&&q&1&&(t=!0,de.toggle=M[0],ve(()=>t=!1)),e.$set(de),(!B||q&2)&&Be(r,M[1]),q&64&&d.value!==M[6]&&ye(d,M[6]),q&256&&v.value!==M[8]&&ye(v,M[8]),q&128&&R.value!==M[7]&&ye(R,M[7]),M[5]?O?O.p(M,q):(O=st(M),O.c(),O.m(x,null)):O&&(O.d(1),O=null)},i(M){B||(K(e.$$.fragment,M),B=!0)},o(M){Y(e.$$.fragment,M),B=!1},d(M){fe(e,M),M&&g(n),M&&g(o),M&&g(l),M&&g(a),M&&g(J),M&&g(F),i[22](null),O&&O.d(),M&&g(se),M&&g(X),H=!1,Se(ee)}}}function cn(i){let e,t;return e=new qe({props:{pos:i[2],$$slots:{default:[un]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,o){ce(e,n,o),t=!0},p(n,[o]){const s={};o&4&&(s.pos=n[2]),o&268435963&&(s.$$scope={dirty:o,ctx:n}),e.$set(s)},i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function fn(i,e,t){let n,o,s,r,l;te(i,ne,P=>t(25,r=P)),te(i,Ut,P=>t(26,l=P));let{key:a}=e,{pos:f}=e,{showNewArea:c}=e,u,p=r[a];const d=l(p);let w={},N,y;function k(P){let $=!1;P.addEventListener("mousedown",X=>{X.preventDefault(),$=!0,t(5,y={x1:X.offsetX,y1:X.offsetY,x2:X.offsetX,y2:X.offsetY})}),P.addEventListener("mousemove",X=>{$&&h(X)}),P.addEventListener("mouseup",X=>{se(X)}),P.addEventListener("mouseout",X=>{se(X)});function se(X){if(y===void 0||!$)return;$=!1;const ie=h(X),oe={};for(let B of Object.keys(ie))oe[B]=Math.floor(ie[B]*u.naturalWidth/u.width);Object.assign(w,{...oe}),w.x=Math.floor(oe.x+oe.w/2),w.y=Math.floor(oe.y+oe.h/2)}}function h(P){t(5,y.x2=P.offsetX,y),t(5,y.y2=P.offsetY,y);const $=Math.min(y.x1,y.x2),se=Math.max(y.x1,y.x2),X=Math.min(y.y1,y.y2),ie=Math.max(y.y1,y.y2),oe={x:$,y:X,w:se-$,h:ie-X};return t(4,N.style.width=`${oe.w}px`,N),t(4,N.style.height=`${oe.h}px`,N),t(4,N.style.top=`${oe.y}px`,N),t(4,N.style.left=`${oe.x}px`,N),oe}function v(){if(w===void 0){alert("debes escoger un area / you must choose an area");return}Object.assign(w,{btn:n,tooltip:o,name:s}),r[a].areas===void 0&&be(ne,r[a].areas=[],r),r[a].areas.push(w),ne.set(r),t(0,c=!1)}function _(P){pe.call(this,i,P)}function S(P){pe.call(this,i,P)}function T(P){pe.call(this,i,P)}function V(P){pe.call(this,i,P)}function j(P){pe.call(this,i,P)}function R(P){c=P,t(0,c)}function J(){s=this.value,t(6,s)}function F(){n=this.value,t(8,n)}function Q(){o=this.value,t(7,o)}function x(P){le[P?"unshift":"push"](()=>{u=P,t(3,u)})}function Z(P){le[P?"unshift":"push"](()=>{N=P,t(4,N)})}return i.$$set=P=>{"key"in P&&t(1,a=P.key),"pos"in P&&t(2,f=P.pos),"showNewArea"in P&&t(0,c=P.showNewArea)},t(8,n=""),t(7,o=""),t(6,s="area"),[c,a,f,u,N,y,s,o,n,p,d,k,v,_,S,T,V,j,R,J,F,Q,x,Z]}class dn extends we{constructor(e){super(),ke(this,e,fn,cn,_e,{key:1,pos:2,showNewArea:0})}}function hn(i){let e,t,n,o,s,r,l,a,f,c,u;return{c(){e=I("input"),t=A(),n=I("label"),o=G("Cargar archivo"),s=A(),r=I("div"),l=I("img"),this.h()},l(p){e=C(p,"INPUT",{type:!0,id:!0}),t=U(p),n=C(p,"LABEL",{class:!0,for:!0});var d=z(n);o=W(d,"Cargar archivo"),d.forEach(g),s=U(p),r=C(p,"DIV",{class:!0,id:!0});var w=z(r);l=C(w,"IMG",{src:!0,alt:!0,class:!0}),w.forEach(g),this.h()},h(){m(e,"type","file"),m(e,"id","load-image"),e.hidden=!0,m(n,"class","gui-button svelte-1f4uqrr"),m(n,"for","load-image"),Ke(l.src,a=i[0])||m(l,"src",a),m(l,"alt","Preview"),m(l,"class",f=tt(`img-preview ${i[0]?"":"hide"}`)+" svelte-1f4uqrr"),m(r,"class","image-preview-container svelte-1f4uqrr"),m(r,"id","image-preview-container")},m(p,d){D(p,e,d),i[4](e),D(p,t,d),D(p,n,d),b(n,o),D(p,s,d),D(p,r,d),b(r,l),i[5](l),c||(u=L(e,"change",i[3]),c=!0)},p(p,[d]){d&1&&!Ke(l.src,a=p[0])&&m(l,"src",a),d&1&&f!==(f=tt(`img-preview ${p[0]?"":"hide"}`)+" svelte-1f4uqrr")&&m(l,"class",f)},i:Ee,o:Ee,d(p){p&&g(e),i[4](null),p&&g(t),p&&g(n),p&&g(s),p&&g(r),i[5](null),c=!1,u()}}}function pn(i,e,t){let{imageUrl:n}=e,o,s;function r(){const f=o.files[0];if(f){const c=new FileReader;c.addEventListener("load",function(){s.setAttribute("src",c.result),t(0,n=c.result)}),c.readAsDataURL(f)}}function l(f){le[f?"unshift":"push"](()=>{o=f,t(1,o)})}function a(f){le[f?"unshift":"push"](()=>{s=f,t(2,s)})}return i.$$set=f=>{"imageUrl"in f&&t(0,n=f.imageUrl)},[n,o,s,r,l,a]}class mn extends we{constructor(e){super(),ke(this,e,pn,hn,_e,{imageUrl:0})}}function gn(i){let e,t,n,o,s,r,l,a,f,c,u,p,d,w,N,y,k,h,v,_,S,T,V,j,R,J,F,Q,x,Z,P,$;function se(B){i[8](B)}let X={};i[0]!==void 0&&(X.toggle=i[0]),e=new Je({props:X}),le.push(()=>ge(e,"toggle",se));function ie(B){i[11](B)}let oe={};return i[3]!==void 0&&(oe.imageUrl=i[3]),j=new mn({props:oe}),le.push(()=>ge(j,"imageUrl",ie)),{c(){ae(e.$$.fragment),n=A(),o=I("div"),s=I("h1"),r=G(i[1]),l=A(),a=I("div"),f=I("h2"),c=G("Texto"),u=A(),p=I("textarea"),d=A(),w=I("div"),N=I("h2"),y=G("Imagen (opcional)"),k=A(),h=I("div"),v=I("label"),_=G("Url:"),S=A(),T=I("input"),V=G(`
      o
      `),ae(j.$$.fragment),J=A(),F=I("div"),Q=I("button"),x=G("Aceptar"),this.h()},l(B){ue(e.$$.fragment,B),n=U(B),o=C(B,"DIV",{});var H=z(o);s=C(H,"H1",{class:!0});var ee=z(s);r=W(ee,i[1]),ee.forEach(g),H.forEach(g),l=U(B),a=C(B,"DIV",{});var re=z(a);f=C(re,"H2",{class:!0});var E=z(f);c=W(E,"Texto"),E.forEach(g),u=U(re),p=C(re,"TEXTAREA",{class:!0}),z(p).forEach(g),re.forEach(g),d=U(B),w=C(B,"DIV",{});var O=z(w);N=C(O,"H2",{class:!0});var M=z(N);y=W(M,"Imagen (opcional)"),M.forEach(g),k=U(O),h=C(O,"DIV",{});var q=z(h);v=C(q,"LABEL",{for:!0});var de=z(v);_=W(de,"Url:"),de.forEach(g),S=U(q),T=C(q,"INPUT",{id:!0,type:!0}),V=W(q,`
      o
      `),ue(j.$$.fragment,q),q.forEach(g),J=U(O),F=C(O,"DIV",{class:!0});var he=z(F);Q=C(he,"BUTTON",{class:!0});var Ie=z(Q);x=W(Ie,"Aceptar"),Ie.forEach(g),he.forEach(g),O.forEach(g),this.h()},h(){m(s,"class","svelte-8prumv"),m(f,"class","no-select svelte-8prumv"),m(p,"class","svelte-8prumv"),m(N,"class","no-select svelte-8prumv"),m(v,"for","inp"),m(T,"id","inp"),m(T,"type","text"),m(Q,"class","gui-button"),m(F,"class","bar")},m(B,H){ce(e,B,H),D(B,n,H),D(B,o,H),b(o,s),b(s,r),D(B,l,H),D(B,a,H),b(a,f),b(f,c),b(a,u),b(a,p),ye(p,i[4]),D(B,d,H),D(B,w,H),b(w,N),b(N,y),b(w,k),b(w,h),b(h,v),b(v,_),b(h,S),b(h,T),ye(T,i[3]),b(h,V),ce(j,h,null),b(w,J),b(w,F),b(F,Q),b(Q,x),Z=!0,P||($=[L(p,"input",i[9]),L(p,"mousedown",me(i[7])),L(T,"input",i[10]),L(T,"mousedown",me(i[6])),L(Q,"click",i[5])],P=!0)},p(B,H){const ee={};!t&&H&1&&(t=!0,ee.toggle=B[0],ve(()=>t=!1)),e.$set(ee),(!Z||H&2)&&Be(r,B[1]),H&16&&ye(p,B[4]),H&8&&T.value!==B[3]&&ye(T,B[3]);const re={};!R&&H&8&&(R=!0,re.imageUrl=B[3],ve(()=>R=!1)),j.$set(re)},i(B){Z||(K(e.$$.fragment,B),K(j.$$.fragment,B),Z=!0)},o(B){Y(e.$$.fragment,B),Y(j.$$.fragment,B),Z=!1},d(B){fe(e,B),B&&g(n),B&&g(o),B&&g(l),B&&g(a),B&&g(d),B&&g(w),fe(j),P=!1,Se($)}}}function vn(i){let e,t;return e=new qe({props:{pos:i[2],$$slots:{default:[gn]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,o){ce(e,n,o),t=!0},p(n,[o]){const s={};o&4&&(s.pos=n[2]),o&32795&&(s.$$scope={dirty:o,ctx:n}),e.$set(s)},i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function _n(i,e,t){let n,o;te(i,ne,h=>t(12,o=h));let{key:s}=e,{pos:r}=e,{showEditor:l}=e,a=null,f=o[s];const c=f.text===void 0&&f.texto!==void 0?"texto":"text";function u(){be(ne,o[s][c]=n,o),a!==null&&be(ne,o[s].image=a,o),t(0,l=!1)}function p(h){pe.call(this,i,h)}function d(h){pe.call(this,i,h)}function w(h){l=h,t(0,l)}function N(){n=this.value,t(4,n),t(13,f)}function y(){a=this.value,t(3,a)}function k(h){a=h,t(3,a)}return i.$$set=h=>{"key"in h&&t(1,s=h.key),"pos"in h&&t(2,r=h.pos),"showEditor"in h&&t(0,l=h.showEditor)},i.$$.update=()=>{i.$$.dirty&2&&be(ne,o[s]=f,o)},t(4,n=f[c]),[l,s,r,a,n,u,p,d,w,N,y,k]}class yn extends we{constructor(e){super(),ke(this,e,_n,vn,_e,{key:1,pos:2,showEditor:0})}}function ot(i,e,t){const n=i.slice();return n[38]=e[t],n[40]=t,n}function it(i,e,t){const n=i.slice();return n[41]=e[t],n[40]=t,n}function rt(i){let e,t,n,o,s,r,l,a;return{c(){e=I("div"),t=I("img"),o=A(),s=I("button"),r=G("x"),this.h()},l(f){e=C(f,"DIV",{class:!0});var c=z(e);t=C(c,"IMG",{src:!0,alt:!0,class:!0}),o=U(c),s=C(c,"BUTTON",{class:!0});var u=z(s);r=W(u,"x"),u.forEach(g),c.forEach(g),this.h()},h(){Ke(t.src,n=i[6][i[13]])||m(t,"src",n),m(t,"alt","Preview"),m(t,"class","img-preview svelte-cnz2jn"),m(s,"class","x-button image-x-button"),m(e,"class","img-preview-container svelte-cnz2jn")},m(f,c){D(f,e,c),b(e,t),b(e,o),b(e,s),b(s,r),l||(a=L(s,"click",i[23]),l=!0)},p(f,c){c[0]&64&&!Ke(t.src,n=f[6][f[13]])&&m(t,"src",n)},d(f){f&&g(e),l=!1,a()}}}function lt(i){let e,t,n,o,s,r,l,a,f;return{c(){e=I("div"),t=I("span"),n=G("área"),o=A(),s=I("div"),r=I("button"),l=G("+"),this.h()},l(c){e=C(c,"DIV",{});var u=z(e);t=C(u,"SPAN",{class:!0});var p=z(t);n=W(p,"área"),p.forEach(g),o=U(u),s=C(u,"DIV",{class:!0});var d=z(s);r=C(d,"BUTTON",{class:!0});var w=z(r);l=W(w,"+"),w.forEach(g),d.forEach(g),u.forEach(g),this.h()},h(){m(t,"class","btns-name svelte-cnz2jn"),m(r,"class","svelte-cnz2jn"),m(s,"class","node-btns-div svelte-cnz2jn")},m(c,u){D(c,e,u),b(e,t),b(t,n),b(e,o),b(e,s),b(s,r),b(r,l),a||(f=L(r,"click",i[10]),a=!0)},p:Ee,d(c){c&&g(e),a=!1,f()}}}function at(i,e){let t,n,o,s,r,l,a,f,c,u,p,d,w,N;return{key:i,first:null,c(){t=I("div"),n=I("input"),r=A(),l=I("button"),a=G("x"),c=A(),u=I("div"),this.h()},l(y){t=C(y,"DIV",{class:!0});var k=z(t);n=C(k,"INPUT",{type:!0,class:!0,i:!0}),r=U(k),l=C(k,"BUTTON",{class:!0,i:!0});var h=z(l);a=W(h,"x"),h.forEach(g),c=U(k),u=C(k,"DIV",{type:!0,key:!0,content:!0,class:!0,i:!0}),z(u).forEach(g),k.forEach(g),this.h()},h(){m(n,"type","text"),m(n,"class","output-text svelte-cnz2jn"),n.value=o=e[41].btn,m(n,"i",s=e[40]),m(l,"class","x-button"),m(l,"i",f=e[40]),m(u,"type","ops"),m(u,"key",e[1]),m(u,"content",p=e[41].btn),m(u,"class","connection output option-connection svelte-cnz2jn"),m(u,"i",d=e[40]),m(t,"class","output-container svelte-cnz2jn"),this.first=t},m(y,k){D(y,t,k),b(t,n),b(t,r),b(t,l),b(l,a),b(t,c),b(t,u),w||(N=[Ae(e[15].call(null,n)),L(n,"change",e[14]),L(n,"mousedown",me(e[27])),L(l,"click",e[21]),L(u,"click",e[18]),L(u,"mousedown",me(e[26]))],w=!0)},p(y,k){e=y,k[0]&6&&o!==(o=e[41].btn)&&n.value!==o&&(n.value=o),k[0]&6&&s!==(s=e[40])&&m(n,"i",s),k[0]&6&&f!==(f=e[40])&&m(l,"i",f),k[0]&2&&m(u,"key",e[1]),k[0]&6&&p!==(p=e[41].btn)&&m(u,"content",p),k[0]&6&&d!==(d=e[40])&&m(u,"i",d)},d(y){y&&g(t),w=!1,Se(N)}}}function ut(i,e){let t,n,o,s,r,l,a,f,c,u,p,d,w,N,y;return{key:i,first:null,c(){t=I("div"),n=I("input"),r=A(),l=I("button"),a=G("x"),c=A(),u=I("div"),w=A(),this.h()},l(k){t=C(k,"DIV",{class:!0});var h=z(t);n=C(h,"INPUT",{type:!0,class:!0,i:!0}),r=U(h),l=C(h,"BUTTON",{class:!0,i:!0});var v=z(l);a=W(v,"x"),v.forEach(g),c=U(h),u=C(h,"DIV",{type:!0,key:!0,content:!0,class:!0,i:!0}),z(u).forEach(g),w=U(h),h.forEach(g),this.h()},h(){m(n,"type","text"),m(n,"class","output-text svelte-cnz2jn"),n.value=o=e[38].name,m(n,"i",s=e[40]),m(l,"class","x-button"),m(l,"i",f=e[40]),m(u,"type","areas"),m(u,"key",e[1]),m(u,"content",p=e[38].name),m(u,"class","connection output area-connection svelte-cnz2jn"),m(u,"i",d=e[40]),m(t,"class","output-container svelte-cnz2jn"),this.first=t},m(k,h){D(k,t,h),b(t,n),b(t,r),b(t,l),b(l,a),b(t,c),b(t,u),b(t,w),N||(y=[Ae(e[17].call(null,n)),L(n,"change",e[16]),L(n,"mousedown",me(e[25])),L(l,"click",e[22]),L(u,"click",e[18]),L(u,"mousedown",me(e[24]))],N=!0)},p(k,h){e=k,h[0]&6&&o!==(o=e[38].name)&&n.value!==o&&(n.value=o),h[0]&6&&s!==(s=e[40])&&m(n,"i",s),h[0]&6&&f!==(f=e[40])&&m(l,"i",f),h[0]&2&&m(u,"key",e[1]),h[0]&6&&p!==(p=e[38].name)&&m(u,"content",p),h[0]&6&&d!==(d=e[40])&&m(u,"i",d)},d(k){k&&g(t),N=!1,Se(y)}}}function ct(i){let e,t=[],n=new Map,o,s=[],r=new Map,l=i[2][i[1]][i[12]]||[];const a=u=>"op"+u[40];for(let u=0;u<l.length;u+=1){let p=it(i,l,u),d=a(p);n.set(d,t[u]=at(d,p))}let f=i[2][i[1]].areas||[];const c=u=>"a"+u[40];for(let u=0;u<f.length;u+=1){let p=ot(i,f,u),d=c(p);r.set(d,s[u]=ut(d,p))}return{c(){e=I("div");for(let u=0;u<t.length;u+=1)t[u].c();o=A();for(let u=0;u<s.length;u+=1)s[u].c();this.h()},l(u){e=C(u,"DIV",{class:!0});var p=z(e);for(let d=0;d<t.length;d+=1)t[d].l(p);o=U(p);for(let d=0;d<s.length;d+=1)s[d].l(p);p.forEach(g),this.h()},h(){m(e,"class","node-outputs svelte-cnz2jn")},m(u,p){D(u,e,p);for(let d=0;d<t.length;d+=1)t[d].m(e,null);b(e,o);for(let d=0;d<s.length;d+=1)s[d].m(e,null)},p(u,p){p[0]&2379782&&(l=u[2][u[1]][u[12]]||[],t=Ue(t,p,a,1,u,l,n,e,He,at,o,it)),p[0]&4521990&&(f=u[2][u[1]].areas||[],s=Ue(s,p,c,1,u,f,r,e,He,ut,null,ot))},d(u){u&&g(e);for(let p=0;p<t.length;p+=1)t[p].d();for(let p=0;p<s.length;p+=1)s[p].d()}}}function bn(i){let e,t,n,o,s,r,l,a,f,c=(i[6][i[11]].length<210?i[6][i[11]]:i[6][i[11]].slice(0,210)+"...")+"",u,p,d,w,N,y,k,h,v,_,S,T,V,j,R,J,F,Q,x,Z,P,$,se,X=i[7],ie,oe,B,H=i[6][i[13]]!==void 0&&i[6][i[13]]!==null&&rt(i),ee=i[6][i[13]]!==void 0&&i[6][i[13]]!==null&&lt(i),re=ct(i);return{c(){e=I("div"),t=A(),n=I("h1"),o=G("Escena: "),s=G(i[1]),r=A(),H&&H.c(),l=A(),a=I("div"),f=I("p"),u=G(c),p=A(),d=I("div"),w=I("div"),N=I("span"),y=G("escena"),k=A(),h=I("div"),v=I("button"),_=G("editar"),S=A(),T=I("button"),V=G("x"),j=A(),R=I("div"),J=I("span"),F=G("btn"),Q=A(),x=I("div"),Z=I("button"),P=G("+"),$=A(),ee&&ee.c(),se=A(),re.c(),ie=Ne(),this.h()},l(E){e=C(E,"DIV",{key:!0,class:!0}),z(e).forEach(g),t=U(E),n=C(E,"H1",{class:!0});var O=z(n);o=W(O,"Escena: "),s=W(O,i[1]),O.forEach(g),r=U(E),H&&H.l(E),l=U(E),a=C(E,"DIV",{class:!0});var M=z(a);f=C(M,"P",{class:!0});var q=z(f);u=W(q,c),q.forEach(g),M.forEach(g),p=U(E),d=C(E,"DIV",{class:!0});var de=z(d);w=C(de,"DIV",{});var he=z(w);N=C(he,"SPAN",{class:!0});var Ie=z(N);y=W(Ie,"escena"),Ie.forEach(g),k=U(he),h=C(he,"DIV",{class:!0});var ze=z(h);v=C(ze,"BUTTON",{class:!0});var Me=z(v);_=W(Me,"editar"),Me.forEach(g),S=U(ze),T=C(ze,"BUTTON",{class:!0});var Re=z(T);V=W(Re,"x"),Re.forEach(g),ze.forEach(g),he.forEach(g),j=U(de),R=C(de,"DIV",{});var Ce=z(R);J=C(Ce,"SPAN",{class:!0});var Ve=z(J);F=W(Ve,"btn"),Ve.forEach(g),Q=U(Ce),x=C(Ce,"DIV",{class:!0});var Ge=z(x);Z=C(Ge,"BUTTON",{class:!0});var We=z(Z);P=W(We,"+"),We.forEach(g),Ge.forEach(g),Ce.forEach(g),$=U(de),ee&&ee.l(de),de.forEach(g),se=U(E),re.l(E),ie=Ne(),this.h()},h(){m(e,"key",i[1]),m(e,"class","connection input svelte-cnz2jn"),m(n,"class","svelte-cnz2jn"),m(f,"class","text-p svelte-cnz2jn"),m(a,"class","p-container svelte-cnz2jn"),m(N,"class","btns-name svelte-cnz2jn"),m(v,"class","svelte-cnz2jn"),m(T,"class","svelte-cnz2jn"),m(h,"class","node-btns-div svelte-cnz2jn"),m(J,"class","btns-name svelte-cnz2jn"),m(Z,"class","svelte-cnz2jn"),m(x,"class","node-btns-div svelte-cnz2jn"),m(d,"class","node-btns svelte-cnz2jn")},m(E,O){D(E,e,O),D(E,t,O),D(E,n,O),b(n,o),b(n,s),D(E,r,O),H&&H.m(E,O),D(E,l,O),D(E,a,O),b(a,f),b(f,u),D(E,p,O),D(E,d,O),b(d,w),b(w,N),b(N,y),b(w,k),b(w,h),b(h,v),b(v,_),b(h,S),b(h,T),b(T,V),b(d,j),b(d,R),b(R,J),b(J,F),b(R,Q),b(R,x),b(x,Z),b(Z,P),b(d,$),ee&&ee.m(d,null),D(E,se,O),re.m(E,O),D(E,ie,O),oe||(B=[L(e,"mousedown",me(i[28])),L(e,"click",i[19]),L(v,"click",i[8]),L(T,"click",i[20]),L(Z,"click",i[9])],oe=!0)},p(E,O){O[0]&2&&m(e,"key",E[1]),O[0]&2&&Be(s,E[1]),E[6][E[13]]!==void 0&&E[6][E[13]]!==null?H?H.p(E,O):(H=rt(E),H.c(),H.m(l.parentNode,l)):H&&(H.d(1),H=null),O[0]&64&&c!==(c=(E[6][E[11]].length<210?E[6][E[11]]:E[6][E[11]].slice(0,210)+"...")+"")&&Be(u,c),E[6][E[13]]!==void 0&&E[6][E[13]]!==null?ee?ee.p(E,O):(ee=lt(E),ee.c(),ee.m(d,null)):ee&&(ee.d(1),ee=null),O[0]&128&&_e(X,X=E[7])?(re.d(1),re=ct(E),re.c(),re.m(ie.parentNode,ie)):re.p(E,O)},d(E){E&&g(e),E&&g(t),E&&g(n),E&&g(r),H&&H.d(E),E&&g(l),E&&g(a),E&&g(p),E&&g(d),ee&&ee.d(),E&&g(se),E&&g(ie),re.d(E),oe=!1,Se(B)}}}function ft(i){let e,t,n;function o(r){i[30](r)}let s={key:i[1],pos:i[6].display};return i[3]!==void 0&&(s.showEditor=i[3]),e=new yn({props:s}),le.push(()=>ge(e,"showEditor",o)),{c(){ae(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,l){ce(e,r,l),n=!0},p(r,l){const a={};l[0]&2&&(a.key=r[1]),l[0]&64&&(a.pos=r[6].display),!t&&l[0]&8&&(t=!0,a.showEditor=r[3],ve(()=>t=!1)),e.$set(a)},i(r){n||(K(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){fe(e,r)}}}function dt(i){let e,t,n;function o(r){i[31](r)}let s={key:i[1],pos:i[6].display};return i[4]!==void 0&&(s.showNewOption=i[4]),e=new an({props:s}),le.push(()=>ge(e,"showNewOption",o)),{c(){ae(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,l){ce(e,r,l),n=!0},p(r,l){const a={};l[0]&2&&(a.key=r[1]),l[0]&64&&(a.pos=r[6].display),!t&&l[0]&16&&(t=!0,a.showNewOption=r[4],ve(()=>t=!1)),e.$set(a)},i(r){n||(K(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){fe(e,r)}}}function ht(i){let e,t,n;function o(r){i[32](r)}let s={key:i[1],pos:i[6].display};return i[5]!==void 0&&(s.showNewArea=i[5]),e=new dn({props:s}),le.push(()=>ge(e,"showNewArea",o)),{c(){ae(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,l){ce(e,r,l),n=!0},p(r,l){const a={};l[0]&2&&(a.key=r[1]),l[0]&64&&(a.pos=r[6].display),!t&&l[0]&32&&(t=!0,a.showNewArea=r[5],ve(()=>t=!1)),e.$set(a)},i(r){n||(K(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){fe(e,r)}}}function wn(i){let e,t,n,o,s,r,l;function a(d){i[29](d)}let f={scene:i[6],key:i[1],$$slots:{default:[bn]},$$scope:{ctx:i}};i[0]!==void 0&&(f.movingNode=i[0]),e=new $t({props:f}),le.push(()=>ge(e,"movingNode",a));let c=i[3]&&ft(i),u=i[4]&&dt(i),p=i[5]&&ht(i);return{c(){ae(e.$$.fragment),n=A(),c&&c.c(),o=A(),u&&u.c(),s=A(),p&&p.c(),r=Ne()},l(d){ue(e.$$.fragment,d),n=U(d),c&&c.l(d),o=U(d),u&&u.l(d),s=U(d),p&&p.l(d),r=Ne()},m(d,w){ce(e,d,w),D(d,n,w),c&&c.m(d,w),D(d,o,w),u&&u.m(d,w),D(d,s,w),p&&p.m(d,w),D(d,r,w),l=!0},p(d,w){const N={};w[0]&64&&(N.scene=d[6]),w[0]&2&&(N.key=d[1]),w[0]&198|w[1]&4096&&(N.$$scope={dirty:w,ctx:d}),!t&&w[0]&1&&(t=!0,N.movingNode=d[0],ve(()=>t=!1)),e.$set(N),d[3]?c?(c.p(d,w),w[0]&8&&K(c,1)):(c=ft(d),c.c(),K(c,1),c.m(o.parentNode,o)):c&&(je(),Y(c,1,1,()=>{c=null}),Oe()),d[4]?u?(u.p(d,w),w[0]&16&&K(u,1)):(u=dt(d),u.c(),K(u,1),u.m(s.parentNode,s)):u&&(je(),Y(u,1,1,()=>{u=null}),Oe()),d[5]?p?(p.p(d,w),w[0]&32&&K(p,1)):(p=ht(d),p.c(),K(p,1),p.m(r.parentNode,r)):p&&(je(),Y(p,1,1,()=>{p=null}),Oe())},i(d){l||(K(e.$$.fragment,d),K(c),K(u),K(p),l=!0)},o(d){Y(e.$$.fragment,d),Y(c),Y(u),Y(p),l=!1},d(d){fe(e,d),d&&g(n),c&&c.d(d),d&&g(o),u&&u.d(d),d&&g(s),p&&p.d(d),d&&g(r)}}}function kn(i,e,t){let n,o,s,r,l,a,f;te(i,Ze,E=>t(7,n=E)),te(i,ne,E=>t(2,o=E)),te(i,At,E=>t(33,s=E)),te(i,xe,E=>t(34,r=E)),te(i,Fe,E=>t(35,l=E)),te(i,Ut,E=>t(36,a=E)),te(i,Bt,E=>t(37,f=E));let{movingNode:c=!1}=e,{key:u}=e,p=!1,d=!1,w=!1;function N(){t(3,p=!0)}function y(){t(4,d=!0)}function k(){t(5,w=!0)}let h=o[u];const v=f(h),_=r(h),S=a(h);h.display===void 0&&(h.display={x:0,y:0});function T(){V(this)}function V(E){const O=+E.getAttribute("i");E.style.width=E.value.length*6.1+"px",t(6,h[_][O].btn=E.value,h),ne.set(o)}function j(){R(this)}function R(E){const O=+E.getAttribute("i");E.style.width=E.value.length*6.1+"px",t(6,h.areas[O].name=E.value,h),ne.set(o)}function J(E){const O=E.target,M=+O.getAttribute("i"),q=O.getAttribute("type");if(l!==void 0&&l.key===u&&l.i===M&&l.type===q){be(Fe,l=void 0,l);const de=q==="ops"?_:"areas",he=s(h[de][M]);t(6,h[de][M][he]=void 0,h);return}be(Fe,l={key:u,i:M,type:q},l)}function F(){if(l===void 0)return;const E=o[l.key],O=l.type==="ops"?r(E):"areas",M=s(E[O][l.i]);E[O][l.i][M]=u,be(Fe,l=void 0,l)}function Q(){for(let E of Object.keys(o)){const O=r(o[E]);if(o[E][O]!==void 0){for(let M of o[E][O]){const q=s(M);M[q]===u&&(M[q]=void 0)}if(o[E].areas!==void 0)for(let M of o[E].areas){const q=s(M);M[q]===u&&(M[q]=void 0)}}}delete o[u],ne.set(o)}function x(E){const M=+E.target.getAttribute("i");o[u][_].splice(M,1),ne.set(o)}function Z(E){const M=+E.target.getAttribute("i");o[u].areas.splice(M,1),ne.set(o)}function P(){delete o[u][S],delete o[u].areas,ne.set(o),be(Ze,n=!n,n)}function $(E){pe.call(this,i,E)}function se(E){pe.call(this,i,E)}function X(E){pe.call(this,i,E)}function ie(E){pe.call(this,i,E)}function oe(E){pe.call(this,i,E)}function B(E){c=E,t(0,c)}function H(E){p=E,t(3,p)}function ee(E){d=E,t(4,d)}function re(E){w=E,t(5,w)}return i.$$set=E=>{"movingNode"in E&&t(0,c=E.movingNode),"key"in E&&t(1,u=E.key)},i.$$.update=()=>{i.$$.dirty[0]&6&&t(6,h=o[u])},[c,u,o,p,d,w,h,n,N,y,k,v,_,S,T,V,j,R,J,F,Q,x,Z,P,$,se,X,ie,oe,B,H,ee,re]}class En extends we{constructor(e){super(),ke(this,e,kn,wn,_e,{movingNode:0,key:1},null,[-1,-1])}}function pt(i,e,t){const n=i.slice();return n[13]=e[t],n[15]=t,n}function mt(i,e,t){const n=i.slice();return n[13]=e[t],n[15]=t,n}function gt(i){let e,t=[],n=new Map,o,s=[],r=new Map,l=i[0][i[2]]||[];const a=u=>"op"+u[15];for(let u=0;u<l.length;u+=1){let p=mt(i,l,u),d=a(p);n.set(d,t[u]=vt(d,p))}let f=i[0].areas||[];const c=u=>"a"+u[15];for(let u=0;u<f.length;u+=1){let p=pt(i,f,u),d=c(p);r.set(d,s[u]=_t(d,p))}return{c(){e=Le("g");for(let u=0;u<t.length;u+=1)t[u].c();o=Ne();for(let u=0;u<s.length;u+=1)s[u].c()},l(u){e=Pe(u,"g",{});var p=z(e);for(let d=0;d<t.length;d+=1)t[d].l(p);o=Ne();for(let d=0;d<s.length;d+=1)s[d].l(p);p.forEach(g)},m(u,p){D(u,e,p);for(let d=0;d<t.length;d+=1)t[d].m(e,null);b(e,o);for(let d=0;d<s.length;d+=1)s[d].m(e,null)},p(u,p){p&29&&(l=u[0][u[2]]||[],t=Ue(t,p,a,1,u,l,n,e,He,vt,o,mt)),p&25&&(f=u[0].areas||[],s=Ue(s,p,c,1,u,f,r,e,He,_t,null,pt))},d(u){u&&g(e);for(let p=0;p<t.length;p+=1)t[p].d();for(let p=0;p<s.length;p+=1)s[p].d()}}}function vt(i,e){let t,n,o,s,r;return{key:i,first:null,c(){t=Le("line"),this.h()},l(l){t=Pe(l,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0});var a=z(t);a.forEach(g),this.h()},h(){m(t,"class","op-connection svelte-1lsc27u"),m(t,"x1",n=e[3]("x","ops",e[15])),m(t,"y1",o=e[3]("y","ops",e[15])),m(t,"x2",s=e[4]("x","ops",e[15])),m(t,"y2",r=e[4]("y","ops",e[15])),this.first=t},m(l,a){D(l,t,a)},p(l,a){e=l,a&1&&n!==(n=e[3]("x","ops",e[15]))&&m(t,"x1",n),a&1&&o!==(o=e[3]("y","ops",e[15]))&&m(t,"y1",o),a&1&&s!==(s=e[4]("x","ops",e[15]))&&m(t,"x2",s),a&1&&r!==(r=e[4]("y","ops",e[15]))&&m(t,"y2",r)},d(l){l&&g(t)}}}function _t(i,e){let t,n,o,s,r;return{key:i,first:null,c(){t=Le("line"),this.h()},l(l){t=Pe(l,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0});var a=z(t);a.forEach(g),this.h()},h(){m(t,"class","a-connection svelte-1lsc27u"),m(t,"x1",n=e[3]("x","areas",e[15])),m(t,"y1",o=e[3]("y","areas",e[15])),m(t,"x2",s=e[4]("x","areas",e[15])),m(t,"y2",r=e[4]("y","areas",e[15])),this.first=t},m(l,a){D(l,t,a)},p(l,a){e=l,a&1&&n!==(n=e[3]("x","areas",e[15]))&&m(t,"x1",n),a&1&&o!==(o=e[3]("y","areas",e[15]))&&m(t,"y1",o),a&1&&s!==(s=e[4]("x","areas",e[15]))&&m(t,"x2",s),a&1&&r!==(r=e[4]("y","areas",e[15]))&&m(t,"y2",r)},d(l){l&&g(t)}}}function Nn(i){let e,t=i[1]&&gt(i);return{c(){t&&t.c(),e=Ne()},l(n){t&&t.l(n),e=Ne()},m(n,o){t&&t.m(n,o),D(n,e,o)},p(n,[o]){n[1]?t?t.p(n,o):(t=gt(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ee,o:Ee,d(n){t&&t.d(n),n&&g(e)}}}function Sn(i,e,t){let n,o,s,r,l;te(i,ne,y=>t(8,n=y)),te(i,Fe,y=>t(9,o=y)),te(i,At,y=>t(10,s=y)),te(i,Ze,y=>t(11,r=y)),te(i,xe,y=>t(12,l=y));let{key:a}=e,{pageMouse:f}=e,{movingNode:c}=e,u=n[a],p=l(u),d=!1;Ot(()=>{t(1,d=!0)});function w(y,k,h){u.areas!==void 0&&u[p]!==void 0&&document.querySelectorAll(`.connection[key=${a}]`).length!==u[p].length+u.areas.length&&y==="x"&&k==="areas"&&be(Ze,r=!r,r);const v=document.querySelector(`[type=${k}][i="${h}"][key=${a}]`);if(!v)return n[a].display[y];const _=y==="x"?v.offsetLeft:v.offsetTop,S=y==="x"?v.offsetWidth/2:v.offsetHeight;return n[a].display[y]+_+S}function N(y,k,h){const v=k==="ops"?p:"areas",_=u[v][h],S=s(_),T=u[v][h][S];if(o!==void 0&&o.key===a&&o.i===h&&o.type===k)return f[y];if(T===void 0)return w(y,k,h);{const V=document.querySelector(`.input[key=${T}]`);return n[T].display[y]+(y==="x"?V.offsetLeft:V.offsetTop)+5}}return i.$$set=y=>{"key"in y&&t(5,a=y.key),"pageMouse"in y&&t(6,f=y.pageMouse),"movingNode"in y&&t(7,c=y.movingNode)},i.$$.update=()=>{i.$$.dirty&449&&(f||n||c)&&(t(0,u),t(6,f),t(8,n),t(7,c))},[u,d,p,w,N,a,f,c,n]}class In extends we{constructor(e){super(),ke(this,e,Sn,Nn,_e,{key:5,pageMouse:6,movingNode:7})}}function Cn(i){let e,t,n,o,s,r,l,a,f,c,u,p,d,w,N;function y(h){i[8](h)}let k={};return i[0]!==void 0&&(k.toggle=i[0]),e=new Je({props:k}),le.push(()=>ge(e,"toggle",y)),{c(){ae(e.$$.fragment),n=A(),o=I("div"),s=I("label"),r=G("Escena:"),l=A(),a=I("input"),f=A(),c=I("div"),u=I("button"),p=G("Aceptar"),this.h()},l(h){ue(e.$$.fragment,h),n=U(h),o=C(h,"DIV",{});var v=z(o);s=C(v,"LABEL",{for:!0});var _=z(s);r=W(_,"Escena:"),_.forEach(g),l=U(v),a=C(v,"INPUT",{id:!0,type:!0}),v.forEach(g),f=U(h),c=C(h,"DIV",{class:!0});var S=z(c);u=C(S,"BUTTON",{class:!0});var T=z(u);p=W(T,"Aceptar"),T.forEach(g),S.forEach(g),this.h()},h(){m(s,"for","inp"),m(a,"id","inp"),m(a,"type","text"),m(u,"class","gui-button"),m(c,"class","bar svelte-1bhrmvp")},m(h,v){ce(e,h,v),D(h,n,v),D(h,o,v),b(o,s),b(s,r),b(o,l),b(o,a),ye(a,i[2]),D(h,f,v),D(h,c,v),b(c,u),b(u,p),d=!0,w||(N=[L(a,"input",i[9]),L(a,"mousedown",me(i[7])),L(u,"click",i[4])],w=!0)},p(h,v){const _={};!t&&v&1&&(t=!0,_.toggle=h[0],ve(()=>t=!1)),e.$set(_),v&4&&a.value!==h[2]&&ye(a,h[2])},i(h){d||(K(e.$$.fragment,h),d=!0)},o(h){Y(e.$$.fragment,h),d=!1},d(h){fe(e,h),h&&g(n),h&&g(o),h&&g(f),h&&g(c),w=!1,Se(N)}}}function Tn(i){let e,t,n,o,s;function r(a){i[10](a)}let l={pos:i[3],$$slots:{default:[Cn]},$$scope:{ctx:i}};return i[1]!==void 0&&(l.displace=i[1]),e=new qe({props:l}),le.push(()=>ge(e,"displace",r)),{c(){ae(e.$$.fragment)},l(a){ue(e.$$.fragment,a)},m(a,f){ce(e,a,f),n=!0,o||(s=L(window,"keydown",i[5]),o=!0)},p(a,[f]){const c={};f&8197&&(c.$$scope={dirty:f,ctx:a}),!t&&f&2&&(t=!0,c.displace=a[1],ve(()=>t=!1)),e.$set(c)},i(a){n||(K(e.$$.fragment,a),n=!0)},o(a){Y(e.$$.fragment,a),n=!1},d(a){fe(e,a),o=!1,s()}}}function zn(i){const e=["á","é","í","ó","ú","ü","ñ"],t=["a","e","i","o","u","u","n"],n=i.toLowerCase();let o="";for(let s=0;s<i.length;s++){const r=n.charAt(s),l=i.charAt(s);if(e.includes(r)){let a;for(let f=0;f<e.length;f++)if(e[f]===r){a=f;break}l===l.toUpperCase()?o+=t[a].toUpperCase():o+=t[a]}else o+=l}return o}function Mn(i,e,t){let n,o;te(i,ne,y=>t(12,o=y));let{showNewScene:s}=e,{offset:r}=e,l=o,a={x:r.x*-1+20,y:r.y*-1+20},f;function c(){if(n.length<=0){alert(`Debes dar un nombre a la escena /
You must give a name to the scene`);return}if(/^\d/.test(n)===!0){alert(`El nombre de la escena no puede empezar con un número /
The name of the scene cannot start with a number`);return}let y=n.replace(/\s/gi,"_").replace(/\W/,"").replace(/[;.,:{}()<>$%&!¡?¿"'/\\#@&*+-]/gi,"");if(y=zn(y),o[y]!==void 0){alert(`Ya existe una escena con ese nombre /
There is already a scene with that name`);return}l[y]={text:"",display:{x:a.x,y:a.y}},be(ne,o[y]=l[y],o),t(0,s=!1)}function u(y){y.key==="Enter"&&c(),y.key==="Escape"&&t(0,s=!1)}function p(y){pe.call(this,i,y)}function d(y){s=y,t(0,s)}function w(){n=this.value,t(2,n)}function N(y){f=y,t(1,f)}return i.$$set=y=>{"showNewScene"in y&&t(0,s=y.showNewScene),"offset"in y&&t(6,r=y.offset)},t(2,n=""),[s,f,n,a,c,u,r,p,d,w,N]}class Dn extends we{constructor(e){super(),ke(this,e,Mn,Tn,_e,{showNewScene:0,offset:6})}}function yt(i,e,t){const n=i.slice();return n[21]=e[t][0],n[22]=e[t][1],n}function bt(i,e,t){const n=i.slice();return n[25]=e[t],n}function wt(i,e,t){const n=i.slice();return n[25]=e[t],n}function kt(i,e){let t,n,o,s,r,l,a;function f(u){e[14](u)}let c={key:e[25]};return e[4]!==void 0&&(c.movingNode=e[4]),n=new En({props:c}),le.push(()=>ge(n,"movingNode",f)),{key:i,first:null,c(){t=I("div"),ae(n.$$.fragment),this.h()},l(u){t=C(u,"DIV",{class:!0,key:!0});var p=z(t);ue(n.$$.fragment,p),p.forEach(g),this.h()},h(){m(t,"class","scene-node-container-div"),m(t,"key",s=e[25]),this.first=t},m(u,p){D(u,t,p),ce(n,t,null),r=!0,l||(a=L(t,"mouseenter",On),l=!0)},p(u,p){e=u;const d={};p&128&&(d.key=e[25]),!o&&p&16&&(o=!0,d.movingNode=e[4],ve(()=>o=!1)),n.$set(d),(!r||p&128&&s!==(s=e[25]))&&m(t,"key",s)},i(u){r||(K(n.$$.fragment,u),r=!0)},o(u){Y(n.$$.fragment,u),r=!1},d(u){u&&g(t),fe(n),l=!1,a()}}}function Et(i,e){let t,n,o;return n=new In({props:{key:e[25],pageMouse:e[1],movingNode:e[4]}}),{key:i,first:null,c(){t=Ne(),ae(n.$$.fragment),this.h()},l(s){t=Ne(),ue(n.$$.fragment,s),this.h()},h(){this.first=t},m(s,r){D(s,t,r),ce(n,s,r),o=!0},p(s,r){e=s;const l={};r&128&&(l.key=e[25]),r&2&&(l.pageMouse=e[1]),r&16&&(l.movingNode=e[4]),n.$set(l)},i(s){o||(K(n.$$.fragment,s),o=!0)},o(s){Y(n.$$.fragment,s),o=!1},d(s){s&&g(t),fe(n,s)}}}function Nt(i){let e,t,n;function o(r){i[15](r)}let s={offset:i[5]};return i[0]!==void 0&&(s.showNewScene=i[0]),e=new Dn({props:s}),le.push(()=>ge(e,"showNewScene",o)),{c(){ae(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,l){ce(e,r,l),n=!0},p(r,l){const a={};l&32&&(a.offset=r[5]),!t&&l&1&&(t=!0,a.showNewScene=r[0],ve(()=>t=!1)),e.$set(a)},i(r){n||(K(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){fe(e,r)}}}function St(i){let e,t=[],n=new Map,o,s,r,l=i[2];const a=c=>c[21];for(let c=0;c<l.length;c+=1){let u=yt(i,l,c),p=a(u);n.set(p,t[c]=It(p,u))}let f=i[6]!==void 0&&Ct(i);return{c(){e=Le("svg");for(let c=0;c<t.length;c+=1)t[c].c();o=Ne(),f&&f.c(),this.h()},l(c){e=Pe(c,"svg",{width:!0,height:!0});var u=z(e);for(let p=0;p<t.length;p+=1)t[p].l(u);o=Ne(),f&&f.l(u),u.forEach(g),this.h()},h(){m(e,"width","100%"),m(e,"height","100%")},m(c,u){D(c,e,u);for(let p=0;p<t.length;p+=1)t[p].m(e,null);b(e,o),f&&f.m(e,null),s||(r=L(e,"click",i[8]),s=!0)},p(c,u){u&68&&(l=c[2],t=Ue(t,u,a,1,c,l,n,e,He,It,o,yt)),c[6]!==void 0?f?f.p(c,u):(f=Ct(c),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(c){c&&g(e);for(let u=0;u<t.length;u+=1)t[u].d();f&&f.d(),s=!1,r()}}}function It(i,e){let t,n,o,s,r,l,a;function f(){return e[17](e[21])}return{key:i,first:null,c(){t=Le("rect"),this.h()},l(c){t=Pe(c,"rect",{class:!0,x:!0,y:!0,width:!0,height:!0,fill:!0});var u=z(t);u.forEach(g),this.h()},h(){m(t,"class","minimap-rect svelte-j7o2a0"),m(t,"x",n=e[22].display.x/De),m(t,"y",o=e[22].display.y/De),m(t,"width",s=Ye(e[21],"width")),m(t,"height",r=Ye(e[21],"height")),m(t,"fill","green"),this.first=t},m(c,u){D(c,t,u),l||(a=[L(t,"mouseleave",e[16]),L(t,"mouseenter",f)],l=!0)},p(c,u){e=c,u&4&&n!==(n=e[22].display.x/De)&&m(t,"x",n),u&4&&o!==(o=e[22].display.y/De)&&m(t,"y",o),u&4&&s!==(s=Ye(e[21],"width"))&&m(t,"width",s),u&4&&r!==(r=Ye(e[21],"height"))&&m(t,"height",r)},d(c){c&&g(t),l=!1,Se(a)}}}function Ct(i){let e,t;return{c(){e=Le("text"),t=G(i[6]),this.h()},l(n){e=Pe(n,"text",{x:!0,y:!0,fill:!0,"font-size":!0});var o=z(e);t=W(o,i[6]),o.forEach(g),this.h()},h(){m(e,"x",5),m(e,"y",343),m(e,"fill","#ffffff99"),m(e,"font-size","0.9em")},m(n,o){D(n,e,o),b(e,t)},p(n,o){o&64&&Be(t,n[6])},d(n){n&&g(e)}}}function jn(i){let e,t=[],n=new Map,o,s,r=[],l=new Map,a,f,c,u,p,d,w=i[7];const N=_=>_[25];for(let _=0;_<w.length;_+=1){let S=wt(i,w,_),T=N(S);n.set(T,t[_]=kt(T,S))}let y=i[7];const k=_=>_[25];for(let _=0;_<y.length;_+=1){let S=bt(i,y,_),T=k(S);l.set(T,r[_]=Et(T,S))}let h=i[0]&&Nt(i),v=i[3]&&St(i);return{c(){e=I("div");for(let _=0;_<t.length;_+=1)t[_].c();o=A(),s=Le("svg");for(let _=0;_<r.length;_+=1)r[_].c();a=A(),h&&h.c(),f=A(),c=I("div"),v&&v.c(),this.h()},l(_){e=C(_,"DIV",{class:!0});var S=z(e);for(let j=0;j<t.length;j+=1)t[j].l(S);o=U(S),s=Pe(S,"svg",{class:!0});var T=z(s);for(let j=0;j<r.length;j+=1)r[j].l(T);T.forEach(g),a=U(S),h&&h.l(S),S.forEach(g),f=U(_),c=C(_,"DIV",{class:!0});var V=z(c);v&&v.l(V),V.forEach(g),this.h()},h(){m(s,"class","connections-container svelte-j7o2a0"),m(e,"class","node-page svelte-j7o2a0"),m(c,"class","minimap-container svelte-j7o2a0")},m(_,S){D(_,e,S);for(let T=0;T<t.length;T+=1)t[T].m(e,null);b(e,o),b(e,s);for(let T=0;T<r.length;T+=1)r[T].m(s,null);b(e,a),h&&h.m(e,null),D(_,f,S),D(_,c,S),v&&v.m(c,null),u=!0,p||(d=[L(e,"mousedown",i[9]),L(e,"mouseup",i[10]),L(e,"mousemove",i[11]),L(e,"mouseleave",i[10]),L(c,"mousedown",me(i[13]))],p=!0)},p(_,[S]){S&144&&(w=_[7],je(),t=Ue(t,S,N,1,_,w,n,e,nt,kt,o,wt),Oe()),S&146&&(y=_[7],je(),r=Ue(r,S,k,1,_,y,l,s,nt,Et,null,bt),Oe()),_[0]?h?(h.p(_,S),S&1&&K(h,1)):(h=Nt(_),h.c(),K(h,1),h.m(e,null)):h&&(je(),Y(h,1,1,()=>{h=null}),Oe()),_[3]?v?v.p(_,S):(v=St(_),v.c(),v.m(c,null)):v&&(v.d(1),v=null)},i(_){if(!u){for(let S=0;S<w.length;S+=1)K(t[S]);for(let S=0;S<y.length;S+=1)K(r[S]);K(h),u=!0}},o(_){for(let S=0;S<t.length;S+=1)Y(t[S]);for(let S=0;S<r.length;S+=1)Y(r[S]);Y(h),u=!1},d(_){_&&g(e);for(let S=0;S<t.length;S+=1)t[S].d();for(let S=0;S<r.length;S+=1)r[S].d();h&&h.d(),_&&g(f),_&&g(c),v&&v.d(),p=!1,Se(d)}}}let De=20;function On(i){[...document.getElementsByClassName("scene-node-container")].forEach(e=>e.style.zIndex="0"),i.target.firstChild.style.zIndex="1"}function Ye(i,e){const t=document.querySelector(`.scene-node-container[key=${i}]`),n=getComputedStyle(t);return Math.floor(+n[e].replace("px","")/De)}function An(i,e,t){let n,o,s;te(i,ne,j=>t(12,s=j));let r=!1;Ot(()=>{t(3,r=!0)});let{showNewScene:l}=e,a,f={},c,u,p=!1;const d={x:0,y:0};let w;function N(j){const R=document.querySelector(".node-page"),J=getComputedStyle(R),F=+J.width.replace("px",""),Q=+J.height.replace("px",""),x=document.querySelector(".page-container"),Z=getComputedStyle(x),P=+Z.borderWidth.replace("px","")*2,$=+Z.width.replace("px","")-P,se=+Z.height.replace("px","")-P;t(5,d.x=-j.offsetX*De+$/2,d),t(5,d.y=-j.offsetY*De+se/2,d),t(5,d.x=d.x>0?0:-d.x>F-$?-F+$:d.x,d),t(5,d.y=d.y>0?0:-d.y>Q-se?-Q+se:d.y,d),R.style.left=`${d.x}px`,R.style.top=`${d.y}px`}function y(){p=!0,this.style.cursor="grabbing"}function k(){p=!1,this.style.cursor="grab"}function h(j){if(p&&!a){c===void 0&&(c=+getComputedStyle(this).width.replace("px","")),u===void 0&&(u=+getComputedStyle(this).height.replace("px",""));const J=+getComputedStyle(this.offsetParent).borderWidth.replace("px","")*2,F=+getComputedStyle(this.offsetParent).width.replace("px","")-J,Q=+getComputedStyle(this.offsetParent).height.replace("px","")-J;t(5,d.x+=j.movementX,d),t(5,d.y+=j.movementY,d),t(5,d.x=d.x>0?0:F-d.x>c?F-c:d.x,d),t(5,d.y=d.y>0?0:Q-d.y>u?Q-u:d.y,d),this.style.left=`${d.x}px`,this.style.top=`${d.y}px`}t(1,f={x:j.offsetX,y:j.offsetY});let R=j.target;for(;R!==this;)t(1,f.x+=R.offsetLeft,f),t(1,f.y+=R.offsetTop,f),R=R.offsetParent}function v(j){pe.call(this,i,j)}function _(j){a=j,t(4,a)}function S(j){l=j,t(0,l)}const T=()=>{t(6,w=void 0)},V=j=>{t(6,w=j)};return i.$$set=j=>{"showNewScene"in j&&t(0,l=j.showNewScene)},i.$$.update=()=>{i.$$.dirty&4096&&t(7,n=Object.keys(s)),i.$$.dirty&4096&&t(2,o=Object.entries(s)),i.$$.dirty&6&&f&&(t(2,o),t(12,s),t(1,f))},[l,f,o,r,a,d,w,n,N,y,k,h,s,v,_,S,T,V]}let Un=class extends we{constructor(e){super(),ke(this,e,An,jn,_e,{showNewScene:0})}};function Tt(i){let e,t;return e=new qe({props:{pos:i[2],$$slots:{default:[Ln]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,o){ce(e,n,o),t=!0},p(n,o){const s={};o&1026&&(s.$$scope={dirty:o,ctx:n}),e.$set(s)},i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function Ln(i){let e,t,n,o,s,r,l;function a(c){i[7](c)}let f={};return i[1]!==void 0&&(f.toggle=i[1]),e=new Je({props:f}),le.push(()=>ge(e,"toggle",a)),{c(){ae(e.$$.fragment),n=A(),o=I("div"),this.h()},l(c){ue(e.$$.fragment,c),n=U(c),o=C(c,"DIV",{class:!0,id:!0}),z(o).forEach(g),this.h()},h(){m(o,"class","test-story-container svelte-1x7qk0r"),m(o,"id","test-story-container")},m(c,u){ce(e,c,u),D(c,n,u),D(c,o,u),s=!0,r||(l=Ae(i[3].call(null,o)),r=!0)},p(c,u){const p={};!t&&u&2&&(t=!0,p.toggle=c[1],ve(()=>t=!1)),e.$set(p)},i(c){s||(K(e.$$.fragment,c),s=!0)},o(c){Y(e.$$.fragment,c),s=!1},d(c){fe(e,c),c&&g(n),c&&g(o),r=!1,l()}}}function Pn(i){let e,t,n,o,s,r,l,a,f,c,u;function p(h){i[4](h)}function d(h){i[5](h)}let w={};i[0]!==void 0&&(w.showNewScene=i[0]),i[1]!==void 0&&(w.showTest=i[1]),t=new Zt({props:w}),le.push(()=>ge(t,"showNewScene",p)),le.push(()=>ge(t,"showTest",d));function N(h){i[6](h)}let y={};i[0]!==void 0&&(y.showNewScene=i[0]),a=new Un({props:y}),le.push(()=>ge(a,"showNewScene",N));let k=i[1]&&Tt(i);return{c(){e=I("div"),ae(t.$$.fragment),s=A(),r=I("div"),l=I("div"),ae(a.$$.fragment),c=A(),k&&k.c(),this.h()},l(h){e=C(h,"DIV",{class:!0});var v=z(e);ue(t.$$.fragment,v),s=U(v),r=C(v,"DIV",{class:!0});var _=z(r);l=C(_,"DIV",{class:!0});var S=z(l);ue(a.$$.fragment,S),S.forEach(g),_.forEach(g),c=U(v),k&&k.l(v),v.forEach(g),this.h()},h(){m(l,"class","page-container svelte-1x7qk0r"),m(r,"class","static-page-container svelte-1x7qk0r"),m(e,"class","main-window-container svelte-1x7qk0r")},m(h,v){D(h,e,v),ce(t,e,null),b(e,s),b(e,r),b(r,l),ce(a,l,null),b(e,c),k&&k.m(e,null),u=!0},p(h,[v]){const _={};!n&&v&1&&(n=!0,_.showNewScene=h[0],ve(()=>n=!1)),!o&&v&2&&(o=!0,_.showTest=h[1],ve(()=>o=!1)),t.$set(_);const S={};!f&&v&1&&(f=!0,S.showNewScene=h[0],ve(()=>f=!1)),a.$set(S),h[1]?k?(k.p(h,v),v&2&&K(k,1)):(k=Tt(h),k.c(),K(k,1),k.m(e,null)):k&&(je(),Y(k,1,1,()=>{k=null}),Oe())},i(h){u||(K(t.$$.fragment,h),K(a.$$.fragment,h),K(k),u=!0)},o(h){Y(t.$$.fragment,h),Y(a.$$.fragment,h),Y(k),u=!1},d(h){h&&g(e),fe(t),fe(a),k&&k.d()}}}function Bn(i,e,t){let n,o;te(i,ne,d=>t(8,n=d)),te(i,Pt,d=>t(9,o=d));let s=!1,r=!1,l={x:40,y:40};function a(){console.log(n);const d=document.getElementById("storygeneraldiv");d&&d.remove();const w=new o("es",{adventureSlide:!1,typewriterSpeed:20}),N=Object.entries(n).sort((h,v)=>h[1].display.y-v[1].display.y);if(N.length===0){alert("No hay escenas / There are no scenes");return}w.setScenes(n).startAdventure(N[0][0]);const y=document.getElementById("test-story-container"),k=document.getElementById("storygeneraldiv");y.appendChild(k)}function f(d){s=d,t(0,s)}function c(d){r=d,t(1,r)}function u(d){s=d,t(0,s)}function p(d){r=d,t(1,r)}return[s,r,l,a,f,c,u,p]}class Rn extends we{constructor(e){super(),ke(this,e,Bn,Pn,_e,{})}}function Vn(i){let e,t,n,o,s,r,l,a,f,c,u,p,d,w;return c=new Rn({}),{c(){e=I("section"),t=I("h1"),n=G("Aventura interactiva"),o=A(),s=I("p"),r=G("Un editor de historias interactivas para la librería "),l=I("a"),a=G("Aventura.js"),f=A(),ae(c.$$.fragment),u=A(),p=I("footer"),d=G("Sergio Rodríguez Gómez — 2023 — v1.0.0"),this.h()},l(N){e=C(N,"SECTION",{class:!0});var y=z(e);t=C(y,"H1",{class:!0});var k=z(t);n=W(k,"Aventura interactiva"),k.forEach(g),o=U(y),s=C(y,"P",{class:!0});var h=z(s);r=W(h,"Un editor de historias interactivas para la librería "),l=C(h,"A",{href:!0,target:!0,rel:!0,class:!0});var v=z(l);a=W(v,"Aventura.js"),v.forEach(g),h.forEach(g),f=U(y),ue(c.$$.fragment,y),u=U(y),p=C(y,"FOOTER",{class:!0});var _=z(p);d=W(_,"Sergio Rodríguez Gómez — 2023 — v1.0.0"),_.forEach(g),y.forEach(g),this.h()},h(){m(t,"class","svelte-1ekz32g"),m(l,"href","https://github.com/srsergiorodriguez/aventura/blob/master/README_es.md"),m(l,"target","_blank"),m(l,"rel","noreferrer"),m(l,"class","svelte-1ekz32g"),m(s,"class","svelte-1ekz32g"),m(p,"class","no-select svelte-1ekz32g"),m(e,"class","general no-select")},m(N,y){D(N,e,y),b(e,t),b(t,n),b(e,o),b(e,s),b(s,r),b(s,l),b(l,a),b(e,f),ce(c,e,null),b(e,u),b(e,p),b(p,d),w=!0},p:Ee,i(N){w||(K(c.$$.fragment,N),w=!0)},o(N){Y(c.$$.fragment,N),w=!1},d(N){N&&g(e),fe(c)}}}class Kn extends we{constructor(e){super(),ke(this,e,null,Vn,_e,{})}}export{Kn as default};
