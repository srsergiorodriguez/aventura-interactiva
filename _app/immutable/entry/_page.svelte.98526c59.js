import{S as we,i as ke,s as _e,e as S,a as U,t as H,b as I,d as M,j as L,f as K,g as v,A as m,l as j,k as _,K as B,n as Ee,L as Ie,v as ee,M as be,D as le,c as St,N as Ae,u as It,m as Ct,o as Tt,p as q,q as x,O as me,P as pe,F as ae,G as ue,H as ce,I as fe,Q as ge,R as ye,T as ve,U as We,r as Fe,V as $e,w as Se,C as De,x as Oe,W as je,X as He,z as jt,Y as Ue,Z as Le,_ as et}from"../chunks/index.4d86df2e.js";import{w as Ye,r as Te}from"../chunks/index.9d73ec15.js";const Xe=Ye(!0),Ge=Ye(void 0),te=Ye({inicio:{texto:"Érase una vez un círculo...",display:{x:140,y:90},opciones:[{btn:"dejar tranquilo",escena:"final1"},{btn:"aplastar",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{x:100,y:300}},final2:{texto:"Parece que la historia formó una elipsis",sinSalida:!0,display:{x:280,y:300}}}),zt=Te(i=>i.scene===void 0&&i.escena!==void 0?"escena":"scene"),xe=Te(i=>i.options===void 0&&i.opciones!==void 0?"opciones":"options"),At=Te(i=>i.text===void 0&&i.texto!==void 0?"texto":"text"),Mt=Te(i=>i.image===void 0&&i.imagen!==void 0?"imagen":"image");function Dt(i,e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([i],{type:e})),n.setAttribute("download",t),document.body.appendChild(n),n.click(),document.body.removeChild(n)}const Ut=Te((i,e)=>{Dt(JSON.stringify(i,null,2),"application/json",`${e.includes(".json")?e:e+".json"}`)}),Lt=Te(i=>{Dt(i,"text/plain;charset=utf-8","index.html")}),Pt=function(i,e,t){return`
<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
  </head>
  <body>
  </body>
  <script>
    const lang = "es";
    const options = {typewriterSpeed: 20, defaultCSS: false};
  <\/script>
  <style>
    
  #storygeneraldiv {
    box-sizing: border-box;
    margin: auto;
    max-width: 600px;
    font-family: 'Courier New', Courier, monospace;
    background: white;
  }
  
  .storydiv {
    border: solid black 1px;
    width: 100%;
    display: flex;
    padding: 10px;
    flex-direction: column;
    box-sizing: border-box;
  }
  
  .storyp {
    font-size: 18px;
    min-height: 25px;
  }
  
  .storybutton-container {
    margin: auto;
  }
  
  .storybutton {
    background: white;
    box-shadow: none;
    border: solid 1px;
    margin: 0px 1em 0px 0px;
    font-size: 20px;
    font-family: 'Courier New', Courier, monospace;
    cursor: pointer;
  }
  
  .storybutton:hover {
    color: white;
    background: black;
  }
  
  .storyimage-container {
    box-sizing: content-box;
    position: relative;
    width: 100%;
    margin: auto;
  }
  
  .storyimage {
    justify-content: center;
    width: 100%;
    margin: auto;
    border-radius: 20px;
    display: block;
  }
  
  .storyimage-area {
    font-size: 14px;
    position: absolute;
    cursor: pointer;
    text-align: center;
    color: black;
    background: #ffffff00;
    border: solid 1px black;
  }
  
  .storyimage-area:hover {
    background: #ffffff33;
  }
  
  @media screen and (max-device-width: 500px) {
    #storygeneraldiv {
      max-width:100%;
    }
    .storyp {
      font-size: 7vw;
    }
    .storybutton {
      font-size: 10vw;
    }
  }
  
  </style>
  <script>
    const A = ${i}
  <\/script>
  <script>
    const scenes = ${e};
    const aventura = new A(lang, options);
    aventura.setScenes(scenes).startAdventure('${t}');
  <\/script>
</html>
`},Bt=Te(Pt);class Rt{constructor(e="en",t){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,adventureSlide:!0,evalTags:!1,igramaFormat:"png",urlWord:"URL",vizWidth:1e3,vizHeight:1e3,vizBg:"#313131",vizCol:"black",vizImageSize:50,vizLoading:!0,minigifOptions:{},sceneCallback:n=>n},t&&(this.options=Object.assign(this.options,this.setOptionsTranslations(t))),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.fijarDatosEscenas=this.setDataScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setOptionsTranslations(e){const t={velocidadMaquina:"typewriterSpeed",CSSporDefecto:"defaultCSS",contenedorAventura:"adventureContainer",rolloAventura:"adventureScroll",deslizarAImagen:"adventureSlide",ejecutarEtiquetas:"evalTags",formatoIgrama:"igramaFormat",palabraUrl:"urlWord",anchoVis:"vizWidth",altoVis:"vizHeight",fondoVis:"vizBg",colorVis:"vizCol",tamanoImagenVis:"visImageSize",cargandoVis:"vizLoading",opcionesMinigif:"minigifOptions",funcionEscena:"sceneCallback"};for(let[n,r]of Object.entries(e))t[n]!==void 0&&(e[t[n]]=r,delete e[n]);return e}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[t,n]of Object.entries(e.grammar));return this}setScenes(e){this.options.defaultCSS&&this.setCSS(),this.scenes=e;for(let t of Object.keys(e)){this.scenes[t].key=t;const n=this.scenes[t].image||this.scenes[t].imagen;n!==void 0&&this.storyPreload[n]===void 0&&(this.storyPreload[n]=new Image,this.storyPreload[n].src=n,this.storyPreload[n].className="storyimage")}return this}async setDataScenes(e,t=void 0,n=[]){if(this.options.defaultCSS&&this.setCSS(),typeof d3>"u"){console.error(this.lang==="es"?"Para crear visualizaciones debes tener también la librería D3":"To create visualizations you must have also the D3 library");return}return this.scenes=JSON.parse(JSON.stringify(e)),this.metaKeys=n,t!==void 0&&(this.data=JSON.parse(JSON.stringify(t)),await this.setViz(this.scenes,this.data)),this.setScenes(this.scenes),this}async setViz(e,t){const n=Object.keys(e),r={compare:Vt,scatter:Gt,pack:Wt};let s=0;for(let c of n)e[c].viz!==void 0&&s++;let o=0,a;const l=this.lang==="en"?"Loading...":"Cargando...";this.options.vizLoading&&(a=document.createElement("div"),a.id="storygeneraldiv",a.className="storydiv",a.textContent=l,(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(a));function d(c,u=15){let f="";for(let h=0;h<Math.ceil(u);h++)f+=h<c*u?"|":"-";return f}for(let c of n){if(e[c].viz===void 0)continue;const{filter:u,type:f,x:h,y:w}=e[c].viz;if(r[f]===void 0||h===void 0||w===void 0){const g=this.lang==="es"?`Parámetros incorrectos de visualización en la escena "${c}"`:`Incorrect parameteres in the scene "${c}"`;console.error(g)}let E=t;for(let g of u)E=this.filterFn(g)(E);let y=o;const{viz:b,areas:p}=await r[f](this,E,h,w,g=>{o=y+g/s;const N=Math.ceil(o*100);this.options.vizLoading&&(a.textContent=`${l} ${d(o)} ${N}%`)});e[c].image=b,e[c].areas=p}for(let c of t){if(c.ID===void 0){const u=this.lang==="es"?"Todos los datos deben tener un valor único con la clave ID":"All data must have a unique value with the ID key";console.error(u),this.scenes={};break}e[`ind_${c.ID}`]={text:`${c.CONT||""}`,meta:c.ID,dataScene:!0,options:[{btn:"<<<",scene:`ind_${c.ID}`}]},c.IMGURL!==void 0&&(e[`ind_${c.ID}`].image=c.IMGURL),c.URL!==void 0&&(e[`ind_${c.ID}`].url=c.URL)}a.remove()}filterFn(e){const t=e[1];if(t==="="||t==="=="||t==="===")return r=>r.filter(s=>n(s[e[0]])==n(e[2]));return t==="<"?r=>r.filter(s=>n(s[e[0]])<n(e[2])):t===">"?r=>r.filter(s=>n(s[e[0]])>n(e[2])):r=>r;function n(r){return r==="true"?!0:r==="false"?!1:r}}setMarkov(e){return this.markov=e,this}expandGrammar(e){const t=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(t)}expandIgrama(e){const t=this.igrama.grammar,n=this.selectGrammarRule(t[e]);return this.grammarRuleRecursion(n,t).split("|").map(s=>this.decodeDrawing(s))}grammarRuleRecursion(e,t){let n=t||this.grammar,r=this.setNewRules(e);const s=r.match(/<[\w\d.,/#]+>/gi);if(!s)return r;for(let o of s){const a=this.defineTransformations(o);r=r.replace(o,()=>{o=o.replace(/[<>]/gi,""),o=o.replace(/#[\w\d.,/]+#/g,"");const l=o.search(/[.]/)>-1?this.getNestedObject(n,o.match(/[\w\d]+/g)):n[o];if(!l){const c=this.lang==="es"?`Se intentó expandir desde la regla "${o}", pero no se pudo encontrar`:`Tried to expand from rule "${o}", but couldn't find it`;console.error(c)}const d=this.selectGrammarRule(l);return this.transformString(d,a)})}return this.grammarRuleRecursion(r,n)}setNewRules(e,t){let n;t===void 0?n=this.grammar:n=t;let r=e;const s=r.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(s)for(;s.length;){const o=s.pop();r=r.replace(o,"");const{symbol:a,pairsString:l}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(o).groups,d=l.match(/[-]?[\w\d]+:[\w\d]+/gi).map(c=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(c).groups);if(d){n[a]=n[a]||{};for(let c of d){const u=n[c.value];if(!u){const w=this.lang==="es"?`Se intentó crear la nueva regla "${a}", pero no se pudo encontrar "${c.value}" para producir la subregla "${c.key}"`:`Tried to create new rule: "${a}", but couldn't find "${c.value}" to produce "${c.key}" subrule`;console.error(w)}const f=c.remove==="-",h=this.selectGrammarRule(u);if(f){const w=u.indexOf(h);n[c.value]=[...u.slice(0,w),...u.slice(w+1)]}n[a][c.key]=[h]}}}return r}startAdventure(e){const t=document.createElement("div");return t.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(t),this.prevScene=e,this.goToScene(this.scenes[e]),this}goToScene(e){const t=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(l=>l.remove()),[...document.getElementsByClassName("storyimage-area")].map(a=>a.remove());const r=document.createElement("div");if(r.className="storydiv",t.appendChild(r),e.image||e.imagen){const a=document.createElement("div");a.className="storyimage-container",r.appendChild(a);const l=e.image||e.imagen,d=this.options.adventureScroll?this.storyPreload[l].cloneNode():this.storyPreload[l];a.appendChild(d),e.areas&&(d.complete?this.setAreas(d,a,e.areas):d.onload=()=>{this.setAreas(d,a,e.areas)})}else if(e.igrama!==void 0){const a=document.createElement("div");a.className="storyimage-container",r.appendChild(a);const l=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(l),this.igramaDataUrl(l,this.options.igramaFormat).then(d=>{const c=new Image;c.src=d,c.className="storyimage",a.appendChild(c)})}if(e.title||e.titulo){const a=document.createElement("div");a.className="storytitle-container",r.appendChild(a);const l=document.createElement("h1");l.className="storytitle",l.textContent=e.title||e.titulo,a.appendChild(l)}if(e.meta!==void 0){const a=document.createElement("div");a.className="storymeta-container",r.appendChild(a);const l=this.data.find(d=>d.ID==e.meta);for(let d of this.metaKeys){if(l[d]===void 0)continue;const c=document.createElement("div");c.className="storymeta-subcontainer",a.appendChild(c);const u=document.createElement("span");u.className="storymeta-key",u.textContent=`${d}: `,c.appendChild(u);const f=document.createElement("span");f.className="storymeta-val",f.textContent=l[d],c.appendChild(f)}}const s=document.createElement("div");s.className="storyp-container",(e.text||e.texto||e.igramaText)&&r.appendChild(s);const o=document.createElement("p");if(o.className="storyp",o.textContent="",s.appendChild(o),e.url){const a=document.createElement("a");a.className="storyurl",a.href=e.url,a.target="_blank",a.textContent=this.options.urlWord,s.appendChild(a)}this.options.adventureSlide&&document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(o,e),this.data&&(e.viz!==void 0?this.prevScene=e.key:e.dataScene===!0&&(e.options[0].scene=this.prevScene)),this.options.sceneCallback(e)}setAreas(e,t,n){const r=e.getBoundingClientRect(),s=t.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,t,n)},[...document.getElementsByClassName("storyimage-area")].map(a=>a.remove());for(let a of n){let l=document.createElement("div");l.className="storyimage-area";const d=(a.x-Math.floor(a.w/2))*r.width/e.naturalWidth;l.style.left=`${r.left-s.left+d}px`;const c=(a.y-Math.floor(a.h/2))*r.height/e.naturalHeight;l.style.top=`${r.top-s.top+c}px`,l.style.width=`${a.w*r.width/e.naturalWidth}px`,l.style.height=`${a.h*r.height/e.naturalHeight}px`,l.textContent=a.btn||"",d>0&&d<r.width&&c>0&&c<r.height&&t.appendChild(l),l.style.fontSize=`${18*r.height/e.naturalHeight}px`,l.onclick=()=>{const u=a.scene||a.escena;this.goToScene(this.scenes[u])},a.tooltip!==void 0&&(l.onmouseover=()=>{l.textContent=a.tooltip||"",l.style.zIndex="100"},l.onmouseout=()=>{l.textContent=a.btn||"",l.style.zIndex="0"})}}async typewriter(e,t){const n=t.text||t.texto||t.igramaText||"";let r=this.grammar?this.grammarRuleRecursion(n):n;if(r=r.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let s=0;await new Promise(o=>{const a=setInterval(()=>{const l=r.substring(0,s);this.options.evalTags?e.innerHTML=l:e.textContent=l,s++,s>r.length&&(clearInterval(a),o(!0))},Math.floor(this.options.typewriterSpeed))}),this.optionButtons(t)}else this.options.evalTags?e.innerHTML=r:e.textContent=r,this.optionButtons(t)}optionButtons(e){const t=[...document.getElementsByClassName("storydiv")],n=t[t.length-1];[...document.getElementsByClassName("storybutton-container")].map(o=>o.remove());const s=document.createElement("div");if(s.className="storybutton-container",n.appendChild(s),e.options||e.opciones){const o=e.options||e.opciones;for(let a of o){const l=document.createElement("button");l.className="storybutton",l.textContent=a.btn,s.appendChild(l),l.addEventListener("click",()=>{if((a.text||a.texto)===void 0){const c=a.scene||a.escena;this.goToScene(this.scenes[c])}else this.goToScene(a)})}}else if(e.scene||e.escena){const o=e.scene||e.escena,a=document.createElement("button");a.className="storybutton",a.textContent=this.lang==="en"?"Continue":"Continuar",s.appendChild(a),a.addEventListener("click",()=>{this.goToScene(this.scenes[o])})}this.options.adventureSlide&&document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const r=Math.random()*e.prob.reduce((o,a)=>o+a);let s=0;for(let o=0;o<e.prob.length;o++){if(s<=r&&r<s+e.prob[o])return e[o];s+=e.prob[o]}}const t=Math.floor(Math.random()*e.length);return e[t]}getNestedObject(e,t){return t.reduce((n,r)=>n&&n[r]!==void 0?n[r]:void 0,e)}defineTransformations(e){let t={};const n=/#(?<trans>[\w\d,]+)#/gi.exec(e),r=n?n.groups.trans.match(/[\w]+/gi):[];for(let s of r)t[s]=!0;return t}transformString(e,t){let n=e;return t.CAPITALIZE&&(n=n.charAt(0).toUpperCase()+n.slice(1)),t.ALLCAPS&&(n=n.toUpperCase()),n}decodeDrawing(e){if(e==="")return[];const[t,n,r]=e.split("%%");let s={};return t==="vector"?s.content=n.split("**").map(o=>{const[a,l,d]=o.split("&"),c=[];if(c.color=a,c.weight=l,d===void 0)return c;const u=d.split(",");for(let f=0;f<u.length;f+=2)c.push([+u[f],+u[f+1]]);return c}):s.content=n,s.attribute=r,s.type=t,s}async getMarkovModel(e,t=1,n=!1){let r=await(await fetch(`./${e}`)).text();r=r.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const s=r.split(this.markovSeparator),o={};for(let l=0;l<s.length-t;l++){let d="";for(let u=0;u<t;u++)d+=u===0?s[l+u]:" "+s[l+u];o[d]===void 0&&(o[d]={});const c=s[l+t];o[d][c]===void 0?o[d][c]=1:o[d][c]++}const a={};for(let l of Object.keys(o)){const d=Object.keys(o[l]);a[l]={probs:[],grams:d};let c=0;for(let u=0;u<d.length;u++)c+=o[l][d[u]];for(let u=0;u<d.length;u++)a[l].probs[u]=o[l][d[u]]/c}if(n){const l=e.split("/");this.saveJSON(a,`${l[l.length-1]}_markovModel_${t}N.json`)}return a}markovChain(e,t,n=.1){let r=t===void 0||this.markov[t]===void 0?this.randomMarkovWord():t,s=r;for(let a=0;a<e-1;a++){let l=this.getNextMarkov(this.markov[s]);l===void 0&&(l=this.getNextMarkov(this.randomMarkovWord()));let d=s.split(this.markovSeparator);d.push(l),d=d.slice(1).join(" "),s=d,r+=` ${l}`}return this.formatMarkov(r,n)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const t=Math.random();let n=0;if(e!==void 0)for(let r=0;r<e.probs.length;r++){if(n<=t&&t<n+e.probs[r])return e.grams[r];n+=e.probs[r]}}formatMarkov(e,t=.1){let n=e.replace(/ ([,:.;])/g,"$1");return n=n.replaceAll(/([.]) ([\wáéíóú])/ig,(r,s,o,a,l)=>Math.random()<t?`.
${o.toUpperCase()}`:`. ${o.toUpperCase()}`),n.charAt(0).toUpperCase()+n.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),n.setAttribute("download",`${t.includes(".json")?t:t+".json"}`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}testScenes(e){const t=e||this.scenes;if(!t){const r=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(r)}let n=[];for(let r of Object.keys(t)){const s=t[r];if(s.options||s.opciones){const a=(s.options||s.opciones).filter(l=>!t[l.scene||l.escena]);n=[...n,...a.map(l=>`${r} => ${l.btn} => ${l.scene||l.escena}`)]}else{if(s.deadEnd||s.sinSalida)continue;t[s.scene||s.escena]||n.push(`${r} => ${s.scene||s.escena}`)}}if(n.length>0){const r=this.lang==="es"?`Las siguientes escenas no llevan a ningún lado: ${n.join(", ")}`:`The following scenes are dead ends: ${n.join(", ")}`;console.error(r),this.scenesError=!0}return this}testGrammar(e){const t=e||this.grammar;if(!t){const n=this.lang==="es"?"No hay gramática para probar":"There is not grammar to test";console.error(n)}for(let n of Object.keys(t)){const r=t[n];for(let s of r){const o=s.match(/<([\w\d]+)>/gi),a=o?o.map(u=>u.replace(/[<>]/g,"")):[],l=s.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),d=l?l.map(u=>u.match(/([ ]?:[\w\d]+)/g).map(f=>/[ ]?:(?<key>[\w\d]+)/.exec(f).groups.key)).reduce((u,f)=>[...u,...f],[]):[],c=[...a,...d].filter(u=>!t[u]);if(c.length>0){const u=this.lang==="es"?`Las siguientes reglas, que se referencian en "${n}", no existen: ${c.join(", ")}`:`The following rules, referenced in "${n}", do not exist: ${c.join(", ")}`;this.grammarError=!0,console.error(u)}}}return this}testDistribution(e){const t=e||this.markov;if(t===void 0){const d=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(d)}const n={},r={};let s=0;const o=Object.values(t);for(let d of o)for(let c of d.probs){const u=(Math.round(c/.05)*.05).toFixed(2);r[s]=u,s++,n[u]===void 0?n[u]=1:n[u]++}console.log("------------------------------------ DIST ------------------------------------");const a=Math.max(...Object.values(n)),l=Object.entries(n).sort((d,c)=>d[0]>c[0]?1:d[0]<c[0]?-1:0);for(let d of l)console.log(`${d[0]}... ${"|".repeat(Math.ceil(d[1]*100/a))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,t="png",n){const r=await this.igramaDataUrl(e,t),s=new Image;s.src=r,n==null?document.body.appendChild(s):document.getElementById(n).appendChild(s)}async igramaDataUrl(e,t="png"){const n=this.igrama.metadata.width,r=this.igrama.metadata.height;let s=document.createElement("canvas");s.width=n,s.height=r;const o=s.getContext("2d");o.lineJoin="round",o.lineCap="round",o.fillStyle=this.igrama.metadata.bg||"#FFFFFF",o.fillRect(0,0,n,r),await this.drawLayers(e,o);let a;if(t==="png")a=s.toDataURL();else if(t==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener también la librería MiniGif":"To create Gifs you must have also the MiniGif library"),"";const l={colorResolution:7,dither:!1,delay:50};Object.assign(l,this.minigifOptions);const d=new MiniGif(l);d.addFrame(s);const c=this.getLayerWiggle(e);o.fillStyle=this.igrama.metadata.bg||"#FFFFFF",o.fillRect(0,0,n,r),await this.drawLayers(c,o),d.addFrame(s);const u=d.makeGif();a="data:image/gif;base64,"+await this.base64_arraybuffer(u)}return s.remove(),a}async base64_arraybuffer(e){return(await new Promise(n=>{const r=new FileReader;r.onload=()=>n(r.result),r.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const n=JSON.parse(JSON.stringify(e)),r=(s,o)=>Math.floor(s+Math.random()*(o-s));for(let[s,o]of n.entries())if(o.type==="vector")for(let[a,l]of o.content.entries()){for(let[d,c]of l.entries())Math.random()<.5?c[0]+=r(-3,3):c[1]+=r(-3,3);l.color=e[s].content[a].color,l.weight=e[s].content[a].weight}return n}getIgramaText(e){return e.map(n=>n.attribute).reverse().join(" ").trim()}async drawLayers(e,t){for(let[n,r]of e.entries())if(r.type==="url"){const{w:s,h:o,x:a,y:l}=this.igrama.sections[n];if(this.imgsMemo[r.content]===void 0){const d=new Image;d.src=r.content,this.imgsMemo[r.content]=await new Promise(c=>{d.addEventListener("load",()=>{c(d)},!1)})}t.drawImage(this.imgsMemo[r.content],a,l,s,o)}else if(r.type=="vector")for(let s of r.content){if(s.length===0)continue;const o=this.getSpline(s);this.drawSpline(o,t,s.color,s.weight)}}drawSpline(e,t,n,r){t.lineWidth=r,t.strokeStyle=n,t.fillStyle="rgba(0,0,0,0)",t.beginPath();for(let s=0;s<e.length;s++)s===0?t.moveTo(...e[0]):t.lineTo(...e[s]);t.stroke()}getSpline(e){let t=[];for(let n=0;n<e.length-1;n++){const r=[];r[0]=n>0?e[n-1]:e[0],r[1]=e[n],r[2]=e[n+1],r[3]=n<e.length-2?e[n+2]:e[e.length-1];for(let s=0;s<1;s+=.05){const o=this.getSplinePoint(s,r);t.push(o)}}return t}getSplinePoint(e,t){const n=Math.floor(e)+1,r=n+1,s=r+1,o=n-1,a=e*e,l=a*e,d=-l+2*a-e,c=3*l-5*a+2,u=-3*l+4*a+e,f=l-a,h=.5*(t[o][0]*d+t[n][0]*c+t[r][0]*u+t[s][0]*f),w=.5*(t[o][1]*d+t[n][1]*c+t[r][1]*u+t[s][1]*f);return[h,w]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=Ft,document.getElementsByTagName("head")[0].appendChild(e)}}async function Vt(i,e,t,n,r=()=>{}){const s=[e.find(E=>E.ID==t),e.find(E=>E.ID==n)],o=i.options.vizWidth,a=i.options.vizHeight;let l=0;const d=[];for(let E of s){const y=new Image;y.setAttribute("crossorigin","anonymous"),y.src=E.IMGURL,await new Promise(b=>{y.onload=()=>{b(!0)}}),d.push({url:E.IMGURL,img:y,ID:E.ID}),r(l/s.length),l++}const c=document.createElement("canvas"),u=c.getContext("2d");c.width=o,c.height=a,u.fillStyle=i.options.vizBg,u.fillRect(0,0,o,a);const f=[];let h=0;for(let E of d){const y=parseInt(o/2)*.1,b=parseInt(o/2)-y,p=parseInt(b*E.img.height/E.img.width),g=h*(b+y)+b/2+y/2,N=a/2;u.save(),u.translate(-b/2,-p/2),u.drawImage(E.img,g,N,b,p),u.restore();const C={x:g,y:N,w:b,h:p,btn:"",scene:`ind_${E.ID}`,tooltip:""};f.push(C),h++}const w=c.toDataURL("image/png");return c.remove(),{viz:w,areas:f}}async function Gt(i,e,t,n,r=()=>{}){const s=i.options.vizWidth,o=i.options.vizHeight,a=i.options.vizImageSize,l={l:.2*s,r:.1*s,t:.1*o,b:.1*o},d=s-l.l-l.r,c=o-l.t-l.b,u=e,f=[...new Set(u.map(D=>D[t]))],h=[...new Set(u.map(D=>D[n]))],w=d3.scalePoint().domain(f).range([0,d]).padding(.5).round(!0),E=d3.scalePoint().domain(h).range([0,c]).padding(.5).round(!0);let y=0;const b=[];for(let D of u){if(i.imgsMemo[D.IMGURL]===void 0){const G=new Image;G.setAttribute("crossorigin","anonymous"),G.src=D.IMGURL,i.imgsMemo[D.IMGURL]=await new Promise(T=>{G.onload=()=>{T(G)}})}b.push({url:D.IMGURL,x:w(D[t]),y:E(D[n]),img:i.imgsMemo[D.IMGURL],r:a,ID:D.ID}),r(y/u.length),y++}d3.forceSimulation(b).force("charge",d3.forceManyBody().strength(5)).force("collide",d3.forceCollide(10)).tick(200);const p=document.createElement("canvas"),g=p.getContext("2d");p.width=s,p.height=o,g.fillStyle=i.options.vizBg,g.fillRect(0,0,s,o),g.strokeStyle=i.options.vizCol,g.font="14px serif",g.textBaseline="middle",g.textAlign="center";for(let D of f)g.fillStyle=i.options.vizCol,g.fillText(D,l.l+w(D),l.t+c+l.b/2);g.beginPath(),g.moveTo(l.l,l.t+c),g.lineTo(l.l+d,l.t+c),g.stroke(),g.textAlign="right";for(let D of h)g.fillStyle=i.options.vizCol,g.fillText(D,l.l-5,l.t+E(D));g.beginPath(),g.moveTo(l.l,l.t),g.lineTo(l.l,l.t+c),g.stroke(),g.strokeStyle=i.options.vizCol;const N=[];for(let D of b){const G=a,T=G*D.img.height/D.img.width,z=D.x+l.l,P=D.y+l.t;g.save(),g.translate(-G/2,-T/2),g.drawImage(D.img,z,P,G,T),g.restore();const F={x:z,y:P,w:G,h:T,btn:"",scene:`ind_${D.ID}`,tooltip:""};N.push(F)}const C=p.toDataURL("image/png");return p.remove(),{viz:C,areas:N}}async function Wt(i,e,t,n,r=()=>{}){const s=i.options.vizWidth,o=i.options.vizHeight,a=e,l=d3.rollup(a,N=>N.length,N=>N[t],N=>N[n]),d=([N,C])=>C.size&&Array.from(C),c=d3.hierarchy(l,d).sum(([,N])=>N).sort((N,C)=>C.value-N.value),u=[...d3.schemeGreys[4]].reverse(),f=c.descendants(),h=N=>u[N];d3.pack(c).size([s,o]).padding(20)(c);const w=[];let E=0;for(let N of a){for(let C of c.leaves())if(N[t]===C.parent.data[0]&&N[n]===C.data[0]){if(i.imgsMemo[N.IMGURL]===void 0){const D=new Image;D.setAttribute("crossorigin","anonymous"),D.src=N.IMGURL,i.imgsMemo[N.IMGURL]=await new Promise(G=>{D.onload=()=>{G(D)}})}w.push({url:N.IMGURL,x:C.x,y:C.y,r:i.options.vizImageSize,img:i.imgsMemo[N.IMGURL],ID:N.ID})}r(E/a.length),E++}d3.forceSimulation(w).force("collide",d3.forceCollide(20)).tick(200);const y=document.createElement("canvas"),b=y.getContext("2d");y.width=s,y.height=o,b.fillStyle=i.options.vizBg,b.fillRect(0,0,s,o),b.font="12px serif",b.textBaseline="middle",b.textAlign="center";for(let N of f)b.save(),b.translate(N.x,N.y),b.strokeStyle=i.options.vizCol,b.fillStyle=h(N.depth),b.beginPath(),b.ellipse(0,0,N.r,N.r,0,0,Math.PI*2),b.fill(),b.stroke(),b.fillStyle=i.options.vizCol,b.fillText(N.depth===1||N.depth===2?N.data[0]:"",0,-N.r-5),b.restore();const p=[];for(let N of w){const C=parseInt(50),D=parseInt(C*N.img.height/N.img.width),G=N.x,T=N.y;b.save(),b.translate(-C/2,-D/2),b.drawImage(N.img,G,T,C,D),b.restore();const z={x:G,y:T,w:C,h:D,btn:"",scene:`ind_${N.ID}`,tooltip:""};p.push(z)}const g=y.toDataURL("image/png");return y.remove(),{viz:g,areas:p}}const Ft=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  box-sizing: border-box;
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 1em;
  flex-direction: column;
}

.storytitle {
  font-size: 2em;
  margin: 0.1em 0;
}

.storyp {
  font-size: 1em;
}

.storymeta-container {
  margin: 0.5em 0;
}

.storymeta-key {
  font-weight: 700;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  box-sizing: border-box;
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: #ffffff00;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: #ffffff33;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,Ot=Te(Rt);function Ht(i){let e,t,n,r,s,o,a,l,d,c,u,f,h,w,E,y,b,p,g,N,C,D,G,T;return{c(){e=S("div"),t=S("input"),n=U(),r=S("div"),s=S("button"),o=H("Nuevo proyecto"),a=U(),l=S("label"),d=H("Importar"),c=U(),u=S("button"),f=H("Exportar"),h=U(),w=S("button"),E=H("Previsualizar"),y=U(),b=S("button"),p=H("Generar interactivo final"),g=U(),N=S("div"),C=S("button"),D=H("Nueva escena"),this.h()},l(z){e=I(z,"DIV",{class:!0});var P=M(e);t=I(P,"INPUT",{type:!0,id:!0}),n=L(P),r=I(P,"DIV",{class:!0});var F=M(r);s=I(F,"BUTTON",{class:!0});var Z=M(s);o=K(Z,"Nuevo proyecto"),Z.forEach(v),a=L(F),l=I(F,"LABEL",{class:!0,for:!0});var W=M(l);d=K(W,"Importar"),W.forEach(v),c=L(F),u=I(F,"BUTTON",{class:!0});var Q=M(u);f=K(Q,"Exportar"),Q.forEach(v),h=L(F),w=I(F,"BUTTON",{class:!0});var V=M(w);E=K(V,"Previsualizar"),V.forEach(v),y=L(F),b=I(F,"BUTTON",{class:!0});var se=M(b);p=K(se,"Generar interactivo final"),se.forEach(v),F.forEach(v),g=L(P),N=I(P,"DIV",{class:!0});var ie=M(N);C=I(ie,"BUTTON",{class:!0});var Y=M(C);D=K(Y,"Nueva escena"),Y.forEach(v),ie.forEach(v),P.forEach(v),this.h()},h(){m(t,"type","file"),m(t,"id","load-input"),t.hidden=!0,m(s,"class","toolbar-button svelte-10r16uj"),m(l,"class","toolbar-button svelte-10r16uj"),m(l,"for","load-input"),m(u,"class","toolbar-button svelte-10r16uj"),m(w,"class","toolbar-button svelte-10r16uj"),m(b,"class","toolbar-button svelte-10r16uj"),m(r,"class","project-toolbar svelte-10r16uj"),m(C,"class","toolbar-button svelte-10r16uj"),m(N,"class","scene-toolbar svelte-10r16uj"),m(e,"class","toolbar svelte-10r16uj")},m(z,P){j(z,e,P),_(e,t),i[9](t),_(e,n),_(e,r),_(r,s),_(s,o),_(r,a),_(r,l),_(l,d),_(r,c),_(r,u),_(u,f),_(r,h),_(r,w),_(w,E),_(r,y),_(r,b),_(b,p),_(e,g),_(e,N),_(N,C),_(C,D),G||(T=[B(t,"change",i[3]),B(s,"click",i[2]),B(u,"click",i[4]),B(w,"click",i[5]),B(b,"click",i[6]),B(C,"click",i[1])],G=!0)},p:Ee,i:Ee,o:Ee,d(z){z&&v(e),i[9](null),G=!1,Ie(T)}}}function Kt(i,e,t){let n,r,s,o,a;ee(i,Lt,p=>t(10,n=p)),ee(i,Bt,p=>t(11,r=p)),ee(i,te,p=>t(12,s=p)),ee(i,Ot,p=>t(13,o=p)),ee(i,Ut,p=>t(14,a=p));let{showNewScene:l}=e,{showTest:d}=e,c;function u(){t(7,l=!0)}function f(){be(te,s={},s)}function h(){const p=c.files[0];if(p.type==="application/json"){const g=new FileReader;g.addEventListener("load",function(){be(te,s={},s);const N=g.result,C=JSON.parse(N);be(te,s=C,s)}),this.value=null,g.readAsText(p);return}else alert("Formato de archivo incorrecto / incorrect file format")}function w(){a(s,"aventuraInteractiva")}function E(){t(8,d=!0)}function y(){const p=Object.entries(s).sort((D,G)=>D[1].display.y-G[1].display.y);if(p.length===0){alert("No hay escenas / There are no scenes");return}const g=o.toString(),N=JSON.stringify(s),C=r(g,N,p[0][0]);n(C)}function b(p){le[p?"unshift":"push"](()=>{c=p,t(0,c)})}return i.$$set=p=>{"showNewScene"in p&&t(7,l=p.showNewScene),"showTest"in p&&t(8,d=p.showTest)},[c,u,f,h,w,E,y,l,d,b]}class qt extends we{constructor(e){super(),ke(this,e,Kt,Ht,_e,{showNewScene:7,showTest:8})}}function Jt(i){let e,t,n,r;const s=i[4].default,o=St(s,i,i[3],null);return{c(){e=S("div"),o&&o.c(),this.h()},l(a){e=I(a,"DIV",{class:!0});var l=M(e);o&&o.l(l),l.forEach(v),this.h()},h(){m(e,"class","scene-node-container svelte-sua7yb")},m(a,l){j(a,e,l),o&&o.m(e,null),t=!0,n||(r=Ae(i[0].call(null,e)),n=!0)},p(a,[l]){o&&o.p&&(!t||l&8)&&It(o,s,a,a[3],t?Tt(s,a[3],l,null):Ct(a[3]),null)},i(a){t||(q(o,a),t=!0)},o(a){x(o,a),t=!1},d(a){a&&v(e),o&&o.d(a),n=!1,r()}}}function Xt(i,e,t){let{$$slots:n={},$$scope:r}=e,{scene:s}=e,{movingNode:o=!1}=e;function a(l){let d=!1;l.style.left=`${s.display.x}px`,l.style.top=`${s.display.y}px`,l.addEventListener("mousedown",()=>{d=!0,t(2,o=!0)}),window.addEventListener("mousemove",c=>{d&&(t(1,s.display.x+=c.movementX,s),t(1,s.display.y+=c.movementY,s),l.style.left=`${s.display.x}px`,l.style.top=`${s.display.y}px`)}),window.addEventListener("mouseup",()=>{d=!1,t(2,o=!1)})}return i.$$set=l=>{"scene"in l&&t(1,s=l.scene),"movingNode"in l&&t(2,o=l.movingNode),"$$scope"in l&&t(3,r=l.$$scope)},[a,s,o,r,n]}class Yt extends we{constructor(e){super(),ke(this,e,Xt,Jt,_e,{scene:1,movingNode:2})}}function xt(i){let e,t,n,r;const s=i[5].default,o=St(s,i,i[4],null);return{c(){e=S("div"),o&&o.c(),this.h()},l(a){e=I(a,"DIV",{class:!0});var l=M(e);o&&o.l(l),l.forEach(v),this.h()},h(){m(e,"class","draggui svelte-lq1cua")},m(a,l){j(a,e,l),o&&o.m(e,null),t=!0,n||(r=[Ae(i[0].call(null,e)),Ae(i[1].call(null,e)),B(e,"mousedown",me(i[6]))],n=!0)},p(a,[l]){o&&o.p&&(!t||l&16)&&It(o,s,a,a[4],t?Tt(s,a[4],l,null):Ct(a[4]),null)},i(a){t||(q(o,a),t=!0)},o(a){x(o,a),t=!1},d(a){a&&v(e),o&&o.d(a),n=!1,Ie(r)}}}function Zt(i,e,t){let{$$slots:n={},$$scope:r}=e,{pos:s}=e,{displace:o={x:s.x,y:s.y}}=e;function a(c){c.style.left=`${o.x}px`,c.style.top=`${o.y}px`}function l(c){let u=!1;c.style.left=`${o.x}px`,c.style.top=`${o.y}px`,c.addEventListener("mousedown",()=>{u=!0}),window.addEventListener("mousemove",f=>{u&&(t(2,o.x+=f.movementX,o),t(2,o.y+=f.movementY,o),c.style.left=`${o.x}px`,c.style.top=`${o.y}px`,c.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{u=!1,c.style.cursor="grab"})}function d(c){pe.call(this,i,c)}return i.$$set=c=>{"pos"in c&&t(3,s=c.pos),"displace"in c&&t(2,o=c.displace),"$$scope"in c&&t(4,r=c.$$scope)},[a,l,o,s,r,n,d]}class Ke extends we{constructor(e){super(),ke(this,e,Zt,xt,_e,{pos:3,displace:2})}}function Qt(i){let e,t,n,r,s;return{c(){e=S("div"),t=S("button"),n=H("X"),this.h()},l(o){e=I(o,"DIV",{class:!0});var a=M(e);t=I(a,"BUTTON",{class:!0});var l=M(t);n=K(l,"X"),l.forEach(v),a.forEach(v),this.h()},h(){m(t,"class","x-button"),m(e,"class","top-bar svelte-15bdkib")},m(o,a){j(o,e,a),_(e,t),_(t,n),r||(s=B(t,"click",i[0]),r=!0)},p:Ee,i:Ee,o:Ee,d(o){o&&v(e),r=!1,s()}}}function $t(i,e,t){let{toggle:n}=e;function r(){t(1,n=!1)}return i.$$set=s=>{"toggle"in s&&t(1,n=s.toggle)},[r,n]}class qe extends we{constructor(e){super(),ke(this,e,$t,Qt,_e,{toggle:1})}}function en(i){let e,t,n,r,s,o,a,l,d,c,u,f,h,w,E;function y(p){i[7](p)}let b={};return i[0]!==void 0&&(b.toggle=i[0]),e=new qe({props:b}),le.push(()=>ge(e,"toggle",y)),{c(){ae(e.$$.fragment),n=U(),r=S("div"),s=S("label"),o=H("Btn:"),a=U(),l=S("input"),d=U(),c=S("div"),u=S("button"),f=H("Aceptar"),this.h()},l(p){ue(e.$$.fragment,p),n=L(p),r=I(p,"DIV",{});var g=M(r);s=I(g,"LABEL",{for:!0});var N=M(s);o=K(N,"Btn:"),N.forEach(v),a=L(g),l=I(g,"INPUT",{id:!0,type:!0}),g.forEach(v),d=L(p),c=I(p,"DIV",{class:!0});var C=M(c);u=I(C,"BUTTON",{class:!0});var D=M(u);f=K(D,"Aceptar"),D.forEach(v),C.forEach(v),this.h()},h(){m(s,"for","inp"),m(l,"id","inp"),m(l,"type","text"),l.autofocus=!0,m(u,"class","gui-button"),m(c,"class","bar svelte-1bhrmvp")},m(p,g){ce(e,p,g),j(p,n,g),j(p,r,g),_(r,s),_(s,o),_(r,a),_(r,l),ye(l,i[2]),j(p,d,g),j(p,c,g),_(c,u),_(u,f),h=!0,l.focus(),w||(E=[B(l,"input",i[8]),B(l,"mousedown",me(i[6])),B(u,"click",i[3])],w=!0)},p(p,g){const N={};!t&&g&1&&(t=!0,N.toggle=p[0],ve(()=>t=!1)),e.$set(N),g&4&&l.value!==p[2]&&ye(l,p[2])},i(p){h||(q(e.$$.fragment,p),h=!0)},o(p){x(e.$$.fragment,p),h=!1},d(p){fe(e,p),p&&v(n),p&&v(r),p&&v(d),p&&v(c),w=!1,Ie(E)}}}function tn(i){let e,t,n,r;return e=new Ke({props:{pos:i[1],$$slots:{default:[en]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(s){ue(e.$$.fragment,s)},m(s,o){ce(e,s,o),t=!0,n||(r=B(window,"keydown",i[4]),n=!0)},p(s,[o]){const a={};o&2&&(a.pos=s[1]),o&4101&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i(s){t||(q(e.$$.fragment,s),t=!0)},o(s){x(e.$$.fragment,s),t=!1},d(s){fe(e,s),n=!1,r()}}}function nn(i,e,t){let n,r,s;ee(i,te,E=>t(9,r=E)),ee(i,xe,E=>t(10,s=E));let{key:o}=e,{pos:a}=e,{showNewOption:l}=e;const d=s(r[o]);function c(){r[o][d]===void 0&&be(te,r[o][d]=[],r),r[o][d].push({btn:n}),te.set(r),t(0,l=!1)}function u(E){E.key==="Enter"&&c(),E.key==="Escape"&&t(0,l=!1)}function f(E){pe.call(this,i,E)}function h(E){l=E,t(0,l)}function w(){n=this.value,t(2,n)}return i.$$set=E=>{"key"in E&&t(5,o=E.key),"pos"in E&&t(1,a=E.pos),"showNewOption"in E&&t(0,l=E.showNewOption)},t(2,n=""),[l,a,n,c,u,o,f,h,w]}class sn extends we{constructor(e){super(),ke(this,e,nn,tn,_e,{key:5,pos:1,showNewOption:0})}}function tt(i){let e,t,n,r;return{c(){e=S("div"),t=H(i[8]),this.h()},l(s){e=I(s,"DIV",{class:!0});var o=M(e);t=K(o,i[8]),o.forEach(v),this.h()},h(){m(e,"class","area svelte-nya92k")},m(s,o){j(s,e,o),_(e,t),i[23](e),n||(r=B(e,"mousedown",me(i[14])),n=!0)},p(s,o){o&256&&Fe(t,s[8])},d(s){s&&v(e),i[23](null),n=!1,r()}}}function on(i){let e,t,n,r,s,o,a,l,d,c,u,f,h,w,E,y,b,p,g,N,C,D,G,T,z,P,F,Z,W,Q,V,se,ie,Y,oe,ne,R,J,$;function re(O){i[18](O)}let k={};i[0]!==void 0&&(k.toggle=i[0]),e=new qe({props:k}),le.push(()=>ge(e,"toggle",re));let A=i[5]&&tt(i);return{c(){ae(e.$$.fragment),n=U(),r=S("div"),s=S("h1"),o=H(i[1]),a=U(),l=S("div"),d=S("div"),c=S("h2"),u=H("Nombre de referencia"),f=U(),h=S("input"),w=U(),E=S("div"),y=S("h2"),b=H("Btn"),p=U(),g=S("input"),N=U(),C=S("div"),D=S("h2"),G=H("Tooltip"),T=U(),z=S("input"),P=U(),F=S("div"),Z=S("div"),W=S("div"),Q=S("img"),se=U(),A&&A.c(),ie=U(),Y=S("div"),oe=S("button"),ne=H("Aceptar"),this.h()},l(O){ue(e.$$.fragment,O),n=L(O),r=I(O,"DIV",{});var X=M(r);s=I(X,"H1",{class:!0});var de=M(s);o=K(de,i[1]),de.forEach(v),X.forEach(v),a=L(O),l=I(O,"DIV",{class:!0});var he=M(l);d=I(he,"DIV",{class:!0});var Ne=M(d);c=I(Ne,"H2",{class:!0});var ze=M(c);u=K(ze,"Nombre de referencia"),ze.forEach(v),f=L(Ne),h=I(Ne,"INPUT",{}),Ne.forEach(v),w=L(he),E=I(he,"DIV",{class:!0});var Me=M(E);y=I(Me,"H2",{class:!0});var Pe=M(y);b=K(Pe,"Btn"),Pe.forEach(v),p=L(Me),g=I(Me,"INPUT",{}),Me.forEach(v),N=L(he),C=I(he,"DIV",{class:!0});var Ce=M(C);D=I(Ce,"H2",{class:!0});var Be=M(D);G=K(Be,"Tooltip"),Be.forEach(v),T=L(Ce),z=I(Ce,"INPUT",{}),Ce.forEach(v),he.forEach(v),P=L(O),F=I(O,"DIV",{class:!0});var Re=M(F);Z=I(Re,"DIV",{class:!0});var Ve=M(Z);W=I(Ve,"DIV",{class:!0});var Je=M(W);Q=I(Je,"IMG",{src:!0,alt:!0,class:!0}),se=L(Je),A&&A.l(Je),Je.forEach(v),Ve.forEach(v),Re.forEach(v),ie=L(O),Y=I(O,"DIV",{class:!0});var Ze=M(Y);oe=I(Ze,"BUTTON",{class:!0});var Qe=M(oe);ne=K(Qe,"Aceptar"),Qe.forEach(v),Ze.forEach(v),this.h()},h(){m(s,"class","svelte-nya92k"),m(c,"class","svelte-nya92k"),m(d,"class","input"),m(y,"class","svelte-nya92k"),m(E,"class","input"),m(D,"class","svelte-nya92k"),m(C,"class","input"),m(l,"class","inputs svelte-nya92k"),We(Q.src,V=i[9][i[10]])||m(Q,"src",V),m(Q,"alt","Preview"),m(Q,"class","img-preview svelte-nya92k"),m(W,"class","area-container"),m(Z,"class","area-absolute-container svelte-nya92k"),m(F,"class","area-normal-container svelte-nya92k"),m(oe,"class","gui-button"),m(Y,"class","bar")},m(O,X){ce(e,O,X),j(O,n,X),j(O,r,X),_(r,s),_(s,o),j(O,a,X),j(O,l,X),_(l,d),_(d,c),_(c,u),_(d,f),_(d,h),ye(h,i[6]),_(l,w),_(l,E),_(E,y),_(y,b),_(E,p),_(E,g),ye(g,i[8]),_(l,N),_(l,C),_(C,D),_(D,G),_(C,T),_(C,z),ye(z,i[7]),j(O,P,X),j(O,F,X),_(F,Z),_(Z,W),_(W,Q),i[22](Q),_(W,se),A&&A.m(W,null),j(O,ie,X),j(O,Y,X),_(Y,oe),_(oe,ne),R=!0,J||($=[B(h,"input",i[19]),B(h,"mousedown",me(i[17])),B(g,"input",i[20]),B(g,"mousedown",me(i[16])),B(z,"input",i[21]),B(z,"mousedown",me(i[15])),Ae(i[11].call(null,Q)),B(Z,"mousedown",me(i[13])),B(oe,"click",i[12])],J=!0)},p(O,X){const de={};!t&&X&1&&(t=!0,de.toggle=O[0],ve(()=>t=!1)),e.$set(de),(!R||X&2)&&Fe(o,O[1]),X&64&&h.value!==O[6]&&ye(h,O[6]),X&256&&g.value!==O[8]&&ye(g,O[8]),X&128&&z.value!==O[7]&&ye(z,O[7]),O[5]?A?A.p(O,X):(A=tt(O),A.c(),A.m(W,null)):A&&(A.d(1),A=null)},i(O){R||(q(e.$$.fragment,O),R=!0)},o(O){x(e.$$.fragment,O),R=!1},d(O){fe(e,O),O&&v(n),O&&v(r),O&&v(a),O&&v(l),O&&v(P),O&&v(F),i[22](null),A&&A.d(),O&&v(ie),O&&v(Y),J=!1,Ie($)}}}function rn(i){let e,t;return e=new Ke({props:{pos:i[2],$$slots:{default:[on]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,r){ce(e,n,r),t=!0},p(n,[r]){const s={};r&4&&(s.pos=n[2]),r&268435963&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(n){t||(q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function ln(i,e,t){let n,r,s,o,a;ee(i,te,V=>t(25,o=V)),ee(i,Mt,V=>t(26,a=V));let{key:l}=e,{pos:d}=e,{showNewArea:c}=e,u,f=o[l];const h=a(f);let w={},E,y;function b(V){let se=!1;V.addEventListener("mousedown",Y=>{Y.preventDefault(),se=!0,t(5,y={x1:Y.offsetX,y1:Y.offsetY,x2:Y.offsetX,y2:Y.offsetY})}),V.addEventListener("mousemove",Y=>{se&&p(Y)}),V.addEventListener("mouseup",Y=>{ie(Y)}),V.addEventListener("mouseout",Y=>{ie(Y)});function ie(Y){if(y===void 0||!se)return;se=!1;const oe=p(Y),ne={};for(let R of Object.keys(oe))ne[R]=Math.floor(oe[R]*u.naturalWidth/u.width);Object.assign(w,{...ne}),w.x=Math.floor(ne.x+ne.w/2),w.y=Math.floor(ne.y+ne.h/2)}}function p(V){t(5,y.x2=V.offsetX,y),t(5,y.y2=V.offsetY,y);const se=Math.min(y.x1,y.x2),ie=Math.max(y.x1,y.x2),Y=Math.min(y.y1,y.y2),oe=Math.max(y.y1,y.y2),ne={x:se,y:Y,w:ie-se,h:oe-Y};return t(4,E.style.width=`${ne.w}px`,E),t(4,E.style.height=`${ne.h}px`,E),t(4,E.style.top=`${ne.y}px`,E),t(4,E.style.left=`${ne.x}px`,E),ne}function g(){if(w===void 0){alert("debes escoger un area / you must choose an area");return}Object.assign(w,{btn:n,tooltip:r,name:s}),o[l].areas===void 0&&be(te,o[l].areas=[],o),o[l].areas.push(w),te.set(o),t(0,c=!1)}function N(V){pe.call(this,i,V)}function C(V){pe.call(this,i,V)}function D(V){pe.call(this,i,V)}function G(V){pe.call(this,i,V)}function T(V){pe.call(this,i,V)}function z(V){c=V,t(0,c)}function P(){s=this.value,t(6,s)}function F(){n=this.value,t(8,n)}function Z(){r=this.value,t(7,r)}function W(V){le[V?"unshift":"push"](()=>{u=V,t(3,u)})}function Q(V){le[V?"unshift":"push"](()=>{E=V,t(4,E)})}return i.$$set=V=>{"key"in V&&t(1,l=V.key),"pos"in V&&t(2,d=V.pos),"showNewArea"in V&&t(0,c=V.showNewArea)},t(8,n=""),t(7,r=""),t(6,s="area"),[c,l,d,u,E,y,s,r,n,f,h,b,g,N,C,D,G,T,z,P,F,Z,W,Q]}class an extends we{constructor(e){super(),ke(this,e,ln,rn,_e,{key:1,pos:2,showNewArea:0})}}function un(i){let e,t,n,r,s,o,a,l,d,c,u;return{c(){e=S("input"),t=U(),n=S("label"),r=H("Cargar archivo"),s=U(),o=S("div"),a=S("img"),this.h()},l(f){e=I(f,"INPUT",{type:!0,id:!0}),t=L(f),n=I(f,"LABEL",{class:!0,for:!0});var h=M(n);r=K(h,"Cargar archivo"),h.forEach(v),s=L(f),o=I(f,"DIV",{class:!0,id:!0});var w=M(o);a=I(w,"IMG",{src:!0,alt:!0,class:!0}),w.forEach(v),this.h()},h(){m(e,"type","file"),m(e,"id","load-image"),e.hidden=!0,m(n,"class","gui-button svelte-1f4uqrr"),m(n,"for","load-image"),We(a.src,l=i[0])||m(a,"src",l),m(a,"alt","Preview"),m(a,"class",d=$e(`img-preview ${i[0]?"":"hide"}`)+" svelte-1f4uqrr"),m(o,"class","image-preview-container svelte-1f4uqrr"),m(o,"id","image-preview-container")},m(f,h){j(f,e,h),i[4](e),j(f,t,h),j(f,n,h),_(n,r),j(f,s,h),j(f,o,h),_(o,a),i[5](a),c||(u=B(e,"change",i[3]),c=!0)},p(f,[h]){h&1&&!We(a.src,l=f[0])&&m(a,"src",l),h&1&&d!==(d=$e(`img-preview ${f[0]?"":"hide"}`)+" svelte-1f4uqrr")&&m(a,"class",d)},i:Ee,o:Ee,d(f){f&&v(e),i[4](null),f&&v(t),f&&v(n),f&&v(s),f&&v(o),i[5](null),c=!1,u()}}}function cn(i,e,t){let{imageUrl:n}=e,r,s;function o(){const d=r.files[0];if(d){const c=new FileReader;c.addEventListener("load",function(){s.setAttribute("src",c.result),t(0,n=c.result)}),c.readAsDataURL(d)}}function a(d){le[d?"unshift":"push"](()=>{r=d,t(1,r)})}function l(d){le[d?"unshift":"push"](()=>{s=d,t(2,s)})}return i.$$set=d=>{"imageUrl"in d&&t(0,n=d.imageUrl)},[n,r,s,o,a,l]}class fn extends we{constructor(e){super(),ke(this,e,cn,un,_e,{imageUrl:0})}}function dn(i){let e,t,n,r,s,o,a,l,d,c,u,f,h,w,E,y,b,p,g,N,C,D,G,T,z,P,F,Z,W,Q,V,se;function ie(R){i[9](R)}let Y={};i[0]!==void 0&&(Y.toggle=i[0]),e=new qe({props:Y}),le.push(()=>ge(e,"toggle",ie));function oe(R){i[12](R)}let ne={};return i[3]!==void 0&&(ne.imageUrl=i[3]),T=new fn({props:ne}),le.push(()=>ge(T,"imageUrl",oe)),{c(){ae(e.$$.fragment),n=U(),r=S("div"),s=S("h1"),o=H(i[1]),a=U(),l=S("div"),d=S("h2"),c=H("Texto"),u=U(),f=S("textarea"),h=U(),w=S("div"),E=S("h2"),y=H("Imagen (opcional)"),b=U(),p=S("div"),g=S("label"),N=H("Url:"),C=U(),D=S("input"),G=H(`
      o
      `),ae(T.$$.fragment),P=U(),F=S("div"),Z=S("button"),W=H("Aceptar"),this.h()},l(R){ue(e.$$.fragment,R),n=L(R),r=I(R,"DIV",{});var J=M(r);s=I(J,"H1",{class:!0});var $=M(s);o=K($,i[1]),$.forEach(v),J.forEach(v),a=L(R),l=I(R,"DIV",{});var re=M(l);d=I(re,"H2",{class:!0});var k=M(d);c=K(k,"Texto"),k.forEach(v),u=L(re),f=I(re,"TEXTAREA",{class:!0}),M(f).forEach(v),re.forEach(v),h=L(R),w=I(R,"DIV",{});var A=M(w);E=I(A,"H2",{class:!0});var O=M(E);y=K(O,"Imagen (opcional)"),O.forEach(v),b=L(A),p=I(A,"DIV",{});var X=M(p);g=I(X,"LABEL",{for:!0});var de=M(g);N=K(de,"Url:"),de.forEach(v),C=L(X),D=I(X,"INPUT",{id:!0,type:!0}),G=K(X,`
      o
      `),ue(T.$$.fragment,X),X.forEach(v),P=L(A),F=I(A,"DIV",{class:!0});var he=M(F);Z=I(he,"BUTTON",{class:!0});var Ne=M(Z);W=K(Ne,"Aceptar"),Ne.forEach(v),he.forEach(v),A.forEach(v),this.h()},h(){m(s,"class","svelte-8prumv"),m(d,"class","no-select svelte-8prumv"),m(f,"class","svelte-8prumv"),m(E,"class","no-select svelte-8prumv"),m(g,"for","inp"),m(D,"id","inp"),m(D,"type","text"),m(Z,"class","gui-button"),m(F,"class","bar")},m(R,J){ce(e,R,J),j(R,n,J),j(R,r,J),_(r,s),_(s,o),j(R,a,J),j(R,l,J),_(l,d),_(d,c),_(l,u),_(l,f),ye(f,i[4]),j(R,h,J),j(R,w,J),_(w,E),_(E,y),_(w,b),_(w,p),_(p,g),_(g,N),_(p,C),_(p,D),ye(D,i[3]),_(p,G),ce(T,p,null),_(w,P),_(w,F),_(F,Z),_(Z,W),Q=!0,V||(se=[B(f,"input",i[10]),B(f,"mousedown",me(i[8])),B(D,"input",i[11]),B(D,"mousedown",me(i[7])),B(Z,"click",i[5])],V=!0)},p(R,J){const $={};!t&&J&1&&(t=!0,$.toggle=R[0],ve(()=>t=!1)),e.$set($),(!Q||J&2)&&Fe(o,R[1]),J&16&&ye(f,R[4]),J&8&&D.value!==R[3]&&ye(D,R[3]);const re={};!z&&J&8&&(z=!0,re.imageUrl=R[3],ve(()=>z=!1)),T.$set(re)},i(R){Q||(q(e.$$.fragment,R),q(T.$$.fragment,R),Q=!0)},o(R){x(e.$$.fragment,R),x(T.$$.fragment,R),Q=!1},d(R){fe(e,R),R&&v(n),R&&v(r),R&&v(a),R&&v(l),R&&v(h),R&&v(w),fe(T),V=!1,Ie(se)}}}function hn(i){let e,t,n,r;return e=new Ke({props:{pos:i[2],$$slots:{default:[dn]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(s){ue(e.$$.fragment,s)},m(s,o){ce(e,s,o),t=!0,n||(r=B(window,"keydown",i[6]),n=!0)},p(s,[o]){const a={};o&4&&(a.pos=s[2]),o&65563&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i(s){t||(q(e.$$.fragment,s),t=!0)},o(s){x(e.$$.fragment,s),t=!1},d(s){fe(e,s),n=!1,r()}}}function pn(i,e,t){let n,r;ee(i,te,g=>t(13,r=g));let{key:s}=e,{pos:o}=e,{showEditor:a}=e,l=null,d=r[s];const c=d.text===void 0&&d.texto!==void 0?"texto":"text";function u(){be(te,r[s][c]=n,r),l!==null&&be(te,r[s].image=l,r),t(0,a=!1)}function f(g){g.key==="Enter"&&u(),g.key==="Escape"&&t(0,a=!1)}function h(g){pe.call(this,i,g)}function w(g){pe.call(this,i,g)}function E(g){a=g,t(0,a)}function y(){n=this.value,t(4,n),t(14,d)}function b(){l=this.value,t(3,l)}function p(g){l=g,t(3,l)}return i.$$set=g=>{"key"in g&&t(1,s=g.key),"pos"in g&&t(2,o=g.pos),"showEditor"in g&&t(0,a=g.showEditor)},i.$$.update=()=>{i.$$.dirty&2&&be(te,r[s]=d,r)},t(4,n=d[c]),[a,s,o,l,n,u,f,h,w,E,y,b,p]}class mn extends we{constructor(e){super(),ke(this,e,pn,hn,_e,{key:1,pos:2,showEditor:0})}}function nt(i,e,t){const n=i.slice();return n[38]=e[t],n[40]=t,n}function st(i,e,t){const n=i.slice();return n[41]=e[t],n[40]=t,n}function ot(i){let e,t,n,r,s,o,a,l;return{c(){e=S("div"),t=S("img"),r=U(),s=S("button"),o=H("x"),this.h()},l(d){e=I(d,"DIV",{class:!0});var c=M(e);t=I(c,"IMG",{src:!0,alt:!0,class:!0}),r=L(c),s=I(c,"BUTTON",{class:!0});var u=M(s);o=K(u,"x"),u.forEach(v),c.forEach(v),this.h()},h(){We(t.src,n=i[6][i[13]])||m(t,"src",n),m(t,"alt","Preview"),m(t,"class","img-preview svelte-cnz2jn"),m(s,"class","x-button image-x-button"),m(e,"class","img-preview-container svelte-cnz2jn")},m(d,c){j(d,e,c),_(e,t),_(e,r),_(e,s),_(s,o),a||(l=B(s,"click",i[23]),a=!0)},p(d,c){c[0]&64&&!We(t.src,n=d[6][d[13]])&&m(t,"src",n)},d(d){d&&v(e),a=!1,l()}}}function it(i){let e,t,n,r,s,o,a,l,d;return{c(){e=S("div"),t=S("span"),n=H("área"),r=U(),s=S("div"),o=S("button"),a=H("+"),this.h()},l(c){e=I(c,"DIV",{});var u=M(e);t=I(u,"SPAN",{class:!0});var f=M(t);n=K(f,"área"),f.forEach(v),r=L(u),s=I(u,"DIV",{class:!0});var h=M(s);o=I(h,"BUTTON",{class:!0});var w=M(o);a=K(w,"+"),w.forEach(v),h.forEach(v),u.forEach(v),this.h()},h(){m(t,"class","btns-name svelte-cnz2jn"),m(o,"class","svelte-cnz2jn"),m(s,"class","node-btns-div svelte-cnz2jn")},m(c,u){j(c,e,u),_(e,t),_(t,n),_(e,r),_(e,s),_(s,o),_(o,a),l||(d=B(o,"click",i[10]),l=!0)},p:Ee,d(c){c&&v(e),l=!1,d()}}}function rt(i,e){let t,n,r,s,o,a,l,d,c,u,f,h,w,E;return{key:i,first:null,c(){t=S("div"),n=S("input"),o=U(),a=S("button"),l=H("x"),c=U(),u=S("div"),this.h()},l(y){t=I(y,"DIV",{class:!0});var b=M(t);n=I(b,"INPUT",{type:!0,class:!0,i:!0}),o=L(b),a=I(b,"BUTTON",{class:!0,i:!0});var p=M(a);l=K(p,"x"),p.forEach(v),c=L(b),u=I(b,"DIV",{type:!0,key:!0,content:!0,class:!0,i:!0}),M(u).forEach(v),b.forEach(v),this.h()},h(){m(n,"type","text"),m(n,"class","output-text svelte-cnz2jn"),n.value=r=e[41].btn,m(n,"i",s=e[40]),m(a,"class","x-button"),m(a,"i",d=e[40]),m(u,"type","ops"),m(u,"key",e[1]),m(u,"content",f=e[41].btn),m(u,"class","connection output option-connection svelte-cnz2jn"),m(u,"i",h=e[40]),m(t,"class","output-container svelte-cnz2jn"),this.first=t},m(y,b){j(y,t,b),_(t,n),_(t,o),_(t,a),_(a,l),_(t,c),_(t,u),w||(E=[Ae(e[15].call(null,n)),B(n,"change",e[14]),B(n,"mousedown",me(e[27])),B(a,"click",e[21]),B(u,"click",e[18]),B(u,"mousedown",me(e[26]))],w=!0)},p(y,b){e=y,b[0]&6&&r!==(r=e[41].btn)&&n.value!==r&&(n.value=r),b[0]&6&&s!==(s=e[40])&&m(n,"i",s),b[0]&6&&d!==(d=e[40])&&m(a,"i",d),b[0]&2&&m(u,"key",e[1]),b[0]&6&&f!==(f=e[41].btn)&&m(u,"content",f),b[0]&6&&h!==(h=e[40])&&m(u,"i",h)},d(y){y&&v(t),w=!1,Ie(E)}}}function lt(i,e){let t,n,r,s,o,a,l,d,c,u,f,h,w,E,y;return{key:i,first:null,c(){t=S("div"),n=S("input"),o=U(),a=S("button"),l=H("x"),c=U(),u=S("div"),w=U(),this.h()},l(b){t=I(b,"DIV",{class:!0});var p=M(t);n=I(p,"INPUT",{type:!0,class:!0,i:!0}),o=L(p),a=I(p,"BUTTON",{class:!0,i:!0});var g=M(a);l=K(g,"x"),g.forEach(v),c=L(p),u=I(p,"DIV",{type:!0,key:!0,content:!0,class:!0,i:!0}),M(u).forEach(v),w=L(p),p.forEach(v),this.h()},h(){m(n,"type","text"),m(n,"class","output-text svelte-cnz2jn"),n.value=r=e[38].name,m(n,"i",s=e[40]),m(a,"class","x-button"),m(a,"i",d=e[40]),m(u,"type","areas"),m(u,"key",e[1]),m(u,"content",f=e[38].name),m(u,"class","connection output area-connection svelte-cnz2jn"),m(u,"i",h=e[40]),m(t,"class","output-container svelte-cnz2jn"),this.first=t},m(b,p){j(b,t,p),_(t,n),_(t,o),_(t,a),_(a,l),_(t,c),_(t,u),_(t,w),E||(y=[Ae(e[17].call(null,n)),B(n,"change",e[16]),B(n,"mousedown",me(e[25])),B(a,"click",e[22]),B(u,"click",e[18]),B(u,"mousedown",me(e[24]))],E=!0)},p(b,p){e=b,p[0]&6&&r!==(r=e[38].name)&&n.value!==r&&(n.value=r),p[0]&6&&s!==(s=e[40])&&m(n,"i",s),p[0]&6&&d!==(d=e[40])&&m(a,"i",d),p[0]&2&&m(u,"key",e[1]),p[0]&6&&f!==(f=e[38].name)&&m(u,"content",f),p[0]&6&&h!==(h=e[40])&&m(u,"i",h)},d(b){b&&v(t),E=!1,Ie(y)}}}function at(i){let e,t=[],n=new Map,r,s=[],o=new Map,a=i[2][i[1]][i[12]]||[];const l=u=>"op"+u[40];for(let u=0;u<a.length;u+=1){let f=st(i,a,u),h=l(f);n.set(h,t[u]=rt(h,f))}let d=i[2][i[1]].areas||[];const c=u=>"a"+u[40];for(let u=0;u<d.length;u+=1){let f=nt(i,d,u),h=c(f);o.set(h,s[u]=lt(h,f))}return{c(){e=S("div");for(let u=0;u<t.length;u+=1)t[u].c();r=U();for(let u=0;u<s.length;u+=1)s[u].c();this.h()},l(u){e=I(u,"DIV",{class:!0});var f=M(e);for(let h=0;h<t.length;h+=1)t[h].l(f);r=L(f);for(let h=0;h<s.length;h+=1)s[h].l(f);f.forEach(v),this.h()},h(){m(e,"class","node-outputs svelte-cnz2jn")},m(u,f){j(u,e,f);for(let h=0;h<t.length;h+=1)t[h].m(e,null);_(e,r);for(let h=0;h<s.length;h+=1)s[h].m(e,null)},p(u,f){f[0]&2379782&&(a=u[2][u[1]][u[12]]||[],t=je(t,f,l,1,u,a,n,e,He,rt,r,st)),f[0]&4521990&&(d=u[2][u[1]].areas||[],s=je(s,f,c,1,u,d,o,e,He,lt,null,nt))},d(u){u&&v(e);for(let f=0;f<t.length;f+=1)t[f].d();for(let f=0;f<s.length;f+=1)s[f].d()}}}function gn(i){let e,t,n,r,s,o,a,l,d,c=(i[6][i[11]].length<210?i[6][i[11]]:i[6][i[11]].slice(0,210)+"...")+"",u,f,h,w,E,y,b,p,g,N,C,D,G,T,z,P,F,Z,W,Q,V,se,ie,Y=i[7],oe,ne,R,J=i[6][i[13]]!==void 0&&i[6][i[13]]!==null&&ot(i),$=i[6][i[13]]!==void 0&&i[6][i[13]]!==null&&it(i),re=at(i);return{c(){e=S("div"),t=U(),n=S("h1"),r=H("Escena: "),s=H(i[1]),o=U(),J&&J.c(),a=U(),l=S("div"),d=S("p"),u=H(c),f=U(),h=S("div"),w=S("div"),E=S("span"),y=H("escena"),b=U(),p=S("div"),g=S("button"),N=H("editar"),C=U(),D=S("button"),G=H("x"),T=U(),z=S("div"),P=S("span"),F=H("btn"),Z=U(),W=S("div"),Q=S("button"),V=H("+"),se=U(),$&&$.c(),ie=U(),re.c(),oe=Se(),this.h()},l(k){e=I(k,"DIV",{key:!0,class:!0}),M(e).forEach(v),t=L(k),n=I(k,"H1",{class:!0});var A=M(n);r=K(A,"Escena: "),s=K(A,i[1]),A.forEach(v),o=L(k),J&&J.l(k),a=L(k),l=I(k,"DIV",{class:!0});var O=M(l);d=I(O,"P",{class:!0});var X=M(d);u=K(X,c),X.forEach(v),O.forEach(v),f=L(k),h=I(k,"DIV",{class:!0});var de=M(h);w=I(de,"DIV",{});var he=M(w);E=I(he,"SPAN",{class:!0});var Ne=M(E);y=K(Ne,"escena"),Ne.forEach(v),b=L(he),p=I(he,"DIV",{class:!0});var ze=M(p);g=I(ze,"BUTTON",{class:!0});var Me=M(g);N=K(Me,"editar"),Me.forEach(v),C=L(ze),D=I(ze,"BUTTON",{class:!0});var Pe=M(D);G=K(Pe,"x"),Pe.forEach(v),ze.forEach(v),he.forEach(v),T=L(de),z=I(de,"DIV",{});var Ce=M(z);P=I(Ce,"SPAN",{class:!0});var Be=M(P);F=K(Be,"btn"),Be.forEach(v),Z=L(Ce),W=I(Ce,"DIV",{class:!0});var Re=M(W);Q=I(Re,"BUTTON",{class:!0});var Ve=M(Q);V=K(Ve,"+"),Ve.forEach(v),Re.forEach(v),Ce.forEach(v),se=L(de),$&&$.l(de),de.forEach(v),ie=L(k),re.l(k),oe=Se(),this.h()},h(){m(e,"key",i[1]),m(e,"class","connection input svelte-cnz2jn"),m(n,"class","svelte-cnz2jn"),m(d,"class","text-p svelte-cnz2jn"),m(l,"class","p-container svelte-cnz2jn"),m(E,"class","btns-name svelte-cnz2jn"),m(g,"class","svelte-cnz2jn"),m(D,"class","svelte-cnz2jn"),m(p,"class","node-btns-div svelte-cnz2jn"),m(P,"class","btns-name svelte-cnz2jn"),m(Q,"class","svelte-cnz2jn"),m(W,"class","node-btns-div svelte-cnz2jn"),m(h,"class","node-btns svelte-cnz2jn")},m(k,A){j(k,e,A),j(k,t,A),j(k,n,A),_(n,r),_(n,s),j(k,o,A),J&&J.m(k,A),j(k,a,A),j(k,l,A),_(l,d),_(d,u),j(k,f,A),j(k,h,A),_(h,w),_(w,E),_(E,y),_(w,b),_(w,p),_(p,g),_(g,N),_(p,C),_(p,D),_(D,G),_(h,T),_(h,z),_(z,P),_(P,F),_(z,Z),_(z,W),_(W,Q),_(Q,V),_(h,se),$&&$.m(h,null),j(k,ie,A),re.m(k,A),j(k,oe,A),ne||(R=[B(e,"mousedown",me(i[28])),B(e,"click",i[19]),B(g,"click",i[8]),B(D,"click",i[20]),B(Q,"click",i[9])],ne=!0)},p(k,A){A[0]&2&&m(e,"key",k[1]),A[0]&2&&Fe(s,k[1]),k[6][k[13]]!==void 0&&k[6][k[13]]!==null?J?J.p(k,A):(J=ot(k),J.c(),J.m(a.parentNode,a)):J&&(J.d(1),J=null),A[0]&64&&c!==(c=(k[6][k[11]].length<210?k[6][k[11]]:k[6][k[11]].slice(0,210)+"...")+"")&&Fe(u,c),k[6][k[13]]!==void 0&&k[6][k[13]]!==null?$?$.p(k,A):($=it(k),$.c(),$.m(h,null)):$&&($.d(1),$=null),A[0]&128&&_e(Y,Y=k[7])?(re.d(1),re=at(k),re.c(),re.m(oe.parentNode,oe)):re.p(k,A)},d(k){k&&v(e),k&&v(t),k&&v(n),k&&v(o),J&&J.d(k),k&&v(a),k&&v(l),k&&v(f),k&&v(h),$&&$.d(),k&&v(ie),k&&v(oe),re.d(k),ne=!1,Ie(R)}}}function ut(i){let e,t,n;function r(o){i[30](o)}let s={key:i[1],pos:i[6].display};return i[3]!==void 0&&(s.showEditor=i[3]),e=new mn({props:s}),le.push(()=>ge(e,"showEditor",r)),{c(){ae(e.$$.fragment)},l(o){ue(e.$$.fragment,o)},m(o,a){ce(e,o,a),n=!0},p(o,a){const l={};a[0]&2&&(l.key=o[1]),a[0]&64&&(l.pos=o[6].display),!t&&a[0]&8&&(t=!0,l.showEditor=o[3],ve(()=>t=!1)),e.$set(l)},i(o){n||(q(e.$$.fragment,o),n=!0)},o(o){x(e.$$.fragment,o),n=!1},d(o){fe(e,o)}}}function ct(i){let e,t,n;function r(o){i[31](o)}let s={key:i[1],pos:i[6].display};return i[4]!==void 0&&(s.showNewOption=i[4]),e=new sn({props:s}),le.push(()=>ge(e,"showNewOption",r)),{c(){ae(e.$$.fragment)},l(o){ue(e.$$.fragment,o)},m(o,a){ce(e,o,a),n=!0},p(o,a){const l={};a[0]&2&&(l.key=o[1]),a[0]&64&&(l.pos=o[6].display),!t&&a[0]&16&&(t=!0,l.showNewOption=o[4],ve(()=>t=!1)),e.$set(l)},i(o){n||(q(e.$$.fragment,o),n=!0)},o(o){x(e.$$.fragment,o),n=!1},d(o){fe(e,o)}}}function ft(i){let e,t,n;function r(o){i[32](o)}let s={key:i[1],pos:i[6].display};return i[5]!==void 0&&(s.showNewArea=i[5]),e=new an({props:s}),le.push(()=>ge(e,"showNewArea",r)),{c(){ae(e.$$.fragment)},l(o){ue(e.$$.fragment,o)},m(o,a){ce(e,o,a),n=!0},p(o,a){const l={};a[0]&2&&(l.key=o[1]),a[0]&64&&(l.pos=o[6].display),!t&&a[0]&32&&(t=!0,l.showNewArea=o[5],ve(()=>t=!1)),e.$set(l)},i(o){n||(q(e.$$.fragment,o),n=!0)},o(o){x(e.$$.fragment,o),n=!1},d(o){fe(e,o)}}}function vn(i){let e,t,n,r,s,o,a;function l(h){i[29](h)}let d={scene:i[6],$$slots:{default:[gn]},$$scope:{ctx:i}};i[0]!==void 0&&(d.movingNode=i[0]),e=new Yt({props:d}),le.push(()=>ge(e,"movingNode",l));let c=i[3]&&ut(i),u=i[4]&&ct(i),f=i[5]&&ft(i);return{c(){ae(e.$$.fragment),n=U(),c&&c.c(),r=U(),u&&u.c(),s=U(),f&&f.c(),o=Se()},l(h){ue(e.$$.fragment,h),n=L(h),c&&c.l(h),r=L(h),u&&u.l(h),s=L(h),f&&f.l(h),o=Se()},m(h,w){ce(e,h,w),j(h,n,w),c&&c.m(h,w),j(h,r,w),u&&u.m(h,w),j(h,s,w),f&&f.m(h,w),j(h,o,w),a=!0},p(h,w){const E={};w[0]&64&&(E.scene=h[6]),w[0]&198|w[1]&4096&&(E.$$scope={dirty:w,ctx:h}),!t&&w[0]&1&&(t=!0,E.movingNode=h[0],ve(()=>t=!1)),e.$set(E),h[3]?c?(c.p(h,w),w[0]&8&&q(c,1)):(c=ut(h),c.c(),q(c,1),c.m(r.parentNode,r)):c&&(De(),x(c,1,1,()=>{c=null}),Oe()),h[4]?u?(u.p(h,w),w[0]&16&&q(u,1)):(u=ct(h),u.c(),q(u,1),u.m(s.parentNode,s)):u&&(De(),x(u,1,1,()=>{u=null}),Oe()),h[5]?f?(f.p(h,w),w[0]&32&&q(f,1)):(f=ft(h),f.c(),q(f,1),f.m(o.parentNode,o)):f&&(De(),x(f,1,1,()=>{f=null}),Oe())},i(h){a||(q(e.$$.fragment,h),q(c),q(u),q(f),a=!0)},o(h){x(e.$$.fragment,h),x(c),x(u),x(f),a=!1},d(h){fe(e,h),h&&v(n),c&&c.d(h),h&&v(r),u&&u.d(h),h&&v(s),f&&f.d(h),h&&v(o)}}}function _n(i,e,t){let n,r,s,o,a,l,d;ee(i,Xe,k=>t(7,n=k)),ee(i,te,k=>t(2,r=k)),ee(i,zt,k=>t(33,s=k)),ee(i,xe,k=>t(34,o=k)),ee(i,Ge,k=>t(35,a=k)),ee(i,Mt,k=>t(36,l=k)),ee(i,At,k=>t(37,d=k));let{movingNode:c=!1}=e,{key:u}=e,f=!1,h=!1,w=!1;function E(){t(3,f=!0)}function y(){t(4,h=!0)}function b(){t(5,w=!0)}let p=r[u];const g=d(p),N=o(p),C=l(p);p.display===void 0&&(p.display={x:0,y:0});function D(){G(this)}function G(k){const A=+k.getAttribute("i");k.style.width=k.value.length*6.1+"px",t(6,p[N][A].btn=k.value,p),te.set(r)}function T(){z(this)}function z(k){const A=+k.getAttribute("i");k.style.width=k.value.length*6.1+"px",t(6,p.areas[A].name=k.value,p),te.set(r)}function P(k){const A=k.target,O=+A.getAttribute("i"),X=A.getAttribute("type");if(a!==void 0&&a.key===u&&a.i===O&&a.type===X){be(Ge,a=void 0,a);const de=X==="ops"?N:"areas",he=s(p[de][O]);t(6,p[de][O][he]=void 0,p);return}be(Ge,a={key:u,i:O,type:X},a)}function F(){if(a===void 0)return;const k=r[a.key],A=a.type==="ops"?o(k):"areas",O=s(k[A][a.i]);k[A][a.i][O]=u,be(Ge,a=void 0,a)}function Z(){for(let k of Object.keys(r)){const A=o(r[k]);if(r[k][A]!==void 0){for(let O of r[k][A]){const X=s(O);O[X]===u&&(O[X]=void 0)}if(r[k].areas!==void 0)for(let O of r[k].areas){const X=s(O);O[X]===u&&(O[X]=void 0)}}}delete r[u],te.set(r)}function W(k){const O=+k.target.getAttribute("i");r[u][N].splice(O,1),te.set(r)}function Q(k){const O=+k.target.getAttribute("i");r[u].areas.splice(O,1),te.set(r)}function V(){delete r[u][C],delete r[u].areas,te.set(r),be(Xe,n=!n,n)}function se(k){pe.call(this,i,k)}function ie(k){pe.call(this,i,k)}function Y(k){pe.call(this,i,k)}function oe(k){pe.call(this,i,k)}function ne(k){pe.call(this,i,k)}function R(k){c=k,t(0,c)}function J(k){f=k,t(3,f)}function $(k){h=k,t(4,h)}function re(k){w=k,t(5,w)}return i.$$set=k=>{"movingNode"in k&&t(0,c=k.movingNode),"key"in k&&t(1,u=k.key)},i.$$.update=()=>{i.$$.dirty[0]&6&&t(6,p=r[u])},[c,u,r,f,h,w,p,n,E,y,b,g,N,C,D,G,T,z,P,F,Z,W,Q,V,se,ie,Y,oe,ne,R,J,$,re]}class yn extends we{constructor(e){super(),ke(this,e,_n,vn,_e,{movingNode:0,key:1},null,[-1,-1])}}function dt(i,e,t){const n=i.slice();return n[13]=e[t],n[15]=t,n}function ht(i,e,t){const n=i.slice();return n[13]=e[t],n[15]=t,n}function pt(i){let e,t=[],n=new Map,r,s=[],o=new Map,a=i[0][i[2]]||[];const l=u=>"op"+u[15];for(let u=0;u<a.length;u+=1){let f=ht(i,a,u),h=l(f);n.set(h,t[u]=mt(h,f))}let d=i[0].areas||[];const c=u=>"a"+u[15];for(let u=0;u<d.length;u+=1){let f=dt(i,d,u),h=c(f);o.set(h,s[u]=gt(h,f))}return{c(){e=Ue("g");for(let u=0;u<t.length;u+=1)t[u].c();r=Se();for(let u=0;u<s.length;u+=1)s[u].c()},l(u){e=Le(u,"g",{});var f=M(e);for(let h=0;h<t.length;h+=1)t[h].l(f);r=Se();for(let h=0;h<s.length;h+=1)s[h].l(f);f.forEach(v)},m(u,f){j(u,e,f);for(let h=0;h<t.length;h+=1)t[h].m(e,null);_(e,r);for(let h=0;h<s.length;h+=1)s[h].m(e,null)},p(u,f){f&29&&(a=u[0][u[2]]||[],t=je(t,f,l,1,u,a,n,e,He,mt,r,ht)),f&25&&(d=u[0].areas||[],s=je(s,f,c,1,u,d,o,e,He,gt,null,dt))},d(u){u&&v(e);for(let f=0;f<t.length;f+=1)t[f].d();for(let f=0;f<s.length;f+=1)s[f].d()}}}function mt(i,e){let t,n,r,s,o;return{key:i,first:null,c(){t=Ue("line"),this.h()},l(a){t=Le(a,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0});var l=M(t);l.forEach(v),this.h()},h(){m(t,"class","op-connection svelte-1lsc27u"),m(t,"x1",n=e[3]("x","ops",e[15])),m(t,"y1",r=e[3]("y","ops",e[15])),m(t,"x2",s=e[4]("x","ops",e[15])),m(t,"y2",o=e[4]("y","ops",e[15])),this.first=t},m(a,l){j(a,t,l)},p(a,l){e=a,l&1&&n!==(n=e[3]("x","ops",e[15]))&&m(t,"x1",n),l&1&&r!==(r=e[3]("y","ops",e[15]))&&m(t,"y1",r),l&1&&s!==(s=e[4]("x","ops",e[15]))&&m(t,"x2",s),l&1&&o!==(o=e[4]("y","ops",e[15]))&&m(t,"y2",o)},d(a){a&&v(t)}}}function gt(i,e){let t,n,r,s,o;return{key:i,first:null,c(){t=Ue("line"),this.h()},l(a){t=Le(a,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0});var l=M(t);l.forEach(v),this.h()},h(){m(t,"class","a-connection svelte-1lsc27u"),m(t,"x1",n=e[3]("x","areas",e[15])),m(t,"y1",r=e[3]("y","areas",e[15])),m(t,"x2",s=e[4]("x","areas",e[15])),m(t,"y2",o=e[4]("y","areas",e[15])),this.first=t},m(a,l){j(a,t,l)},p(a,l){e=a,l&1&&n!==(n=e[3]("x","areas",e[15]))&&m(t,"x1",n),l&1&&r!==(r=e[3]("y","areas",e[15]))&&m(t,"y1",r),l&1&&s!==(s=e[4]("x","areas",e[15]))&&m(t,"x2",s),l&1&&o!==(o=e[4]("y","areas",e[15]))&&m(t,"y2",o)},d(a){a&&v(t)}}}function bn(i){let e,t=i[1]&&pt(i);return{c(){t&&t.c(),e=Se()},l(n){t&&t.l(n),e=Se()},m(n,r){t&&t.m(n,r),j(n,e,r)},p(n,[r]){n[1]?t?t.p(n,r):(t=pt(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ee,o:Ee,d(n){t&&t.d(n),n&&v(e)}}}function wn(i,e,t){let n,r,s,o,a;ee(i,te,y=>t(8,n=y)),ee(i,Ge,y=>t(9,r=y)),ee(i,zt,y=>t(10,s=y)),ee(i,Xe,y=>t(11,o=y)),ee(i,xe,y=>t(12,a=y));let{key:l}=e,{pageMouse:d}=e,{movingNode:c}=e,u=n[l],f=a(u),h=!1;jt(()=>{t(1,h=!0)});function w(y,b,p){u.areas!==void 0&&u[f]!==void 0&&document.querySelectorAll(`.connection[key=${l}]`).length!==u[f].length+u.areas.length&&y==="x"&&b==="areas"&&be(Xe,o=!o,o);const g=document.querySelector(`[type=${b}][i="${p}"][key=${l}]`);if(!g)return n[l].display[y];const N=y==="x"?g.offsetLeft:g.offsetTop,C=y==="x"?g.offsetWidth/2:g.offsetHeight;return n[l].display[y]+N+C}function E(y,b,p){const g=b==="ops"?f:"areas",N=u[g][p],C=s(N),D=u[g][p][C];if(r!==void 0&&r.key===l&&r.i===p&&r.type===b)return d[y];if(D===void 0)return w(y,b,p);{const G=document.querySelector(`.input[key=${D}]`);return n[D].display[y]+(y==="x"?G.offsetLeft:G.offsetTop)+5}}return i.$$set=y=>{"key"in y&&t(5,l=y.key),"pageMouse"in y&&t(6,d=y.pageMouse),"movingNode"in y&&t(7,c=y.movingNode)},i.$$.update=()=>{i.$$.dirty&449&&(d||n||c)&&(t(0,u),t(6,d),t(8,n),t(7,c))},[u,h,f,w,E,l,d,c,n]}class kn extends we{constructor(e){super(),ke(this,e,wn,bn,_e,{key:5,pageMouse:6,movingNode:7})}}function En(i){let e,t,n,r,s,o,a,l,d,c,u,f,h,w,E;function y(p){i[8](p)}let b={};return i[0]!==void 0&&(b.toggle=i[0]),e=new qe({props:b}),le.push(()=>ge(e,"toggle",y)),{c(){ae(e.$$.fragment),n=U(),r=S("div"),s=S("label"),o=H("Escena:"),a=U(),l=S("input"),d=U(),c=S("div"),u=S("button"),f=H("Aceptar"),this.h()},l(p){ue(e.$$.fragment,p),n=L(p),r=I(p,"DIV",{});var g=M(r);s=I(g,"LABEL",{for:!0});var N=M(s);o=K(N,"Escena:"),N.forEach(v),a=L(g),l=I(g,"INPUT",{id:!0,type:!0}),g.forEach(v),d=L(p),c=I(p,"DIV",{class:!0});var C=M(c);u=I(C,"BUTTON",{class:!0});var D=M(u);f=K(D,"Aceptar"),D.forEach(v),C.forEach(v),this.h()},h(){m(s,"for","inp"),m(l,"id","inp"),m(l,"type","text"),m(u,"class","gui-button"),m(c,"class","bar svelte-1bhrmvp")},m(p,g){ce(e,p,g),j(p,n,g),j(p,r,g),_(r,s),_(s,o),_(r,a),_(r,l),ye(l,i[2]),j(p,d,g),j(p,c,g),_(c,u),_(u,f),h=!0,w||(E=[B(l,"input",i[9]),B(l,"mousedown",me(i[7])),B(u,"click",i[4])],w=!0)},p(p,g){const N={};!t&&g&1&&(t=!0,N.toggle=p[0],ve(()=>t=!1)),e.$set(N),g&4&&l.value!==p[2]&&ye(l,p[2])},i(p){h||(q(e.$$.fragment,p),h=!0)},o(p){x(e.$$.fragment,p),h=!1},d(p){fe(e,p),p&&v(n),p&&v(r),p&&v(d),p&&v(c),w=!1,Ie(E)}}}function Nn(i){let e,t,n,r,s;function o(l){i[10](l)}let a={pos:i[3],$$slots:{default:[En]},$$scope:{ctx:i}};return i[1]!==void 0&&(a.displace=i[1]),e=new Ke({props:a}),le.push(()=>ge(e,"displace",o)),{c(){ae(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,d){ce(e,l,d),n=!0,r||(s=B(window,"keydown",i[5]),r=!0)},p(l,[d]){const c={};d&8197&&(c.$$scope={dirty:d,ctx:l}),!t&&d&2&&(t=!0,c.displace=l[1],ve(()=>t=!1)),e.$set(c)},i(l){n||(q(e.$$.fragment,l),n=!0)},o(l){x(e.$$.fragment,l),n=!1},d(l){fe(e,l),r=!1,s()}}}function Sn(i){const e=["á","é","í","ó","ú","ü","ñ"],t=["a","e","i","o","u","u","n"],n=i.toLowerCase();let r="";for(let s=0;s<i.length;s++){const o=n.charAt(s),a=i.charAt(s);if(e.includes(o)){let l;for(let d=0;d<e.length;d++)if(e[d]===o){l=d;break}a===a.toUpperCase()?r+=t[l].toUpperCase():r+=t[l]}else r+=a}return r}function In(i,e,t){let n,r;ee(i,te,y=>t(12,r=y));let{showNewScene:s}=e,{offset:o}=e,a=r,l={x:o.x*-1+20,y:o.y*-1+20},d;function c(){if(n.length<=0){alert(`Debes dar un nombre a la escena /
You must give a name to the scene`);return}if(/^\d/.test(n)===!0){alert(`El nombre de la escena no puede empezar con un número /
The name of the scene cannot start with a number`);return}let y=n.replace(/\s/gi,"_").replace(/\W/,"").replace(/[;.,:{}()<>$%&!¡?¿"'/\\#@&*+-]/gi,"");if(y=Sn(y),r[y]!==void 0){alert(`Ya existe una escena con ese nombre /
There is already a scene with that name`);return}a[y]={text:"",display:{x:l.x,y:l.y}},be(te,r[y]=a[y],r),t(0,s=!1)}function u(y){y.key==="Enter"&&c(),y.key==="Escape"&&t(0,s=!1)}function f(y){pe.call(this,i,y)}function h(y){s=y,t(0,s)}function w(){n=this.value,t(2,n)}function E(y){d=y,t(1,d)}return i.$$set=y=>{"showNewScene"in y&&t(0,s=y.showNewScene),"offset"in y&&t(6,o=y.offset)},t(2,n=""),[s,d,n,l,c,u,o,f,h,w,E]}class Cn extends we{constructor(e){super(),ke(this,e,In,Nn,_e,{showNewScene:0,offset:6})}}function vt(i,e,t){const n=i.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function _t(i,e,t){const n=i.slice();return n[17]=e[t],n}function yt(i,e,t){const n=i.slice();return n[17]=e[t],n}function bt(i,e){let t,n,r,s,o,a;function l(c){e[12](c)}let d={key:e[17]};return e[3]!==void 0&&(d.movingNode=e[3]),n=new yn({props:d}),le.push(()=>ge(n,"movingNode",l)),{key:i,first:null,c(){t=S("div"),ae(n.$$.fragment),this.h()},l(c){t=I(c,"DIV",{class:!0});var u=M(t);ue(n.$$.fragment,u),u.forEach(v),this.h()},h(){m(t,"class","scene-node-container"),this.first=t},m(c,u){j(c,t,u),ce(n,t,null),s=!0,o||(a=B(t,"mouseenter",zn),o=!0)},p(c,u){e=c;const f={};u&32&&(f.key=e[17]),!r&&u&8&&(r=!0,f.movingNode=e[3],ve(()=>r=!1)),n.$set(f)},i(c){s||(q(n.$$.fragment,c),s=!0)},o(c){x(n.$$.fragment,c),s=!1},d(c){c&&v(t),fe(n),o=!1,a()}}}function wt(i,e){let t,n,r;return n=new kn({props:{key:e[17],pageMouse:e[1],movingNode:e[3]}}),{key:i,first:null,c(){t=Se(),ae(n.$$.fragment),this.h()},l(s){t=Se(),ue(n.$$.fragment,s),this.h()},h(){this.first=t},m(s,o){j(s,t,o),ce(n,s,o),r=!0},p(s,o){e=s;const a={};o&32&&(a.key=e[17]),o&2&&(a.pageMouse=e[1]),o&8&&(a.movingNode=e[3]),n.$set(a)},i(s){r||(q(n.$$.fragment,s),r=!0)},o(s){x(n.$$.fragment,s),r=!1},d(s){s&&v(t),fe(n,s)}}}function kt(i){let e,t,n;function r(o){i[13](o)}let s={offset:i[4]};return i[0]!==void 0&&(s.showNewScene=i[0]),e=new Cn({props:s}),le.push(()=>ge(e,"showNewScene",r)),{c(){ae(e.$$.fragment)},l(o){ue(e.$$.fragment,o)},m(o,a){ce(e,o,a),n=!0},p(o,a){const l={};a&16&&(l.offset=o[4]),!t&&a&1&&(t=!0,l.showNewScene=o[0],ve(()=>t=!1)),e.$set(l)},i(o){n||(q(e.$$.fragment,o),n=!0)},o(o){x(e.$$.fragment,o),n=!1},d(o){fe(e,o)}}}function Et(i,e){let t,n,r;return{key:i,first:null,c(){t=Ue("rect"),this.h()},l(s){t=Le(s,"rect",{class:!0,x:!0,y:!0,width:!0,height:!0,fill:!0}),M(t).forEach(v),this.h()},h(){m(t,"class","minimap-rect svelte-13bnhrb"),m(t,"x",n=e[18].display.x/20),m(t,"y",r=e[18].display.y/20),m(t,"width","8"),m(t,"height","8"),m(t,"fill","green"),this.first=t},m(s,o){j(s,t,o)},p(s,o){e=s,o&4&&n!==(n=e[18].display.x/20)&&m(t,"x",n),o&4&&r!==(r=e[18].display.y/20)&&m(t,"y",r)},d(s){s&&v(t)}}}function Tn(i){let e,t=[],n=new Map,r,s,o=[],a=new Map,l,d,c,u,f=[],h=new Map,w,E,y,b=i[5];const p=T=>T[17];for(let T=0;T<b.length;T+=1){let z=yt(i,b,T),P=p(z);n.set(P,t[T]=bt(P,z))}let g=i[5];const N=T=>T[17];for(let T=0;T<g.length;T+=1){let z=_t(i,g,T),P=N(z);a.set(P,o[T]=wt(P,z))}let C=i[0]&&kt(i),D=i[2];const G=T=>T[17];for(let T=0;T<D.length;T+=1){let z=vt(i,D,T),P=G(z);h.set(P,f[T]=Et(P,z))}return{c(){e=S("div");for(let T=0;T<t.length;T+=1)t[T].c();r=U(),s=Ue("svg");for(let T=0;T<o.length;T+=1)o[T].c();l=U(),C&&C.c(),d=U(),c=S("div"),u=Ue("svg");for(let T=0;T<f.length;T+=1)f[T].c();this.h()},l(T){e=I(T,"DIV",{class:!0});var z=M(e);for(let W=0;W<t.length;W+=1)t[W].l(z);r=L(z),s=Le(z,"svg",{class:!0});var P=M(s);for(let W=0;W<o.length;W+=1)o[W].l(P);P.forEach(v),l=L(z),C&&C.l(z),z.forEach(v),d=L(T),c=I(T,"DIV",{class:!0});var F=M(c);u=Le(F,"svg",{width:!0,height:!0});var Z=M(u);for(let W=0;W<f.length;W+=1)f[W].l(Z);Z.forEach(v),F.forEach(v),this.h()},h(){m(s,"class","connections-container svelte-13bnhrb"),m(e,"class","node-page svelte-13bnhrb"),m(u,"width","100px"),m(u,"height","250px"),m(c,"class","minimap-container svelte-13bnhrb")},m(T,z){j(T,e,z);for(let P=0;P<t.length;P+=1)t[P].m(e,null);_(e,r),_(e,s);for(let P=0;P<o.length;P+=1)o[P].m(s,null);_(e,l),C&&C.m(e,null),j(T,d,z),j(T,c,z),_(c,u);for(let P=0;P<f.length;P+=1)f[P].m(u,null);w=!0,E||(y=[B(e,"mousedown",i[7]),B(e,"mouseup",i[8]),B(e,"mousemove",i[9]),B(e,"mouseleave",i[8]),B(u,"click",i[6]),B(c,"mousedown",me(i[11]))],E=!0)},p(T,[z]){z&40&&(b=T[5],De(),t=je(t,z,p,1,T,b,n,e,et,bt,r,yt),Oe()),z&42&&(g=T[5],De(),o=je(o,z,N,1,T,g,a,s,et,wt,null,_t),Oe()),T[0]?C?(C.p(T,z),z&1&&q(C,1)):(C=kt(T),C.c(),q(C,1),C.m(e,null)):C&&(De(),x(C,1,1,()=>{C=null}),Oe()),z&4&&(D=T[2],f=je(f,z,G,1,T,D,h,u,He,Et,null,vt))},i(T){if(!w){for(let z=0;z<b.length;z+=1)q(t[z]);for(let z=0;z<g.length;z+=1)q(o[z]);q(C),w=!0}},o(T){for(let z=0;z<t.length;z+=1)x(t[z]);for(let z=0;z<o.length;z+=1)x(o[z]);x(C),w=!1},d(T){T&&v(e);for(let z=0;z<t.length;z+=1)t[z].d();for(let z=0;z<o.length;z+=1)o[z].d();C&&C.d(),T&&v(d),T&&v(c);for(let z=0;z<f.length;z+=1)f[z].d();E=!1,Ie(y)}}}function zn(i){[...document.getElementsByClassName("scene-node-container")].forEach(e=>e.style.zIndex="0"),i.target.firstChild.style.zIndex="1"}function Mn(i,e,t){let n,r,s;ee(i,te,N=>t(10,s=N));let{showNewScene:o}=e,a,l={},d,c,u=!1;const f={x:0,y:0};function h(N){const C=document.querySelector(".node-page"),D=getComputedStyle(C),G=+D.width.replace("px",""),T=+D.height.replace("px",""),z=document.querySelector(".page-container"),P=getComputedStyle(z),F=+P.borderWidth.replace("px","")*2,Z=+P.width.replace("px","")-F,W=+P.height.replace("px","")-F;t(4,f.x=-N.offsetX*20+Z/2,f),t(4,f.y=-N.offsetY*20+W/2,f),t(4,f.x=f.x>0?0:-f.x>G-Z?-G+Z:f.x,f),t(4,f.y=f.y>0?0:-f.y>T-W?-T+W:f.y,f),C.style.left=`${f.x}px`,C.style.top=`${f.y}px`}function w(){u=!0,this.style.cursor="grabbing"}function E(){u=!1,this.style.cursor="grab"}function y(N){if(u&&!a){d===void 0&&(d=+getComputedStyle(this).width.replace("px","")),c===void 0&&(c=+getComputedStyle(this).height.replace("px",""));const D=+getComputedStyle(this.offsetParent).borderWidth.replace("px","")*2,G=+getComputedStyle(this.offsetParent).width.replace("px","")-D,T=+getComputedStyle(this.offsetParent).height.replace("px","")-D;t(4,f.x+=N.movementX,f),t(4,f.y+=N.movementY,f),t(4,f.x=f.x>0?0:G-f.x>d?G-d:f.x,f),t(4,f.y=f.y>0?0:T-f.y>c?T-c:f.y,f),this.style.left=`${f.x}px`,this.style.top=`${f.y}px`}t(1,l={x:N.offsetX,y:N.offsetY});let C=N.target;for(;C!==this;)t(1,l.x+=C.offsetLeft,l),t(1,l.y+=C.offsetTop,l),C=C.offsetParent}function b(N){pe.call(this,i,N)}function p(N){a=N,t(3,a)}function g(N){o=N,t(0,o)}return i.$$set=N=>{"showNewScene"in N&&t(0,o=N.showNewScene)},i.$$.update=()=>{i.$$.dirty&1024&&t(5,n=Object.keys(s)),i.$$.dirty&1024&&t(2,r=Object.entries(s)),i.$$.dirty&6&&l&&(t(2,r),t(10,s),t(1,l))},[o,l,r,a,f,n,h,w,E,y,s,b,p,g]}let Dn=class extends we{constructor(e){super(),ke(this,e,Mn,Tn,_e,{showNewScene:0})}};function Nt(i){let e,t;return e=new Ke({props:{pos:i[2],$$slots:{default:[On]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,r){ce(e,n,r),t=!0},p(n,r){const s={};r&1026&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(n){t||(q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function On(i){let e,t,n,r,s,o,a;function l(c){i[7](c)}let d={};return i[1]!==void 0&&(d.toggle=i[1]),e=new qe({props:d}),le.push(()=>ge(e,"toggle",l)),{c(){ae(e.$$.fragment),n=U(),r=S("div"),this.h()},l(c){ue(e.$$.fragment,c),n=L(c),r=I(c,"DIV",{class:!0,id:!0}),M(r).forEach(v),this.h()},h(){m(r,"class","test-story-container svelte-1x7qk0r"),m(r,"id","test-story-container")},m(c,u){ce(e,c,u),j(c,n,u),j(c,r,u),s=!0,o||(a=Ae(i[3].call(null,r)),o=!0)},p(c,u){const f={};!t&&u&2&&(t=!0,f.toggle=c[1],ve(()=>t=!1)),e.$set(f)},i(c){s||(q(e.$$.fragment,c),s=!0)},o(c){x(e.$$.fragment,c),s=!1},d(c){fe(e,c),c&&v(n),c&&v(r),o=!1,a()}}}function jn(i){let e,t,n,r,s,o,a,l,d,c,u;function f(p){i[4](p)}function h(p){i[5](p)}let w={};i[0]!==void 0&&(w.showNewScene=i[0]),i[1]!==void 0&&(w.showTest=i[1]),t=new qt({props:w}),le.push(()=>ge(t,"showNewScene",f)),le.push(()=>ge(t,"showTest",h));function E(p){i[6](p)}let y={};i[0]!==void 0&&(y.showNewScene=i[0]),l=new Dn({props:y}),le.push(()=>ge(l,"showNewScene",E));let b=i[1]&&Nt(i);return{c(){e=S("div"),ae(t.$$.fragment),s=U(),o=S("div"),a=S("div"),ae(l.$$.fragment),c=U(),b&&b.c(),this.h()},l(p){e=I(p,"DIV",{class:!0});var g=M(e);ue(t.$$.fragment,g),s=L(g),o=I(g,"DIV",{class:!0});var N=M(o);a=I(N,"DIV",{class:!0});var C=M(a);ue(l.$$.fragment,C),C.forEach(v),N.forEach(v),c=L(g),b&&b.l(g),g.forEach(v),this.h()},h(){m(a,"class","page-container svelte-1x7qk0r"),m(o,"class","static-page-container svelte-1x7qk0r"),m(e,"class","main-window-container svelte-1x7qk0r")},m(p,g){j(p,e,g),ce(t,e,null),_(e,s),_(e,o),_(o,a),ce(l,a,null),_(e,c),b&&b.m(e,null),u=!0},p(p,[g]){const N={};!n&&g&1&&(n=!0,N.showNewScene=p[0],ve(()=>n=!1)),!r&&g&2&&(r=!0,N.showTest=p[1],ve(()=>r=!1)),t.$set(N);const C={};!d&&g&1&&(d=!0,C.showNewScene=p[0],ve(()=>d=!1)),l.$set(C),p[1]?b?(b.p(p,g),g&2&&q(b,1)):(b=Nt(p),b.c(),q(b,1),b.m(e,null)):b&&(De(),x(b,1,1,()=>{b=null}),Oe())},i(p){u||(q(t.$$.fragment,p),q(l.$$.fragment,p),q(b),u=!0)},o(p){x(t.$$.fragment,p),x(l.$$.fragment,p),x(b),u=!1},d(p){p&&v(e),fe(t),fe(l),b&&b.d()}}}function An(i,e,t){let n,r;ee(i,te,h=>t(8,n=h)),ee(i,Ot,h=>t(9,r=h));let s=!1,o=!1,a={x:40,y:40};function l(){console.log(n);const h=document.getElementById("storygeneraldiv");h&&h.remove();const w=new r("es",{adventureSlide:!1,typewriterSpeed:20}),E=Object.entries(n).sort((p,g)=>p[1].display.y-g[1].display.y);if(E.length===0){alert("No hay escenas / There are no scenes");return}w.setScenes(n).startAdventure(E[0][0]);const y=document.getElementById("test-story-container"),b=document.getElementById("storygeneraldiv");y.appendChild(b)}function d(h){s=h,t(0,s)}function c(h){o=h,t(1,o)}function u(h){s=h,t(0,s)}function f(h){o=h,t(1,o)}return[s,o,a,l,d,c,u,f]}class Un extends we{constructor(e){super(),ke(this,e,An,jn,_e,{})}}function Ln(i){let e,t,n,r,s,o,a,l,d,c,u,f,h,w;return c=new Un({}),{c(){e=S("section"),t=S("h1"),n=H("Aventura interactiva"),r=U(),s=S("p"),o=H("Un editor de historias interactivas para la librería "),a=S("a"),l=H("Aventura.js"),d=U(),ae(c.$$.fragment),u=U(),f=S("footer"),h=H("Sergio Rodríguez Gómez — 2023 — v1.0.0"),this.h()},l(E){e=I(E,"SECTION",{class:!0});var y=M(e);t=I(y,"H1",{class:!0});var b=M(t);n=K(b,"Aventura interactiva"),b.forEach(v),r=L(y),s=I(y,"P",{class:!0});var p=M(s);o=K(p,"Un editor de historias interactivas para la librería "),a=I(p,"A",{href:!0,target:!0,rel:!0,class:!0});var g=M(a);l=K(g,"Aventura.js"),g.forEach(v),p.forEach(v),d=L(y),ue(c.$$.fragment,y),u=L(y),f=I(y,"FOOTER",{class:!0});var N=M(f);h=K(N,"Sergio Rodríguez Gómez — 2023 — v1.0.0"),N.forEach(v),y.forEach(v),this.h()},h(){m(t,"class","svelte-1ekz32g"),m(a,"href","https://github.com/srsergiorodriguez/aventura/blob/master/README_es.md"),m(a,"target","_blank"),m(a,"rel","noreferrer"),m(a,"class","svelte-1ekz32g"),m(s,"class","svelte-1ekz32g"),m(f,"class","no-select svelte-1ekz32g"),m(e,"class","general no-select")},m(E,y){j(E,e,y),_(e,t),_(t,n),_(e,r),_(e,s),_(s,o),_(s,a),_(a,l),_(e,d),ce(c,e,null),_(e,u),_(e,f),_(f,h),w=!0},p:Ee,i(E){w||(q(c.$$.fragment,E),w=!0)},o(E){x(c.$$.fragment,E),w=!1},d(E){E&&v(e),fe(c)}}}class Vn extends we{constructor(e){super(),ke(this,e,null,Ln,_e,{})}}export{Vn as default};
