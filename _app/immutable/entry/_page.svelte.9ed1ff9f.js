import{S as Ee,i as Ne,s as we,e as C,a as U,t as W,b as T,d as z,j as L,f as K,g as y,A as g,l as D,k,K as P,n as Ie,L as Ce,v as $,M as he,D as le,c as At,N as Re,u as Ut,m as Lt,o as Pt,p as F,q as Q,O as _e,P as ge,F as ae,G as ue,H as ce,I as fe,Q as ye,R as ke,T as be,U as Je,r as Ge,V as nt,w as ve,C as Pe,x as Be,W as Me,X as Ve,z as Bt,Y as De,Z as Oe,_ as st}from"../chunks/index.4d86df2e.js";import{w as xe,r as Ae}from"../chunks/index.9d73ec15.js";const je=xe(!0),qe=xe(void 0),oe=xe({inicio:{texto:"Érase una vez un círculo...",display:{x:150,y:90},opciones:[{btn:"dejar tranquilo",escena:"final1"},{btn:"aplastar",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{x:50,y:300}},final2:{texto:"Parece que la historia formó una elipsis",sinSalida:!0,display:{x:230,y:300}}}),$e=Ae(i=>i.scene===void 0&&i.escena!==void 0?"escena":"scene"),Qe=Ae(i=>i.options===void 0&&i.opciones!==void 0?"opciones":"options"),Wt=Ae(i=>i.text===void 0&&i.texto!==void 0?"texto":"text"),Rt=Ae(i=>i.image===void 0&&i.imagen!==void 0?"imagen":"image");function Vt(i,e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([i],{type:e})),n.setAttribute("download",t),document.body.appendChild(n),n.click(),document.body.removeChild(n)}const Kt=Ae((i,e)=>{Vt(JSON.stringify(i,null,2),"application/json",`${e.includes(".json")?e:e+".json"}`)}),Ft=Ae(i=>{Vt(i,"text/plain;charset=utf-8","index.html")}),Ht=function(i,e,t){return`
<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
  </head>
  <body>
  </body>
  <script>
    const lang = "es";
    const options = {typewriterSpeed: 20, defaultCSS: false};
  <\/script>
  <style>
    
  #storygeneraldiv {
    box-sizing: border-box;
    margin: auto;
    max-width: 600px;
    font-family: 'Courier New', Courier, monospace;
    background: white;
  }
  
  .storydiv {
    border: solid black 1px;
    width: 100%;
    display: flex;
    padding: 10px;
    flex-direction: column;
    box-sizing: border-box;
  }
  
  .storyp {
    font-size: 18px;
    min-height: 25px;
  }
  
  .storybutton-container {
    margin: auto;
  }
  
  .storybutton {
    background: white;
    box-shadow: none;
    border: solid 1px;
    margin: 0px 1em 0px 0px;
    font-size: 20px;
    font-family: 'Courier New', Courier, monospace;
    cursor: pointer;
  }
  
  .storybutton:hover {
    color: white;
    background: black;
  }
  
  .storyimage-container {
    box-sizing: content-box;
    position: relative;
    width: 100%;
    margin: auto;
  }
  
  .storyimage {
    justify-content: center;
    width: 100%;
    margin: auto;
    border-radius: 20px;
    display: block;
  }
  
  .storyimage-area {
    font-size: 14px;
    position: absolute;
    cursor: pointer;
    text-align: center;
    color: black;
    background: #ffffff00;
    border: solid 1px black;
  }
  
  .storyimage-area:hover {
    background: #ffffff33;
  }
  
  @media screen and (max-device-width: 500px) {
    #storygeneraldiv {
      max-width:100%;
    }
    .storyp {
      font-size: 7vw;
    }
    .storybutton {
      font-size: 10vw;
    }
  }
  
  </style>
  <script>
    const A = ${i}
  <\/script>
  <script>
    const scenes = ${e};
    const aventura = new A(lang, options);
    aventura.setScenes(scenes).startAdventure('${t}');
  <\/script>
</html>
`},qt=Ae(Ht);class Jt{constructor(e="en",t){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,adventureSlide:!0,evalTags:!1,igramaFormat:"png",urlWord:"URL",vizWidth:1e3,vizHeight:1e3,vizBg:"#313131",vizCol:"black",vizImageSize:50,vizLoading:!0,minigifOptions:{},sceneCallback:n=>n},t&&(this.options=Object.assign(this.options,this.setOptionsTranslations(t))),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.fijarDatosEscenas=this.setDataScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setOptionsTranslations(e){const t={velocidadMaquina:"typewriterSpeed",CSSporDefecto:"defaultCSS",contenedorAventura:"adventureContainer",rolloAventura:"adventureScroll",deslizarAImagen:"adventureSlide",ejecutarEtiquetas:"evalTags",formatoIgrama:"igramaFormat",palabraUrl:"urlWord",anchoVis:"vizWidth",altoVis:"vizHeight",fondoVis:"vizBg",colorVis:"vizCol",tamanoImagenVis:"visImageSize",cargandoVis:"vizLoading",opcionesMinigif:"minigifOptions",funcionEscena:"sceneCallback"};for(let[n,r]of Object.entries(e))t[n]!==void 0&&(e[t[n]]=r,delete e[n]);return e}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[t,n]of Object.entries(e.grammar));return this}setScenes(e){this.options.defaultCSS&&this.setCSS(),this.scenes=e;for(let t of Object.keys(e)){this.scenes[t].key=t;const n=this.scenes[t].image||this.scenes[t].imagen;n!==void 0&&this.storyPreload[n]===void 0&&(this.storyPreload[n]=new Image,this.storyPreload[n].src=n,this.storyPreload[n].className="storyimage")}return this}async setDataScenes(e,t=void 0,n=[]){if(this.options.defaultCSS&&this.setCSS(),typeof d3>"u"){console.error(this.lang==="es"?"Para crear visualizaciones debes tener también la librería D3":"To create visualizations you must have also the D3 library");return}return this.scenes=JSON.parse(JSON.stringify(e)),this.metaKeys=n,t!==void 0&&(this.data=JSON.parse(JSON.stringify(t)),await this.setViz(this.scenes,this.data)),this.setScenes(this.scenes),this}async setViz(e,t){const n=Object.keys(e),r={compare:Xt,scatter:Yt,pack:Zt};let s=0;for(let c of n)e[c].viz!==void 0&&s++;let o=0,a;const l=this.lang==="en"?"Loading...":"Cargando...";this.options.vizLoading&&(a=document.createElement("div"),a.id="storygeneraldiv",a.className="storydiv",a.textContent=l,(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(a));function f(c,u=15){let d="";for(let h=0;h<Math.ceil(u);h++)d+=h<c*u?"|":"-";return d}for(let c of n){if(e[c].viz===void 0)continue;const{filter:u,type:d,x:h,y:E}=e[c].viz;if(r[d]===void 0||h===void 0||E===void 0){const v=this.lang==="es"?`Parámetros incorrectos de visualización en la escena "${c}"`:`Incorrect parameteres in the scene "${c}"`;console.error(v)}let _=t;for(let v of u)_=this.filterFn(v)(_);let S=o;const{viz:b,areas:p}=await r[d](this,_,h,E,v=>{o=S+v/s;const m=Math.ceil(o*100);this.options.vizLoading&&(a.textContent=`${l} ${f(o)} ${m}%`)});e[c].image=b,e[c].areas=p}for(let c of t){if(c.ID===void 0){const u=this.lang==="es"?"Todos los datos deben tener un valor único con la clave ID":"All data must have a unique value with the ID key";console.error(u),this.scenes={};break}e[`ind_${c.ID}`]={text:`${c.CONT||""}`,meta:c.ID,dataScene:!0,options:[{btn:"<<<",scene:`ind_${c.ID}`}]},c.IMGURL!==void 0&&(e[`ind_${c.ID}`].image=c.IMGURL),c.URL!==void 0&&(e[`ind_${c.ID}`].url=c.URL)}a.remove()}filterFn(e){const t=e[1];if(t==="="||t==="=="||t==="===")return r=>r.filter(s=>n(s[e[0]])==n(e[2]));return t==="<"?r=>r.filter(s=>n(s[e[0]])<n(e[2])):t===">"?r=>r.filter(s=>n(s[e[0]])>n(e[2])):r=>r;function n(r){return r==="true"?!0:r==="false"?!1:r}}setMarkov(e){return this.markov=e,this}expandGrammar(e){const t=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(t)}expandIgrama(e){const t=this.igrama.grammar,n=this.selectGrammarRule(t[e]);return this.grammarRuleRecursion(n,t).split("|").map(s=>this.decodeDrawing(s))}grammarRuleRecursion(e,t){let n=t||this.grammar,r=this.setNewRules(e);const s=r.match(/<[\w\d.,/#]+>/gi);if(!s)return r;for(let o of s){const a=this.defineTransformations(o);r=r.replace(o,()=>{o=o.replace(/[<>]/gi,""),o=o.replace(/#[\w\d.,/]+#/g,"");const l=o.search(/[.]/)>-1?this.getNestedObject(n,o.match(/[\w\d]+/g)):n[o];if(!l){const c=this.lang==="es"?`Se intentó expandir desde la regla "${o}", pero no se pudo encontrar`:`Tried to expand from rule "${o}", but couldn't find it`;console.error(c)}const f=this.selectGrammarRule(l);return this.transformString(f,a)})}return this.grammarRuleRecursion(r,n)}setNewRules(e,t){let n;t===void 0?n=this.grammar:n=t;let r=e;const s=r.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(s)for(;s.length;){const o=s.pop();r=r.replace(o,"");const{symbol:a,pairsString:l}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(o).groups,f=l.match(/[-]?[\w\d]+:[\w\d]+/gi).map(c=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(c).groups);if(f){n[a]=n[a]||{};for(let c of f){const u=n[c.value];if(!u){const E=this.lang==="es"?`Se intentó crear la nueva regla "${a}", pero no se pudo encontrar "${c.value}" para producir la subregla "${c.key}"`:`Tried to create new rule: "${a}", but couldn't find "${c.value}" to produce "${c.key}" subrule`;console.error(E)}const d=c.remove==="-",h=this.selectGrammarRule(u);if(d){const E=u.indexOf(h);n[c.value]=[...u.slice(0,E),...u.slice(E+1)]}n[a][c.key]=[h]}}}return r}startAdventure(e){const t=document.createElement("div");return t.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(t),this.prevScene=e,this.goToScene(this.scenes[e]),this}goToScene(e){const t=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(l=>l.remove()),[...document.getElementsByClassName("storyimage-area")].map(a=>a.remove());const r=document.createElement("div");if(r.className="storydiv",t.appendChild(r),e.image||e.imagen){const a=document.createElement("div");a.className="storyimage-container",r.appendChild(a);const l=e.image||e.imagen,f=this.options.adventureScroll?this.storyPreload[l].cloneNode():this.storyPreload[l];a.appendChild(f),e.areas&&(f.complete?this.setAreas(f,a,e.areas):f.onload=()=>{this.setAreas(f,a,e.areas)})}else if(e.igrama!==void 0){const a=document.createElement("div");a.className="storyimage-container",r.appendChild(a);const l=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(l),this.igramaDataUrl(l,this.options.igramaFormat).then(f=>{const c=new Image;c.src=f,c.className="storyimage",a.appendChild(c)})}if(e.title||e.titulo){const a=document.createElement("div");a.className="storytitle-container",r.appendChild(a);const l=document.createElement("h1");l.className="storytitle",l.textContent=e.title||e.titulo,a.appendChild(l)}if(e.meta!==void 0){const a=document.createElement("div");a.className="storymeta-container",r.appendChild(a);const l=this.data.find(f=>f.ID==e.meta);for(let f of this.metaKeys){if(l[f]===void 0)continue;const c=document.createElement("div");c.className="storymeta-subcontainer",a.appendChild(c);const u=document.createElement("span");u.className="storymeta-key",u.textContent=`${f}: `,c.appendChild(u);const d=document.createElement("span");d.className="storymeta-val",d.textContent=l[f],c.appendChild(d)}}const s=document.createElement("div");s.className="storyp-container",(e.text||e.texto||e.igramaText)&&r.appendChild(s);const o=document.createElement("p");if(o.className="storyp",o.textContent="",s.appendChild(o),e.url){const a=document.createElement("a");a.className="storyurl",a.href=e.url,a.target="_blank",a.textContent=this.options.urlWord,s.appendChild(a)}this.options.adventureSlide&&document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(o,e),this.data&&(e.viz!==void 0?this.prevScene=e.key:e.dataScene===!0&&(e.options[0].scene=this.prevScene)),this.options.sceneCallback(e)}setAreas(e,t,n){const r=e.getBoundingClientRect(),s=t.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,t,n)},[...document.getElementsByClassName("storyimage-area")].map(a=>a.remove());for(let a of n){let l=document.createElement("div");l.className="storyimage-area";const f=(a.x-Math.floor(a.w/2))*r.width/e.naturalWidth;l.style.left=`${r.left-s.left+f}px`;const c=(a.y-Math.floor(a.h/2))*r.height/e.naturalHeight;l.style.top=`${r.top-s.top+c}px`,l.style.width=`${a.w*r.width/e.naturalWidth}px`,l.style.height=`${a.h*r.height/e.naturalHeight}px`,l.textContent=a.btn||"",f>0&&f<r.width&&c>0&&c<r.height&&t.appendChild(l),l.style.fontSize=`${18*r.height/e.naturalHeight}px`,l.onclick=()=>{const u=a.scene||a.escena;this.goToScene(this.scenes[u])},a.tooltip!==void 0&&(l.onmouseover=()=>{l.textContent=a.tooltip||"",l.style.zIndex="100"},l.onmouseout=()=>{l.textContent=a.btn||"",l.style.zIndex="0"})}}async typewriter(e,t){const n=t.text||t.texto||t.igramaText||"";let r=this.grammar?this.grammarRuleRecursion(n):n;if(r=r.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let s=0;await new Promise(o=>{const a=setInterval(()=>{const l=r.substring(0,s);this.options.evalTags?e.innerHTML=l:e.textContent=l,s++,s>r.length&&(clearInterval(a),o(!0))},Math.floor(this.options.typewriterSpeed))}),this.optionButtons(t)}else this.options.evalTags?e.innerHTML=r:e.textContent=r,this.optionButtons(t)}optionButtons(e){const t=[...document.getElementsByClassName("storydiv")],n=t[t.length-1];[...document.getElementsByClassName("storybutton-container")].map(o=>o.remove());const s=document.createElement("div");if(s.className="storybutton-container",n.appendChild(s),e.options||e.opciones){const o=e.options||e.opciones;for(let a of o){const l=document.createElement("button");l.className="storybutton",l.textContent=a.btn,s.appendChild(l),l.addEventListener("click",()=>{if((a.text||a.texto)===void 0){const c=a.scene||a.escena;this.goToScene(this.scenes[c])}else this.goToScene(a)})}}else if(e.scene||e.escena){const o=e.scene||e.escena,a=document.createElement("button");a.className="storybutton",a.textContent=this.lang==="en"?"Continue":"Continuar",s.appendChild(a),a.addEventListener("click",()=>{this.goToScene(this.scenes[o])})}this.options.adventureSlide&&document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const r=Math.random()*e.prob.reduce((o,a)=>o+a);let s=0;for(let o=0;o<e.prob.length;o++){if(s<=r&&r<s+e.prob[o])return e[o];s+=e.prob[o]}}const t=Math.floor(Math.random()*e.length);return e[t]}getNestedObject(e,t){return t.reduce((n,r)=>n&&n[r]!==void 0?n[r]:void 0,e)}defineTransformations(e){let t={};const n=/#(?<trans>[\w\d,]+)#/gi.exec(e),r=n?n.groups.trans.match(/[\w]+/gi):[];for(let s of r)t[s]=!0;return t}transformString(e,t){let n=e;return t.CAPITALIZE&&(n=n.charAt(0).toUpperCase()+n.slice(1)),t.ALLCAPS&&(n=n.toUpperCase()),n}decodeDrawing(e){if(e==="")return[];const[t,n,r]=e.split("%%");let s={};return t==="vector"?s.content=n.split("**").map(o=>{const[a,l,f]=o.split("&"),c=[];if(c.color=a,c.weight=l,f===void 0)return c;const u=f.split(",");for(let d=0;d<u.length;d+=2)c.push([+u[d],+u[d+1]]);return c}):s.content=n,s.attribute=r,s.type=t,s}async getMarkovModel(e,t=1,n=!1){let r=await(await fetch(`./${e}`)).text();r=r.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const s=r.split(this.markovSeparator),o={};for(let l=0;l<s.length-t;l++){let f="";for(let u=0;u<t;u++)f+=u===0?s[l+u]:" "+s[l+u];o[f]===void 0&&(o[f]={});const c=s[l+t];o[f][c]===void 0?o[f][c]=1:o[f][c]++}const a={};for(let l of Object.keys(o)){const f=Object.keys(o[l]);a[l]={probs:[],grams:f};let c=0;for(let u=0;u<f.length;u++)c+=o[l][f[u]];for(let u=0;u<f.length;u++)a[l].probs[u]=o[l][f[u]]/c}if(n){const l=e.split("/");this.saveJSON(a,`${l[l.length-1]}_markovModel_${t}N.json`)}return a}markovChain(e,t,n=.1){let r=t===void 0||this.markov[t]===void 0?this.randomMarkovWord():t,s=r;for(let a=0;a<e-1;a++){let l=this.getNextMarkov(this.markov[s]);l===void 0&&(l=this.getNextMarkov(this.randomMarkovWord()));let f=s.split(this.markovSeparator);f.push(l),f=f.slice(1).join(" "),s=f,r+=` ${l}`}return this.formatMarkov(r,n)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const t=Math.random();let n=0;if(e!==void 0)for(let r=0;r<e.probs.length;r++){if(n<=t&&t<n+e.probs[r])return e.grams[r];n+=e.probs[r]}}formatMarkov(e,t=.1){let n=e.replace(/ ([,:.;])/g,"$1");return n=n.replaceAll(/([.]) ([\wáéíóú])/ig,(r,s,o,a,l)=>Math.random()<t?`.
${o.toUpperCase()}`:`. ${o.toUpperCase()}`),n.charAt(0).toUpperCase()+n.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),n.setAttribute("download",`${t.includes(".json")?t:t+".json"}`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}testScenes(e){const t=e||this.scenes;if(!t){const r=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(r)}let n=[];for(let r of Object.keys(t)){const s=t[r];if(s.options||s.opciones){const a=(s.options||s.opciones).filter(l=>!t[l.scene||l.escena]);n=[...n,...a.map(l=>`${r} => ${l.btn} => ${l.scene||l.escena}`)]}else{if(s.deadEnd||s.sinSalida)continue;t[s.scene||s.escena]||n.push(`${r} => ${s.scene||s.escena}`)}}if(n.length>0){const r=this.lang==="es"?`Las siguientes escenas no llevan a ningún lado: ${n.join(", ")}`:`The following scenes are dead ends: ${n.join(", ")}`;console.error(r),this.scenesError=!0}return this}testGrammar(e){const t=e||this.grammar;if(!t){const n=this.lang==="es"?"No hay gramática para probar":"There is not grammar to test";console.error(n)}for(let n of Object.keys(t)){const r=t[n];for(let s of r){const o=s.match(/<([\w\d]+)>/gi),a=o?o.map(u=>u.replace(/[<>]/g,"")):[],l=s.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),f=l?l.map(u=>u.match(/([ ]?:[\w\d]+)/g).map(d=>/[ ]?:(?<key>[\w\d]+)/.exec(d).groups.key)).reduce((u,d)=>[...u,...d],[]):[],c=[...a,...f].filter(u=>!t[u]);if(c.length>0){const u=this.lang==="es"?`Las siguientes reglas, que se referencian en "${n}", no existen: ${c.join(", ")}`:`The following rules, referenced in "${n}", do not exist: ${c.join(", ")}`;this.grammarError=!0,console.error(u)}}}return this}testDistribution(e){const t=e||this.markov;if(t===void 0){const f=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(f)}const n={},r={};let s=0;const o=Object.values(t);for(let f of o)for(let c of f.probs){const u=(Math.round(c/.05)*.05).toFixed(2);r[s]=u,s++,n[u]===void 0?n[u]=1:n[u]++}console.log("------------------------------------ DIST ------------------------------------");const a=Math.max(...Object.values(n)),l=Object.entries(n).sort((f,c)=>f[0]>c[0]?1:f[0]<c[0]?-1:0);for(let f of l)console.log(`${f[0]}... ${"|".repeat(Math.ceil(f[1]*100/a))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,t="png",n){const r=await this.igramaDataUrl(e,t),s=new Image;s.src=r,n==null?document.body.appendChild(s):document.getElementById(n).appendChild(s)}async igramaDataUrl(e,t="png"){const n=this.igrama.metadata.width,r=this.igrama.metadata.height;let s=document.createElement("canvas");s.width=n,s.height=r;const o=s.getContext("2d");o.lineJoin="round",o.lineCap="round",o.fillStyle=this.igrama.metadata.bg||"#FFFFFF",o.fillRect(0,0,n,r),await this.drawLayers(e,o);let a;if(t==="png")a=s.toDataURL();else if(t==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener también la librería MiniGif":"To create Gifs you must have also the MiniGif library"),"";const l={colorResolution:7,dither:!1,delay:50};Object.assign(l,this.minigifOptions);const f=new MiniGif(l);f.addFrame(s);const c=this.getLayerWiggle(e);o.fillStyle=this.igrama.metadata.bg||"#FFFFFF",o.fillRect(0,0,n,r),await this.drawLayers(c,o),f.addFrame(s);const u=f.makeGif();a="data:image/gif;base64,"+await this.base64_arraybuffer(u)}return s.remove(),a}async base64_arraybuffer(e){return(await new Promise(n=>{const r=new FileReader;r.onload=()=>n(r.result),r.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const n=JSON.parse(JSON.stringify(e)),r=(s,o)=>Math.floor(s+Math.random()*(o-s));for(let[s,o]of n.entries())if(o.type==="vector")for(let[a,l]of o.content.entries()){for(let[f,c]of l.entries())Math.random()<.5?c[0]+=r(-3,3):c[1]+=r(-3,3);l.color=e[s].content[a].color,l.weight=e[s].content[a].weight}return n}getIgramaText(e){return e.map(n=>n.attribute).reverse().join(" ").trim()}async drawLayers(e,t){for(let[n,r]of e.entries())if(r.type==="url"){const{w:s,h:o,x:a,y:l}=this.igrama.sections[n];if(this.imgsMemo[r.content]===void 0){const f=new Image;f.src=r.content,this.imgsMemo[r.content]=await new Promise(c=>{f.addEventListener("load",()=>{c(f)},!1)})}t.drawImage(this.imgsMemo[r.content],a,l,s,o)}else if(r.type=="vector")for(let s of r.content){if(s.length===0)continue;const o=this.getSpline(s);this.drawSpline(o,t,s.color,s.weight)}}drawSpline(e,t,n,r){t.lineWidth=r,t.strokeStyle=n,t.fillStyle="rgba(0,0,0,0)",t.beginPath();for(let s=0;s<e.length;s++)s===0?t.moveTo(...e[0]):t.lineTo(...e[s]);t.stroke()}getSpline(e){let t=[];for(let n=0;n<e.length-1;n++){const r=[];r[0]=n>0?e[n-1]:e[0],r[1]=e[n],r[2]=e[n+1],r[3]=n<e.length-2?e[n+2]:e[e.length-1];for(let s=0;s<1;s+=.05){const o=this.getSplinePoint(s,r);t.push(o)}}return t}getSplinePoint(e,t){const n=Math.floor(e)+1,r=n+1,s=r+1,o=n-1,a=e*e,l=a*e,f=-l+2*a-e,c=3*l-5*a+2,u=-3*l+4*a+e,d=l-a,h=.5*(t[o][0]*f+t[n][0]*c+t[r][0]*u+t[s][0]*d),E=.5*(t[o][1]*f+t[n][1]*c+t[r][1]*u+t[s][1]*d);return[h,E]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=Qt,document.getElementsByTagName("head")[0].appendChild(e)}}async function Xt(i,e,t,n,r=()=>{}){const s=[e.find(_=>_.ID==t),e.find(_=>_.ID==n)],o=i.options.vizWidth,a=i.options.vizHeight;let l=0;const f=[];for(let _ of s){const S=new Image;S.setAttribute("crossorigin","anonymous"),S.src=_.IMGURL,await new Promise(b=>{S.onload=()=>{b(!0)}}),f.push({url:_.IMGURL,img:S,ID:_.ID}),r(l/s.length),l++}const c=document.createElement("canvas"),u=c.getContext("2d");c.width=o,c.height=a,u.fillStyle=i.options.vizBg,u.fillRect(0,0,o,a);const d=[];let h=0;for(let _ of f){const S=parseInt(o/2)*.1,b=parseInt(o/2)-S,p=parseInt(b*_.img.height/_.img.width),v=h*(b+S)+b/2+S/2,m=a/2;u.save(),u.translate(-b/2,-p/2),u.drawImage(_.img,v,m,b,p),u.restore();const w={x:v,y:m,w:b,h:p,btn:"",scene:`ind_${_.ID}`,tooltip:""};d.push(w),h++}const E=c.toDataURL("image/png");return c.remove(),{viz:E,areas:d}}async function Yt(i,e,t,n,r=()=>{}){const s=i.options.vizWidth,o=i.options.vizHeight,a=i.options.vizImageSize,l={l:.2*s,r:.1*s,t:.1*o,b:.1*o},f=s-l.l-l.r,c=o-l.t-l.b,u=e,d=[...new Set(u.map(I=>I[t]))],h=[...new Set(u.map(I=>I[n]))],E=d3.scalePoint().domain(d).range([0,f]).padding(.5).round(!0),_=d3.scalePoint().domain(h).range([0,c]).padding(.5).round(!0);let S=0;const b=[];for(let I of u){if(i.imgsMemo[I.IMGURL]===void 0){const V=new Image;V.setAttribute("crossorigin","anonymous"),V.src=I.IMGURL,i.imgsMemo[I.IMGURL]=await new Promise(R=>{V.onload=()=>{R(V)}})}b.push({url:I.IMGURL,x:E(I[t]),y:_(I[n]),img:i.imgsMemo[I.IMGURL],r:a,ID:I.ID}),r(S/u.length),S++}d3.forceSimulation(b).force("charge",d3.forceManyBody().strength(5)).force("collide",d3.forceCollide(10)).tick(200);const p=document.createElement("canvas"),v=p.getContext("2d");p.width=s,p.height=o,v.fillStyle=i.options.vizBg,v.fillRect(0,0,s,o),v.strokeStyle=i.options.vizCol,v.font="14px serif",v.textBaseline="middle",v.textAlign="center";for(let I of d)v.fillStyle=i.options.vizCol,v.fillText(I,l.l+E(I),l.t+c+l.b/2);v.beginPath(),v.moveTo(l.l,l.t+c),v.lineTo(l.l+f,l.t+c),v.stroke(),v.textAlign="right";for(let I of h)v.fillStyle=i.options.vizCol,v.fillText(I,l.l-5,l.t+_(I));v.beginPath(),v.moveTo(l.l,l.t),v.lineTo(l.l,l.t+c),v.stroke(),v.strokeStyle=i.options.vizCol;const m=[];for(let I of b){const V=a,R=V*I.img.height/I.img.width,Y=I.x+l.l,x=I.y+l.t;v.save(),v.translate(-V/2,-R/2),v.drawImage(I.img,Y,x,V,R),v.restore();const j={x:Y,y:x,w:V,h:R,btn:"",scene:`ind_${I.ID}`,tooltip:""};m.push(j)}const w=p.toDataURL("image/png");return p.remove(),{viz:w,areas:m}}async function Zt(i,e,t,n,r=()=>{}){const s=i.options.vizWidth,o=i.options.vizHeight,a=e,l=d3.rollup(a,m=>m.length,m=>m[t],m=>m[n]),f=([m,w])=>w.size&&Array.from(w),c=d3.hierarchy(l,f).sum(([,m])=>m).sort((m,w)=>w.value-m.value),u=[...d3.schemeGreys[4]].reverse(),d=c.descendants(),h=m=>u[m];d3.pack(c).size([s,o]).padding(20)(c);const E=[];let _=0;for(let m of a){for(let w of c.leaves())if(m[t]===w.parent.data[0]&&m[n]===w.data[0]){if(i.imgsMemo[m.IMGURL]===void 0){const I=new Image;I.setAttribute("crossorigin","anonymous"),I.src=m.IMGURL,i.imgsMemo[m.IMGURL]=await new Promise(V=>{I.onload=()=>{V(I)}})}E.push({url:m.IMGURL,x:w.x,y:w.y,r:i.options.vizImageSize,img:i.imgsMemo[m.IMGURL],ID:m.ID})}r(_/a.length),_++}d3.forceSimulation(E).force("collide",d3.forceCollide(20)).tick(200);const S=document.createElement("canvas"),b=S.getContext("2d");S.width=s,S.height=o,b.fillStyle=i.options.vizBg,b.fillRect(0,0,s,o),b.font="12px serif",b.textBaseline="middle",b.textAlign="center";for(let m of d)b.save(),b.translate(m.x,m.y),b.strokeStyle=i.options.vizCol,b.fillStyle=h(m.depth),b.beginPath(),b.ellipse(0,0,m.r,m.r,0,0,Math.PI*2),b.fill(),b.stroke(),b.fillStyle=i.options.vizCol,b.fillText(m.depth===1||m.depth===2?m.data[0]:"",0,-m.r-5),b.restore();const p=[];for(let m of E){const w=parseInt(50),I=parseInt(w*m.img.height/m.img.width),V=m.x,R=m.y;b.save(),b.translate(-w/2,-I/2),b.drawImage(m.img,V,R,w,I),b.restore();const Y={x:V,y:R,w,h:I,btn:"",scene:`ind_${m.ID}`,tooltip:""};p.push(Y)}const v=S.toDataURL("image/png");return S.remove(),{viz:v,areas:p}}const Qt=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  box-sizing: border-box;
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 1em;
  flex-direction: column;
}

.storytitle {
  font-size: 2em;
  margin: 0.1em 0;
}

.storyp {
  font-size: 1em;
}

.storymeta-container {
  margin: 0.5em 0;
}

.storymeta-key {
  font-weight: 700;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  box-sizing: border-box;
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: #ffffff00;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: #ffffff33;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,Gt=Ae(Jt);function xt(i){let e,t,n,r,s,o,a,l,f,c,u,d,h,E,_,S,b,p,v,m,w,I,V,R;return{c(){e=C("div"),t=C("input"),n=U(),r=C("div"),s=C("button"),o=W("Nuevo proyecto"),a=U(),l=C("label"),f=W("Importar"),c=U(),u=C("button"),d=W("Exportar"),h=U(),E=C("button"),_=W("Previsualizar"),S=U(),b=C("button"),p=W("Generar interactivo final"),v=U(),m=C("div"),w=C("button"),I=W("Nueva escena"),this.h()},l(Y){e=T(Y,"DIV",{class:!0});var x=z(e);t=T(x,"INPUT",{type:!0,id:!0}),n=L(x),r=T(x,"DIV",{class:!0});var j=z(r);s=T(j,"BUTTON",{class:!0});var H=z(s);o=K(H,"Nuevo proyecto"),H.forEach(y),a=L(j),l=T(j,"LABEL",{class:!0,for:!0});var Z=z(l);f=K(Z,"Importar"),Z.forEach(y),c=L(j),u=T(j,"BUTTON",{class:!0});var q=z(u);d=K(q,"Exportar"),q.forEach(y),h=L(j),E=T(j,"BUTTON",{class:!0});var ne=z(E);_=K(ne,"Previsualizar"),ne.forEach(y),S=L(j),b=T(j,"BUTTON",{class:!0});var B=z(b);p=K(B,"Generar interactivo final"),B.forEach(y),j.forEach(y),v=L(x),m=T(x,"DIV",{class:!0});var ee=z(m);w=T(ee,"BUTTON",{class:!0});var se=z(w);I=K(se,"Nueva escena"),se.forEach(y),ee.forEach(y),x.forEach(y),this.h()},h(){g(t,"type","file"),g(t,"id","load-input"),t.hidden=!0,g(s,"class","toolbar-button svelte-1wzh48a"),g(l,"class","toolbar-button svelte-1wzh48a"),g(l,"for","load-input"),g(u,"class","toolbar-button svelte-1wzh48a"),g(E,"class","toolbar-button svelte-1wzh48a"),g(b,"class","toolbar-button svelte-1wzh48a"),g(r,"class","project-toolbar subtoolbar svelte-1wzh48a"),g(w,"class","toolbar-button svelte-1wzh48a"),g(m,"class","scene-toolbar subtoolbar svelte-1wzh48a"),g(e,"class","toolbar svelte-1wzh48a")},m(Y,x){D(Y,e,x),k(e,t),i[9](t),k(e,n),k(e,r),k(r,s),k(s,o),k(r,a),k(r,l),k(l,f),k(r,c),k(r,u),k(u,d),k(r,h),k(r,E),k(E,_),k(r,S),k(r,b),k(b,p),k(e,v),k(e,m),k(m,w),k(w,I),V||(R=[P(t,"change",i[3]),P(s,"click",i[2]),P(u,"click",i[4]),P(E,"click",i[5]),P(b,"click",i[6]),P(w,"click",i[1])],V=!0)},p:Ie,i:Ie,o:Ie,d(Y){Y&&y(e),i[9](null),V=!1,Ce(R)}}}function $t(i,e,t){let n,r,s,o,a;$(i,Ft,p=>t(10,n=p)),$(i,qt,p=>t(11,r=p)),$(i,oe,p=>t(12,s=p)),$(i,Gt,p=>t(13,o=p)),$(i,Kt,p=>t(14,a=p));let{showNewScene:l}=e,{showTest:f}=e,c;function u(){t(7,l=!0)}function d(){he(oe,s={},s)}function h(){d();const p=c.files[0];if(p.type==="application/json"){const v=new FileReader;v.addEventListener("load",function(){he(oe,s={},s);const m=v.result,w=JSON.parse(m);he(oe,s=w,s)}),this.value=null,v.readAsText(p);return}else alert("Formato de archivo incorrecto / incorrect file format")}function E(){a(s,"aventuraInteractiva")}function _(){t(8,f=!0)}function S(){const p=Object.entries(s).sort((I,V)=>I[1].display.y-V[1].display.y);if(p.length===0){alert("No hay escenas / There are no scenes");return}const v=o.toString(),m=JSON.stringify(s),w=r(v,m,p[0][0]);n(w)}function b(p){le[p?"unshift":"push"](()=>{c=p,t(0,c)})}return i.$$set=p=>{"showNewScene"in p&&t(7,l=p.showNewScene),"showTest"in p&&t(8,f=p.showTest)},[c,u,d,h,E,_,S,l,f,b]}class en extends Ee{constructor(e){super(),Ne(this,e,$t,xt,we,{showNewScene:7,showTest:8})}}function tn(i){let e,t,n,r;const s=i[5].default,o=At(s,i,i[4],null);return{c(){e=C("div"),o&&o.c(),this.h()},l(a){e=T(a,"DIV",{class:!0,key:!0});var l=z(e);o&&o.l(l),l.forEach(y),this.h()},h(){g(e,"class","scene-node-container svelte-sua7yb"),g(e,"key",i[0])},m(a,l){D(a,e,l),o&&o.m(e,null),t=!0,n||(r=Re(i[1].call(null,e)),n=!0)},p(a,[l]){o&&o.p&&(!t||l&16)&&Ut(o,s,a,a[4],t?Pt(s,a[4],l,null):Lt(a[4]),null),(!t||l&1)&&g(e,"key",a[0])},i(a){t||(F(o,a),t=!0)},o(a){Q(o,a),t=!1},d(a){a&&y(e),o&&o.d(a),n=!1,r()}}}function nn(i,e,t){let{$$slots:n={},$$scope:r}=e,{scene:s}=e,{movingNode:o=!1}=e,{key:a}=e;function l(f){let c=!1;f.style.left=`${s.display.x}px`,f.style.top=`${s.display.y}px`,f.addEventListener("mousedown",()=>{c=!0,t(3,o=!0)}),window.addEventListener("mousemove",u=>{c&&(t(2,s.display.x+=u.movementX,s),t(2,s.display.y+=u.movementY,s),f.style.left=`${s.display.x}px`,f.style.top=`${s.display.y}px`)}),window.addEventListener("mouseup",()=>{c=!1,t(3,o=!1)})}return i.$$set=f=>{"scene"in f&&t(2,s=f.scene),"movingNode"in f&&t(3,o=f.movingNode),"key"in f&&t(0,a=f.key),"$$scope"in f&&t(4,r=f.$$scope)},[a,l,s,o,r,n]}class sn extends Ee{constructor(e){super(),Ne(this,e,nn,tn,we,{scene:2,movingNode:3,key:0})}}function on(i){let e,t,n,r;const s=i[5].default,o=At(s,i,i[4],null);return{c(){e=C("div"),o&&o.c(),this.h()},l(a){e=T(a,"DIV",{class:!0});var l=z(e);o&&o.l(l),l.forEach(y),this.h()},h(){g(e,"class","draggui svelte-lq1cua")},m(a,l){D(a,e,l),o&&o.m(e,null),t=!0,n||(r=[Re(i[0].call(null,e)),Re(i[1].call(null,e)),P(e,"mousedown",_e(i[6]))],n=!0)},p(a,[l]){o&&o.p&&(!t||l&16)&&Ut(o,s,a,a[4],t?Pt(s,a[4],l,null):Lt(a[4]),null)},i(a){t||(F(o,a),t=!0)},o(a){Q(o,a),t=!1},d(a){a&&y(e),o&&o.d(a),n=!1,Ce(r)}}}function rn(i,e,t){let{$$slots:n={},$$scope:r}=e,{pos:s}=e,{displace:o={x:s.x,y:s.y}}=e;function a(c){c.style.left=`${o.x}px`,c.style.top=`${o.y}px`}function l(c){let u=!1;c.style.left=`${o.x}px`,c.style.top=`${o.y}px`,c.addEventListener("mousedown",()=>{u=!0}),window.addEventListener("mousemove",d=>{u&&(t(2,o.x+=d.movementX,o),t(2,o.y+=d.movementY,o),c.style.left=`${o.x}px`,c.style.top=`${o.y}px`,c.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{u=!1,c.style.cursor="grab"})}function f(c){ge.call(this,i,c)}return i.$$set=c=>{"pos"in c&&t(3,s=c.pos),"displace"in c&&t(2,o=c.displace),"$$scope"in c&&t(4,r=c.$$scope)},[a,l,o,s,r,n,f]}class Xe extends Ee{constructor(e){super(),Ne(this,e,rn,on,we,{pos:3,displace:2})}}function ln(i){let e,t,n,r,s;return{c(){e=C("div"),t=C("button"),n=W("X"),this.h()},l(o){e=T(o,"DIV",{class:!0});var a=z(e);t=T(a,"BUTTON",{class:!0});var l=z(t);n=K(l,"X"),l.forEach(y),a.forEach(y),this.h()},h(){g(t,"class","x-button"),g(e,"class","top-bar svelte-15bdkib")},m(o,a){D(o,e,a),k(e,t),k(t,n),r||(s=P(t,"click",i[0]),r=!0)},p:Ie,i:Ie,o:Ie,d(o){o&&y(e),r=!1,s()}}}function an(i,e,t){let{toggle:n}=e;function r(){t(1,n=!1)}return i.$$set=s=>{"toggle"in s&&t(1,n=s.toggle)},[r,n]}class Ye extends Ee{constructor(e){super(),Ne(this,e,an,ln,we,{toggle:1})}}function un(i){let e,t,n,r,s,o,a,l,f,c,u,d,h,E,_;function S(p){i[7](p)}let b={};return i[0]!==void 0&&(b.toggle=i[0]),e=new Ye({props:b}),le.push(()=>ye(e,"toggle",S)),{c(){ae(e.$$.fragment),n=U(),r=C("div"),s=C("label"),o=W("Btn:"),a=U(),l=C("input"),f=U(),c=C("div"),u=C("button"),d=W("Aceptar"),this.h()},l(p){ue(e.$$.fragment,p),n=L(p),r=T(p,"DIV",{});var v=z(r);s=T(v,"LABEL",{for:!0});var m=z(s);o=K(m,"Btn:"),m.forEach(y),a=L(v),l=T(v,"INPUT",{id:!0,type:!0}),v.forEach(y),f=L(p),c=T(p,"DIV",{class:!0});var w=z(c);u=T(w,"BUTTON",{class:!0});var I=z(u);d=K(I,"Aceptar"),I.forEach(y),w.forEach(y),this.h()},h(){g(s,"for","inp"),g(l,"id","inp"),g(l,"type","text"),l.autofocus=!0,g(u,"class","gui-button"),g(c,"class","bar svelte-1bhrmvp")},m(p,v){ce(e,p,v),D(p,n,v),D(p,r,v),k(r,s),k(s,o),k(r,a),k(r,l),ke(l,i[2]),D(p,f,v),D(p,c,v),k(c,u),k(u,d),h=!0,l.focus(),E||(_=[P(l,"input",i[8]),P(l,"mousedown",_e(i[6])),P(u,"click",i[3])],E=!0)},p(p,v){const m={};!t&&v&1&&(t=!0,m.toggle=p[0],be(()=>t=!1)),e.$set(m),v&4&&l.value!==p[2]&&ke(l,p[2])},i(p){h||(F(e.$$.fragment,p),h=!0)},o(p){Q(e.$$.fragment,p),h=!1},d(p){fe(e,p),p&&y(n),p&&y(r),p&&y(f),p&&y(c),E=!1,Ce(_)}}}function cn(i){let e,t,n,r;return e=new Xe({props:{pos:i[1],$$slots:{default:[un]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(s){ue(e.$$.fragment,s)},m(s,o){ce(e,s,o),t=!0,n||(r=P(window,"keydown",i[4]),n=!0)},p(s,[o]){const a={};o&2&&(a.pos=s[1]),o&4101&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i(s){t||(F(e.$$.fragment,s),t=!0)},o(s){Q(e.$$.fragment,s),t=!1},d(s){fe(e,s),n=!1,r()}}}function fn(i,e,t){let n,r,s;$(i,oe,_=>t(9,r=_)),$(i,Qe,_=>t(10,s=_));let{key:o}=e,{pos:a}=e,{showNewOption:l}=e;const f=s(r[o]);function c(){r[o][f]===void 0&&he(oe,r[o][f]=[],r),r[o][f].push({btn:n}),oe.set(r),t(0,l=!1)}function u(_){_.key==="Enter"&&c(),_.key==="Escape"&&t(0,l=!1)}function d(_){ge.call(this,i,_)}function h(_){l=_,t(0,l)}function E(){n=this.value,t(2,n)}return i.$$set=_=>{"key"in _&&t(5,o=_.key),"pos"in _&&t(1,a=_.pos),"showNewOption"in _&&t(0,l=_.showNewOption)},t(2,n=""),[l,a,n,c,u,o,d,h,E]}class dn extends Ee{constructor(e){super(),Ne(this,e,fn,cn,we,{key:5,pos:1,showNewOption:0})}}function ot(i){let e,t,n,r;return{c(){e=C("div"),t=W(i[8]),this.h()},l(s){e=T(s,"DIV",{class:!0});var o=z(e);t=K(o,i[8]),o.forEach(y),this.h()},h(){g(e,"class","area svelte-1picauk")},m(s,o){D(s,e,o),k(e,t),i[23](e),n||(r=P(e,"mousedown",_e(i[14])),n=!0)},p(s,o){o&256&&Ge(t,s[8])},d(s){s&&y(e),i[23](null),n=!1,r()}}}function hn(i){let e,t,n,r,s,o,a,l,f,c,u,d,h,E,_,S,b,p,v,m,w,I,V,R,Y,x,j,H,Z,q,ne,B,ee,se,J,ie,O,G,te;function re(M){i[18](M)}let N={};i[0]!==void 0&&(N.toggle=i[0]),e=new Ye({props:N}),le.push(()=>ye(e,"toggle",re));let A=i[5]&&ot(i);return{c(){ae(e.$$.fragment),n=U(),r=C("div"),s=C("h1"),o=W(i[1]),a=U(),l=C("div"),f=C("div"),c=C("h2"),u=W("Nombre de referencia"),d=U(),h=C("input"),E=U(),_=C("div"),S=C("h2"),b=W("Btn"),p=U(),v=C("input"),m=U(),w=C("div"),I=C("h2"),V=W("Tooltip"),R=U(),Y=C("input"),x=U(),j=C("div"),H=C("div"),Z=C("div"),q=C("img"),B=U(),A&&A.c(),ee=U(),se=C("div"),J=C("button"),ie=W("Aceptar"),this.h()},l(M){ue(e.$$.fragment,M),n=L(M),r=T(M,"DIV",{});var X=z(r);s=T(X,"H1",{class:!0});var de=z(s);o=K(de,i[1]),de.forEach(y),X.forEach(y),a=L(M),l=T(M,"DIV",{class:!0});var me=z(l);f=T(me,"DIV",{class:!0});var Te=z(f);c=T(Te,"H2",{class:!0});var Ue=z(c);u=K(Ue,"Nombre de referencia"),Ue.forEach(y),d=L(Te),h=T(Te,"INPUT",{}),Te.forEach(y),E=L(me),_=T(me,"DIV",{class:!0});var Le=z(_);S=T(Le,"H2",{class:!0});var We=z(S);b=K(We,"Btn"),We.forEach(y),p=L(Le),v=T(Le,"INPUT",{}),Le.forEach(y),m=L(me),w=T(me,"DIV",{class:!0});var ze=z(w);I=T(ze,"H2",{class:!0});var Ke=z(I);V=K(Ke,"Tooltip"),Ke.forEach(y),R=L(ze),Y=T(ze,"INPUT",{}),ze.forEach(y),me.forEach(y),x=L(M),j=T(M,"DIV",{class:!0});var Fe=z(j);H=T(Fe,"DIV",{class:!0});var He=z(H);Z=T(He,"DIV",{class:!0});var Ze=z(Z);q=T(Ze,"IMG",{src:!0,alt:!0,class:!0}),B=L(Ze),A&&A.l(Ze),Ze.forEach(y),He.forEach(y),Fe.forEach(y),ee=L(M),se=T(M,"DIV",{class:!0});var et=z(se);J=T(et,"BUTTON",{class:!0});var tt=z(J);ie=K(tt,"Aceptar"),tt.forEach(y),et.forEach(y),this.h()},h(){g(s,"class","svelte-1picauk"),g(c,"class","svelte-1picauk"),g(f,"class","input"),g(S,"class","svelte-1picauk"),g(_,"class","input"),g(I,"class","svelte-1picauk"),g(w,"class","input"),g(l,"class","inputs svelte-1picauk"),Je(q.src,ne=i[9][i[10]])||g(q,"src",ne),g(q,"alt","Preview"),g(q,"class","img-preview svelte-1picauk"),g(Z,"class","area-container"),g(H,"class","area-absolute-container svelte-1picauk"),g(j,"class","area-normal-container svelte-1picauk"),g(J,"class","gui-button"),g(se,"class","bar")},m(M,X){ce(e,M,X),D(M,n,X),D(M,r,X),k(r,s),k(s,o),D(M,a,X),D(M,l,X),k(l,f),k(f,c),k(c,u),k(f,d),k(f,h),ke(h,i[6]),k(l,E),k(l,_),k(_,S),k(S,b),k(_,p),k(_,v),ke(v,i[8]),k(l,m),k(l,w),k(w,I),k(I,V),k(w,R),k(w,Y),ke(Y,i[7]),D(M,x,X),D(M,j,X),k(j,H),k(H,Z),k(Z,q),i[22](q),k(Z,B),A&&A.m(Z,null),D(M,ee,X),D(M,se,X),k(se,J),k(J,ie),O=!0,G||(te=[P(h,"input",i[19]),P(h,"mousedown",_e(i[17])),P(v,"input",i[20]),P(v,"mousedown",_e(i[16])),P(Y,"input",i[21]),P(Y,"mousedown",_e(i[15])),Re(i[11].call(null,q)),P(H,"mousedown",_e(i[13])),P(J,"click",i[12])],G=!0)},p(M,X){const de={};!t&&X&1&&(t=!0,de.toggle=M[0],be(()=>t=!1)),e.$set(de),(!O||X&2)&&Ge(o,M[1]),X&64&&h.value!==M[6]&&ke(h,M[6]),X&256&&v.value!==M[8]&&ke(v,M[8]),X&128&&Y.value!==M[7]&&ke(Y,M[7]),M[5]?A?A.p(M,X):(A=ot(M),A.c(),A.m(Z,null)):A&&(A.d(1),A=null)},i(M){O||(F(e.$$.fragment,M),O=!0)},o(M){Q(e.$$.fragment,M),O=!1},d(M){fe(e,M),M&&y(n),M&&y(r),M&&y(a),M&&y(l),M&&y(x),M&&y(j),i[22](null),A&&A.d(),M&&y(ee),M&&y(se),G=!1,Ce(te)}}}function pn(i){let e,t;return e=new Xe({props:{pos:i[2],$$slots:{default:[hn]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,r){ce(e,n,r),t=!0},p(n,[r]){const s={};r&4&&(s.pos=n[2]),r&536871419&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function mn(i,e,t){let n,r,s,o,a,l;$(i,je,B=>t(25,o=B)),$(i,oe,B=>t(26,a=B)),$(i,Rt,B=>t(27,l=B));let{key:f}=e,{pos:c}=e,{showNewArea:u}=e,d,h=a[f];const E=l(h);let _={},S,b;function p(B){let ee=!1;B.addEventListener("mousedown",J=>{J.preventDefault(),ee=!0,t(5,b={x1:J.offsetX,y1:J.offsetY,x2:J.offsetX,y2:J.offsetY})}),B.addEventListener("mousemove",J=>{ee&&v(J)}),B.addEventListener("mouseup",J=>{se(J)}),B.addEventListener("mouseout",J=>{se(J)});function se(J){if(b===void 0||!ee)return;ee=!1;const ie=v(J),O={};for(let G of Object.keys(ie))O[G]=Math.floor(ie[G]*d.naturalWidth/d.width);Object.assign(_,{...O}),_.x=Math.floor(O.x+O.w/2),_.y=Math.floor(O.y+O.h/2)}}function v(B){t(5,b.x2=B.offsetX,b),t(5,b.y2=B.offsetY,b);const ee=Math.min(b.x1,b.x2),se=Math.max(b.x1,b.x2),J=Math.min(b.y1,b.y2),ie=Math.max(b.y1,b.y2),O={x:ee,y:J,w:se-ee,h:ie-J};return t(4,S.style.width=`${O.w}px`,S),t(4,S.style.height=`${O.h}px`,S),t(4,S.style.top=`${O.y}px`,S),t(4,S.style.left=`${O.x}px`,S),O}function m(){if(_===void 0){alert("debes escoger un area / you must choose an area");return}Object.assign(_,{btn:n,tooltip:r,name:s}),a[f].areas===void 0&&he(oe,a[f].areas=[],a),a[f].areas.push(_),oe.set(a),t(0,u=!1),he(je,o=!o,o)}function w(B){ge.call(this,i,B)}function I(B){ge.call(this,i,B)}function V(B){ge.call(this,i,B)}function R(B){ge.call(this,i,B)}function Y(B){ge.call(this,i,B)}function x(B){u=B,t(0,u)}function j(){s=this.value,t(6,s)}function H(){n=this.value,t(8,n)}function Z(){r=this.value,t(7,r)}function q(B){le[B?"unshift":"push"](()=>{d=B,t(3,d)})}function ne(B){le[B?"unshift":"push"](()=>{S=B,t(4,S)})}return i.$$set=B=>{"key"in B&&t(1,f=B.key),"pos"in B&&t(2,c=B.pos),"showNewArea"in B&&t(0,u=B.showNewArea)},t(8,n=""),t(7,r=""),t(6,s="area"),[u,f,c,d,S,b,s,r,n,h,E,p,m,w,I,V,R,Y,x,j,H,Z,q,ne]}class gn extends Ee{constructor(e){super(),Ne(this,e,mn,pn,we,{key:1,pos:2,showNewArea:0})}}function _n(i){let e,t,n,r,s,o,a,l,f,c,u;return{c(){e=C("input"),t=U(),n=C("label"),r=W("Cargar archivo"),s=U(),o=C("div"),a=C("img"),this.h()},l(d){e=T(d,"INPUT",{type:!0,id:!0}),t=L(d),n=T(d,"LABEL",{class:!0,for:!0});var h=z(n);r=K(h,"Cargar archivo"),h.forEach(y),s=L(d),o=T(d,"DIV",{class:!0,id:!0});var E=z(o);a=T(E,"IMG",{src:!0,alt:!0,class:!0}),E.forEach(y),this.h()},h(){g(e,"type","file"),g(e,"id","load-image"),e.hidden=!0,g(n,"class","gui-button svelte-1f4uqrr"),g(n,"for","load-image"),Je(a.src,l=i[0])||g(a,"src",l),g(a,"alt","Preview"),g(a,"class",f=nt(`img-preview ${i[0]?"":"hide"}`)+" svelte-1f4uqrr"),g(o,"class","image-preview-container svelte-1f4uqrr"),g(o,"id","image-preview-container")},m(d,h){D(d,e,h),i[4](e),D(d,t,h),D(d,n,h),k(n,r),D(d,s,h),D(d,o,h),k(o,a),i[5](a),c||(u=P(e,"change",i[3]),c=!0)},p(d,[h]){h&1&&!Je(a.src,l=d[0])&&g(a,"src",l),h&1&&f!==(f=nt(`img-preview ${d[0]?"":"hide"}`)+" svelte-1f4uqrr")&&g(a,"class",f)},i:Ie,o:Ie,d(d){d&&y(e),i[4](null),d&&y(t),d&&y(n),d&&y(s),d&&y(o),i[5](null),c=!1,u()}}}function vn(i,e,t){let{imageUrl:n}=e,r,s;function o(){const f=r.files[0];if(f){const c=new FileReader;c.addEventListener("load",function(){s.setAttribute("src",c.result),t(0,n=c.result)}),c.readAsDataURL(f)}}function a(f){le[f?"unshift":"push"](()=>{r=f,t(1,r)})}function l(f){le[f?"unshift":"push"](()=>{s=f,t(2,s)})}return i.$$set=f=>{"imageUrl"in f&&t(0,n=f.imageUrl)},[n,r,s,o,a,l]}class yn extends Ee{constructor(e){super(),Ne(this,e,vn,_n,we,{imageUrl:0})}}function bn(i){let e,t,n,r,s,o,a,l,f,c,u,d,h,E,_,S,b,p,v,m,w,I,V,R,Y,x,j,H,Z,q,ne,B;function ee(O){i[8](O)}let se={};i[0]!==void 0&&(se.toggle=i[0]),e=new Ye({props:se}),le.push(()=>ye(e,"toggle",ee));function J(O){i[11](O)}let ie={};return i[3]!==void 0&&(ie.imageUrl=i[3]),R=new yn({props:ie}),le.push(()=>ye(R,"imageUrl",J)),{c(){ae(e.$$.fragment),n=U(),r=C("div"),s=C("h1"),o=W(i[1]),a=U(),l=C("div"),f=C("h2"),c=W("Texto"),u=U(),d=C("textarea"),h=U(),E=C("div"),_=C("h2"),S=W("Imagen (opcional)"),b=U(),p=C("div"),v=C("label"),m=W("Url:"),w=U(),I=C("input"),V=W(`
      o
      `),ae(R.$$.fragment),x=U(),j=C("div"),H=C("button"),Z=W("Aceptar"),this.h()},l(O){ue(e.$$.fragment,O),n=L(O),r=T(O,"DIV",{});var G=z(r);s=T(G,"H1",{class:!0});var te=z(s);o=K(te,i[1]),te.forEach(y),G.forEach(y),a=L(O),l=T(O,"DIV",{});var re=z(l);f=T(re,"H2",{class:!0});var N=z(f);c=K(N,"Texto"),N.forEach(y),u=L(re),d=T(re,"TEXTAREA",{class:!0}),z(d).forEach(y),re.forEach(y),h=L(O),E=T(O,"DIV",{});var A=z(E);_=T(A,"H2",{class:!0});var M=z(_);S=K(M,"Imagen (opcional)"),M.forEach(y),b=L(A),p=T(A,"DIV",{});var X=z(p);v=T(X,"LABEL",{for:!0});var de=z(v);m=K(de,"Url:"),de.forEach(y),w=L(X),I=T(X,"INPUT",{id:!0,type:!0}),V=K(X,`
      o
      `),ue(R.$$.fragment,X),X.forEach(y),x=L(A),j=T(A,"DIV",{class:!0});var me=z(j);H=T(me,"BUTTON",{class:!0});var Te=z(H);Z=K(Te,"Aceptar"),Te.forEach(y),me.forEach(y),A.forEach(y),this.h()},h(){g(s,"class","svelte-8prumv"),g(f,"class","no-select svelte-8prumv"),g(d,"class","svelte-8prumv"),g(_,"class","no-select svelte-8prumv"),g(v,"for","inp"),g(I,"id","inp"),g(I,"type","text"),g(H,"class","gui-button"),g(j,"class","bar")},m(O,G){ce(e,O,G),D(O,n,G),D(O,r,G),k(r,s),k(s,o),D(O,a,G),D(O,l,G),k(l,f),k(f,c),k(l,u),k(l,d),ke(d,i[4]),D(O,h,G),D(O,E,G),k(E,_),k(_,S),k(E,b),k(E,p),k(p,v),k(v,m),k(p,w),k(p,I),ke(I,i[3]),k(p,V),ce(R,p,null),k(E,x),k(E,j),k(j,H),k(H,Z),q=!0,ne||(B=[P(d,"input",i[9]),P(d,"mousedown",_e(i[7])),P(I,"input",i[10]),P(I,"mousedown",_e(i[6])),P(H,"click",i[5])],ne=!0)},p(O,G){const te={};!t&&G&1&&(t=!0,te.toggle=O[0],be(()=>t=!1)),e.$set(te),(!q||G&2)&&Ge(o,O[1]),G&16&&ke(d,O[4]),G&8&&I.value!==O[3]&&ke(I,O[3]);const re={};!Y&&G&8&&(Y=!0,re.imageUrl=O[3],be(()=>Y=!1)),R.$set(re)},i(O){q||(F(e.$$.fragment,O),F(R.$$.fragment,O),q=!0)},o(O){Q(e.$$.fragment,O),Q(R.$$.fragment,O),q=!1},d(O){fe(e,O),O&&y(n),O&&y(r),O&&y(a),O&&y(l),O&&y(h),O&&y(E),fe(R),ne=!1,Ce(B)}}}function wn(i){let e,t;return e=new Xe({props:{pos:i[2],$$slots:{default:[bn]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,r){ce(e,n,r),t=!0},p(n,[r]){const s={};r&4&&(s.pos=n[2]),r&65563&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function kn(i,e,t){let n,r,s;$(i,je,v=>t(12,r=v)),$(i,oe,v=>t(13,s=v));let{key:o}=e,{pos:a}=e,{showEditor:l}=e,f=null,c=s[o];const u=c.text===void 0&&c.texto!==void 0?"texto":"text";function d(){he(oe,s[o][u]=n,s),f!==null&&he(oe,s[o].image=f,s),t(0,l=!1),he(je,r=!r,r)}function h(v){ge.call(this,i,v)}function E(v){ge.call(this,i,v)}function _(v){l=v,t(0,l)}function S(){n=this.value,t(4,n),t(14,c)}function b(){f=this.value,t(3,f)}function p(v){f=v,t(3,f)}return i.$$set=v=>{"key"in v&&t(1,o=v.key),"pos"in v&&t(2,a=v.pos),"showEditor"in v&&t(0,l=v.showEditor)},i.$$.update=()=>{i.$$.dirty&2&&he(oe,s[o]=c,s)},t(4,n=c[u]),[l,o,a,f,n,d,h,E,_,S,b,p]}class En extends Ee{constructor(e){super(),Ne(this,e,kn,wn,we,{key:1,pos:2,showEditor:0})}}function it(i,e,t){const n=i.slice();return n[38]=e[t],n[40]=t,n}function rt(i,e,t){const n=i.slice();return n[41]=e[t],n[40]=t,n}function lt(i){let e,t,n,r,s,o,a,l;return{c(){e=C("div"),t=C("img"),r=U(),s=C("button"),o=W("x"),this.h()},l(f){e=T(f,"DIV",{class:!0});var c=z(e);t=T(c,"IMG",{src:!0,alt:!0,class:!0}),r=L(c),s=T(c,"BUTTON",{class:!0});var u=z(s);o=K(u,"x"),u.forEach(y),c.forEach(y),this.h()},h(){Je(t.src,n=i[6][i[13]])||g(t,"src",n),g(t,"alt","Preview"),g(t,"class","img-preview svelte-cnz2jn"),g(s,"class","x-button image-x-button"),g(e,"class","img-preview-container svelte-cnz2jn")},m(f,c){D(f,e,c),k(e,t),k(e,r),k(e,s),k(s,o),a||(l=P(s,"click",i[23]),a=!0)},p(f,c){c[0]&64&&!Je(t.src,n=f[6][f[13]])&&g(t,"src",n)},d(f){f&&y(e),a=!1,l()}}}function at(i){let e,t,n,r,s,o,a,l,f;return{c(){e=C("div"),t=C("span"),n=W("área"),r=U(),s=C("div"),o=C("button"),a=W("+"),this.h()},l(c){e=T(c,"DIV",{});var u=z(e);t=T(u,"SPAN",{class:!0});var d=z(t);n=K(d,"área"),d.forEach(y),r=L(u),s=T(u,"DIV",{class:!0});var h=z(s);o=T(h,"BUTTON",{class:!0});var E=z(o);a=K(E,"+"),E.forEach(y),h.forEach(y),u.forEach(y),this.h()},h(){g(t,"class","btns-name svelte-cnz2jn"),g(o,"class","svelte-cnz2jn"),g(s,"class","node-btns-div svelte-cnz2jn")},m(c,u){D(c,e,u),k(e,t),k(t,n),k(e,r),k(e,s),k(s,o),k(o,a),l||(f=P(o,"click",i[10]),l=!0)},p:Ie,d(c){c&&y(e),l=!1,f()}}}function ut(i,e){let t,n,r,s,o,a,l,f,c,u,d,h,E,_;return{key:i,first:null,c(){t=C("div"),n=C("input"),o=U(),a=C("button"),l=W("x"),c=U(),u=C("div"),this.h()},l(S){t=T(S,"DIV",{class:!0});var b=z(t);n=T(b,"INPUT",{type:!0,class:!0,i:!0}),o=L(b),a=T(b,"BUTTON",{class:!0,i:!0});var p=z(a);l=K(p,"x"),p.forEach(y),c=L(b),u=T(b,"DIV",{type:!0,key:!0,content:!0,class:!0,i:!0}),z(u).forEach(y),b.forEach(y),this.h()},h(){g(n,"type","text"),g(n,"class","output-text svelte-cnz2jn"),n.value=r=e[41].btn,g(n,"i",s=e[40]),g(a,"class","x-button"),g(a,"i",f=e[40]),g(u,"type","ops"),g(u,"key",e[1]),g(u,"content",d=e[41].btn),g(u,"class","connection output option-connection svelte-cnz2jn"),g(u,"i",h=e[40]),g(t,"class","output-container svelte-cnz2jn"),this.first=t},m(S,b){D(S,t,b),k(t,n),k(t,o),k(t,a),k(a,l),k(t,c),k(t,u),E||(_=[Re(e[15].call(null,n)),P(n,"change",e[14]),P(n,"mousedown",_e(e[27])),P(a,"click",e[21]),P(u,"click",e[18]),P(u,"mousedown",_e(e[26]))],E=!0)},p(S,b){e=S,b[0]&6&&r!==(r=e[41].btn)&&n.value!==r&&(n.value=r),b[0]&6&&s!==(s=e[40])&&g(n,"i",s),b[0]&6&&f!==(f=e[40])&&g(a,"i",f),b[0]&2&&g(u,"key",e[1]),b[0]&6&&d!==(d=e[41].btn)&&g(u,"content",d),b[0]&6&&h!==(h=e[40])&&g(u,"i",h)},d(S){S&&y(t),E=!1,Ce(_)}}}function ct(i,e){let t,n,r,s,o,a,l,f,c,u,d,h,E,_,S;return{key:i,first:null,c(){t=C("div"),n=C("input"),o=U(),a=C("button"),l=W("x"),c=U(),u=C("div"),E=U(),this.h()},l(b){t=T(b,"DIV",{class:!0});var p=z(t);n=T(p,"INPUT",{type:!0,class:!0,i:!0}),o=L(p),a=T(p,"BUTTON",{class:!0,i:!0});var v=z(a);l=K(v,"x"),v.forEach(y),c=L(p),u=T(p,"DIV",{type:!0,key:!0,content:!0,class:!0,i:!0}),z(u).forEach(y),E=L(p),p.forEach(y),this.h()},h(){g(n,"type","text"),g(n,"class","output-text svelte-cnz2jn"),n.value=r=e[38].name,g(n,"i",s=e[40]),g(a,"class","x-button"),g(a,"i",f=e[40]),g(u,"type","areas"),g(u,"key",e[1]),g(u,"content",d=e[38].name),g(u,"class","connection output area-connection svelte-cnz2jn"),g(u,"i",h=e[40]),g(t,"class","output-container svelte-cnz2jn"),this.first=t},m(b,p){D(b,t,p),k(t,n),k(t,o),k(t,a),k(a,l),k(t,c),k(t,u),k(t,E),_||(S=[Re(e[17].call(null,n)),P(n,"change",e[16]),P(n,"mousedown",_e(e[25])),P(a,"click",e[22]),P(u,"click",e[18]),P(u,"mousedown",_e(e[24]))],_=!0)},p(b,p){e=b,p[0]&6&&r!==(r=e[38].name)&&n.value!==r&&(n.value=r),p[0]&6&&s!==(s=e[40])&&g(n,"i",s),p[0]&6&&f!==(f=e[40])&&g(a,"i",f),p[0]&2&&g(u,"key",e[1]),p[0]&6&&d!==(d=e[38].name)&&g(u,"content",d),p[0]&6&&h!==(h=e[40])&&g(u,"i",h)},d(b){b&&y(t),_=!1,Ce(S)}}}function ft(i){let e,t=[],n=new Map,r,s=[],o=new Map,a=i[2][i[1]][i[12]]||[];const l=u=>"op"+u[40];for(let u=0;u<a.length;u+=1){let d=rt(i,a,u),h=l(d);n.set(h,t[u]=ut(h,d))}let f=i[2][i[1]].areas||[];const c=u=>"a"+u[40];for(let u=0;u<f.length;u+=1){let d=it(i,f,u),h=c(d);o.set(h,s[u]=ct(h,d))}return{c(){e=C("div");for(let u=0;u<t.length;u+=1)t[u].c();r=U();for(let u=0;u<s.length;u+=1)s[u].c();this.h()},l(u){e=T(u,"DIV",{class:!0});var d=z(e);for(let h=0;h<t.length;h+=1)t[h].l(d);r=L(d);for(let h=0;h<s.length;h+=1)s[h].l(d);d.forEach(y),this.h()},h(){g(e,"class","node-outputs svelte-cnz2jn")},m(u,d){D(u,e,d);for(let h=0;h<t.length;h+=1)t[h].m(e,null);k(e,r);for(let h=0;h<s.length;h+=1)s[h].m(e,null)},p(u,d){d[0]&2379782&&(a=u[2][u[1]][u[12]]||[],t=Me(t,d,l,1,u,a,n,e,Ve,ut,r,rt)),d[0]&4521990&&(f=u[2][u[1]].areas||[],s=Me(s,d,c,1,u,f,o,e,Ve,ct,null,it))},d(u){u&&y(e);for(let d=0;d<t.length;d+=1)t[d].d();for(let d=0;d<s.length;d+=1)s[d].d()}}}function Nn(i){let e,t,n,r,s,o,a,l,f,c=(i[6][i[11]].length<210?i[6][i[11]]:i[6][i[11]].slice(0,210)+"...")+"",u,d,h,E,_,S,b,p,v,m,w,I,V,R,Y,x,j,H,Z,q,ne,B,ee,se=i[7],J,ie,O,G=i[6][i[13]]!==void 0&&i[6][i[13]]!==null&&lt(i),te=i[6][i[13]]!==void 0&&i[6][i[13]]!==null&&at(i),re=ft(i);return{c(){e=C("div"),t=U(),n=C("h1"),r=W("Escena: "),s=W(i[1]),o=U(),G&&G.c(),a=U(),l=C("div"),f=C("p"),u=W(c),d=U(),h=C("div"),E=C("div"),_=C("span"),S=W("escena"),b=U(),p=C("div"),v=C("button"),m=W("editar"),w=U(),I=C("button"),V=W("x"),R=U(),Y=C("div"),x=C("span"),j=W("btn"),H=U(),Z=C("div"),q=C("button"),ne=W("+"),B=U(),te&&te.c(),ee=U(),re.c(),J=ve(),this.h()},l(N){e=T(N,"DIV",{key:!0,class:!0}),z(e).forEach(y),t=L(N),n=T(N,"H1",{class:!0});var A=z(n);r=K(A,"Escena: "),s=K(A,i[1]),A.forEach(y),o=L(N),G&&G.l(N),a=L(N),l=T(N,"DIV",{class:!0});var M=z(l);f=T(M,"P",{class:!0});var X=z(f);u=K(X,c),X.forEach(y),M.forEach(y),d=L(N),h=T(N,"DIV",{class:!0});var de=z(h);E=T(de,"DIV",{});var me=z(E);_=T(me,"SPAN",{class:!0});var Te=z(_);S=K(Te,"escena"),Te.forEach(y),b=L(me),p=T(me,"DIV",{class:!0});var Ue=z(p);v=T(Ue,"BUTTON",{class:!0});var Le=z(v);m=K(Le,"editar"),Le.forEach(y),w=L(Ue),I=T(Ue,"BUTTON",{class:!0});var We=z(I);V=K(We,"x"),We.forEach(y),Ue.forEach(y),me.forEach(y),R=L(de),Y=T(de,"DIV",{});var ze=z(Y);x=T(ze,"SPAN",{class:!0});var Ke=z(x);j=K(Ke,"btn"),Ke.forEach(y),H=L(ze),Z=T(ze,"DIV",{class:!0});var Fe=z(Z);q=T(Fe,"BUTTON",{class:!0});var He=z(q);ne=K(He,"+"),He.forEach(y),Fe.forEach(y),ze.forEach(y),B=L(de),te&&te.l(de),de.forEach(y),ee=L(N),re.l(N),J=ve(),this.h()},h(){g(e,"key",i[1]),g(e,"class","connection input svelte-cnz2jn"),g(n,"class","svelte-cnz2jn"),g(f,"class","text-p svelte-cnz2jn"),g(l,"class","p-container svelte-cnz2jn"),g(_,"class","btns-name svelte-cnz2jn"),g(v,"class","svelte-cnz2jn"),g(I,"class","svelte-cnz2jn"),g(p,"class","node-btns-div svelte-cnz2jn"),g(x,"class","btns-name svelte-cnz2jn"),g(q,"class","svelte-cnz2jn"),g(Z,"class","node-btns-div svelte-cnz2jn"),g(h,"class","node-btns svelte-cnz2jn")},m(N,A){D(N,e,A),D(N,t,A),D(N,n,A),k(n,r),k(n,s),D(N,o,A),G&&G.m(N,A),D(N,a,A),D(N,l,A),k(l,f),k(f,u),D(N,d,A),D(N,h,A),k(h,E),k(E,_),k(_,S),k(E,b),k(E,p),k(p,v),k(v,m),k(p,w),k(p,I),k(I,V),k(h,R),k(h,Y),k(Y,x),k(x,j),k(Y,H),k(Y,Z),k(Z,q),k(q,ne),k(h,B),te&&te.m(h,null),D(N,ee,A),re.m(N,A),D(N,J,A),ie||(O=[P(e,"mousedown",_e(i[28])),P(e,"click",i[19]),P(v,"click",i[8]),P(I,"click",i[20]),P(q,"click",i[9])],ie=!0)},p(N,A){A[0]&2&&g(e,"key",N[1]),A[0]&2&&Ge(s,N[1]),N[6][N[13]]!==void 0&&N[6][N[13]]!==null?G?G.p(N,A):(G=lt(N),G.c(),G.m(a.parentNode,a)):G&&(G.d(1),G=null),A[0]&64&&c!==(c=(N[6][N[11]].length<210?N[6][N[11]]:N[6][N[11]].slice(0,210)+"...")+"")&&Ge(u,c),N[6][N[13]]!==void 0&&N[6][N[13]]!==null?te?te.p(N,A):(te=at(N),te.c(),te.m(h,null)):te&&(te.d(1),te=null),A[0]&128&&we(se,se=N[7])?(re.d(1),re=ft(N),re.c(),re.m(J.parentNode,J)):re.p(N,A)},d(N){N&&y(e),N&&y(t),N&&y(n),N&&y(o),G&&G.d(N),N&&y(a),N&&y(l),N&&y(d),N&&y(h),te&&te.d(),N&&y(ee),N&&y(J),re.d(N),ie=!1,Ce(O)}}}function dt(i){let e,t,n;function r(o){i[30](o)}let s={key:i[1],pos:i[6].display};return i[3]!==void 0&&(s.showEditor=i[3]),e=new En({props:s}),le.push(()=>ye(e,"showEditor",r)),{c(){ae(e.$$.fragment)},l(o){ue(e.$$.fragment,o)},m(o,a){ce(e,o,a),n=!0},p(o,a){const l={};a[0]&2&&(l.key=o[1]),a[0]&64&&(l.pos=o[6].display),!t&&a[0]&8&&(t=!0,l.showEditor=o[3],be(()=>t=!1)),e.$set(l)},i(o){n||(F(e.$$.fragment,o),n=!0)},o(o){Q(e.$$.fragment,o),n=!1},d(o){fe(e,o)}}}function ht(i){let e,t,n;function r(o){i[31](o)}let s={key:i[1],pos:i[6].display};return i[4]!==void 0&&(s.showNewOption=i[4]),e=new dn({props:s}),le.push(()=>ye(e,"showNewOption",r)),{c(){ae(e.$$.fragment)},l(o){ue(e.$$.fragment,o)},m(o,a){ce(e,o,a),n=!0},p(o,a){const l={};a[0]&2&&(l.key=o[1]),a[0]&64&&(l.pos=o[6].display),!t&&a[0]&16&&(t=!0,l.showNewOption=o[4],be(()=>t=!1)),e.$set(l)},i(o){n||(F(e.$$.fragment,o),n=!0)},o(o){Q(e.$$.fragment,o),n=!1},d(o){fe(e,o)}}}function pt(i){let e,t,n;function r(o){i[32](o)}let s={key:i[1],pos:i[6].display};return i[5]!==void 0&&(s.showNewArea=i[5]),e=new gn({props:s}),le.push(()=>ye(e,"showNewArea",r)),{c(){ae(e.$$.fragment)},l(o){ue(e.$$.fragment,o)},m(o,a){ce(e,o,a),n=!0},p(o,a){const l={};a[0]&2&&(l.key=o[1]),a[0]&64&&(l.pos=o[6].display),!t&&a[0]&32&&(t=!0,l.showNewArea=o[5],be(()=>t=!1)),e.$set(l)},i(o){n||(F(e.$$.fragment,o),n=!0)},o(o){Q(e.$$.fragment,o),n=!1},d(o){fe(e,o)}}}function Sn(i){let e,t,n,r,s,o,a;function l(h){i[29](h)}let f={scene:i[6],key:i[1],$$slots:{default:[Nn]},$$scope:{ctx:i}};i[0]!==void 0&&(f.movingNode=i[0]),e=new sn({props:f}),le.push(()=>ye(e,"movingNode",l));let c=i[3]&&dt(i),u=i[4]&&ht(i),d=i[5]&&pt(i);return{c(){ae(e.$$.fragment),n=U(),c&&c.c(),r=U(),u&&u.c(),s=U(),d&&d.c(),o=ve()},l(h){ue(e.$$.fragment,h),n=L(h),c&&c.l(h),r=L(h),u&&u.l(h),s=L(h),d&&d.l(h),o=ve()},m(h,E){ce(e,h,E),D(h,n,E),c&&c.m(h,E),D(h,r,E),u&&u.m(h,E),D(h,s,E),d&&d.m(h,E),D(h,o,E),a=!0},p(h,E){const _={};E[0]&64&&(_.scene=h[6]),E[0]&2&&(_.key=h[1]),E[0]&198|E[1]&4096&&(_.$$scope={dirty:E,ctx:h}),!t&&E[0]&1&&(t=!0,_.movingNode=h[0],be(()=>t=!1)),e.$set(_),h[3]?c?(c.p(h,E),E[0]&8&&F(c,1)):(c=dt(h),c.c(),F(c,1),c.m(r.parentNode,r)):c&&(Pe(),Q(c,1,1,()=>{c=null}),Be()),h[4]?u?(u.p(h,E),E[0]&16&&F(u,1)):(u=ht(h),u.c(),F(u,1),u.m(s.parentNode,s)):u&&(Pe(),Q(u,1,1,()=>{u=null}),Be()),h[5]?d?(d.p(h,E),E[0]&32&&F(d,1)):(d=pt(h),d.c(),F(d,1),d.m(o.parentNode,o)):d&&(Pe(),Q(d,1,1,()=>{d=null}),Be())},i(h){a||(F(e.$$.fragment,h),F(c),F(u),F(d),a=!0)},o(h){Q(e.$$.fragment,h),Q(c),Q(u),Q(d),a=!1},d(h){fe(e,h),h&&y(n),c&&c.d(h),h&&y(r),u&&u.d(h),h&&y(s),d&&d.d(h),h&&y(o)}}}function In(i,e,t){let n,r,s,o,a,l,f;$(i,je,N=>t(7,n=N)),$(i,oe,N=>t(2,r=N)),$(i,$e,N=>t(33,s=N)),$(i,Qe,N=>t(34,o=N)),$(i,qe,N=>t(35,a=N)),$(i,Rt,N=>t(36,l=N)),$(i,Wt,N=>t(37,f=N));let{movingNode:c=!1}=e,{key:u}=e,d=!1,h=!1,E=!1;function _(){t(3,d=!0)}function S(){t(4,h=!0)}function b(){t(5,E=!0)}let p=r[u];const v=f(p),m=o(p),w=l(p);p.display===void 0&&(p.display={x:0,y:0});function I(){V(this)}function V(N){const A=+N.getAttribute("i");N.style.width=N.value.length*6.1+"px",t(6,p[m][A].btn=N.value,p),oe.set(r)}function R(){Y(this)}function Y(N){const A=+N.getAttribute("i");N.style.width=N.value.length*6.1+"px",t(6,p.areas[A].name=N.value,p),oe.set(r)}function x(N){const A=N.target,M=+A.getAttribute("i"),X=A.getAttribute("type");if(a!==void 0&&a.key===u&&a.i===M&&a.type===X){he(qe,a=void 0,a);const de=X==="ops"?m:"areas",me=s(p[de][M]);t(6,p[de][M][me]=void 0,p);return}he(qe,a={key:u,i:M,type:X},a)}function j(){if(a===void 0)return;const N=r[a.key],A=a.type==="ops"?o(N):"areas",M=s(N[A][a.i]);N[A][a.i][M]=u,he(qe,a=void 0,a)}function H(){for(let N of Object.keys(r)){const A=o(r[N]);if(r[N][A]!==void 0){for(let M of r[N][A]){const X=s(M);M[X]===u&&(M[X]=void 0)}if(r[N].areas!==void 0)for(let M of r[N].areas){const X=s(M);M[X]===u&&(M[X]=void 0)}}}delete r[u],oe.set(r)}function Z(N){const M=+N.target.getAttribute("i");r[u][m].splice(M,1),oe.set(r),he(je,n=!n,n)}function q(N){const M=+N.target.getAttribute("i");r[u].areas.splice(M,1),oe.set(r),he(je,n=!n,n)}function ne(){delete r[u][w],delete r[u].areas,oe.set(r),he(je,n=!n,n)}function B(N){ge.call(this,i,N)}function ee(N){ge.call(this,i,N)}function se(N){ge.call(this,i,N)}function J(N){ge.call(this,i,N)}function ie(N){ge.call(this,i,N)}function O(N){c=N,t(0,c)}function G(N){d=N,t(3,d)}function te(N){h=N,t(4,h)}function re(N){E=N,t(5,E)}return i.$$set=N=>{"movingNode"in N&&t(0,c=N.movingNode),"key"in N&&t(1,u=N.key)},i.$$.update=()=>{i.$$.dirty[0]&6&&t(6,p=r[u])},[c,u,r,d,h,E,p,n,_,S,b,v,m,w,I,V,R,Y,x,j,H,Z,q,ne,B,ee,se,J,ie,O,G,te,re]}class Cn extends Ee{constructor(e){super(),Ne(this,e,In,Sn,we,{movingNode:0,key:1},null,[-1,-1])}}function mt(i,e,t){const n=i.slice();return n[12]=e[t],n[14]=t,n}function gt(i,e,t){const n=i.slice();return n[12]=e[t],n[14]=t,n}function _t(i){let e,t=[],n=new Map,r,s=[],o=new Map,a=i[0][i[2]]||[];const l=u=>"op"+u[14];for(let u=0;u<a.length;u+=1){let d=gt(i,a,u),h=l(d);n.set(h,t[u]=vt(h,d))}let f=i[0].areas||[];const c=u=>"a"+u[14];for(let u=0;u<f.length;u+=1){let d=mt(i,f,u),h=c(d);o.set(h,s[u]=yt(h,d))}return{c(){e=De("g");for(let u=0;u<t.length;u+=1)t[u].c();r=ve();for(let u=0;u<s.length;u+=1)s[u].c()},l(u){e=Oe(u,"g",{});var d=z(e);for(let h=0;h<t.length;h+=1)t[h].l(d);r=ve();for(let h=0;h<s.length;h+=1)s[h].l(d);d.forEach(y)},m(u,d){D(u,e,d);for(let h=0;h<t.length;h+=1)t[h].m(e,null);k(e,r);for(let h=0;h<s.length;h+=1)s[h].m(e,null)},p(u,d){d&29&&(a=u[0][u[2]]||[],t=Me(t,d,l,1,u,a,n,e,Ve,vt,r,gt)),d&25&&(f=u[0].areas||[],s=Me(s,d,c,1,u,f,o,e,Ve,yt,null,mt))},d(u){u&&y(e);for(let d=0;d<t.length;d+=1)t[d].d();for(let d=0;d<s.length;d+=1)s[d].d()}}}function vt(i,e){let t,n,r,s,o;return{key:i,first:null,c(){t=De("line"),this.h()},l(a){t=Oe(a,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0});var l=z(t);l.forEach(y),this.h()},h(){g(t,"class","op-connection svelte-1lsc27u"),g(t,"x1",n=e[3]("x","ops",e[14])),g(t,"y1",r=e[3]("y","ops",e[14])),g(t,"x2",s=e[4]("x","ops",e[14])),g(t,"y2",o=e[4]("y","ops",e[14])),this.first=t},m(a,l){D(a,t,l)},p(a,l){e=a,l&1&&n!==(n=e[3]("x","ops",e[14]))&&g(t,"x1",n),l&1&&r!==(r=e[3]("y","ops",e[14]))&&g(t,"y1",r),l&1&&s!==(s=e[4]("x","ops",e[14]))&&g(t,"x2",s),l&1&&o!==(o=e[4]("y","ops",e[14]))&&g(t,"y2",o)},d(a){a&&y(t)}}}function yt(i,e){let t,n,r,s,o;return{key:i,first:null,c(){t=De("line"),this.h()},l(a){t=Oe(a,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0});var l=z(t);l.forEach(y),this.h()},h(){g(t,"class","a-connection svelte-1lsc27u"),g(t,"x1",n=e[3]("x","areas",e[14])),g(t,"y1",r=e[3]("y","areas",e[14])),g(t,"x2",s=e[4]("x","areas",e[14])),g(t,"y2",o=e[4]("y","areas",e[14])),this.first=t},m(a,l){D(a,t,l)},p(a,l){e=a,l&1&&n!==(n=e[3]("x","areas",e[14]))&&g(t,"x1",n),l&1&&r!==(r=e[3]("y","areas",e[14]))&&g(t,"y1",r),l&1&&s!==(s=e[4]("x","areas",e[14]))&&g(t,"x2",s),l&1&&o!==(o=e[4]("y","areas",e[14]))&&g(t,"y2",o)},d(a){a&&y(t)}}}function Tn(i){let e,t=i[1]&&_t(i);return{c(){t&&t.c(),e=ve()},l(n){t&&t.l(n),e=ve()},m(n,r){t&&t.m(n,r),D(n,e,r)},p(n,[r]){n[1]?t?t.p(n,r):(t=_t(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ie,o:Ie,d(n){t&&t.d(n),n&&y(e)}}}function zn(i,e,t){let n,r,s,o;$(i,oe,_=>t(8,n=_)),$(i,qe,_=>t(9,r=_)),$(i,$e,_=>t(10,s=_)),$(i,Qe,_=>t(11,o=_));let{key:a}=e,{pageMouse:l}=e,{movingNode:f}=e,c=n[a],u=o(c),d=!1;Bt(()=>{t(1,d=!0)});function h(_,S,b){const p=document.querySelector(`[type=${S}][i="${b}"][key=${a}]`);if(!p)return n[a].display[_];const v=_==="x"?p.offsetLeft:p.offsetTop,m=_==="x"?p.offsetWidth/2:p.offsetHeight;return n[a].display[_]+v+m}function E(_,S,b){const p=S==="ops"?u:"areas",v=c[p][b],m=s(v),w=c[p][b][m];if(r!==void 0&&r.key===a&&r.i===b&&r.type===S)return l[_];if(w===void 0)return h(_,S,b);{const I=document.querySelector(`.input[key=${w}]`);return n[w].display[_]+(_==="x"?I.offsetLeft:I.offsetTop)+5}}return i.$$set=_=>{"key"in _&&t(5,a=_.key),"pageMouse"in _&&t(6,l=_.pageMouse),"movingNode"in _&&t(7,f=_.movingNode)},i.$$.update=()=>{i.$$.dirty&449&&(l||n||f)&&(t(0,c),t(6,l),t(8,n),t(7,f))},[c,d,u,h,E,a,l,f,n]}class Mn extends Ee{constructor(e){super(),Ne(this,e,zn,Tn,we,{key:5,pageMouse:6,movingNode:7})}}function Dn(i){let e,t,n,r,s,o,a,l,f,c,u,d,h,E,_;function S(p){i[8](p)}let b={};return i[0]!==void 0&&(b.toggle=i[0]),e=new Ye({props:b}),le.push(()=>ye(e,"toggle",S)),{c(){ae(e.$$.fragment),n=U(),r=C("div"),s=C("label"),o=W("Escena:"),a=U(),l=C("input"),f=U(),c=C("div"),u=C("button"),d=W("Aceptar"),this.h()},l(p){ue(e.$$.fragment,p),n=L(p),r=T(p,"DIV",{});var v=z(r);s=T(v,"LABEL",{for:!0});var m=z(s);o=K(m,"Escena:"),m.forEach(y),a=L(v),l=T(v,"INPUT",{id:!0,type:!0}),v.forEach(y),f=L(p),c=T(p,"DIV",{class:!0});var w=z(c);u=T(w,"BUTTON",{class:!0});var I=z(u);d=K(I,"Aceptar"),I.forEach(y),w.forEach(y),this.h()},h(){g(s,"for","inp"),g(l,"id","inp"),g(l,"type","text"),g(u,"class","gui-button"),g(c,"class","bar svelte-1bhrmvp")},m(p,v){ce(e,p,v),D(p,n,v),D(p,r,v),k(r,s),k(s,o),k(r,a),k(r,l),ke(l,i[2]),D(p,f,v),D(p,c,v),k(c,u),k(u,d),h=!0,E||(_=[P(l,"input",i[9]),P(l,"mousedown",_e(i[7])),P(u,"click",i[4])],E=!0)},p(p,v){const m={};!t&&v&1&&(t=!0,m.toggle=p[0],be(()=>t=!1)),e.$set(m),v&4&&l.value!==p[2]&&ke(l,p[2])},i(p){h||(F(e.$$.fragment,p),h=!0)},o(p){Q(e.$$.fragment,p),h=!1},d(p){fe(e,p),p&&y(n),p&&y(r),p&&y(f),p&&y(c),E=!1,Ce(_)}}}function On(i){let e,t,n,r,s;function o(l){i[10](l)}let a={pos:i[3],$$slots:{default:[Dn]},$$scope:{ctx:i}};return i[1]!==void 0&&(a.displace=i[1]),e=new Xe({props:a}),le.push(()=>ye(e,"displace",o)),{c(){ae(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,f){ce(e,l,f),n=!0,r||(s=P(window,"keydown",i[5]),r=!0)},p(l,[f]){const c={};f&8197&&(c.$$scope={dirty:f,ctx:l}),!t&&f&2&&(t=!0,c.displace=l[1],be(()=>t=!1)),e.$set(c)},i(l){n||(F(e.$$.fragment,l),n=!0)},o(l){Q(e.$$.fragment,l),n=!1},d(l){fe(e,l),r=!1,s()}}}function jn(i){const e=["á","é","í","ó","ú","ü","ñ"],t=["a","e","i","o","u","u","n"],n=i.toLowerCase();let r="";for(let s=0;s<i.length;s++){const o=n.charAt(s),a=i.charAt(s);if(e.includes(o)){let l;for(let f=0;f<e.length;f++)if(e[f]===o){l=f;break}a===a.toUpperCase()?r+=t[l].toUpperCase():r+=t[l]}else r+=a}return r}function An(i,e,t){let n,r;$(i,oe,S=>t(12,r=S));let{showNewScene:s}=e,{offset:o}=e,a=r,l={x:o.x*-1+20,y:o.y*-1+20},f;function c(){if(n.length<=0){alert(`Debes dar un nombre a la escena /
You must give a name to the scene`);return}if(/^\d/.test(n)===!0){alert(`El nombre de la escena no puede empezar con un número /
The name of the scene cannot start with a number`);return}let S=n.replace(/\s/gi,"_").replace(/\W/,"").replace(/[;.,:{}()<>$%&!¡?¿"'/\\#@&*+-]/gi,"");if(S=jn(S),r[S]!==void 0){alert(`Ya existe una escena con ese nombre /
There is already a scene with that name`);return}a[S]={text:"",display:{x:l.x,y:l.y}},he(oe,r[S]=a[S],r),t(0,s=!1)}function u(S){S.key==="Enter"&&c(),S.key==="Escape"&&t(0,s=!1)}function d(S){ge.call(this,i,S)}function h(S){s=S,t(0,s)}function E(){n=this.value,t(2,n)}function _(S){f=S,t(1,f)}return i.$$set=S=>{"showNewScene"in S&&t(0,s=S.showNewScene),"offset"in S&&t(6,o=S.offset)},t(2,n=""),[s,f,n,l,c,u,o,d,h,E,_]}class Un extends Ee{constructor(e){super(),Ne(this,e,An,On,we,{showNewScene:0,offset:6})}}function bt(i,e,t){const n=i.slice();return n[24]=e[t][0],n[25]=e[t][1],n}function wt(i,e,t){const n=i.slice();return n[28]=e[t],n[30]=t,n}function kt(i,e,t){const n=i.slice();return n[28]=e[t],n[30]=t,n}function Et(i,e,t){const n=i.slice();return n[32]=e[t],n}function Nt(i,e,t){const n=i.slice();return n[32]=e[t],n}function St(i,e){let t,n,r,s,o,a,l;function f(u){e[16](u)}let c={key:e[32]};return e[4]!==void 0&&(c.movingNode=e[4]),n=new Cn({props:c}),le.push(()=>ye(n,"movingNode",f)),{key:i,first:null,c(){t=C("div"),ae(n.$$.fragment),this.h()},l(u){t=T(u,"DIV",{class:!0,key:!0});var d=z(t);ue(n.$$.fragment,d),d.forEach(y),this.h()},h(){g(t,"class","scene-node-container-div"),g(t,"key",s=e[32]),this.first=t},m(u,d){D(u,t,d),ce(n,t,null),o=!0,a||(l=P(t,"mouseenter",Pn),a=!0)},p(u,d){e=u;const h={};d[0]&128&&(h.key=e[32]),!r&&d[0]&16&&(r=!0,h.movingNode=e[4],be(()=>r=!1)),n.$set(h),(!o||d[0]&128&&s!==(s=e[32]))&&g(t,"key",s)},i(u){o||(F(n.$$.fragment,u),o=!0)},o(u){Q(n.$$.fragment,u),o=!1},d(u){u&&y(t),fe(n),a=!1,l()}}}function It(i,e){let t,n,r;return n=new Mn({props:{key:e[32],pageMouse:e[1],movingNode:e[4]}}),{key:i,first:null,c(){t=ve(),ae(n.$$.fragment),this.h()},l(s){t=ve(),ue(n.$$.fragment,s),this.h()},h(){this.first=t},m(s,o){D(s,t,o),ce(n,s,o),r=!0},p(s,o){e=s;const a={};o[0]&128&&(a.key=e[32]),o[0]&2&&(a.pageMouse=e[1]),o[0]&16&&(a.movingNode=e[4]),n.$set(a)},i(s){r||(F(n.$$.fragment,s),r=!0)},o(s){Q(n.$$.fragment,s),r=!1},d(s){s&&y(t),fe(n,s)}}}function Ct(i){let e,t,n;function r(o){i[17](o)}let s={offset:i[5]};return i[0]!==void 0&&(s.showNewScene=i[0]),e=new Un({props:s}),le.push(()=>ye(e,"showNewScene",r)),{c(){ae(e.$$.fragment)},l(o){ue(e.$$.fragment,o)},m(o,a){ce(e,o,a),n=!0},p(o,a){const l={};a[0]&32&&(l.offset=o[5]),!t&&a[0]&1&&(t=!0,l.showNewScene=o[0],be(()=>t=!1)),e.$set(l)},i(o){n||(F(e.$$.fragment,o),n=!0)},o(o){Q(e.$$.fragment,o),n=!1},d(o){fe(e,o)}}}function Tt(i){let e,t=[],n=new Map,r,s,o,a=i[2];const l=c=>c[24];for(let c=0;c<a.length;c+=1){let u=bt(i,a,c),d=l(u);n.set(d,t[c]=Dt(d,u))}let f=i[6]!==void 0&&Ot(i);return{c(){e=De("svg");for(let c=0;c<t.length;c+=1)t[c].c();r=ve(),f&&f.c(),this.h()},l(c){e=Oe(c,"svg",{width:!0,height:!0});var u=z(e);for(let d=0;d<t.length;d+=1)t[d].l(u);r=ve(),f&&f.l(u),u.forEach(y),this.h()},h(){g(e,"width","100%"),g(e,"height","100%")},m(c,u){D(c,e,u);for(let d=0;d<t.length;d+=1)t[d].m(e,null);k(e,r),f&&f.m(e,null),s||(o=P(e,"click",i[9]),s=!0)},p(c,u){u[0]&8516&&(a=c[2],t=Me(t,u,l,1,c,a,n,e,Ve,Dt,r,bt)),c[6]!==void 0?f?f.p(c,u):(f=Ot(c),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(c){c&&y(e);for(let u=0;u<t.length;u+=1)t[u].d();f&&f.d(),s=!1,o()}}}function zt(i,e){let t,n,r,s,o;return{key:i,first:null,c(){t=De("line"),this.h()},l(a){t=Oe(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0});var l=z(t);l.forEach(y),this.h()},h(){g(t,"x1",n=e[25].display.x/pe+Se(e[24],"width")/2),g(t,"y1",r=e[25].display.y/pe+Se(e[24],"height")),g(t,"x2",s=e[13](e[25],e[28],"x")),g(t,"y2",o=e[13](e[25],e[28],"y")),g(t,"stroke","var(--scene-stroke)"),this.first=t},m(a,l){D(a,t,l)},p(a,l){e=a,l[0]&4&&n!==(n=e[25].display.x/pe+Se(e[24],"width")/2)&&g(t,"x1",n),l[0]&4&&r!==(r=e[25].display.y/pe+Se(e[24],"height"))&&g(t,"y1",r),l[0]&260&&s!==(s=e[13](e[25],e[28],"x"))&&g(t,"x2",s),l[0]&260&&o!==(o=e[13](e[25],e[28],"y"))&&g(t,"y2",o)},d(a){a&&y(t)}}}function Mt(i,e){let t,n,r,s,o;return{key:i,first:null,c(){t=De("line"),this.h()},l(a){t=Oe(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0});var l=z(t);l.forEach(y),this.h()},h(){g(t,"x1",n=e[25].display.x/pe+Se(e[24],"width")/2),g(t,"y1",r=e[25].display.y/pe+Se(e[24],"height")),g(t,"x2",s=e[13](e[25],e[28],"x")),g(t,"y2",o=e[13](e[25],e[28],"y")),g(t,"stroke","var(--area-stroke)"),this.first=t},m(a,l){D(a,t,l)},p(a,l){e=a,l[0]&4&&n!==(n=e[25].display.x/pe+Se(e[24],"width")/2)&&g(t,"x1",n),l[0]&4&&r!==(r=e[25].display.y/pe+Se(e[24],"height"))&&g(t,"y1",r),l[0]&4&&s!==(s=e[13](e[25],e[28],"x"))&&g(t,"x2",s),l[0]&4&&o!==(o=e[13](e[25],e[28],"y"))&&g(t,"y2",o)},d(a){a&&y(t)}}}function Dt(i,e){let t,n=[],r=new Map,s,o=[],a=new Map,l,f,c,u,d,h,E,_=e[25][e[8](e[25])]||[];const S=m=>m[30];for(let m=0;m<_.length;m+=1){let w=kt(e,_,m),I=S(w);r.set(I,n[m]=zt(I,w))}let b=e[25].areas||[];const p=m=>m[30];for(let m=0;m<b.length;m+=1){let w=wt(e,b,m),I=p(w);a.set(I,o[m]=Mt(I,w))}function v(){return e[19](e[24])}return{key:i,first:null,c(){t=ve();for(let m=0;m<n.length;m+=1)n[m].c();s=ve();for(let m=0;m<o.length;m+=1)o[m].c();l=De("rect"),this.h()},l(m){t=ve();for(let I=0;I<n.length;I+=1)n[I].l(m);s=ve();for(let I=0;I<o.length;I+=1)o[I].l(m);l=Oe(m,"rect",{class:!0,x:!0,y:!0,width:!0,height:!0});var w=z(l);w.forEach(y),this.h()},h(){g(l,"class","minimap-rect svelte-j7o2a0"),g(l,"x",f=e[25].display.x/pe),g(l,"y",c=e[25].display.y/pe),g(l,"width",u=Se(e[24],"width")),g(l,"height",d=Se(e[24],"height")),this.first=t},m(m,w){D(m,t,w);for(let I=0;I<n.length;I+=1)n[I].m(m,w);D(m,s,w);for(let I=0;I<o.length;I+=1)o[I].m(m,w);D(m,l,w),h||(E=[P(l,"mouseleave",e[18]),P(l,"mouseenter",v)],h=!0)},p(m,w){e=m,w[0]&8452&&(_=e[25][e[8](e[25])]||[],n=Me(n,w,S,1,e,_,r,s.parentNode,Ve,zt,s,kt)),w[0]&8196&&(b=e[25].areas||[],o=Me(o,w,p,1,e,b,a,l.parentNode,Ve,Mt,l,wt)),w[0]&4&&f!==(f=e[25].display.x/pe)&&g(l,"x",f),w[0]&4&&c!==(c=e[25].display.y/pe)&&g(l,"y",c),w[0]&4&&u!==(u=Se(e[24],"width"))&&g(l,"width",u),w[0]&4&&d!==(d=Se(e[24],"height"))&&g(l,"height",d)},d(m){m&&y(t);for(let w=0;w<n.length;w+=1)n[w].d(m);m&&y(s);for(let w=0;w<o.length;w+=1)o[w].d(m);m&&y(l),h=!1,Ce(E)}}}function Ot(i){let e,t;return{c(){e=De("text"),t=W(i[6]),this.h()},l(n){e=Oe(n,"text",{x:!0,y:!0,fill:!0,"font-size":!0});var r=z(e);t=K(r,i[6]),r.forEach(y),this.h()},h(){g(e,"x",5),g(e,"y",343),g(e,"fill","#ffffff99"),g(e,"font-size","0.9em")},m(n,r){D(n,e,r),k(e,t)},p(n,r){r[0]&64&&Ge(t,n[6])},d(n){n&&y(e)}}}function Ln(i){let e,t=[],n=new Map,r,s,o=[],a=new Map,l,f,c,u,d,h,E=i[7];const _=m=>m[32];for(let m=0;m<E.length;m+=1){let w=Nt(i,E,m),I=_(w);n.set(I,t[m]=St(I,w))}let S=i[7];const b=m=>m[32];for(let m=0;m<S.length;m+=1){let w=Et(i,S,m),I=b(w);a.set(I,o[m]=It(I,w))}let p=i[0]&&Ct(i),v=i[3]&&Tt(i);return{c(){e=C("div");for(let m=0;m<t.length;m+=1)t[m].c();r=U(),s=De("svg");for(let m=0;m<o.length;m+=1)o[m].c();l=U(),p&&p.c(),f=U(),c=C("div"),v&&v.c(),this.h()},l(m){e=T(m,"DIV",{class:!0});var w=z(e);for(let R=0;R<t.length;R+=1)t[R].l(w);r=L(w),s=Oe(w,"svg",{class:!0});var I=z(s);for(let R=0;R<o.length;R+=1)o[R].l(I);I.forEach(y),l=L(w),p&&p.l(w),w.forEach(y),f=L(m),c=T(m,"DIV",{class:!0});var V=z(c);v&&v.l(V),V.forEach(y),this.h()},h(){g(s,"class","connections-container svelte-j7o2a0"),g(e,"class","node-page svelte-j7o2a0"),g(c,"class","minimap-container svelte-j7o2a0")},m(m,w){D(m,e,w);for(let I=0;I<t.length;I+=1)t[I].m(e,null);k(e,r),k(e,s);for(let I=0;I<o.length;I+=1)o[I].m(s,null);k(e,l),p&&p.m(e,null),D(m,f,w),D(m,c,w),v&&v.m(c,null),u=!0,d||(h=[P(e,"mousedown",i[10]),P(e,"mouseup",i[11]),P(e,"mousemove",i[12]),P(e,"mouseleave",i[11]),P(c,"mousedown",_e(i[15]))],d=!0)},p(m,w){w[0]&144&&(E=m[7],Pe(),t=Me(t,w,_,1,m,E,n,e,st,St,r,Nt),Be()),w[0]&146&&(S=m[7],Pe(),o=Me(o,w,b,1,m,S,a,s,st,It,null,Et),Be()),m[0]?p?(p.p(m,w),w[0]&1&&F(p,1)):(p=Ct(m),p.c(),F(p,1),p.m(e,null)):p&&(Pe(),Q(p,1,1,()=>{p=null}),Be()),m[3]?v?v.p(m,w):(v=Tt(m),v.c(),v.m(c,null)):v&&(v.d(1),v=null)},i(m){if(!u){for(let w=0;w<E.length;w+=1)F(t[w]);for(let w=0;w<S.length;w+=1)F(o[w]);F(p),u=!0}},o(m){for(let w=0;w<t.length;w+=1)Q(t[w]);for(let w=0;w<o.length;w+=1)Q(o[w]);Q(p),u=!1},d(m){m&&y(e);for(let w=0;w<t.length;w+=1)t[w].d();for(let w=0;w<o.length;w+=1)o[w].d();p&&p.d(),m&&y(f),m&&y(c),v&&v.d(),d=!1,Ce(h)}}}let pe=20;function Pn(i){[...document.getElementsByClassName("scene-node-container")].forEach(e=>e.style.zIndex="0"),i.target.firstChild.style.zIndex="1"}function Se(i,e){const t=document.querySelector(`.scene-node-container[key=${i}]`),n=getComputedStyle(t);return Math.floor(+n[e].replace("px","")/pe)}function Bn(i,e,t){let n,r,s,o,a;$(i,oe,j=>t(14,s=j)),$(i,$e,j=>t(23,o=j)),$(i,Qe,j=>t(8,a=j));let l=!1;Bt(()=>{t(3,l=!0)});let{showNewScene:f}=e,c,u={},d,h,E=!1;const _={x:0,y:0};let S;function b(j){const H=document.querySelector(".node-page"),Z=getComputedStyle(H),q=+Z.width.replace("px",""),ne=+Z.height.replace("px",""),B=document.querySelector(".page-container"),ee=getComputedStyle(B),se=+ee.borderWidth.replace("px","")*2,J=+ee.width.replace("px","")-se,ie=+ee.height.replace("px","")-se;t(5,_.x=-j.offsetX*pe+J/2,_),t(5,_.y=-j.offsetY*pe+ie/2,_),t(5,_.x=_.x>0?0:-_.x>q-J?-q+J:_.x,_),t(5,_.y=_.y>0?0:-_.y>ne-ie?-ne+ie:_.y,_),H.style.left=`${_.x}px`,H.style.top=`${_.y}px`}function p(){E=!0,this.style.cursor="grabbing"}function v(){E=!1,this.style.cursor="grab"}function m(j){if(E&&!c){d===void 0&&(d=+getComputedStyle(this).width.replace("px","")),h===void 0&&(h=+getComputedStyle(this).height.replace("px",""));const Z=+getComputedStyle(this.offsetParent).borderWidth.replace("px","")*2,q=+getComputedStyle(this.offsetParent).width.replace("px","")-Z,ne=+getComputedStyle(this.offsetParent).height.replace("px","")-Z;t(5,_.x+=j.movementX,_),t(5,_.y+=j.movementY,_),t(5,_.x=_.x>0?0:q-_.x>d?q-d:_.x,_),t(5,_.y=_.y>0?0:ne-_.y>h?ne-h:_.y,_),this.style.left=`${_.x}px`,this.style.top=`${_.y}px`}t(1,u={x:j.offsetX,y:j.offsetY});let H=j.target;for(;H!==this;)t(1,u.x+=H.offsetLeft,u),t(1,u.y+=H.offsetTop,u),H=H.offsetParent}function w(j,H,Z){const q=H[o(H)],ne=s[q];return ne===void 0?j.display[Z]/pe:ne.display[Z]/pe+(Z==="x"?Se(q,"width")/2:0)}function I(j){ge.call(this,i,j)}function V(j){c=j,t(4,c)}function R(j){f=j,t(0,f)}const Y=()=>{t(6,S=void 0)},x=j=>{t(6,S=j)};return i.$$set=j=>{"showNewScene"in j&&t(0,f=j.showNewScene)},i.$$.update=()=>{i.$$.dirty[0]&16384&&t(7,n=Object.keys(s)),i.$$.dirty[0]&16384&&t(2,r=Object.entries(s)),i.$$.dirty[0]&6&&u&&(t(2,r),t(14,s),t(1,u))},[f,u,r,l,c,_,S,n,a,b,p,v,m,w,s,I,V,R,Y,x]}let Rn=class extends Ee{constructor(e){super(),Ne(this,e,Bn,Ln,we,{showNewScene:0},null,[-1,-1])}};function jt(i){let e,t;return e=new Xe({props:{pos:i[2],$$slots:{default:[Vn]},$$scope:{ctx:i}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,r){ce(e,n,r),t=!0},p(n,r){const s={};r&1026&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function Vn(i){let e,t,n,r,s,o,a;function l(c){i[7](c)}let f={};return i[1]!==void 0&&(f.toggle=i[1]),e=new Ye({props:f}),le.push(()=>ye(e,"toggle",l)),{c(){ae(e.$$.fragment),n=U(),r=C("div"),this.h()},l(c){ue(e.$$.fragment,c),n=L(c),r=T(c,"DIV",{class:!0,id:!0}),z(r).forEach(y),this.h()},h(){g(r,"class","test-story-container svelte-a561jp"),g(r,"id","test-story-container")},m(c,u){ce(e,c,u),D(c,n,u),D(c,r,u),s=!0,o||(a=Re(i[3].call(null,r)),o=!0)},p(c,u){const d={};!t&&u&2&&(t=!0,d.toggle=c[1],be(()=>t=!1)),e.$set(d)},i(c){s||(F(e.$$.fragment,c),s=!0)},o(c){Q(e.$$.fragment,c),s=!1},d(c){fe(e,c),c&&y(n),c&&y(r),o=!1,a()}}}function Gn(i){let e,t,n,r,s,o,a,l,f,c,u;function d(p){i[4](p)}function h(p){i[5](p)}let E={};i[0]!==void 0&&(E.showNewScene=i[0]),i[1]!==void 0&&(E.showTest=i[1]),t=new en({props:E}),le.push(()=>ye(t,"showNewScene",d)),le.push(()=>ye(t,"showTest",h));function _(p){i[6](p)}let S={};i[0]!==void 0&&(S.showNewScene=i[0]),l=new Rn({props:S}),le.push(()=>ye(l,"showNewScene",_));let b=i[1]&&jt(i);return{c(){e=C("div"),ae(t.$$.fragment),s=U(),o=C("div"),a=C("div"),ae(l.$$.fragment),c=U(),b&&b.c(),this.h()},l(p){e=T(p,"DIV",{class:!0});var v=z(e);ue(t.$$.fragment,v),s=L(v),o=T(v,"DIV",{class:!0});var m=z(o);a=T(m,"DIV",{class:!0});var w=z(a);ue(l.$$.fragment,w),w.forEach(y),m.forEach(y),c=L(v),b&&b.l(v),v.forEach(y),this.h()},h(){g(a,"class","page-container svelte-a561jp"),g(o,"class","static-page-container svelte-a561jp"),g(e,"class","main-window-container svelte-a561jp")},m(p,v){D(p,e,v),ce(t,e,null),k(e,s),k(e,o),k(o,a),ce(l,a,null),k(e,c),b&&b.m(e,null),u=!0},p(p,[v]){const m={};!n&&v&1&&(n=!0,m.showNewScene=p[0],be(()=>n=!1)),!r&&v&2&&(r=!0,m.showTest=p[1],be(()=>r=!1)),t.$set(m);const w={};!f&&v&1&&(f=!0,w.showNewScene=p[0],be(()=>f=!1)),l.$set(w),p[1]?b?(b.p(p,v),v&2&&F(b,1)):(b=jt(p),b.c(),F(b,1),b.m(e,null)):b&&(Pe(),Q(b,1,1,()=>{b=null}),Be())},i(p){u||(F(t.$$.fragment,p),F(l.$$.fragment,p),F(b),u=!0)},o(p){Q(t.$$.fragment,p),Q(l.$$.fragment,p),Q(b),u=!1},d(p){p&&y(e),fe(t),fe(l),b&&b.d()}}}function Wn(i,e,t){let n,r;$(i,oe,h=>t(8,n=h)),$(i,Gt,h=>t(9,r=h));let s=!1,o=!1,a={x:40,y:40};function l(){console.log(n);const h=document.getElementById("storygeneraldiv");h&&h.remove();const E=new r("es",{adventureSlide:!1,typewriterSpeed:20}),_=Object.entries(n).sort((p,v)=>p[1].display.y-v[1].display.y);if(_.length===0){alert("No hay escenas / There are no scenes");return}E.setScenes(n).startAdventure(_[0][0]);const S=document.getElementById("test-story-container"),b=document.getElementById("storygeneraldiv");S.appendChild(b)}function f(h){s=h,t(0,s)}function c(h){o=h,t(1,o)}function u(h){s=h,t(0,s)}function d(h){o=h,t(1,o)}return[s,o,a,l,f,c,u,d]}class Kn extends Ee{constructor(e){super(),Ne(this,e,Wn,Gn,we,{})}}function Fn(i){let e,t,n,r,s,o,a,l,f,c,u,d,h,E,_;return u=new Kn({}),{c(){e=C("section"),t=C("div"),n=C("h1"),r=W("Aventura interactiva"),s=U(),o=C("span"),a=W("Un editor de historias interactivas para la librería "),l=C("a"),f=W("Aventura.js"),c=U(),ae(u.$$.fragment),d=U(),h=C("footer"),E=W("Sergio Rodríguez Gómez — 2023 — v1.0.0"),this.h()},l(S){e=T(S,"SECTION",{class:!0});var b=z(e);t=T(b,"DIV",{class:!0});var p=z(t);n=T(p,"H1",{class:!0});var v=z(n);r=K(v,"Aventura interactiva"),v.forEach(y),s=L(p),o=T(p,"SPAN",{class:!0});var m=z(o);a=K(m,"Un editor de historias interactivas para la librería "),l=T(m,"A",{href:!0,target:!0,rel:!0,class:!0});var w=z(l);f=K(w,"Aventura.js"),w.forEach(y),m.forEach(y),p.forEach(y),c=L(b),ue(u.$$.fragment,b),d=L(b),h=T(b,"FOOTER",{class:!0});var I=z(h);E=K(I,"Sergio Rodríguez Gómez — 2023 — v1.0.0"),I.forEach(y),b.forEach(y),this.h()},h(){g(n,"class","svelte-18pgm1v"),g(l,"href","https://github.com/srsergiorodriguez/aventura/blob/master/README_es.md"),g(l,"target","_blank"),g(l,"rel","noreferrer"),g(l,"class","svelte-18pgm1v"),g(o,"class","svelte-18pgm1v"),g(t,"class","main-title svelte-18pgm1v"),g(h,"class","no-select svelte-18pgm1v"),g(e,"class","general no-select")},m(S,b){D(S,e,b),k(e,t),k(t,n),k(n,r),k(t,s),k(t,o),k(o,a),k(o,l),k(l,f),k(e,c),ce(u,e,null),k(e,d),k(e,h),k(h,E),_=!0},p:Ie,i(S){_||(F(u.$$.fragment,S),_=!0)},o(S){Q(u.$$.fragment,S),_=!1},d(S){S&&y(e),fe(u)}}}class Xn extends Ee{constructor(e){super(),Ne(this,e,null,Fn,we,{})}}export{Xn as default};
