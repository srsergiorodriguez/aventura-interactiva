import{S as we,i as ke,s as _e,e as S,a as L,t as F,b as I,d as D,j as P,f as H,g as v,A as m,l as A,k as _,K as R,n as Ee,L as Ie,v as ee,M as be,D as le,c as St,N as Ue,u as It,m as Ct,o as Tt,p as K,q as Y,O as me,P as pe,F as ae,G as ue,H as ce,I as fe,Q as ge,R as ye,T as ve,U as We,r as xe,V as $e,w as Se,C as ze,x as Oe,W as Ae,X as Fe,z as At,Y as Le,Z as Pe,_ as et}from"../chunks/index.4d86df2e.js";import{w as Xe,r as Te}from"../chunks/index.9d73ec15.js";const Je=Xe(!0),Ge=Xe(void 0),te=Xe({inicio:{texto:"Érase una vez un círculo...",display:{x:40,y:40},opciones:[{btn:"dejar tranquilo",escena:"final1"},{btn:"aplastar",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{x:40,y:250}},final2:{texto:"Parece que la historia formó una elipsis",sinSalida:!0,display:{x:220,y:250}}}),Mt=Te(r=>r.scene===void 0&&r.escena!==void 0?"escena":"scene"),Ye=Te(r=>r.options===void 0&&r.opciones!==void 0?"opciones":"options"),Ut=Te(r=>r.text===void 0&&r.texto!==void 0?"texto":"text"),Dt=Te(r=>r.image===void 0&&r.imagen!==void 0?"imagen":"image");function zt(r,e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([r],{type:e})),n.setAttribute("download",t),document.body.appendChild(n),n.click(),document.body.removeChild(n)}const Lt=Te((r,e)=>{zt(JSON.stringify(r,null,2),"application/json",`${e.includes(".json")?e:e+".json"}`)}),Pt=Te(r=>{zt(r,"text/plain;charset=utf-8","index.html")}),Bt=function(r,e,t){return`
<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
  </head>
  <body>
  </body>
  <script>
    const lang = "es";
    const options = {typewriterSpeed: 20, defaultCSS: false};
  <\/script>
  <style>
    
  #storygeneraldiv {
    box-sizing: border-box;
    margin: auto;
    max-width: 600px;
    font-family: 'Courier New', Courier, monospace;
    background: white;
  }
  
  .storydiv {
    border: solid black 1px;
    width: 100%;
    display: flex;
    padding: 10px;
    flex-direction: column;
    box-sizing: border-box;
  }
  
  .storyp {
    font-size: 18px;
    min-height: 25px;
  }
  
  .storybutton-container {
    margin: auto;
  }
  
  .storybutton {
    background: white;
    box-shadow: none;
    border: solid 1px;
    margin: 0px 1em 0px 0px;
    font-size: 20px;
    font-family: 'Courier New', Courier, monospace;
    cursor: pointer;
  }
  
  .storybutton:hover {
    color: white;
    background: black;
  }
  
  .storyimage-container {
    box-sizing: content-box;
    position: relative;
    width: 100%;
    margin: auto;
  }
  
  .storyimage {
    justify-content: center;
    width: 100%;
    margin: auto;
    border-radius: 20px;
    display: block;
  }
  
  .storyimage-area {
    font-size: 14px;
    position: absolute;
    cursor: pointer;
    text-align: center;
    color: black;
    background: #ffffff00;
    border: solid 1px black;
  }
  
  .storyimage-area:hover {
    background: #ffffff33;
  }
  
  @media screen and (max-device-width: 500px) {
    #storygeneraldiv {
      max-width:100%;
    }
    .storyp {
      font-size: 7vw;
    }
    .storybutton {
      font-size: 10vw;
    }
  }
  
  </style>
  <script>
    const A = ${r}
  <\/script>
  <script>
    const scenes = ${e};
    const aventura = new A(lang, options);
    aventura.setScenes(scenes).startAdventure('${t}');
  <\/script>
</html>
`},Rt=Te(Bt);class jt{constructor(e="en",t){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,adventureSlide:!0,evalTags:!1,igramaFormat:"png",urlWord:"URL",vizWidth:1e3,vizHeight:1e3,vizBg:"#313131",vizCol:"black",vizImageSize:50,vizLoading:!0,minigifOptions:{},sceneCallback:n=>n},t&&(this.options=Object.assign(this.options,this.setOptionsTranslations(t))),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.fijarDatosEscenas=this.setDataScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setOptionsTranslations(e){const t={velocidadMaquina:"typewriterSpeed",CSSporDefecto:"defaultCSS",contenedorAventura:"adventureContainer",rolloAventura:"adventureScroll",deslizarAImagen:"adventureSlide",ejecutarEtiquetas:"evalTags",formatoIgrama:"igramaFormat",palabraUrl:"urlWord",anchoVis:"vizWidth",altoVis:"vizHeight",fondoVis:"vizBg",colorVis:"vizCol",tamanoImagenVis:"visImageSize",cargandoVis:"vizLoading",opcionesMinigif:"minigifOptions",funcionEscena:"sceneCallback"};for(let[n,i]of Object.entries(e))t[n]!==void 0&&(e[t[n]]=i,delete e[n]);return e}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[t,n]of Object.entries(e.grammar));return this}setScenes(e){this.options.defaultCSS&&this.setCSS(),this.scenes=e;for(let t of Object.keys(e)){this.scenes[t].key=t;const n=this.scenes[t].image||this.scenes[t].imagen;n!==void 0&&this.storyPreload[n]===void 0&&(this.storyPreload[n]=new Image,this.storyPreload[n].src=n,this.storyPreload[n].className="storyimage")}return this}async setDataScenes(e,t=void 0,n=[]){if(this.options.defaultCSS&&this.setCSS(),typeof d3>"u"){console.error(this.lang==="es"?"Para crear visualizaciones debes tener también la librería D3":"To create visualizations you must have also the D3 library");return}return this.scenes=JSON.parse(JSON.stringify(e)),this.metaKeys=n,t!==void 0&&(this.data=JSON.parse(JSON.stringify(t)),await this.setViz(this.scenes,this.data)),this.setScenes(this.scenes),this}async setViz(e,t){const n=Object.keys(e),i={compare:Vt,scatter:Gt,pack:Wt};let s=0;for(let c of n)e[c].viz!==void 0&&s++;let o=0,a;const l=this.lang==="en"?"Loading...":"Cargando...";this.options.vizLoading&&(a=document.createElement("div"),a.id="storygeneraldiv",a.className="storydiv",a.textContent=l,(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(a));function d(c,u=15){let f="";for(let h=0;h<Math.ceil(u);h++)f+=h<c*u?"|":"-";return f}for(let c of n){if(e[c].viz===void 0)continue;const{filter:u,type:f,x:h,y}=e[c].viz;if(i[f]===void 0||h===void 0||y===void 0){const g=this.lang==="es"?`Parámetros incorrectos de visualización en la escena "${c}"`:`Incorrect parameteres in the scene "${c}"`;console.error(g)}let N=t;for(let g of u)N=this.filterFn(g)(N);let b=o;const{viz:w,areas:p}=await i[f](this,N,h,y,g=>{o=b+g/s;const E=Math.ceil(o*100);this.options.vizLoading&&(a.textContent=`${l} ${d(o)} ${E}%`)});e[c].image=w,e[c].areas=p}for(let c of t){if(c.ID===void 0){const u=this.lang==="es"?"Todos los datos deben tener un valor único con la clave ID":"All data must have a unique value with the ID key";console.error(u),this.scenes={};break}e[`ind_${c.ID}`]={text:`${c.CONT||""}`,meta:c.ID,dataScene:!0,options:[{btn:"<<<",scene:`ind_${c.ID}`}]},c.IMGURL!==void 0&&(e[`ind_${c.ID}`].image=c.IMGURL),c.URL!==void 0&&(e[`ind_${c.ID}`].url=c.URL)}a.remove()}filterFn(e){const t=e[1];if(t==="="||t==="=="||t==="===")return i=>i.filter(s=>n(s[e[0]])==n(e[2]));return t==="<"?i=>i.filter(s=>n(s[e[0]])<n(e[2])):t===">"?i=>i.filter(s=>n(s[e[0]])>n(e[2])):i=>i;function n(i){return i==="true"?!0:i==="false"?!1:i}}setMarkov(e){return this.markov=e,this}expandGrammar(e){const t=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(t)}expandIgrama(e){const t=this.igrama.grammar,n=this.selectGrammarRule(t[e]);return this.grammarRuleRecursion(n,t).split("|").map(s=>this.decodeDrawing(s))}grammarRuleRecursion(e,t){let n=t||this.grammar,i=this.setNewRules(e);const s=i.match(/<[\w\d.,/#]+>/gi);if(!s)return i;for(let o of s){const a=this.defineTransformations(o);i=i.replace(o,()=>{o=o.replace(/[<>]/gi,""),o=o.replace(/#[\w\d.,/]+#/g,"");const l=o.search(/[.]/)>-1?this.getNestedObject(n,o.match(/[\w\d]+/g)):n[o];if(!l){const c=this.lang==="es"?`Se intentó expandir desde la regla "${o}", pero no se pudo encontrar`:`Tried to expand from rule "${o}", but couldn't find it`;console.error(c)}const d=this.selectGrammarRule(l);return this.transformString(d,a)})}return this.grammarRuleRecursion(i,n)}setNewRules(e,t){let n;t===void 0?n=this.grammar:n=t;let i=e;const s=i.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(s)for(;s.length;){const o=s.pop();i=i.replace(o,"");const{symbol:a,pairsString:l}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(o).groups,d=l.match(/[-]?[\w\d]+:[\w\d]+/gi).map(c=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(c).groups);if(d){n[a]=n[a]||{};for(let c of d){const u=n[c.value];if(!u){const y=this.lang==="es"?`Se intentó crear la nueva regla "${a}", pero no se pudo encontrar "${c.value}" para producir la subregla "${c.key}"`:`Tried to create new rule: "${a}", but couldn't find "${c.value}" to produce "${c.key}" subrule`;console.error(y)}const f=c.remove==="-",h=this.selectGrammarRule(u);if(f){const y=u.indexOf(h);n[c.value]=[...u.slice(0,y),...u.slice(y+1)]}n[a][c.key]=[h]}}}return i}startAdventure(e){const t=document.createElement("div");return t.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(t),this.prevScene=e,this.goToScene(this.scenes[e]),this}goToScene(e){const t=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(l=>l.remove()),[...document.getElementsByClassName("storyimage-area")].map(a=>a.remove());const i=document.createElement("div");if(i.className="storydiv",t.appendChild(i),e.image||e.imagen){const a=document.createElement("div");a.className="storyimage-container",i.appendChild(a);const l=e.image||e.imagen,d=this.options.adventureScroll?this.storyPreload[l].cloneNode():this.storyPreload[l];a.appendChild(d),e.areas&&(d.complete?this.setAreas(d,a,e.areas):d.onload=()=>{this.setAreas(d,a,e.areas)})}else if(e.igrama!==void 0){const a=document.createElement("div");a.className="storyimage-container",i.appendChild(a);const l=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(l),this.igramaDataUrl(l,this.options.igramaFormat).then(d=>{const c=new Image;c.src=d,c.className="storyimage",a.appendChild(c)})}if(e.title||e.titulo){const a=document.createElement("div");a.className="storytitle-container",i.appendChild(a);const l=document.createElement("h1");l.className="storytitle",l.textContent=e.title||e.titulo,a.appendChild(l)}if(e.meta!==void 0){const a=document.createElement("div");a.className="storymeta-container",i.appendChild(a);const l=this.data.find(d=>d.ID==e.meta);for(let d of this.metaKeys){if(l[d]===void 0)continue;const c=document.createElement("div");c.className="storymeta-subcontainer",a.appendChild(c);const u=document.createElement("span");u.className="storymeta-key",u.textContent=`${d}: `,c.appendChild(u);const f=document.createElement("span");f.className="storymeta-val",f.textContent=l[d],c.appendChild(f)}}const s=document.createElement("div");s.className="storyp-container",(e.text||e.texto||e.igramaText)&&i.appendChild(s);const o=document.createElement("p");if(o.className="storyp",o.textContent="",s.appendChild(o),e.url){const a=document.createElement("a");a.className="storyurl",a.href=e.url,a.target="_blank",a.textContent=this.options.urlWord,s.appendChild(a)}this.options.adventureSlide&&document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(o,e),this.data&&(e.viz!==void 0?this.prevScene=e.key:e.dataScene===!0&&(e.options[0].scene=this.prevScene)),this.options.sceneCallback(e)}setAreas(e,t,n){const i=e.getBoundingClientRect(),s=t.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,t,n)},[...document.getElementsByClassName("storyimage-area")].map(a=>a.remove());for(let a of n){let l=document.createElement("div");l.className="storyimage-area";const d=(a.x-Math.floor(a.w/2))*i.width/e.naturalWidth;l.style.left=`${i.left-s.left+d}px`;const c=(a.y-Math.floor(a.h/2))*i.height/e.naturalHeight;l.style.top=`${i.top-s.top+c}px`,l.style.width=`${a.w*i.width/e.naturalWidth}px`,l.style.height=`${a.h*i.height/e.naturalHeight}px`,l.textContent=a.btn||"",d>0&&d<i.width&&c>0&&c<i.height&&t.appendChild(l),l.style.fontSize=`${18*i.height/e.naturalHeight}px`,l.onclick=()=>{const u=a.scene||a.escena;this.goToScene(this.scenes[u])},a.tooltip!==void 0&&(l.onmouseover=()=>{l.textContent=a.tooltip||"",l.style.zIndex="100"},l.onmouseout=()=>{l.textContent=a.btn||"",l.style.zIndex="0"})}}async typewriter(e,t){const n=t.text||t.texto||t.igramaText||"";let i=this.grammar?this.grammarRuleRecursion(n):n;if(i=i.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let s=0;await new Promise(o=>{const a=setInterval(()=>{const l=i.substring(0,s);this.options.evalTags?e.innerHTML=l:e.textContent=l,s++,s>i.length&&(clearInterval(a),o(!0))},Math.floor(this.options.typewriterSpeed))}),this.optionButtons(t)}else this.options.evalTags?e.innerHTML=i:e.textContent=i,this.optionButtons(t)}optionButtons(e){const t=[...document.getElementsByClassName("storydiv")],n=t[t.length-1];[...document.getElementsByClassName("storybutton-container")].map(o=>o.remove());const s=document.createElement("div");if(s.className="storybutton-container",n.appendChild(s),e.options||e.opciones){const o=e.options||e.opciones;for(let a of o){const l=document.createElement("button");l.className="storybutton",l.textContent=a.btn,s.appendChild(l),l.addEventListener("click",()=>{if((a.text||a.texto)===void 0){const c=a.scene||a.escena;this.goToScene(this.scenes[c])}else this.goToScene(a)})}}else if(e.scene||e.escena){const o=e.scene||e.escena,a=document.createElement("button");a.className="storybutton",a.textContent=this.lang==="en"?"Continue":"Continuar",s.appendChild(a),a.addEventListener("click",()=>{this.goToScene(this.scenes[o])})}this.options.adventureSlide&&document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const i=Math.random()*e.prob.reduce((o,a)=>o+a);let s=0;for(let o=0;o<e.prob.length;o++){if(s<=i&&i<s+e.prob[o])return e[o];s+=e.prob[o]}}const t=Math.floor(Math.random()*e.length);return e[t]}getNestedObject(e,t){return t.reduce((n,i)=>n&&n[i]!==void 0?n[i]:void 0,e)}defineTransformations(e){let t={};const n=/#(?<trans>[\w\d,]+)#/gi.exec(e),i=n?n.groups.trans.match(/[\w]+/gi):[];for(let s of i)t[s]=!0;return t}transformString(e,t){let n=e;return t.CAPITALIZE&&(n=n.charAt(0).toUpperCase()+n.slice(1)),t.ALLCAPS&&(n=n.toUpperCase()),n}decodeDrawing(e){if(e==="")return[];const[t,n,i]=e.split("%%");let s={};return t==="vector"?s.content=n.split("**").map(o=>{const[a,l,d]=o.split("&"),c=[];if(c.color=a,c.weight=l,d===void 0)return c;const u=d.split(",");for(let f=0;f<u.length;f+=2)c.push([+u[f],+u[f+1]]);return c}):s.content=n,s.attribute=i,s.type=t,s}async getMarkovModel(e,t=1,n=!1){let i=await(await fetch(`./${e}`)).text();i=i.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const s=i.split(this.markovSeparator),o={};for(let l=0;l<s.length-t;l++){let d="";for(let u=0;u<t;u++)d+=u===0?s[l+u]:" "+s[l+u];o[d]===void 0&&(o[d]={});const c=s[l+t];o[d][c]===void 0?o[d][c]=1:o[d][c]++}const a={};for(let l of Object.keys(o)){const d=Object.keys(o[l]);a[l]={probs:[],grams:d};let c=0;for(let u=0;u<d.length;u++)c+=o[l][d[u]];for(let u=0;u<d.length;u++)a[l].probs[u]=o[l][d[u]]/c}if(n){const l=e.split("/");this.saveJSON(a,`${l[l.length-1]}_markovModel_${t}N.json`)}return a}markovChain(e,t,n=.1){let i=t===void 0||this.markov[t]===void 0?this.randomMarkovWord():t,s=i;for(let a=0;a<e-1;a++){let l=this.getNextMarkov(this.markov[s]);l===void 0&&(l=this.getNextMarkov(this.randomMarkovWord()));let d=s.split(this.markovSeparator);d.push(l),d=d.slice(1).join(" "),s=d,i+=` ${l}`}return this.formatMarkov(i,n)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const t=Math.random();let n=0;if(e!==void 0)for(let i=0;i<e.probs.length;i++){if(n<=t&&t<n+e.probs[i])return e.grams[i];n+=e.probs[i]}}formatMarkov(e,t=.1){let n=e.replace(/ ([,:.;])/g,"$1");return n=n.replaceAll(/([.]) ([\wáéíóú])/ig,(i,s,o,a,l)=>Math.random()<t?`.
${o.toUpperCase()}`:`. ${o.toUpperCase()}`),n.charAt(0).toUpperCase()+n.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),n.setAttribute("download",`${t.includes(".json")?t:t+".json"}`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}testScenes(e){const t=e||this.scenes;if(!t){const i=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(i)}let n=[];for(let i of Object.keys(t)){const s=t[i];if(s.options||s.opciones){const a=(s.options||s.opciones).filter(l=>!t[l.scene||l.escena]);n=[...n,...a.map(l=>`${i} => ${l.btn} => ${l.scene||l.escena}`)]}else{if(s.deadEnd||s.sinSalida)continue;t[s.scene||s.escena]||n.push(`${i} => ${s.scene||s.escena}`)}}if(n.length>0){const i=this.lang==="es"?`Las siguientes escenas no llevan a ningún lado: ${n.join(", ")}`:`The following scenes are dead ends: ${n.join(", ")}`;console.error(i),this.scenesError=!0}return this}testGrammar(e){const t=e||this.grammar;if(!t){const n=this.lang==="es"?"No hay gramática para probar":"There is not grammar to test";console.error(n)}for(let n of Object.keys(t)){const i=t[n];for(let s of i){const o=s.match(/<([\w\d]+)>/gi),a=o?o.map(u=>u.replace(/[<>]/g,"")):[],l=s.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),d=l?l.map(u=>u.match(/([ ]?:[\w\d]+)/g).map(f=>/[ ]?:(?<key>[\w\d]+)/.exec(f).groups.key)).reduce((u,f)=>[...u,...f],[]):[],c=[...a,...d].filter(u=>!t[u]);if(c.length>0){const u=this.lang==="es"?`Las siguientes reglas, que se referencian en "${n}", no existen: ${c.join(", ")}`:`The following rules, referenced in "${n}", do not exist: ${c.join(", ")}`;this.grammarError=!0,console.error(u)}}}return this}testDistribution(e){const t=e||this.markov;if(t===void 0){const d=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(d)}const n={},i={};let s=0;const o=Object.values(t);for(let d of o)for(let c of d.probs){const u=(Math.round(c/.05)*.05).toFixed(2);i[s]=u,s++,n[u]===void 0?n[u]=1:n[u]++}console.log("------------------------------------ DIST ------------------------------------");const a=Math.max(...Object.values(n)),l=Object.entries(n).sort((d,c)=>d[0]>c[0]?1:d[0]<c[0]?-1:0);for(let d of l)console.log(`${d[0]}... ${"|".repeat(Math.ceil(d[1]*100/a))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,t="png",n){const i=await this.igramaDataUrl(e,t),s=new Image;s.src=i,n==null?document.body.appendChild(s):document.getElementById(n).appendChild(s)}async igramaDataUrl(e,t="png"){const n=this.igrama.metadata.width,i=this.igrama.metadata.height;let s=document.createElement("canvas");s.width=n,s.height=i;const o=s.getContext("2d");o.lineJoin="round",o.lineCap="round",o.fillStyle=this.igrama.metadata.bg||"#FFFFFF",o.fillRect(0,0,n,i),await this.drawLayers(e,o);let a;if(t==="png")a=s.toDataURL();else if(t==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener también la librería MiniGif":"To create Gifs you must have also the MiniGif library"),"";const l={colorResolution:7,dither:!1,delay:50};Object.assign(l,this.minigifOptions);const d=new MiniGif(l);d.addFrame(s);const c=this.getLayerWiggle(e);o.fillStyle=this.igrama.metadata.bg||"#FFFFFF",o.fillRect(0,0,n,i),await this.drawLayers(c,o),d.addFrame(s);const u=d.makeGif();a="data:image/gif;base64,"+await this.base64_arraybuffer(u)}return s.remove(),a}async base64_arraybuffer(e){return(await new Promise(n=>{const i=new FileReader;i.onload=()=>n(i.result),i.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const n=JSON.parse(JSON.stringify(e)),i=(s,o)=>Math.floor(s+Math.random()*(o-s));for(let[s,o]of n.entries())if(o.type==="vector")for(let[a,l]of o.content.entries()){for(let[d,c]of l.entries())Math.random()<.5?c[0]+=i(-3,3):c[1]+=i(-3,3);l.color=e[s].content[a].color,l.weight=e[s].content[a].weight}return n}getIgramaText(e){return e.map(n=>n.attribute).reverse().join(" ").trim()}async drawLayers(e,t){for(let[n,i]of e.entries())if(i.type==="url"){const{w:s,h:o,x:a,y:l}=this.igrama.sections[n];if(this.imgsMemo[i.content]===void 0){const d=new Image;d.src=i.content,this.imgsMemo[i.content]=await new Promise(c=>{d.addEventListener("load",()=>{c(d)},!1)})}t.drawImage(this.imgsMemo[i.content],a,l,s,o)}else if(i.type=="vector")for(let s of i.content){if(s.length===0)continue;const o=this.getSpline(s);this.drawSpline(o,t,s.color,s.weight)}}drawSpline(e,t,n,i){t.lineWidth=i,t.strokeStyle=n,t.fillStyle="rgba(0,0,0,0)",t.beginPath();for(let s=0;s<e.length;s++)s===0?t.moveTo(...e[0]):t.lineTo(...e[s]);t.stroke()}getSpline(e){let t=[];for(let n=0;n<e.length-1;n++){const i=[];i[0]=n>0?e[n-1]:e[0],i[1]=e[n],i[2]=e[n+1],i[3]=n<e.length-2?e[n+2]:e[e.length-1];for(let s=0;s<1;s+=.05){const o=this.getSplinePoint(s,i);t.push(o)}}return t}getSplinePoint(e,t){const n=Math.floor(e)+1,i=n+1,s=i+1,o=n-1,a=e*e,l=a*e,d=-l+2*a-e,c=3*l-5*a+2,u=-3*l+4*a+e,f=l-a,h=.5*(t[o][0]*d+t[n][0]*c+t[i][0]*u+t[s][0]*f),y=.5*(t[o][1]*d+t[n][1]*c+t[i][1]*u+t[s][1]*f);return[h,y]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=xt,document.getElementsByTagName("head")[0].appendChild(e)}}async function Vt(r,e,t,n,i=()=>{}){const s=[e.find(N=>N.ID==t),e.find(N=>N.ID==n)],o=r.options.vizWidth,a=r.options.vizHeight;let l=0;const d=[];for(let N of s){const b=new Image;b.setAttribute("crossorigin","anonymous"),b.src=N.IMGURL,await new Promise(w=>{b.onload=()=>{w(!0)}}),d.push({url:N.IMGURL,img:b,ID:N.ID}),i(l/s.length),l++}const c=document.createElement("canvas"),u=c.getContext("2d");c.width=o,c.height=a,u.fillStyle=r.options.vizBg,u.fillRect(0,0,o,a);const f=[];let h=0;for(let N of d){const b=parseInt(o/2)*.1,w=parseInt(o/2)-b,p=parseInt(w*N.img.height/N.img.width),g=h*(w+b)+w/2+b/2,E=a/2;u.save(),u.translate(-w/2,-p/2),u.drawImage(N.img,g,E,w,p),u.restore();const C={x:g,y:E,w,h:p,btn:"",scene:`ind_${N.ID}`,tooltip:""};f.push(C),h++}const y=c.toDataURL("image/png");return c.remove(),{viz:y,areas:f}}async function Gt(r,e,t,n,i=()=>{}){const s=r.options.vizWidth,o=r.options.vizHeight,a=r.options.vizImageSize,l={l:.2*s,r:.1*s,t:.1*o,b:.1*o},d=s-l.l-l.r,c=o-l.t-l.b,u=e,f=[...new Set(u.map(z=>z[t]))],h=[...new Set(u.map(z=>z[n]))],y=d3.scalePoint().domain(f).range([0,d]).padding(.5).round(!0),N=d3.scalePoint().domain(h).range([0,c]).padding(.5).round(!0);let b=0;const w=[];for(let z of u){if(r.imgsMemo[z.IMGURL]===void 0){const G=new Image;G.setAttribute("crossorigin","anonymous"),G.src=z.IMGURL,r.imgsMemo[z.IMGURL]=await new Promise(T=>{G.onload=()=>{T(G)}})}w.push({url:z.IMGURL,x:y(z[t]),y:N(z[n]),img:r.imgsMemo[z.IMGURL],r:a,ID:z.ID}),i(b/u.length),b++}d3.forceSimulation(w).force("charge",d3.forceManyBody().strength(5)).force("collide",d3.forceCollide(10)).tick(200);const p=document.createElement("canvas"),g=p.getContext("2d");p.width=s,p.height=o,g.fillStyle=r.options.vizBg,g.fillRect(0,0,s,o),g.strokeStyle=r.options.vizCol,g.font="14px serif",g.textBaseline="middle",g.textAlign="center";for(let z of f)g.fillStyle=r.options.vizCol,g.fillText(z,l.l+y(z),l.t+c+l.b/2);g.beginPath(),g.moveTo(l.l,l.t+c),g.lineTo(l.l+d,l.t+c),g.stroke(),g.textAlign="right";for(let z of h)g.fillStyle=r.options.vizCol,g.fillText(z,l.l-5,l.t+N(z));g.beginPath(),g.moveTo(l.l,l.t),g.lineTo(l.l,l.t+c),g.stroke(),g.strokeStyle=r.options.vizCol;const E=[];for(let z of w){const G=a,T=G*z.img.height/z.img.width,M=z.x+l.l,B=z.y+l.t;g.save(),g.translate(-G/2,-T/2),g.drawImage(z.img,M,B,G,T),g.restore();const x={x:M,y:B,w:G,h:T,btn:"",scene:`ind_${z.ID}`,tooltip:""};E.push(x)}const C=p.toDataURL("image/png");return p.remove(),{viz:C,areas:E}}async function Wt(r,e,t,n,i=()=>{}){const s=r.options.vizWidth,o=r.options.vizHeight,a=e,l=d3.rollup(a,E=>E.length,E=>E[t],E=>E[n]),d=([E,C])=>C.size&&Array.from(C),c=d3.hierarchy(l,d).sum(([,E])=>E).sort((E,C)=>C.value-E.value),u=[...d3.schemeGreys[4]].reverse(),f=c.descendants(),h=E=>u[E];d3.pack(c).size([s,o]).padding(20)(c);const y=[];let N=0;for(let E of a){for(let C of c.leaves())if(E[t]===C.parent.data[0]&&E[n]===C.data[0]){if(r.imgsMemo[E.IMGURL]===void 0){const z=new Image;z.setAttribute("crossorigin","anonymous"),z.src=E.IMGURL,r.imgsMemo[E.IMGURL]=await new Promise(G=>{z.onload=()=>{G(z)}})}y.push({url:E.IMGURL,x:C.x,y:C.y,r:r.options.vizImageSize,img:r.imgsMemo[E.IMGURL],ID:E.ID})}i(N/a.length),N++}d3.forceSimulation(y).force("collide",d3.forceCollide(20)).tick(200);const b=document.createElement("canvas"),w=b.getContext("2d");b.width=s,b.height=o,w.fillStyle=r.options.vizBg,w.fillRect(0,0,s,o),w.font="12px serif",w.textBaseline="middle",w.textAlign="center";for(let E of f)w.save(),w.translate(E.x,E.y),w.strokeStyle=r.options.vizCol,w.fillStyle=h(E.depth),w.beginPath(),w.ellipse(0,0,E.r,E.r,0,0,Math.PI*2),w.fill(),w.stroke(),w.fillStyle=r.options.vizCol,w.fillText(E.depth===1||E.depth===2?E.data[0]:"",0,-E.r-5),w.restore();const p=[];for(let E of y){const C=parseInt(50),z=parseInt(C*E.img.height/E.img.width),G=E.x,T=E.y;w.save(),w.translate(-C/2,-z/2),w.drawImage(E.img,G,T,C,z),w.restore();const M={x:G,y:T,w:C,h:z,btn:"",scene:`ind_${E.ID}`,tooltip:""};p.push(M)}const g=b.toDataURL("image/png");return b.remove(),{viz:g,areas:p}}const xt=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  box-sizing: border-box;
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 1em;
  flex-direction: column;
}

.storytitle {
  font-size: 2em;
  margin: 0.1em 0;
}

.storyp {
  font-size: 1em;
}

.storymeta-container {
  margin: 0.5em 0;
}

.storymeta-key {
  font-weight: 700;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  box-sizing: border-box;
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: #ffffff00;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: #ffffff33;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,Ot=Te(jt);function Ft(r){let e,t,n,i,s,o,a,l,d,c,u,f,h,y,N,b,w,p,g,E,C,z,G,T;return{c(){e=S("div"),t=S("input"),n=L(),i=S("div"),s=S("button"),o=F("Nuevo proyecto"),a=L(),l=S("label"),d=F("Importar"),c=L(),u=S("button"),f=F("Exportar"),h=L(),y=S("button"),N=F("Previsualizar"),b=L(),w=S("button"),p=F("Generar interactivo final"),g=L(),E=S("div"),C=S("button"),z=F("Nueva escena"),this.h()},l(M){e=I(M,"DIV",{class:!0});var B=D(e);t=I(B,"INPUT",{type:!0,id:!0}),n=P(B),i=I(B,"DIV",{class:!0});var x=D(i);s=I(x,"BUTTON",{class:!0});var Z=D(s);o=H(Z,"Nuevo proyecto"),Z.forEach(v),a=P(x),l=I(x,"LABEL",{class:!0,for:!0});var W=D(l);d=H(W,"Importar"),W.forEach(v),c=P(x),u=I(x,"BUTTON",{class:!0});var Q=D(u);f=H(Q,"Exportar"),Q.forEach(v),h=P(x),y=I(x,"BUTTON",{class:!0});var V=D(y);N=H(V,"Previsualizar"),V.forEach(v),b=P(x),w=I(x,"BUTTON",{class:!0});var se=D(w);p=H(se,"Generar interactivo final"),se.forEach(v),x.forEach(v),g=P(B),E=I(B,"DIV",{class:!0});var ie=D(E);C=I(ie,"BUTTON",{class:!0});var X=D(C);z=H(X,"Nueva escena"),X.forEach(v),ie.forEach(v),B.forEach(v),this.h()},h(){m(t,"type","file"),m(t,"id","load-input"),t.hidden=!0,m(s,"class","toolbar-button svelte-bproii"),m(l,"class","toolbar-button svelte-bproii"),m(l,"for","load-input"),m(u,"class","toolbar-button svelte-bproii"),m(y,"class","toolbar-button svelte-bproii"),m(w,"class","toolbar-button svelte-bproii"),m(i,"class","project-toolbar svelte-bproii"),m(C,"class","toolbar-button svelte-bproii"),m(E,"class","scene-toolbar svelte-bproii"),m(e,"class","toolbar svelte-bproii")},m(M,B){A(M,e,B),_(e,t),r[9](t),_(e,n),_(e,i),_(i,s),_(s,o),_(i,a),_(i,l),_(l,d),_(i,c),_(i,u),_(u,f),_(i,h),_(i,y),_(y,N),_(i,b),_(i,w),_(w,p),_(e,g),_(e,E),_(E,C),_(C,z),G||(T=[R(t,"change",r[3]),R(s,"click",r[2]),R(u,"click",r[4]),R(y,"click",r[5]),R(w,"click",r[6]),R(C,"click",r[1])],G=!0)},p:Ee,i:Ee,o:Ee,d(M){M&&v(e),r[9](null),G=!1,Ie(T)}}}function Ht(r,e,t){let n,i,s,o,a;ee(r,Pt,p=>t(10,n=p)),ee(r,Rt,p=>t(11,i=p)),ee(r,te,p=>t(12,s=p)),ee(r,Ot,p=>t(13,o=p)),ee(r,Lt,p=>t(14,a=p));let{showNewScene:l}=e,{showTest:d}=e,c;function u(){t(7,l=!0)}function f(){be(te,s={},s)}function h(){const p=c.files[0];if(p.type==="application/json"){const g=new FileReader;g.addEventListener("load",function(){be(te,s={},s);const E=g.result,C=JSON.parse(E);be(te,s=C,s)}),this.value=null,g.readAsText(p);return}else alert("Formato de archivo incorrecto / incorrect file format")}function y(){a(s,"aventuraInteractiva")}function N(){t(8,d=!0)}function b(){const p=Object.entries(s).sort((z,G)=>z[1].display.y-G[1].display.y);if(p.length===0){alert("No hay escenas / There are no scenes");return}const g=o.toString(),E=JSON.stringify(s),C=i(g,E,p[0][0]);n(C)}function w(p){le[p?"unshift":"push"](()=>{c=p,t(0,c)})}return r.$$set=p=>{"showNewScene"in p&&t(7,l=p.showNewScene),"showTest"in p&&t(8,d=p.showTest)},[c,u,f,h,y,N,b,l,d,w]}class Kt extends we{constructor(e){super(),ke(this,e,Ht,Ft,_e,{showNewScene:7,showTest:8})}}function qt(r){let e,t,n,i;const s=r[4].default,o=St(s,r,r[3],null);return{c(){e=S("div"),o&&o.c(),this.h()},l(a){e=I(a,"DIV",{class:!0});var l=D(e);o&&o.l(l),l.forEach(v),this.h()},h(){m(e,"class","scene-node-container svelte-sua7yb")},m(a,l){A(a,e,l),o&&o.m(e,null),t=!0,n||(i=Ue(r[0].call(null,e)),n=!0)},p(a,[l]){o&&o.p&&(!t||l&8)&&It(o,s,a,a[3],t?Tt(s,a[3],l,null):Ct(a[3]),null)},i(a){t||(K(o,a),t=!0)},o(a){Y(o,a),t=!1},d(a){a&&v(e),o&&o.d(a),n=!1,i()}}}function Jt(r,e,t){let{$$slots:n={},$$scope:i}=e,{scene:s}=e,{movingNode:o=!1}=e;function a(l){let d=!1;l.style.left=`${s.display.x}px`,l.style.top=`${s.display.y}px`,l.addEventListener("mousedown",()=>{d=!0,t(2,o=!0)}),window.addEventListener("mousemove",c=>{d&&(t(1,s.display.x+=c.movementX,s),t(1,s.display.y+=c.movementY,s),l.style.left=`${s.display.x}px`,l.style.top=`${s.display.y}px`)}),window.addEventListener("mouseup",()=>{d=!1,t(2,o=!1)})}return r.$$set=l=>{"scene"in l&&t(1,s=l.scene),"movingNode"in l&&t(2,o=l.movingNode),"$$scope"in l&&t(3,i=l.$$scope)},[a,s,o,i,n]}class Xt extends we{constructor(e){super(),ke(this,e,Jt,qt,_e,{scene:1,movingNode:2})}}function Yt(r){let e,t,n,i;const s=r[5].default,o=St(s,r,r[4],null);return{c(){e=S("div"),o&&o.c(),this.h()},l(a){e=I(a,"DIV",{class:!0});var l=D(e);o&&o.l(l),l.forEach(v),this.h()},h(){m(e,"class","draggui svelte-lq1cua")},m(a,l){A(a,e,l),o&&o.m(e,null),t=!0,n||(i=[Ue(r[0].call(null,e)),Ue(r[1].call(null,e)),R(e,"mousedown",me(r[6]))],n=!0)},p(a,[l]){o&&o.p&&(!t||l&16)&&It(o,s,a,a[4],t?Tt(s,a[4],l,null):Ct(a[4]),null)},i(a){t||(K(o,a),t=!0)},o(a){Y(o,a),t=!1},d(a){a&&v(e),o&&o.d(a),n=!1,Ie(i)}}}function Zt(r,e,t){let{$$slots:n={},$$scope:i}=e,{pos:s}=e,{displace:o={x:s.x,y:s.y}}=e;function a(c){c.style.left=`${o.x}px`,c.style.top=`${o.y}px`}function l(c){let u=!1;c.style.left=`${o.x}px`,c.style.top=`${o.y}px`,c.addEventListener("mousedown",()=>{u=!0}),window.addEventListener("mousemove",f=>{u&&(t(2,o.x+=f.movementX,o),t(2,o.y+=f.movementY,o),c.style.left=`${o.x}px`,c.style.top=`${o.y}px`,c.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{u=!1,c.style.cursor="grab"})}function d(c){pe.call(this,r,c)}return r.$$set=c=>{"pos"in c&&t(3,s=c.pos),"displace"in c&&t(2,o=c.displace),"$$scope"in c&&t(4,i=c.$$scope)},[a,l,o,s,i,n,d]}class He extends we{constructor(e){super(),ke(this,e,Zt,Yt,_e,{pos:3,displace:2})}}function Qt(r){let e,t,n,i,s;return{c(){e=S("div"),t=S("button"),n=F("X"),this.h()},l(o){e=I(o,"DIV",{class:!0});var a=D(e);t=I(a,"BUTTON",{class:!0});var l=D(t);n=H(l,"X"),l.forEach(v),a.forEach(v),this.h()},h(){m(t,"class","x-button"),m(e,"class","top-bar svelte-15bdkib")},m(o,a){A(o,e,a),_(e,t),_(t,n),i||(s=R(t,"click",r[0]),i=!0)},p:Ee,i:Ee,o:Ee,d(o){o&&v(e),i=!1,s()}}}function $t(r,e,t){let{toggle:n}=e;function i(){t(1,n=!1)}return r.$$set=s=>{"toggle"in s&&t(1,n=s.toggle)},[i,n]}class Ke extends we{constructor(e){super(),ke(this,e,$t,Qt,_e,{toggle:1})}}function en(r){let e,t,n,i,s,o,a,l,d,c,u,f,h,y,N;function b(p){r[6](p)}let w={};return r[0]!==void 0&&(w.toggle=r[0]),e=new Ke({props:w}),le.push(()=>ge(e,"toggle",b)),{c(){ae(e.$$.fragment),n=L(),i=S("div"),s=S("label"),o=F("Btn:"),a=L(),l=S("input"),d=L(),c=S("div"),u=S("button"),f=F("Aceptar"),this.h()},l(p){ue(e.$$.fragment,p),n=P(p),i=I(p,"DIV",{});var g=D(i);s=I(g,"LABEL",{for:!0});var E=D(s);o=H(E,"Btn:"),E.forEach(v),a=P(g),l=I(g,"INPUT",{id:!0,type:!0}),g.forEach(v),d=P(p),c=I(p,"DIV",{class:!0});var C=D(c);u=I(C,"BUTTON",{class:!0});var z=D(u);f=H(z,"Aceptar"),z.forEach(v),C.forEach(v),this.h()},h(){m(s,"for","inp"),m(l,"id","inp"),m(l,"type","text"),m(u,"class","gui-button"),m(c,"class","bar svelte-1bhrmvp")},m(p,g){ce(e,p,g),A(p,n,g),A(p,i,g),_(i,s),_(s,o),_(i,a),_(i,l),ye(l,r[2]),A(p,d,g),A(p,c,g),_(c,u),_(u,f),h=!0,y||(N=[R(l,"input",r[7]),R(l,"mousedown",me(r[5])),R(u,"click",r[3])],y=!0)},p(p,g){const E={};!t&&g&1&&(t=!0,E.toggle=p[0],ve(()=>t=!1)),e.$set(E),g&4&&l.value!==p[2]&&ye(l,p[2])},i(p){h||(K(e.$$.fragment,p),h=!0)},o(p){Y(e.$$.fragment,p),h=!1},d(p){fe(e,p),p&&v(n),p&&v(i),p&&v(d),p&&v(c),y=!1,Ie(N)}}}function tn(r){let e,t;return e=new He({props:{pos:r[1],$$slots:{default:[en]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,i){ce(e,n,i),t=!0},p(n,[i]){const s={};i&2&&(s.pos=n[1]),i&2053&&(s.$$scope={dirty:i,ctx:n}),e.$set(s)},i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function nn(r,e,t){let n,i,s;ee(r,te,y=>t(8,i=y)),ee(r,Ye,y=>t(9,s=y));let{key:o}=e,{pos:a}=e,{showNewOption:l}=e;const d=s(i[o]);function c(){i[o][d]===void 0&&be(te,i[o][d]=[],i),i[o][d].push({btn:n}),te.set(i),t(0,l=!1)}function u(y){pe.call(this,r,y)}function f(y){l=y,t(0,l)}function h(){n=this.value,t(2,n)}return r.$$set=y=>{"key"in y&&t(4,o=y.key),"pos"in y&&t(1,a=y.pos),"showNewOption"in y&&t(0,l=y.showNewOption)},t(2,n=""),[l,a,n,c,o,u,f,h]}class sn extends we{constructor(e){super(),ke(this,e,nn,tn,_e,{key:4,pos:1,showNewOption:0})}}function tt(r){let e,t,n,i;return{c(){e=S("div"),t=F(r[8]),this.h()},l(s){e=I(s,"DIV",{class:!0});var o=D(e);t=H(o,r[8]),o.forEach(v),this.h()},h(){m(e,"class","area svelte-nya92k")},m(s,o){A(s,e,o),_(e,t),r[23](e),n||(i=R(e,"mousedown",me(r[14])),n=!0)},p(s,o){o&256&&xe(t,s[8])},d(s){s&&v(e),r[23](null),n=!1,i()}}}function on(r){let e,t,n,i,s,o,a,l,d,c,u,f,h,y,N,b,w,p,g,E,C,z,G,T,M,B,x,Z,W,Q,V,se,ie,X,oe,ne,j,q,$;function re(O){r[18](O)}let k={};r[0]!==void 0&&(k.toggle=r[0]),e=new Ke({props:k}),le.push(()=>ge(e,"toggle",re));let U=r[5]&&tt(r);return{c(){ae(e.$$.fragment),n=L(),i=S("div"),s=S("h1"),o=F(r[1]),a=L(),l=S("div"),d=S("div"),c=S("h2"),u=F("Nombre de referencia"),f=L(),h=S("input"),y=L(),N=S("div"),b=S("h2"),w=F("Btn"),p=L(),g=S("input"),E=L(),C=S("div"),z=S("h2"),G=F("Tooltip"),T=L(),M=S("input"),B=L(),x=S("div"),Z=S("div"),W=S("div"),Q=S("img"),se=L(),U&&U.c(),ie=L(),X=S("div"),oe=S("button"),ne=F("Aceptar"),this.h()},l(O){ue(e.$$.fragment,O),n=P(O),i=I(O,"DIV",{});var J=D(i);s=I(J,"H1",{class:!0});var de=D(s);o=H(de,r[1]),de.forEach(v),J.forEach(v),a=P(O),l=I(O,"DIV",{class:!0});var he=D(l);d=I(he,"DIV",{class:!0});var Ne=D(d);c=I(Ne,"H2",{class:!0});var Me=D(c);u=H(Me,"Nombre de referencia"),Me.forEach(v),f=P(Ne),h=I(Ne,"INPUT",{}),Ne.forEach(v),y=P(he),N=I(he,"DIV",{class:!0});var De=D(N);b=I(De,"H2",{class:!0});var Be=D(b);w=H(Be,"Btn"),Be.forEach(v),p=P(De),g=I(De,"INPUT",{}),De.forEach(v),E=P(he),C=I(he,"DIV",{class:!0});var Ce=D(C);z=I(Ce,"H2",{class:!0});var Re=D(z);G=H(Re,"Tooltip"),Re.forEach(v),T=P(Ce),M=I(Ce,"INPUT",{}),Ce.forEach(v),he.forEach(v),B=P(O),x=I(O,"DIV",{class:!0});var je=D(x);Z=I(je,"DIV",{class:!0});var Ve=D(Z);W=I(Ve,"DIV",{class:!0});var qe=D(W);Q=I(qe,"IMG",{src:!0,alt:!0,class:!0}),se=P(qe),U&&U.l(qe),qe.forEach(v),Ve.forEach(v),je.forEach(v),ie=P(O),X=I(O,"DIV",{class:!0});var Ze=D(X);oe=I(Ze,"BUTTON",{class:!0});var Qe=D(oe);ne=H(Qe,"Aceptar"),Qe.forEach(v),Ze.forEach(v),this.h()},h(){m(s,"class","svelte-nya92k"),m(c,"class","svelte-nya92k"),m(d,"class","input"),m(b,"class","svelte-nya92k"),m(N,"class","input"),m(z,"class","svelte-nya92k"),m(C,"class","input"),m(l,"class","inputs svelte-nya92k"),We(Q.src,V=r[9][r[10]])||m(Q,"src",V),m(Q,"alt","Preview"),m(Q,"class","img-preview svelte-nya92k"),m(W,"class","area-container"),m(Z,"class","area-absolute-container svelte-nya92k"),m(x,"class","area-normal-container svelte-nya92k"),m(oe,"class","gui-button"),m(X,"class","bar")},m(O,J){ce(e,O,J),A(O,n,J),A(O,i,J),_(i,s),_(s,o),A(O,a,J),A(O,l,J),_(l,d),_(d,c),_(c,u),_(d,f),_(d,h),ye(h,r[6]),_(l,y),_(l,N),_(N,b),_(b,w),_(N,p),_(N,g),ye(g,r[8]),_(l,E),_(l,C),_(C,z),_(z,G),_(C,T),_(C,M),ye(M,r[7]),A(O,B,J),A(O,x,J),_(x,Z),_(Z,W),_(W,Q),r[22](Q),_(W,se),U&&U.m(W,null),A(O,ie,J),A(O,X,J),_(X,oe),_(oe,ne),j=!0,q||($=[R(h,"input",r[19]),R(h,"mousedown",me(r[17])),R(g,"input",r[20]),R(g,"mousedown",me(r[16])),R(M,"input",r[21]),R(M,"mousedown",me(r[15])),Ue(r[11].call(null,Q)),R(Z,"mousedown",me(r[13])),R(oe,"click",r[12])],q=!0)},p(O,J){const de={};!t&&J&1&&(t=!0,de.toggle=O[0],ve(()=>t=!1)),e.$set(de),(!j||J&2)&&xe(o,O[1]),J&64&&h.value!==O[6]&&ye(h,O[6]),J&256&&g.value!==O[8]&&ye(g,O[8]),J&128&&M.value!==O[7]&&ye(M,O[7]),O[5]?U?U.p(O,J):(U=tt(O),U.c(),U.m(W,null)):U&&(U.d(1),U=null)},i(O){j||(K(e.$$.fragment,O),j=!0)},o(O){Y(e.$$.fragment,O),j=!1},d(O){fe(e,O),O&&v(n),O&&v(i),O&&v(a),O&&v(l),O&&v(B),O&&v(x),r[22](null),U&&U.d(),O&&v(ie),O&&v(X),q=!1,Ie($)}}}function rn(r){let e,t;return e=new He({props:{pos:r[2],$$slots:{default:[on]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,i){ce(e,n,i),t=!0},p(n,[i]){const s={};i&4&&(s.pos=n[2]),i&268435963&&(s.$$scope={dirty:i,ctx:n}),e.$set(s)},i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function ln(r,e,t){let n,i,s,o,a;ee(r,te,V=>t(25,o=V)),ee(r,Dt,V=>t(26,a=V));let{key:l}=e,{pos:d}=e,{showNewArea:c}=e,u,f=o[l];const h=a(f);let y={},N,b;function w(V){let se=!1;V.addEventListener("mousedown",X=>{X.preventDefault(),se=!0,t(5,b={x1:X.offsetX,y1:X.offsetY,x2:X.offsetX,y2:X.offsetY})}),V.addEventListener("mousemove",X=>{se&&p(X)}),V.addEventListener("mouseup",X=>{ie(X)}),V.addEventListener("mouseout",X=>{ie(X)});function ie(X){if(b===void 0||!se)return;se=!1;const oe=p(X),ne={};for(let j of Object.keys(oe))ne[j]=Math.floor(oe[j]*u.naturalWidth/u.width);Object.assign(y,{...ne}),y.x=Math.floor(ne.x+ne.w/2),y.y=Math.floor(ne.y+ne.h/2)}}function p(V){t(5,b.x2=V.offsetX,b),t(5,b.y2=V.offsetY,b);const se=Math.min(b.x1,b.x2),ie=Math.max(b.x1,b.x2),X=Math.min(b.y1,b.y2),oe=Math.max(b.y1,b.y2),ne={x:se,y:X,w:ie-se,h:oe-X};return t(4,N.style.width=`${ne.w}px`,N),t(4,N.style.height=`${ne.h}px`,N),t(4,N.style.top=`${ne.y}px`,N),t(4,N.style.left=`${ne.x}px`,N),ne}function g(){if(y===void 0){alert("debes escoger un area / you must choose an area");return}Object.assign(y,{btn:n,tooltip:i,name:s}),o[l].areas===void 0&&be(te,o[l].areas=[],o),o[l].areas.push(y),te.set(o),t(0,c=!1)}function E(V){pe.call(this,r,V)}function C(V){pe.call(this,r,V)}function z(V){pe.call(this,r,V)}function G(V){pe.call(this,r,V)}function T(V){pe.call(this,r,V)}function M(V){c=V,t(0,c)}function B(){s=this.value,t(6,s)}function x(){n=this.value,t(8,n)}function Z(){i=this.value,t(7,i)}function W(V){le[V?"unshift":"push"](()=>{u=V,t(3,u)})}function Q(V){le[V?"unshift":"push"](()=>{N=V,t(4,N)})}return r.$$set=V=>{"key"in V&&t(1,l=V.key),"pos"in V&&t(2,d=V.pos),"showNewArea"in V&&t(0,c=V.showNewArea)},t(8,n=""),t(7,i=""),t(6,s="area"),[c,l,d,u,N,b,s,i,n,f,h,w,g,E,C,z,G,T,M,B,x,Z,W,Q]}class an extends we{constructor(e){super(),ke(this,e,ln,rn,_e,{key:1,pos:2,showNewArea:0})}}function un(r){let e,t,n,i,s,o,a,l,d,c,u;return{c(){e=S("input"),t=L(),n=S("label"),i=F("Cargar archivo"),s=L(),o=S("div"),a=S("img"),this.h()},l(f){e=I(f,"INPUT",{type:!0,id:!0}),t=P(f),n=I(f,"LABEL",{class:!0,for:!0});var h=D(n);i=H(h,"Cargar archivo"),h.forEach(v),s=P(f),o=I(f,"DIV",{class:!0,id:!0});var y=D(o);a=I(y,"IMG",{src:!0,alt:!0,class:!0}),y.forEach(v),this.h()},h(){m(e,"type","file"),m(e,"id","load-image"),e.hidden=!0,m(n,"class","gui-button svelte-1f4uqrr"),m(n,"for","load-image"),We(a.src,l=r[0])||m(a,"src",l),m(a,"alt","Preview"),m(a,"class",d=$e(`img-preview ${r[0]?"":"hide"}`)+" svelte-1f4uqrr"),m(o,"class","image-preview-container svelte-1f4uqrr"),m(o,"id","image-preview-container")},m(f,h){A(f,e,h),r[4](e),A(f,t,h),A(f,n,h),_(n,i),A(f,s,h),A(f,o,h),_(o,a),r[5](a),c||(u=R(e,"change",r[3]),c=!0)},p(f,[h]){h&1&&!We(a.src,l=f[0])&&m(a,"src",l),h&1&&d!==(d=$e(`img-preview ${f[0]?"":"hide"}`)+" svelte-1f4uqrr")&&m(a,"class",d)},i:Ee,o:Ee,d(f){f&&v(e),r[4](null),f&&v(t),f&&v(n),f&&v(s),f&&v(o),r[5](null),c=!1,u()}}}function cn(r,e,t){let{imageUrl:n}=e,i,s;function o(){const d=i.files[0];if(d){const c=new FileReader;c.addEventListener("load",function(){s.setAttribute("src",c.result),t(0,n=c.result)}),c.readAsDataURL(d)}}function a(d){le[d?"unshift":"push"](()=>{i=d,t(1,i)})}function l(d){le[d?"unshift":"push"](()=>{s=d,t(2,s)})}return r.$$set=d=>{"imageUrl"in d&&t(0,n=d.imageUrl)},[n,i,s,o,a,l]}class fn extends we{constructor(e){super(),ke(this,e,cn,un,_e,{imageUrl:0})}}function dn(r){let e,t,n,i,s,o,a,l,d,c,u,f,h,y,N,b,w,p,g,E,C,z,G,T,M,B,x,Z,W,Q,V,se;function ie(j){r[9](j)}let X={};r[0]!==void 0&&(X.toggle=r[0]),e=new Ke({props:X}),le.push(()=>ge(e,"toggle",ie));function oe(j){r[12](j)}let ne={};return r[3]!==void 0&&(ne.imageUrl=r[3]),T=new fn({props:ne}),le.push(()=>ge(T,"imageUrl",oe)),{c(){ae(e.$$.fragment),n=L(),i=S("div"),s=S("h1"),o=F(r[1]),a=L(),l=S("div"),d=S("h2"),c=F("Texto"),u=L(),f=S("textarea"),h=L(),y=S("div"),N=S("h2"),b=F("Imagen (opcional)"),w=L(),p=S("div"),g=S("label"),E=F("Url:"),C=L(),z=S("input"),G=F(`
      o
      `),ae(T.$$.fragment),B=L(),x=S("div"),Z=S("button"),W=F("Aceptar"),this.h()},l(j){ue(e.$$.fragment,j),n=P(j),i=I(j,"DIV",{});var q=D(i);s=I(q,"H1",{class:!0});var $=D(s);o=H($,r[1]),$.forEach(v),q.forEach(v),a=P(j),l=I(j,"DIV",{});var re=D(l);d=I(re,"H2",{class:!0});var k=D(d);c=H(k,"Texto"),k.forEach(v),u=P(re),f=I(re,"TEXTAREA",{class:!0}),D(f).forEach(v),re.forEach(v),h=P(j),y=I(j,"DIV",{});var U=D(y);N=I(U,"H2",{class:!0});var O=D(N);b=H(O,"Imagen (opcional)"),O.forEach(v),w=P(U),p=I(U,"DIV",{});var J=D(p);g=I(J,"LABEL",{for:!0});var de=D(g);E=H(de,"Url:"),de.forEach(v),C=P(J),z=I(J,"INPUT",{id:!0,type:!0}),G=H(J,`
      o
      `),ue(T.$$.fragment,J),J.forEach(v),B=P(U),x=I(U,"DIV",{class:!0});var he=D(x);Z=I(he,"BUTTON",{class:!0});var Ne=D(Z);W=H(Ne,"Aceptar"),Ne.forEach(v),he.forEach(v),U.forEach(v),this.h()},h(){m(s,"class","svelte-8prumv"),m(d,"class","no-select svelte-8prumv"),m(f,"class","svelte-8prumv"),m(N,"class","no-select svelte-8prumv"),m(g,"for","inp"),m(z,"id","inp"),m(z,"type","text"),m(Z,"class","gui-button"),m(x,"class","bar")},m(j,q){ce(e,j,q),A(j,n,q),A(j,i,q),_(i,s),_(s,o),A(j,a,q),A(j,l,q),_(l,d),_(d,c),_(l,u),_(l,f),ye(f,r[4]),A(j,h,q),A(j,y,q),_(y,N),_(N,b),_(y,w),_(y,p),_(p,g),_(g,E),_(p,C),_(p,z),ye(z,r[3]),_(p,G),ce(T,p,null),_(y,B),_(y,x),_(x,Z),_(Z,W),Q=!0,V||(se=[R(f,"input",r[10]),R(f,"mousedown",me(r[8])),R(z,"input",r[11]),R(z,"mousedown",me(r[7])),R(Z,"click",r[5])],V=!0)},p(j,q){const $={};!t&&q&1&&(t=!0,$.toggle=j[0],ve(()=>t=!1)),e.$set($),(!Q||q&2)&&xe(o,j[1]),q&16&&ye(f,j[4]),q&8&&z.value!==j[3]&&ye(z,j[3]);const re={};!M&&q&8&&(M=!0,re.imageUrl=j[3],ve(()=>M=!1)),T.$set(re)},i(j){Q||(K(e.$$.fragment,j),K(T.$$.fragment,j),Q=!0)},o(j){Y(e.$$.fragment,j),Y(T.$$.fragment,j),Q=!1},d(j){fe(e,j),j&&v(n),j&&v(i),j&&v(a),j&&v(l),j&&v(h),j&&v(y),fe(T),V=!1,Ie(se)}}}function hn(r){let e,t,n,i;return e=new He({props:{pos:r[2],$$slots:{default:[dn]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},l(s){ue(e.$$.fragment,s)},m(s,o){ce(e,s,o),t=!0,n||(i=R(window,"keydown",r[6]),n=!0)},p(s,[o]){const a={};o&4&&(a.pos=s[2]),o&65563&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i(s){t||(K(e.$$.fragment,s),t=!0)},o(s){Y(e.$$.fragment,s),t=!1},d(s){fe(e,s),n=!1,i()}}}function pn(r,e,t){let n,i;ee(r,te,g=>t(13,i=g));let{key:s}=e,{pos:o}=e,{showEditor:a}=e,l=null,d=i[s];const c=d.text===void 0&&d.texto!==void 0?"texto":"text";function u(){be(te,i[s][c]=n,i),l!==null&&be(te,i[s].image=l,i),t(0,a=!1)}function f(g){g.key==="Enter"&&u(),g.key==="Escape"&&t(0,a=!1)}function h(g){pe.call(this,r,g)}function y(g){pe.call(this,r,g)}function N(g){a=g,t(0,a)}function b(){n=this.value,t(4,n),t(14,d)}function w(){l=this.value,t(3,l)}function p(g){l=g,t(3,l)}return r.$$set=g=>{"key"in g&&t(1,s=g.key),"pos"in g&&t(2,o=g.pos),"showEditor"in g&&t(0,a=g.showEditor)},r.$$.update=()=>{r.$$.dirty&2&&be(te,i[s]=d,i)},t(4,n=d[c]),[a,s,o,l,n,u,f,h,y,N,b,w,p]}class mn extends we{constructor(e){super(),ke(this,e,pn,hn,_e,{key:1,pos:2,showEditor:0})}}function nt(r,e,t){const n=r.slice();return n[38]=e[t],n[40]=t,n}function st(r,e,t){const n=r.slice();return n[41]=e[t],n[40]=t,n}function ot(r){let e,t,n,i,s,o,a,l;return{c(){e=S("div"),t=S("img"),i=L(),s=S("button"),o=F("x"),this.h()},l(d){e=I(d,"DIV",{class:!0});var c=D(e);t=I(c,"IMG",{src:!0,alt:!0,class:!0}),i=P(c),s=I(c,"BUTTON",{class:!0});var u=D(s);o=H(u,"x"),u.forEach(v),c.forEach(v),this.h()},h(){We(t.src,n=r[6][r[13]])||m(t,"src",n),m(t,"alt","Preview"),m(t,"class","img-preview svelte-1kx7ff2"),m(s,"class","x-button image-x-button"),m(e,"class","img-preview-container svelte-1kx7ff2")},m(d,c){A(d,e,c),_(e,t),_(e,i),_(e,s),_(s,o),a||(l=R(s,"click",r[23]),a=!0)},p(d,c){c[0]&64&&!We(t.src,n=d[6][d[13]])&&m(t,"src",n)},d(d){d&&v(e),a=!1,l()}}}function it(r){let e,t,n,i,s,o,a,l,d;return{c(){e=S("div"),t=S("span"),n=F("área"),i=L(),s=S("div"),o=S("button"),a=F("+"),this.h()},l(c){e=I(c,"DIV",{});var u=D(e);t=I(u,"SPAN",{class:!0});var f=D(t);n=H(f,"área"),f.forEach(v),i=P(u),s=I(u,"DIV",{class:!0});var h=D(s);o=I(h,"BUTTON",{class:!0});var y=D(o);a=H(y,"+"),y.forEach(v),h.forEach(v),u.forEach(v),this.h()},h(){m(t,"class","btns-name svelte-1kx7ff2"),m(o,"class","svelte-1kx7ff2"),m(s,"class","node-btns-div svelte-1kx7ff2")},m(c,u){A(c,e,u),_(e,t),_(t,n),_(e,i),_(e,s),_(s,o),_(o,a),l||(d=R(o,"click",r[10]),l=!0)},p:Ee,d(c){c&&v(e),l=!1,d()}}}function rt(r,e){let t,n,i,s,o,a,l,d,c,u,f,h,y,N;return{key:r,first:null,c(){t=S("div"),n=S("input"),o=L(),a=S("button"),l=F("x"),c=L(),u=S("div"),this.h()},l(b){t=I(b,"DIV",{class:!0});var w=D(t);n=I(w,"INPUT",{type:!0,class:!0,i:!0}),o=P(w),a=I(w,"BUTTON",{class:!0,i:!0});var p=D(a);l=H(p,"x"),p.forEach(v),c=P(w),u=I(w,"DIV",{type:!0,key:!0,content:!0,class:!0,i:!0}),D(u).forEach(v),w.forEach(v),this.h()},h(){m(n,"type","text"),m(n,"class","output-text svelte-1kx7ff2"),n.value=i=e[41].btn,m(n,"i",s=e[40]),m(a,"class","x-button"),m(a,"i",d=e[40]),m(u,"type","ops"),m(u,"key",e[1]),m(u,"content",f=e[41].btn),m(u,"class","connection output option-connection svelte-1kx7ff2"),m(u,"i",h=e[40]),m(t,"class","output-container svelte-1kx7ff2"),this.first=t},m(b,w){A(b,t,w),_(t,n),_(t,o),_(t,a),_(a,l),_(t,c),_(t,u),y||(N=[Ue(e[15].call(null,n)),R(n,"change",e[14]),R(n,"mousedown",me(e[27])),R(a,"click",e[21]),R(u,"click",e[18]),R(u,"mousedown",me(e[26]))],y=!0)},p(b,w){e=b,w[0]&6&&i!==(i=e[41].btn)&&n.value!==i&&(n.value=i),w[0]&6&&s!==(s=e[40])&&m(n,"i",s),w[0]&6&&d!==(d=e[40])&&m(a,"i",d),w[0]&2&&m(u,"key",e[1]),w[0]&6&&f!==(f=e[41].btn)&&m(u,"content",f),w[0]&6&&h!==(h=e[40])&&m(u,"i",h)},d(b){b&&v(t),y=!1,Ie(N)}}}function lt(r,e){let t,n,i,s,o,a,l,d,c,u,f,h,y,N,b;return{key:r,first:null,c(){t=S("div"),n=S("input"),o=L(),a=S("button"),l=F("x"),c=L(),u=S("div"),y=L(),this.h()},l(w){t=I(w,"DIV",{class:!0});var p=D(t);n=I(p,"INPUT",{type:!0,class:!0,i:!0}),o=P(p),a=I(p,"BUTTON",{class:!0,i:!0});var g=D(a);l=H(g,"x"),g.forEach(v),c=P(p),u=I(p,"DIV",{type:!0,key:!0,content:!0,class:!0,i:!0}),D(u).forEach(v),y=P(p),p.forEach(v),this.h()},h(){m(n,"type","text"),m(n,"class","output-text svelte-1kx7ff2"),n.value=i=e[38].name,m(n,"i",s=e[40]),m(a,"class","x-button"),m(a,"i",d=e[40]),m(u,"type","areas"),m(u,"key",e[1]),m(u,"content",f=e[38].name),m(u,"class","connection output area-connection svelte-1kx7ff2"),m(u,"i",h=e[40]),m(t,"class","output-container svelte-1kx7ff2"),this.first=t},m(w,p){A(w,t,p),_(t,n),_(t,o),_(t,a),_(a,l),_(t,c),_(t,u),_(t,y),N||(b=[Ue(e[17].call(null,n)),R(n,"change",e[16]),R(n,"mousedown",me(e[25])),R(a,"click",e[22]),R(u,"click",e[18]),R(u,"mousedown",me(e[24]))],N=!0)},p(w,p){e=w,p[0]&6&&i!==(i=e[38].name)&&n.value!==i&&(n.value=i),p[0]&6&&s!==(s=e[40])&&m(n,"i",s),p[0]&6&&d!==(d=e[40])&&m(a,"i",d),p[0]&2&&m(u,"key",e[1]),p[0]&6&&f!==(f=e[38].name)&&m(u,"content",f),p[0]&6&&h!==(h=e[40])&&m(u,"i",h)},d(w){w&&v(t),N=!1,Ie(b)}}}function at(r){let e,t=[],n=new Map,i,s=[],o=new Map,a=r[2][r[1]][r[12]]||[];const l=u=>"op"+u[40];for(let u=0;u<a.length;u+=1){let f=st(r,a,u),h=l(f);n.set(h,t[u]=rt(h,f))}let d=r[2][r[1]].areas||[];const c=u=>"a"+u[40];for(let u=0;u<d.length;u+=1){let f=nt(r,d,u),h=c(f);o.set(h,s[u]=lt(h,f))}return{c(){e=S("div");for(let u=0;u<t.length;u+=1)t[u].c();i=L();for(let u=0;u<s.length;u+=1)s[u].c();this.h()},l(u){e=I(u,"DIV",{class:!0});var f=D(e);for(let h=0;h<t.length;h+=1)t[h].l(f);i=P(f);for(let h=0;h<s.length;h+=1)s[h].l(f);f.forEach(v),this.h()},h(){m(e,"class","node-outputs svelte-1kx7ff2")},m(u,f){A(u,e,f);for(let h=0;h<t.length;h+=1)t[h].m(e,null);_(e,i);for(let h=0;h<s.length;h+=1)s[h].m(e,null)},p(u,f){f[0]&2379782&&(a=u[2][u[1]][u[12]]||[],t=Ae(t,f,l,1,u,a,n,e,Fe,rt,i,st)),f[0]&4521990&&(d=u[2][u[1]].areas||[],s=Ae(s,f,c,1,u,d,o,e,Fe,lt,null,nt))},d(u){u&&v(e);for(let f=0;f<t.length;f+=1)t[f].d();for(let f=0;f<s.length;f+=1)s[f].d()}}}function gn(r){let e,t,n,i,s,o,a,l,d,c=(r[6][r[11]].length<210?r[6][r[11]]:r[6][r[11]].slice(0,210)+"...")+"",u,f,h,y,N,b,w,p,g,E,C,z,G,T,M,B,x,Z,W,Q,V,se,ie,X=r[7],oe,ne,j,q=r[6][r[13]]!==void 0&&r[6][r[13]]!==null&&ot(r),$=r[6][r[13]]!==void 0&&r[6][r[13]]!==null&&it(r),re=at(r);return{c(){e=S("div"),t=L(),n=S("h1"),i=F("Escena: "),s=F(r[1]),o=L(),q&&q.c(),a=L(),l=S("div"),d=S("p"),u=F(c),f=L(),h=S("div"),y=S("div"),N=S("span"),b=F("escena"),w=L(),p=S("div"),g=S("button"),E=F("editar"),C=L(),z=S("button"),G=F("x"),T=L(),M=S("div"),B=S("span"),x=F("btn"),Z=L(),W=S("div"),Q=S("button"),V=F("+"),se=L(),$&&$.c(),ie=L(),re.c(),oe=Se(),this.h()},l(k){e=I(k,"DIV",{class:!0}),D(e).forEach(v),t=P(k),n=I(k,"H1",{class:!0});var U=D(n);i=H(U,"Escena: "),s=H(U,r[1]),U.forEach(v),o=P(k),q&&q.l(k),a=P(k),l=I(k,"DIV",{class:!0});var O=D(l);d=I(O,"P",{class:!0});var J=D(d);u=H(J,c),J.forEach(v),O.forEach(v),f=P(k),h=I(k,"DIV",{class:!0});var de=D(h);y=I(de,"DIV",{});var he=D(y);N=I(he,"SPAN",{class:!0});var Ne=D(N);b=H(Ne,"escena"),Ne.forEach(v),w=P(he),p=I(he,"DIV",{class:!0});var Me=D(p);g=I(Me,"BUTTON",{class:!0});var De=D(g);E=H(De,"editar"),De.forEach(v),C=P(Me),z=I(Me,"BUTTON",{class:!0});var Be=D(z);G=H(Be,"x"),Be.forEach(v),Me.forEach(v),he.forEach(v),T=P(de),M=I(de,"DIV",{});var Ce=D(M);B=I(Ce,"SPAN",{class:!0});var Re=D(B);x=H(Re,"btn"),Re.forEach(v),Z=P(Ce),W=I(Ce,"DIV",{class:!0});var je=D(W);Q=I(je,"BUTTON",{class:!0});var Ve=D(Q);V=H(Ve,"+"),Ve.forEach(v),je.forEach(v),Ce.forEach(v),se=P(de),$&&$.l(de),de.forEach(v),ie=P(k),re.l(k),oe=Se(),this.h()},h(){m(e,"class","connection input svelte-1kx7ff2"),m(n,"class","svelte-1kx7ff2"),m(d,"class","text-p svelte-1kx7ff2"),m(l,"class","p-container svelte-1kx7ff2"),m(N,"class","btns-name svelte-1kx7ff2"),m(g,"class","svelte-1kx7ff2"),m(z,"class","svelte-1kx7ff2"),m(p,"class","node-btns-div svelte-1kx7ff2"),m(B,"class","btns-name svelte-1kx7ff2"),m(Q,"class","svelte-1kx7ff2"),m(W,"class","node-btns-div svelte-1kx7ff2"),m(h,"class","node-btns svelte-1kx7ff2")},m(k,U){A(k,e,U),A(k,t,U),A(k,n,U),_(n,i),_(n,s),A(k,o,U),q&&q.m(k,U),A(k,a,U),A(k,l,U),_(l,d),_(d,u),A(k,f,U),A(k,h,U),_(h,y),_(y,N),_(N,b),_(y,w),_(y,p),_(p,g),_(g,E),_(p,C),_(p,z),_(z,G),_(h,T),_(h,M),_(M,B),_(B,x),_(M,Z),_(M,W),_(W,Q),_(Q,V),_(h,se),$&&$.m(h,null),A(k,ie,U),re.m(k,U),A(k,oe,U),ne||(j=[R(e,"mousedown",me(r[28])),R(e,"click",r[19]),R(g,"click",r[8]),R(z,"click",r[20]),R(Q,"click",r[9])],ne=!0)},p(k,U){U[0]&2&&xe(s,k[1]),k[6][k[13]]!==void 0&&k[6][k[13]]!==null?q?q.p(k,U):(q=ot(k),q.c(),q.m(a.parentNode,a)):q&&(q.d(1),q=null),U[0]&64&&c!==(c=(k[6][k[11]].length<210?k[6][k[11]]:k[6][k[11]].slice(0,210)+"...")+"")&&xe(u,c),k[6][k[13]]!==void 0&&k[6][k[13]]!==null?$?$.p(k,U):($=it(k),$.c(),$.m(h,null)):$&&($.d(1),$=null),U[0]&128&&_e(X,X=k[7])?(re.d(1),re=at(k),re.c(),re.m(oe.parentNode,oe)):re.p(k,U)},d(k){k&&v(e),k&&v(t),k&&v(n),k&&v(o),q&&q.d(k),k&&v(a),k&&v(l),k&&v(f),k&&v(h),$&&$.d(),k&&v(ie),k&&v(oe),re.d(k),ne=!1,Ie(j)}}}function ut(r){let e,t,n;function i(o){r[30](o)}let s={key:r[1],pos:r[6].display};return r[3]!==void 0&&(s.showEditor=r[3]),e=new mn({props:s}),le.push(()=>ge(e,"showEditor",i)),{c(){ae(e.$$.fragment)},l(o){ue(e.$$.fragment,o)},m(o,a){ce(e,o,a),n=!0},p(o,a){const l={};a[0]&2&&(l.key=o[1]),a[0]&64&&(l.pos=o[6].display),!t&&a[0]&8&&(t=!0,l.showEditor=o[3],ve(()=>t=!1)),e.$set(l)},i(o){n||(K(e.$$.fragment,o),n=!0)},o(o){Y(e.$$.fragment,o),n=!1},d(o){fe(e,o)}}}function ct(r){let e,t,n;function i(o){r[31](o)}let s={key:r[1],pos:r[6].display};return r[4]!==void 0&&(s.showNewOption=r[4]),e=new sn({props:s}),le.push(()=>ge(e,"showNewOption",i)),{c(){ae(e.$$.fragment)},l(o){ue(e.$$.fragment,o)},m(o,a){ce(e,o,a),n=!0},p(o,a){const l={};a[0]&2&&(l.key=o[1]),a[0]&64&&(l.pos=o[6].display),!t&&a[0]&16&&(t=!0,l.showNewOption=o[4],ve(()=>t=!1)),e.$set(l)},i(o){n||(K(e.$$.fragment,o),n=!0)},o(o){Y(e.$$.fragment,o),n=!1},d(o){fe(e,o)}}}function ft(r){let e,t,n;function i(o){r[32](o)}let s={key:r[1],pos:r[6].display};return r[5]!==void 0&&(s.showNewArea=r[5]),e=new an({props:s}),le.push(()=>ge(e,"showNewArea",i)),{c(){ae(e.$$.fragment)},l(o){ue(e.$$.fragment,o)},m(o,a){ce(e,o,a),n=!0},p(o,a){const l={};a[0]&2&&(l.key=o[1]),a[0]&64&&(l.pos=o[6].display),!t&&a[0]&32&&(t=!0,l.showNewArea=o[5],ve(()=>t=!1)),e.$set(l)},i(o){n||(K(e.$$.fragment,o),n=!0)},o(o){Y(e.$$.fragment,o),n=!1},d(o){fe(e,o)}}}function vn(r){let e,t,n,i,s,o,a;function l(h){r[29](h)}let d={scene:r[6],$$slots:{default:[gn]},$$scope:{ctx:r}};r[0]!==void 0&&(d.movingNode=r[0]),e=new Xt({props:d}),le.push(()=>ge(e,"movingNode",l));let c=r[3]&&ut(r),u=r[4]&&ct(r),f=r[5]&&ft(r);return{c(){ae(e.$$.fragment),n=L(),c&&c.c(),i=L(),u&&u.c(),s=L(),f&&f.c(),o=Se()},l(h){ue(e.$$.fragment,h),n=P(h),c&&c.l(h),i=P(h),u&&u.l(h),s=P(h),f&&f.l(h),o=Se()},m(h,y){ce(e,h,y),A(h,n,y),c&&c.m(h,y),A(h,i,y),u&&u.m(h,y),A(h,s,y),f&&f.m(h,y),A(h,o,y),a=!0},p(h,y){const N={};y[0]&64&&(N.scene=h[6]),y[0]&198|y[1]&4096&&(N.$$scope={dirty:y,ctx:h}),!t&&y[0]&1&&(t=!0,N.movingNode=h[0],ve(()=>t=!1)),e.$set(N),h[3]?c?(c.p(h,y),y[0]&8&&K(c,1)):(c=ut(h),c.c(),K(c,1),c.m(i.parentNode,i)):c&&(ze(),Y(c,1,1,()=>{c=null}),Oe()),h[4]?u?(u.p(h,y),y[0]&16&&K(u,1)):(u=ct(h),u.c(),K(u,1),u.m(s.parentNode,s)):u&&(ze(),Y(u,1,1,()=>{u=null}),Oe()),h[5]?f?(f.p(h,y),y[0]&32&&K(f,1)):(f=ft(h),f.c(),K(f,1),f.m(o.parentNode,o)):f&&(ze(),Y(f,1,1,()=>{f=null}),Oe())},i(h){a||(K(e.$$.fragment,h),K(c),K(u),K(f),a=!0)},o(h){Y(e.$$.fragment,h),Y(c),Y(u),Y(f),a=!1},d(h){fe(e,h),h&&v(n),c&&c.d(h),h&&v(i),u&&u.d(h),h&&v(s),f&&f.d(h),h&&v(o)}}}function _n(r,e,t){let n,i,s,o,a,l,d;ee(r,Je,k=>t(7,n=k)),ee(r,te,k=>t(2,i=k)),ee(r,Mt,k=>t(33,s=k)),ee(r,Ye,k=>t(34,o=k)),ee(r,Ge,k=>t(35,a=k)),ee(r,Dt,k=>t(36,l=k)),ee(r,Ut,k=>t(37,d=k));let{movingNode:c=!1}=e,{key:u}=e,f=!1,h=!1,y=!1;function N(){t(3,f=!0)}function b(){t(4,h=!0)}function w(){t(5,y=!0)}let p=i[u];const g=d(p),E=o(p),C=l(p);p.display===void 0&&(p.display={x:0,y:0});function z(){G(this)}function G(k){const U=+k.getAttribute("i");k.style.width=k.value.length*6.1+"px",t(6,p[E][U].btn=k.value,p),te.set(i)}function T(){M(this)}function M(k){const U=+k.getAttribute("i");k.style.width=k.value.length*6.1+"px",t(6,p.areas[U].name=k.value,p),te.set(i)}function B(k){const U=k.target,O=+U.getAttribute("i"),J=U.getAttribute("type");if(a!==void 0&&a.key===u&&a.i===O&&a.type===J){be(Ge,a=void 0,a);const de=J==="ops"?E:"areas",he=s(p[de][O]);t(6,p[de][O][he]=void 0,p);return}be(Ge,a={key:u,i:O,type:J},a)}function x(){if(a===void 0)return;const k=i[a.key],U=a.type==="ops"?o(k):"areas",O=s(k[U][a.i]);k[U][a.i][O]=u,be(Ge,a=void 0,a)}function Z(){for(let k of Object.keys(i)){const U=o(i[k]);if(i[k][U]!==void 0){for(let O of i[k][U]){const J=s(O);O[J]===u&&(O[J]=void 0)}if(i[k].areas!==void 0)for(let O of i[k].areas){const J=s(O);O[J]===u&&(O[J]=void 0)}}}delete i[u],te.set(i)}function W(k){const O=+k.target.getAttribute("i");i[u][E].splice(O,1),te.set(i)}function Q(k){const O=+k.target.getAttribute("i");i[u].areas.splice(O,1),te.set(i)}function V(){delete i[u][C],delete i[u].areas,te.set(i),be(Je,n=!n,n)}function se(k){pe.call(this,r,k)}function ie(k){pe.call(this,r,k)}function X(k){pe.call(this,r,k)}function oe(k){pe.call(this,r,k)}function ne(k){pe.call(this,r,k)}function j(k){c=k,t(0,c)}function q(k){f=k,t(3,f)}function $(k){h=k,t(4,h)}function re(k){y=k,t(5,y)}return r.$$set=k=>{"movingNode"in k&&t(0,c=k.movingNode),"key"in k&&t(1,u=k.key)},r.$$.update=()=>{r.$$.dirty[0]&6&&t(6,p=i[u])},[c,u,i,f,h,y,p,n,N,b,w,g,E,C,z,G,T,M,B,x,Z,W,Q,V,se,ie,X,oe,ne,j,q,$,re]}class yn extends we{constructor(e){super(),ke(this,e,_n,vn,_e,{movingNode:0,key:1},null,[-1,-1])}}function dt(r,e,t){const n=r.slice();return n[13]=e[t],n[15]=t,n}function ht(r,e,t){const n=r.slice();return n[13]=e[t],n[15]=t,n}function pt(r){let e,t=[],n=new Map,i,s=[],o=new Map,a=r[0][r[2]]||[];const l=u=>"op"+u[15];for(let u=0;u<a.length;u+=1){let f=ht(r,a,u),h=l(f);n.set(h,t[u]=mt(h,f))}let d=r[0].areas||[];const c=u=>"a"+u[15];for(let u=0;u<d.length;u+=1){let f=dt(r,d,u),h=c(f);o.set(h,s[u]=gt(h,f))}return{c(){e=Le("g");for(let u=0;u<t.length;u+=1)t[u].c();i=Se();for(let u=0;u<s.length;u+=1)s[u].c()},l(u){e=Pe(u,"g",{});var f=D(e);for(let h=0;h<t.length;h+=1)t[h].l(f);i=Se();for(let h=0;h<s.length;h+=1)s[h].l(f);f.forEach(v)},m(u,f){A(u,e,f);for(let h=0;h<t.length;h+=1)t[h].m(e,null);_(e,i);for(let h=0;h<s.length;h+=1)s[h].m(e,null)},p(u,f){f&29&&(a=u[0][u[2]]||[],t=Ae(t,f,l,1,u,a,n,e,Fe,mt,i,ht)),f&25&&(d=u[0].areas||[],s=Ae(s,f,c,1,u,d,o,e,Fe,gt,null,dt))},d(u){u&&v(e);for(let f=0;f<t.length;f+=1)t[f].d();for(let f=0;f<s.length;f+=1)s[f].d()}}}function mt(r,e){let t,n,i,s,o;return{key:r,first:null,c(){t=Le("line"),this.h()},l(a){t=Pe(a,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0});var l=D(t);l.forEach(v),this.h()},h(){m(t,"class","op-connection svelte-1lsc27u"),m(t,"x1",n=e[3]("x","ops",e[15])),m(t,"y1",i=e[3]("y","ops",e[15])),m(t,"x2",s=e[4]("x","ops",e[15])),m(t,"y2",o=e[4]("y","ops",e[15])),this.first=t},m(a,l){A(a,t,l)},p(a,l){e=a,l&1&&n!==(n=e[3]("x","ops",e[15]))&&m(t,"x1",n),l&1&&i!==(i=e[3]("y","ops",e[15]))&&m(t,"y1",i),l&1&&s!==(s=e[4]("x","ops",e[15]))&&m(t,"x2",s),l&1&&o!==(o=e[4]("y","ops",e[15]))&&m(t,"y2",o)},d(a){a&&v(t)}}}function gt(r,e){let t,n,i,s,o;return{key:r,first:null,c(){t=Le("line"),this.h()},l(a){t=Pe(a,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0});var l=D(t);l.forEach(v),this.h()},h(){m(t,"class","a-connection svelte-1lsc27u"),m(t,"x1",n=e[3]("x","areas",e[15])),m(t,"y1",i=e[3]("y","areas",e[15])),m(t,"x2",s=e[4]("x","areas",e[15])),m(t,"y2",o=e[4]("y","areas",e[15])),this.first=t},m(a,l){A(a,t,l)},p(a,l){e=a,l&1&&n!==(n=e[3]("x","areas",e[15]))&&m(t,"x1",n),l&1&&i!==(i=e[3]("y","areas",e[15]))&&m(t,"y1",i),l&1&&s!==(s=e[4]("x","areas",e[15]))&&m(t,"x2",s),l&1&&o!==(o=e[4]("y","areas",e[15]))&&m(t,"y2",o)},d(a){a&&v(t)}}}function bn(r){let e,t=r[1]&&pt(r);return{c(){t&&t.c(),e=Se()},l(n){t&&t.l(n),e=Se()},m(n,i){t&&t.m(n,i),A(n,e,i)},p(n,[i]){n[1]?t?t.p(n,i):(t=pt(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ee,o:Ee,d(n){t&&t.d(n),n&&v(e)}}}function wn(r,e,t){let n,i,s,o,a;ee(r,te,b=>t(8,n=b)),ee(r,Ge,b=>t(9,i=b)),ee(r,Mt,b=>t(10,s=b)),ee(r,Je,b=>t(11,o=b)),ee(r,Ye,b=>t(12,a=b));let{key:l}=e,{pageMouse:d}=e,{movingNode:c}=e,u=n[l],f=a(u),h=!1;At(()=>{t(1,h=!0)});function y(b,w,p){u.areas!==void 0&&u[f]!==void 0&&document.querySelectorAll(`.connection[key=${l}]`).length!==u[f].length+u.areas.length&&b==="x"&&w==="areas"&&be(Je,o=!o,o);const g=document.querySelector(`[type=${w}][i="${p}"][key=${l}]`);if(!g)return n[l].display[b];const E=b==="x"?g.offsetLeft:g.offsetTop,C=b==="x"?g.offsetWidth/2:g.offsetHeight;return n[l].display[b]+E+C}function N(b,w,p){const g=w==="ops"?f:"areas",E=u[g][p],C=s(E),z=u[g][p][C];return i!==void 0&&i.key===l&&i.i===p&&i.type===w?d[b]:z===void 0?y(b,w,p):n[z].display[b]+5}return r.$$set=b=>{"key"in b&&t(5,l=b.key),"pageMouse"in b&&t(6,d=b.pageMouse),"movingNode"in b&&t(7,c=b.movingNode)},r.$$.update=()=>{r.$$.dirty&449&&(d||n||c)&&(t(0,u),t(6,d),t(8,n),t(7,c))},[u,h,f,y,N,l,d,c,n]}class kn extends we{constructor(e){super(),ke(this,e,wn,bn,_e,{key:5,pageMouse:6,movingNode:7})}}function En(r){let e,t,n,i,s,o,a,l,d,c,u,f,h,y,N;function b(p){r[8](p)}let w={};return r[0]!==void 0&&(w.toggle=r[0]),e=new Ke({props:w}),le.push(()=>ge(e,"toggle",b)),{c(){ae(e.$$.fragment),n=L(),i=S("div"),s=S("label"),o=F("Escena:"),a=L(),l=S("input"),d=L(),c=S("div"),u=S("button"),f=F("Aceptar"),this.h()},l(p){ue(e.$$.fragment,p),n=P(p),i=I(p,"DIV",{});var g=D(i);s=I(g,"LABEL",{for:!0});var E=D(s);o=H(E,"Escena:"),E.forEach(v),a=P(g),l=I(g,"INPUT",{id:!0,type:!0}),g.forEach(v),d=P(p),c=I(p,"DIV",{class:!0});var C=D(c);u=I(C,"BUTTON",{class:!0});var z=D(u);f=H(z,"Aceptar"),z.forEach(v),C.forEach(v),this.h()},h(){m(s,"for","inp"),m(l,"id","inp"),m(l,"type","text"),m(u,"class","gui-button"),m(c,"class","bar svelte-1bhrmvp")},m(p,g){ce(e,p,g),A(p,n,g),A(p,i,g),_(i,s),_(s,o),_(i,a),_(i,l),ye(l,r[2]),A(p,d,g),A(p,c,g),_(c,u),_(u,f),h=!0,y||(N=[R(l,"input",r[9]),R(l,"mousedown",me(r[7])),R(u,"click",r[4])],y=!0)},p(p,g){const E={};!t&&g&1&&(t=!0,E.toggle=p[0],ve(()=>t=!1)),e.$set(E),g&4&&l.value!==p[2]&&ye(l,p[2])},i(p){h||(K(e.$$.fragment,p),h=!0)},o(p){Y(e.$$.fragment,p),h=!1},d(p){fe(e,p),p&&v(n),p&&v(i),p&&v(d),p&&v(c),y=!1,Ie(N)}}}function Nn(r){let e,t,n,i,s;function o(l){r[10](l)}let a={pos:r[3],$$slots:{default:[En]},$$scope:{ctx:r}};return r[1]!==void 0&&(a.displace=r[1]),e=new He({props:a}),le.push(()=>ge(e,"displace",o)),{c(){ae(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,d){ce(e,l,d),n=!0,i||(s=R(window,"keydown",r[5]),i=!0)},p(l,[d]){const c={};d&8197&&(c.$$scope={dirty:d,ctx:l}),!t&&d&2&&(t=!0,c.displace=l[1],ve(()=>t=!1)),e.$set(c)},i(l){n||(K(e.$$.fragment,l),n=!0)},o(l){Y(e.$$.fragment,l),n=!1},d(l){fe(e,l),i=!1,s()}}}function Sn(r){const e=["á","é","í","ó","ú","ü","ñ"],t=["a","e","i","o","u","u","n"],n=r.toLowerCase();let i="";for(let s=0;s<r.length;s++){const o=n.charAt(s),a=r.charAt(s);if(e.includes(o)){let l;for(let d=0;d<e.length;d++)if(e[d]===o){l=d;break}a===a.toUpperCase()?i+=t[l].toUpperCase():i+=t[l]}else i+=a}return i}function In(r,e,t){let n,i;ee(r,te,b=>t(12,i=b));let{showNewScene:s}=e,{offset:o}=e,a=i,l={x:o.x*-1+50,y:o.y*-1+50},d;function c(){if(n.length<=0){alert(`Debes dar un nombre a la escena /
You must give a name to the scene`);return}if(/^\d/.test(n)===!0){alert(`El nombre de la escena no puede empezar con un número /
The name of the scene cannot start with a number`);return}let b=n.replace(/\s/gi,"_").replace(/\W/,"").replace(/[;.,:{}()<>$%&!¡?¿"'/\\#@&*+-]/gi,"");if(b=Sn(b),i[b]!==void 0){alert(`Ya existe una escena con ese nombre /
There is already a scene with that name`);return}a[b]={text:"",display:{x:l.x,y:l.y}},be(te,i[b]=a[b],i),t(0,s=!1)}function u(b){b.key==="Enter"&&c(),b.key==="Escape"&&t(0,s=!1)}function f(b){pe.call(this,r,b)}function h(b){s=b,t(0,s)}function y(){n=this.value,t(2,n)}function N(b){d=b,t(1,d)}return r.$$set=b=>{"showNewScene"in b&&t(0,s=b.showNewScene),"offset"in b&&t(6,o=b.offset)},t(2,n=""),[s,d,n,l,c,u,o,f,h,y,N]}class Cn extends we{constructor(e){super(),ke(this,e,In,Nn,_e,{showNewScene:0,offset:6})}}function vt(r,e,t){const n=r.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function _t(r,e,t){const n=r.slice();return n[17]=e[t],n}function yt(r,e,t){const n=r.slice();return n[17]=e[t],n}function bt(r,e){let t,n,i,s,o,a;function l(c){e[12](c)}let d={key:e[17]};return e[3]!==void 0&&(d.movingNode=e[3]),n=new yn({props:d}),le.push(()=>ge(n,"movingNode",l)),{key:r,first:null,c(){t=S("div"),ae(n.$$.fragment),this.h()},l(c){t=I(c,"DIV",{class:!0});var u=D(t);ue(n.$$.fragment,u),u.forEach(v),this.h()},h(){m(t,"class","scene-node-container"),this.first=t},m(c,u){A(c,t,u),ce(n,t,null),s=!0,o||(a=R(t,"mouseenter",Mn),o=!0)},p(c,u){e=c;const f={};u&32&&(f.key=e[17]),!i&&u&8&&(i=!0,f.movingNode=e[3],ve(()=>i=!1)),n.$set(f)},i(c){s||(K(n.$$.fragment,c),s=!0)},o(c){Y(n.$$.fragment,c),s=!1},d(c){c&&v(t),fe(n),o=!1,a()}}}function wt(r,e){let t,n,i;return n=new kn({props:{key:e[17],pageMouse:e[1],movingNode:e[3]}}),{key:r,first:null,c(){t=Se(),ae(n.$$.fragment),this.h()},l(s){t=Se(),ue(n.$$.fragment,s),this.h()},h(){this.first=t},m(s,o){A(s,t,o),ce(n,s,o),i=!0},p(s,o){e=s;const a={};o&32&&(a.key=e[17]),o&2&&(a.pageMouse=e[1]),o&8&&(a.movingNode=e[3]),n.$set(a)},i(s){i||(K(n.$$.fragment,s),i=!0)},o(s){Y(n.$$.fragment,s),i=!1},d(s){s&&v(t),fe(n,s)}}}function kt(r){let e,t,n;function i(o){r[13](o)}let s={offset:r[4]};return r[0]!==void 0&&(s.showNewScene=r[0]),e=new Cn({props:s}),le.push(()=>ge(e,"showNewScene",i)),{c(){ae(e.$$.fragment)},l(o){ue(e.$$.fragment,o)},m(o,a){ce(e,o,a),n=!0},p(o,a){const l={};a&16&&(l.offset=o[4]),!t&&a&1&&(t=!0,l.showNewScene=o[0],ve(()=>t=!1)),e.$set(l)},i(o){n||(K(e.$$.fragment,o),n=!0)},o(o){Y(e.$$.fragment,o),n=!1},d(o){fe(e,o)}}}function Et(r,e){let t,n,i;return{key:r,first:null,c(){t=Le("rect"),this.h()},l(s){t=Pe(s,"rect",{class:!0,x:!0,y:!0,width:!0,height:!0,fill:!0}),D(t).forEach(v),this.h()},h(){m(t,"class","minimap-rect svelte-13wv1gj"),m(t,"x",n=e[18].display.x/20),m(t,"y",i=e[18].display.y/20),m(t,"width","8"),m(t,"height","8"),m(t,"fill","green"),this.first=t},m(s,o){A(s,t,o)},p(s,o){e=s,o&4&&n!==(n=e[18].display.x/20)&&m(t,"x",n),o&4&&i!==(i=e[18].display.y/20)&&m(t,"y",i)},d(s){s&&v(t)}}}function Tn(r){let e,t=[],n=new Map,i,s,o=[],a=new Map,l,d,c,u,f=[],h=new Map,y,N,b,w=r[5];const p=T=>T[17];for(let T=0;T<w.length;T+=1){let M=yt(r,w,T),B=p(M);n.set(B,t[T]=bt(B,M))}let g=r[5];const E=T=>T[17];for(let T=0;T<g.length;T+=1){let M=_t(r,g,T),B=E(M);a.set(B,o[T]=wt(B,M))}let C=r[0]&&kt(r),z=r[2];const G=T=>T[17];for(let T=0;T<z.length;T+=1){let M=vt(r,z,T),B=G(M);h.set(B,f[T]=Et(B,M))}return{c(){e=S("div");for(let T=0;T<t.length;T+=1)t[T].c();i=L(),s=Le("svg");for(let T=0;T<o.length;T+=1)o[T].c();l=L(),C&&C.c(),d=L(),c=S("div"),u=Le("svg");for(let T=0;T<f.length;T+=1)f[T].c();this.h()},l(T){e=I(T,"DIV",{class:!0});var M=D(e);for(let W=0;W<t.length;W+=1)t[W].l(M);i=P(M),s=Pe(M,"svg",{class:!0});var B=D(s);for(let W=0;W<o.length;W+=1)o[W].l(B);B.forEach(v),l=P(M),C&&C.l(M),M.forEach(v),d=P(T),c=I(T,"DIV",{class:!0});var x=D(c);u=Pe(x,"svg",{width:!0,height:!0});var Z=D(u);for(let W=0;W<f.length;W+=1)f[W].l(Z);Z.forEach(v),x.forEach(v),this.h()},h(){m(s,"class","connections-container svelte-13wv1gj"),m(e,"class","node-page svelte-13wv1gj"),m(u,"width","100px"),m(u,"height","250px"),m(c,"class","minimap-container svelte-13wv1gj")},m(T,M){A(T,e,M);for(let B=0;B<t.length;B+=1)t[B].m(e,null);_(e,i),_(e,s);for(let B=0;B<o.length;B+=1)o[B].m(s,null);_(e,l),C&&C.m(e,null),A(T,d,M),A(T,c,M),_(c,u);for(let B=0;B<f.length;B+=1)f[B].m(u,null);y=!0,N||(b=[R(e,"mousedown",r[7]),R(e,"mouseup",r[8]),R(e,"mousemove",r[9]),R(e,"mouseleave",r[8]),R(u,"click",r[6]),R(c,"mousedown",me(r[11]))],N=!0)},p(T,[M]){M&40&&(w=T[5],ze(),t=Ae(t,M,p,1,T,w,n,e,et,bt,i,yt),Oe()),M&42&&(g=T[5],ze(),o=Ae(o,M,E,1,T,g,a,s,et,wt,null,_t),Oe()),T[0]?C?(C.p(T,M),M&1&&K(C,1)):(C=kt(T),C.c(),K(C,1),C.m(e,null)):C&&(ze(),Y(C,1,1,()=>{C=null}),Oe()),M&4&&(z=T[2],f=Ae(f,M,G,1,T,z,h,u,Fe,Et,null,vt))},i(T){if(!y){for(let M=0;M<w.length;M+=1)K(t[M]);for(let M=0;M<g.length;M+=1)K(o[M]);K(C),y=!0}},o(T){for(let M=0;M<t.length;M+=1)Y(t[M]);for(let M=0;M<o.length;M+=1)Y(o[M]);Y(C),y=!1},d(T){T&&v(e);for(let M=0;M<t.length;M+=1)t[M].d();for(let M=0;M<o.length;M+=1)o[M].d();C&&C.d(),T&&v(d),T&&v(c);for(let M=0;M<f.length;M+=1)f[M].d();N=!1,Ie(b)}}}function Mn(r){[...document.getElementsByClassName("scene-node-container")].forEach(e=>e.style.zIndex="0"),r.target.firstChild.style.zIndex="1"}function Dn(r,e,t){let n,i,s;ee(r,te,E=>t(10,s=E));let{showNewScene:o}=e,a,l={},d,c,u=!1;const f={x:0,y:0};function h(E){const C=document.querySelector(".node-page"),z=getComputedStyle(C),G=+z.width.replace("px",""),T=+z.height.replace("px",""),M=document.querySelector(".page-container"),B=getComputedStyle(M),x=+B.borderWidth.replace("px","")*2,Z=+B.width.replace("px","")-x,W=+B.height.replace("px","")-x;t(4,f.x=-E.offsetX*20+Z/2,f),t(4,f.y=-E.offsetY*20+W/2,f),t(4,f.x=f.x>0?0:-f.x>G-Z?-G+Z:f.x,f),t(4,f.y=f.y>0?0:-f.y>T-W?-T+W:f.y,f),C.style.left=`${f.x}px`,C.style.top=`${f.y}px`}function y(){u=!0,this.style.cursor="grabbing"}function N(){u=!1,this.style.cursor="grab"}function b(E){if(u&&!a){d===void 0&&(d=+getComputedStyle(this).width.replace("px","")),c===void 0&&(c=+getComputedStyle(this).height.replace("px",""));const z=+getComputedStyle(this.offsetParent).borderWidth.replace("px","")*2,G=+getComputedStyle(this.offsetParent).width.replace("px","")-z,T=+getComputedStyle(this.offsetParent).height.replace("px","")-z;t(4,f.x+=E.movementX,f),t(4,f.y+=E.movementY,f),t(4,f.x=f.x>0?0:G-f.x>d?G-d:f.x,f),t(4,f.y=f.y>0?0:T-f.y>c?T-c:f.y,f),this.style.left=`${f.x}px`,this.style.top=`${f.y}px`}t(1,l={x:E.offsetX,y:E.offsetY});let C=E.target;for(;C!==this;)t(1,l.x+=C.offsetLeft,l),t(1,l.y+=C.offsetTop,l),C=C.offsetParent}function w(E){pe.call(this,r,E)}function p(E){a=E,t(3,a)}function g(E){o=E,t(0,o)}return r.$$set=E=>{"showNewScene"in E&&t(0,o=E.showNewScene)},r.$$.update=()=>{r.$$.dirty&1024&&t(5,n=Object.keys(s)),r.$$.dirty&1024&&t(2,i=Object.entries(s)),r.$$.dirty&6&&l&&(t(2,i),t(10,s),t(1,l))},[o,l,i,a,f,n,h,y,N,b,s,w,p,g]}let zn=class extends we{constructor(e){super(),ke(this,e,Dn,Tn,_e,{showNewScene:0})}};function Nt(r){let e,t;return e=new He({props:{pos:r[2],$$slots:{default:[On]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,i){ce(e,n,i),t=!0},p(n,i){const s={};i&1026&&(s.$$scope={dirty:i,ctx:n}),e.$set(s)},i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function On(r){let e,t,n,i,s,o,a;function l(c){r[7](c)}let d={};return r[1]!==void 0&&(d.toggle=r[1]),e=new Ke({props:d}),le.push(()=>ge(e,"toggle",l)),{c(){ae(e.$$.fragment),n=L(),i=S("div"),this.h()},l(c){ue(e.$$.fragment,c),n=P(c),i=I(c,"DIV",{class:!0,id:!0}),D(i).forEach(v),this.h()},h(){m(i,"class","test-story-container svelte-1x7qk0r"),m(i,"id","test-story-container")},m(c,u){ce(e,c,u),A(c,n,u),A(c,i,u),s=!0,o||(a=Ue(r[3].call(null,i)),o=!0)},p(c,u){const f={};!t&&u&2&&(t=!0,f.toggle=c[1],ve(()=>t=!1)),e.$set(f)},i(c){s||(K(e.$$.fragment,c),s=!0)},o(c){Y(e.$$.fragment,c),s=!1},d(c){fe(e,c),c&&v(n),c&&v(i),o=!1,a()}}}function An(r){let e,t,n,i,s,o,a,l,d,c,u;function f(p){r[4](p)}function h(p){r[5](p)}let y={};r[0]!==void 0&&(y.showNewScene=r[0]),r[1]!==void 0&&(y.showTest=r[1]),t=new Kt({props:y}),le.push(()=>ge(t,"showNewScene",f)),le.push(()=>ge(t,"showTest",h));function N(p){r[6](p)}let b={};r[0]!==void 0&&(b.showNewScene=r[0]),l=new zn({props:b}),le.push(()=>ge(l,"showNewScene",N));let w=r[1]&&Nt(r);return{c(){e=S("div"),ae(t.$$.fragment),s=L(),o=S("div"),a=S("div"),ae(l.$$.fragment),c=L(),w&&w.c(),this.h()},l(p){e=I(p,"DIV",{class:!0});var g=D(e);ue(t.$$.fragment,g),s=P(g),o=I(g,"DIV",{class:!0});var E=D(o);a=I(E,"DIV",{class:!0});var C=D(a);ue(l.$$.fragment,C),C.forEach(v),E.forEach(v),c=P(g),w&&w.l(g),g.forEach(v),this.h()},h(){m(a,"class","page-container svelte-1x7qk0r"),m(o,"class","static-page-container svelte-1x7qk0r"),m(e,"class","main-window-container svelte-1x7qk0r")},m(p,g){A(p,e,g),ce(t,e,null),_(e,s),_(e,o),_(o,a),ce(l,a,null),_(e,c),w&&w.m(e,null),u=!0},p(p,[g]){const E={};!n&&g&1&&(n=!0,E.showNewScene=p[0],ve(()=>n=!1)),!i&&g&2&&(i=!0,E.showTest=p[1],ve(()=>i=!1)),t.$set(E);const C={};!d&&g&1&&(d=!0,C.showNewScene=p[0],ve(()=>d=!1)),l.$set(C),p[1]?w?(w.p(p,g),g&2&&K(w,1)):(w=Nt(p),w.c(),K(w,1),w.m(e,null)):w&&(ze(),Y(w,1,1,()=>{w=null}),Oe())},i(p){u||(K(t.$$.fragment,p),K(l.$$.fragment,p),K(w),u=!0)},o(p){Y(t.$$.fragment,p),Y(l.$$.fragment,p),Y(w),u=!1},d(p){p&&v(e),fe(t),fe(l),w&&w.d()}}}function Un(r,e,t){let n,i;ee(r,te,h=>t(8,n=h)),ee(r,Ot,h=>t(9,i=h));let s=!1,o=!1,a={x:40,y:40};function l(){console.log(n);const h=document.getElementById("storygeneraldiv");h&&h.remove();const y=new i("es",{adventureSlide:!1,typewriterSpeed:20}),N=Object.entries(n).sort((p,g)=>p[1].display.y-g[1].display.y);if(N.length===0){alert("No hay escenas / There are no scenes");return}y.setScenes(n).startAdventure(N[0][0]);const b=document.getElementById("test-story-container"),w=document.getElementById("storygeneraldiv");b.appendChild(w)}function d(h){s=h,t(0,s)}function c(h){o=h,t(1,o)}function u(h){s=h,t(0,s)}function f(h){o=h,t(1,o)}return[s,o,a,l,d,c,u,f]}class Ln extends we{constructor(e){super(),ke(this,e,Un,An,_e,{})}}function Pn(r){let e,t,n,i,s,o,a,l,d,c,u,f,h,y;return c=new Ln({}),{c(){e=S("section"),t=S("h1"),n=F("Aventura interactiva"),i=L(),s=S("p"),o=F("Un editor de historias interactivas para la librería "),a=S("a"),l=F("Aventura.js"),d=L(),ae(c.$$.fragment),u=L(),f=S("footer"),h=F("Sergio Rodríguez Gómez — 2023 — v1.0.0"),this.h()},l(N){e=I(N,"SECTION",{class:!0});var b=D(e);t=I(b,"H1",{class:!0});var w=D(t);n=H(w,"Aventura interactiva"),w.forEach(v),i=P(b),s=I(b,"P",{class:!0});var p=D(s);o=H(p,"Un editor de historias interactivas para la librería "),a=I(p,"A",{href:!0,target:!0,rel:!0,class:!0});var g=D(a);l=H(g,"Aventura.js"),g.forEach(v),p.forEach(v),d=P(b),ue(c.$$.fragment,b),u=P(b),f=I(b,"FOOTER",{class:!0});var E=D(f);h=H(E,"Sergio Rodríguez Gómez — 2023 — v1.0.0"),E.forEach(v),b.forEach(v),this.h()},h(){m(t,"class","svelte-1ekz32g"),m(a,"href","https://github.com/srsergiorodriguez/aventura/blob/master/README_es.md"),m(a,"target","_blank"),m(a,"rel","noreferrer"),m(a,"class","svelte-1ekz32g"),m(s,"class","svelte-1ekz32g"),m(f,"class","no-select svelte-1ekz32g"),m(e,"class","general no-select")},m(N,b){A(N,e,b),_(e,t),_(t,n),_(e,i),_(e,s),_(s,o),_(s,a),_(a,l),_(e,d),ce(c,e,null),_(e,u),_(e,f),_(f,h),y=!0},p:Ee,i(N){y||(K(c.$$.fragment,N),y=!0)},o(N){Y(c.$$.fragment,N),y=!1},d(N){N&&v(e),fe(c)}}}class Vn extends we{constructor(e){super(),ke(this,e,null,Pn,_e,{})}}export{Vn as default};
