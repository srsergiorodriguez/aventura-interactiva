import{S as ye,i as we,s as _e,e as S,a as B,t as q,b as I,d as T,j as R,f as H,g,A as m,l as L,k as _,K as W,n as ke,L as Te,v as ee,M as Ee,D as re,c as It,N as Ue,u as Ct,m as Tt,o as Mt,p as K,q as Y,O as pe,P as he,F as le,G as ae,H as ue,I as ce,Q as me,R as be,T as ge,U as We,r as Fe,V as $e,w as Ce,C as ze,x as Oe,W as Ae,X as Ke,z as Ut,Y as Le,Z as Pe,_ as et}from"../chunks/index.4d86df2e.js";import{w as Ye,r as De}from"../chunks/index.9d73ec15.js";const Xe=Ye(!0),Ge=Ye(void 0),te=Ye({inicio:{texto:"Érase una vez un círculo...",display:{x:40,y:40},opciones:[{btn:"dejar tranquilo",escena:"final1"},{btn:"aplastar",escena:"final2"}]},final1:{texto:"Perfecto, un final redondo",sinSalida:!0,display:{x:40,y:250}},final2:{texto:"Parece que la historia formó una elipsis",sinSalida:!0,display:{x:220,y:250}}}),Dt=De(i=>i.scene===void 0&&i.escena!==void 0?"escena":"scene"),Qe=De(i=>i.options===void 0&&i.opciones!==void 0?"opciones":"options"),Lt=De(i=>i.text===void 0&&i.texto!==void 0?"texto":"text"),zt=De(i=>i.image===void 0&&i.imagen!==void 0?"imagen":"image");function Ot(i,e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([i],{type:e})),n.setAttribute("download",t),document.body.appendChild(n),n.click(),document.body.removeChild(n)}const Pt=De((i,e)=>{Ot(JSON.stringify(i,null,2),"application/json",`${e.includes(".json")?e:e+".json"}`)}),Bt=De(i=>{Ot(i,"text/plain;charset=utf-8","index.html")}),Rt=function(i,e,t){return`
<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
  </head>
  <body>
  </body>
  <script>
    const lang = "es";
    const options = {typewriterSpeed: 20, defaultCSS: false};
  <\/script>
  <style>
    
  #storygeneraldiv {
    box-sizing: border-box;
    margin: auto;
    max-width: 600px;
    font-family: 'Courier New', Courier, monospace;
    background: white;
  }
  
  .storydiv {
    border: solid black 1px;
    width: 100%;
    display: flex;
    padding: 10px;
    flex-direction: column;
    box-sizing: border-box;
  }
  
  .storyp {
    font-size: 18px;
    min-height: 25px;
  }
  
  .storybutton-container {
    margin: auto;
  }
  
  .storybutton {
    background: white;
    box-shadow: none;
    border: solid 1px;
    margin: 0px 1em 0px 0px;
    font-size: 20px;
    font-family: 'Courier New', Courier, monospace;
    cursor: pointer;
  }
  
  .storybutton:hover {
    color: white;
    background: black;
  }
  
  .storyimage-container {
    box-sizing: content-box;
    position: relative;
    width: 100%;
    margin: auto;
  }
  
  .storyimage {
    justify-content: center;
    width: 100%;
    margin: auto;
    border-radius: 20px;
    display: block;
  }
  
  .storyimage-area {
    font-size: 14px;
    position: absolute;
    cursor: pointer;
    text-align: center;
    color: black;
    background: #ffffff00;
    border: solid 1px black;
  }
  
  .storyimage-area:hover {
    background: #ffffff33;
  }
  
  @media screen and (max-device-width: 500px) {
    #storygeneraldiv {
      max-width:100%;
    }
    .storyp {
      font-size: 7vw;
    }
    .storybutton {
      font-size: 10vw;
    }
  }
  
  </style>
  <script>
    const A = ${i}
  <\/script>
  <script>
    const scenes = ${e};
    const aventura = new A(lang, options);
    aventura.setScenes(scenes).startAdventure('${t}');
  <\/script>
</html>
`},jt=De(Rt);class Vt{constructor(e="en",t){this.lang=e==="en"||e==="es"?e:"en",this.options={typewriterSpeed:50,defaultCSS:!0,adventureContainer:void 0,adventureScroll:!1,adventureSlide:!0,evalTags:!1,igramaFormat:"png",urlWord:"URL",vizWidth:1e3,vizHeight:1e3,vizBg:"#313131",vizCol:"black",vizImageSize:50,vizLoading:!0,minigifOptions:{},sceneCallback:n=>n},t&&(this.options=Object.assign(this.options,this.setOptionsTranslations(t))),this.grammarError=!1,this.scenesError=!1,this.fijarGramatica=this.setGrammar,this.expandirGramatica=this.expandGrammar,this.probarGramatica=this.testGrammar,this.fijarEscenas=this.setScenes,this.fijarDatosEscenas=this.setDataScenes,this.iniciarAventura=this.startAdventure,this.probarEscenas=this.testScenes,this.cargarJSON=this.loadJSON,this.modeloMarkov=this.getMarkovModel,this.fijarMarkov=this.setMarkov,this.cadenaMarkov=this.markovChain,this.probarDistribucion=this.testDistribution,this.markovSeparator=/[^\S\r\n]+/i,this.fijarIgrama=this.setIgrama,this.expandirIgrama=this.expandIgrama,this.mostrarIgrama=this.showIgrama,this.textoIgrama=this.getIgramaText,this.imgsMemo={},this.storyPreload={}}setOptionsTranslations(e){const t={velocidadMaquina:"typewriterSpeed",CSSporDefecto:"defaultCSS",contenedorAventura:"adventureContainer",rolloAventura:"adventureScroll",deslizarAImagen:"adventureSlide",ejecutarEtiquetas:"evalTags",formatoIgrama:"igramaFormat",palabraUrl:"urlWord",anchoVis:"vizWidth",altoVis:"vizHeight",fondoVis:"vizBg",colorVis:"vizCol",tamanoImagenVis:"visImageSize",cargandoVis:"vizLoading",opcionesMinigif:"minigifOptions",funcionEscena:"sceneCallback"};for(let[n,r]of Object.entries(e))t[n]!==void 0&&(e[t[n]]=r,delete e[n]);return e}setGrammar(e){return this.grammar=e,this}setIgrama(e){this.igrama=e;for(let[t,n]of Object.entries(e.grammar));return this}setScenes(e){this.options.defaultCSS&&this.setCSS(),this.scenes=e;for(let t of Object.keys(e)){this.scenes[t].key=t;const n=this.scenes[t].image||this.scenes[t].imagen;n!==void 0&&this.storyPreload[n]===void 0&&(this.storyPreload[n]=new Image,this.storyPreload[n].src=n,this.storyPreload[n].className="storyimage")}return this}async setDataScenes(e,t=void 0,n=[]){if(this.options.defaultCSS&&this.setCSS(),typeof d3>"u"){console.error(this.lang==="es"?"Para crear visualizaciones debes tener también la librería D3":"To create visualizations you must have also the D3 library");return}return this.scenes=JSON.parse(JSON.stringify(e)),this.metaKeys=n,t!==void 0&&(this.data=JSON.parse(JSON.stringify(t)),await this.setViz(this.scenes,this.data)),this.setScenes(this.scenes),this}async setViz(e,t){const n=Object.keys(e),r={compare:Gt,scatter:Wt,pack:Ft};let o=0;for(let c of n)e[c].viz!==void 0&&o++;let s=0,a;const l=this.lang==="en"?"Loading...":"Cargando...";this.options.vizLoading&&(a=document.createElement("div"),a.id="storygeneraldiv",a.className="storydiv",a.textContent=l,(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(a));function d(c,u=15){let f="";for(let h=0;h<Math.ceil(u);h++)f+=h<c*u?"|":"-";return f}for(let c of n){if(e[c].viz===void 0)continue;const{filter:u,type:f,x:h,y:b}=e[c].viz;if(r[f]===void 0||h===void 0||b===void 0){const v=this.lang==="es"?`Parámetros incorrectos de visualización en la escena "${c}"`:`Incorrect parameteres in the scene "${c}"`;console.error(v)}let k=t;for(let v of u)k=this.filterFn(v)(k);let E=s;const{viz:y,areas:p}=await r[f](this,k,h,b,v=>{s=E+v/o;const w=Math.ceil(s*100);this.options.vizLoading&&(a.textContent=`${l} ${d(s)} ${w}%`)});e[c].image=y,e[c].areas=p}for(let c of t){if(c.ID===void 0){const u=this.lang==="es"?"Todos los datos deben tener un valor único con la clave ID":"All data must have a unique value with the ID key";console.error(u),this.scenes={};break}e[`ind_${c.ID}`]={text:`${c.CONT||""}`,meta:c.ID,dataScene:!0,options:[{btn:"<<<",scene:`ind_${c.ID}`}]},c.IMGURL!==void 0&&(e[`ind_${c.ID}`].image=c.IMGURL),c.URL!==void 0&&(e[`ind_${c.ID}`].url=c.URL)}a.remove()}filterFn(e){const t=e[1];if(t==="="||t==="=="||t==="===")return r=>r.filter(o=>n(o[e[0]])==n(e[2]));return t==="<"?r=>r.filter(o=>n(o[e[0]])<n(e[2])):t===">"?r=>r.filter(o=>n(o[e[0]])>n(e[2])):r=>r;function n(r){return r==="true"?!0:r==="false"?!1:r}}setMarkov(e){return this.markov=e,this}expandGrammar(e){const t=this.selectGrammarRule(this.grammar[e]);return this.grammarRuleRecursion(t)}expandIgrama(e){const t=this.igrama.grammar,n=this.selectGrammarRule(t[e]);return this.grammarRuleRecursion(n,t).split("|").map(o=>this.decodeDrawing(o))}grammarRuleRecursion(e,t){let n=t||this.grammar,r=this.setNewRules(e);const o=r.match(/<[\w\d.,/#]+>/gi);if(!o)return r;for(let s of o){const a=this.defineTransformations(s);r=r.replace(s,()=>{s=s.replace(/[<>]/gi,""),s=s.replace(/#[\w\d.,/]+#/g,"");const l=s.search(/[.]/)>-1?this.getNestedObject(n,s.match(/[\w\d]+/g)):n[s];if(!l){const c=this.lang==="es"?`Se intentó expandir desde la regla "${s}", pero no se pudo encontrar`:`Tried to expand from rule "${s}", but couldn't find it`;console.error(c)}const d=this.selectGrammarRule(l);return this.transformString(d,a)})}return this.grammarRuleRecursion(r,n)}setNewRules(e,t){let n;t===void 0?n=this.grammar:n=t;let r=e;const o=r.match(/\$[\w\d]+\$\[[\w\d:,-]+\]/ig);if(o)for(;o.length;){const s=o.pop();r=r.replace(s,"");const{symbol:a,pairsString:l}=/\$(?<symbol>[\w\d]+)\$\[(?<pairsString>[\w\d:,-]+)\]/i.exec(s).groups,d=l.match(/[-]?[\w\d]+:[\w\d]+/gi).map(c=>/(?<remove>[-]?)(?<key>[\w\d]+)[ ]?:[ ]?(?<value>[\w\d]+)/gi.exec(c).groups);if(d){n[a]=n[a]||{};for(let c of d){const u=n[c.value];if(!u){const b=this.lang==="es"?`Se intentó crear la nueva regla "${a}", pero no se pudo encontrar "${c.value}" para producir la subregla "${c.key}"`:`Tried to create new rule: "${a}", but couldn't find "${c.value}" to produce "${c.key}" subrule`;console.error(b)}const f=c.remove==="-",h=this.selectGrammarRule(u);if(f){const b=u.indexOf(h);n[c.value]=[...u.slice(0,b),...u.slice(b+1)]}n[a][c.key]=[h]}}}return r}startAdventure(e){const t=document.createElement("div");return t.id="storygeneraldiv",(this.options.adventureContainer!==void 0?document.getElementById(this.options.adventureContainer):document.body).appendChild(t),this.prevScene=e,this.goToScene(this.scenes[e]),this}goToScene(e){const t=document.getElementById("storygeneraldiv");(!this.options.adventureScroll||e.plop===!0)&&[...document.getElementsByClassName("storydiv")].map(l=>l.remove()),[...document.getElementsByClassName("storyimage-area")].map(a=>a.remove());const r=document.createElement("div");if(r.className="storydiv",t.appendChild(r),e.image||e.imagen){const a=document.createElement("div");a.className="storyimage-container",r.appendChild(a);const l=e.image||e.imagen,d=this.options.adventureScroll?this.storyPreload[l].cloneNode():this.storyPreload[l];a.appendChild(d),e.areas&&(d.complete?this.setAreas(d,a,e.areas):d.onload=()=>{this.setAreas(d,a,e.areas)})}else if(e.igrama!==void 0){const a=document.createElement("div");a.className="storyimage-container",r.appendChild(a);const l=this.expandIgrama(e.igrama);e.igramaText=this.getIgramaText(l),this.igramaDataUrl(l,this.options.igramaFormat).then(d=>{const c=new Image;c.src=d,c.className="storyimage",a.appendChild(c)})}if(e.title||e.titulo){const a=document.createElement("div");a.className="storytitle-container",r.appendChild(a);const l=document.createElement("h1");l.className="storytitle",l.textContent=e.title||e.titulo,a.appendChild(l)}if(e.meta!==void 0){const a=document.createElement("div");a.className="storymeta-container",r.appendChild(a);const l=this.data.find(d=>d.ID==e.meta);for(let d of this.metaKeys){if(l[d]===void 0)continue;const c=document.createElement("div");c.className="storymeta-subcontainer",a.appendChild(c);const u=document.createElement("span");u.className="storymeta-key",u.textContent=`${d}: `,c.appendChild(u);const f=document.createElement("span");f.className="storymeta-val",f.textContent=l[d],c.appendChild(f)}}const o=document.createElement("div");o.className="storyp-container",(e.text||e.texto||e.igramaText)&&r.appendChild(o);const s=document.createElement("p");if(s.className="storyp",s.textContent="",o.appendChild(s),e.url){const a=document.createElement("a");a.className="storyurl",a.href=e.url,a.target="_blank",a.textContent=this.options.urlWord,o.appendChild(a)}this.options.adventureSlide&&document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"}),this.typewriter(s,e),this.data&&(e.viz!==void 0?this.prevScene=e.key:e.dataScene===!0&&(e.options[0].scene=this.prevScene)),this.options.sceneCallback(e)}setAreas(e,t,n){const r=e.getBoundingClientRect(),o=t.getBoundingClientRect();window.onresize=()=>{document.getElementsByClassName("storyimage-area").length>0&&this.setAreas(e,t,n)},[...document.getElementsByClassName("storyimage-area")].map(a=>a.remove());for(let a of n){let l=document.createElement("div");l.className="storyimage-area";const d=(a.x-Math.floor(a.w/2))*r.width/e.naturalWidth;l.style.left=`${r.left-o.left+d}px`;const c=(a.y-Math.floor(a.h/2))*r.height/e.naturalHeight;l.style.top=`${r.top-o.top+c}px`,l.style.width=`${a.w*r.width/e.naturalWidth}px`,l.style.height=`${a.h*r.height/e.naturalHeight}px`,l.textContent=a.btn||"",d>0&&d<r.width&&c>0&&c<r.height&&t.appendChild(l),l.style.fontSize=`${18*r.height/e.naturalHeight}px`,l.onclick=()=>{const u=a.scene||a.escena;this.goToScene(this.scenes[u])},a.tooltip!==void 0&&(l.onmouseover=()=>{l.textContent=a.tooltip||"",l.style.zIndex="100"},l.onmouseout=()=>{l.textContent=a.btn||"",l.style.zIndex="0"})}}async typewriter(e,t){const n=t.text||t.texto||t.igramaText||"";let r=this.grammar?this.grammarRuleRecursion(n):n;if(r=r.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let o=0;await new Promise(s=>{const a=setInterval(()=>{const l=r.substring(0,o);this.options.evalTags?e.innerHTML=l:e.textContent=l,o++,o>r.length&&(clearInterval(a),s(!0))},Math.floor(this.options.typewriterSpeed))}),this.optionButtons(t)}else this.options.evalTags?e.innerHTML=r:e.textContent=r,this.optionButtons(t)}optionButtons(e){const t=[...document.getElementsByClassName("storydiv")],n=t[t.length-1];[...document.getElementsByClassName("storybutton-container")].map(s=>s.remove());const o=document.createElement("div");if(o.className="storybutton-container",n.appendChild(o),e.options||e.opciones){const s=e.options||e.opciones;for(let a of s){const l=document.createElement("button");l.className="storybutton",l.textContent=a.btn,o.appendChild(l),l.addEventListener("click",()=>{if((a.text||a.texto)===void 0){const c=a.scene||a.escena;this.goToScene(this.scenes[c])}else this.goToScene(a)})}}else if(e.scene||e.escena){const s=e.scene||e.escena,a=document.createElement("button");a.className="storybutton",a.textContent=this.lang==="en"?"Continue":"Continuar",o.appendChild(a),a.addEventListener("click",()=>{this.goToScene(this.scenes[s])})}this.options.adventureSlide&&document.getElementById("storygeneraldiv").scrollIntoView({behavior:"smooth",block:"end"})}selectGrammarRule(e){if(e.length===0)return"";if(e.prob){const r=Math.random()*e.prob.reduce((s,a)=>s+a);let o=0;for(let s=0;s<e.prob.length;s++){if(o<=r&&r<o+e.prob[s])return e[s];o+=e.prob[s]}}const t=Math.floor(Math.random()*e.length);return e[t]}getNestedObject(e,t){return t.reduce((n,r)=>n&&n[r]!==void 0?n[r]:void 0,e)}defineTransformations(e){let t={};const n=/#(?<trans>[\w\d,]+)#/gi.exec(e),r=n?n.groups.trans.match(/[\w]+/gi):[];for(let o of r)t[o]=!0;return t}transformString(e,t){let n=e;return t.CAPITALIZE&&(n=n.charAt(0).toUpperCase()+n.slice(1)),t.ALLCAPS&&(n=n.toUpperCase()),n}decodeDrawing(e){if(e==="")return[];const[t,n,r]=e.split("%%");let o={};return t==="vector"?o.content=n.split("**").map(s=>{const[a,l,d]=s.split("&"),c=[];if(c.color=a,c.weight=l,d===void 0)return c;const u=d.split(",");for(let f=0;f<u.length;f+=2)c.push([+u[f],+u[f+1]]);return c}):o.content=n,o.attribute=r,o.type=t,o}async getMarkovModel(e,t=1,n=!1){let r=await(await fetch(`./${e}`)).text();r=r.replace(/([,:.;])/g," $1").replace(/[()\¿¡!?”“—-]/g,"").toLowerCase();const o=r.split(this.markovSeparator),s={};for(let l=0;l<o.length-t;l++){let d="";for(let u=0;u<t;u++)d+=u===0?o[l+u]:" "+o[l+u];s[d]===void 0&&(s[d]={});const c=o[l+t];s[d][c]===void 0?s[d][c]=1:s[d][c]++}const a={};for(let l of Object.keys(s)){const d=Object.keys(s[l]);a[l]={probs:[],grams:d};let c=0;for(let u=0;u<d.length;u++)c+=s[l][d[u]];for(let u=0;u<d.length;u++)a[l].probs[u]=s[l][d[u]]/c}if(n){const l=e.split("/");this.saveJSON(a,`${l[l.length-1]}_markovModel_${t}N.json`)}return a}markovChain(e,t,n=.1){let r=t===void 0||this.markov[t]===void 0?this.randomMarkovWord():t,o=r;for(let a=0;a<e-1;a++){let l=this.getNextMarkov(this.markov[o]);l===void 0&&(l=this.getNextMarkov(this.randomMarkovWord()));let d=o.split(this.markovSeparator);d.push(l),d=d.slice(1).join(" "),o=d,r+=` ${l}`}return this.formatMarkov(r,n)}randomMarkovWord(){const e=Math.floor(Math.random()*Object.keys(this.markov).length);return Object.keys(this.markov)[e]}getNextMarkov(e){const t=Math.random();let n=0;if(e!==void 0)for(let r=0;r<e.probs.length;r++){if(n<=t&&t<n+e.probs[r])return e.grams[r];n+=e.probs[r]}}formatMarkov(e,t=.1){let n=e.replace(/ ([,:.;])/g,"$1");return n=n.replaceAll(/([.]) ([\wáéíóú])/ig,(r,o,s,a,l)=>Math.random()<t?`.
${s.toUpperCase()}`:`. ${s.toUpperCase()}`),n.charAt(0).toUpperCase()+n.slice(1)}async loadJSON(e){return await(await fetch(e)).json()}saveJSON(e,t){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([JSON.stringify(e,null,2)],{type:"application/json"})),n.setAttribute("download",`${t.includes(".json")?t:t+".json"}`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}testScenes(e){const t=e||this.scenes;if(!t){const r=this.lang==="es"?"No hay escenas para probar":"There are not scenes to test";console.error(r)}let n=[];for(let r of Object.keys(t)){const o=t[r];if(o.options||o.opciones){const a=(o.options||o.opciones).filter(l=>!t[l.scene||l.escena]);n=[...n,...a.map(l=>`${r} => ${l.btn} => ${l.scene||l.escena}`)]}else{if(o.deadEnd||o.sinSalida)continue;t[o.scene||o.escena]||n.push(`${r} => ${o.scene||o.escena}`)}}if(n.length>0){const r=this.lang==="es"?`Las siguientes escenas no llevan a ningún lado: ${n.join(", ")}`:`The following scenes are dead ends: ${n.join(", ")}`;console.error(r),this.scenesError=!0}return this}testGrammar(e){const t=e||this.grammar;if(!t){const n=this.lang==="es"?"No hay gramática para probar":"There is not grammar to test";console.error(n)}for(let n of Object.keys(t)){const r=t[n];for(let o of r){const s=o.match(/<([\w\d]+)>/gi),a=s?s.map(u=>u.replace(/[<>]/g,"")):[],l=o.match(/\$[\w\d]+\$\[([\w\d.,:]+)\]/gi),d=l?l.map(u=>u.match(/([ ]?:[\w\d]+)/g).map(f=>/[ ]?:(?<key>[\w\d]+)/.exec(f).groups.key)).reduce((u,f)=>[...u,...f],[]):[],c=[...a,...d].filter(u=>!t[u]);if(c.length>0){const u=this.lang==="es"?`Las siguientes reglas, que se referencian en "${n}", no existen: ${c.join(", ")}`:`The following rules, referenced in "${n}", do not exist: ${c.join(", ")}`;this.grammarError=!0,console.error(u)}}}return this}testDistribution(e){const t=e||this.markov;if(t===void 0){const d=this.lang==="es"?"No hay modelo Markov para probar":"There is not Markov model to test";console.error(d)}const n={},r={};let o=0;const s=Object.values(t);for(let d of s)for(let c of d.probs){const u=(Math.round(c/.05)*.05).toFixed(2);r[o]=u,o++,n[u]===void 0?n[u]=1:n[u]++}console.log("------------------------------------ DIST ------------------------------------");const a=Math.max(...Object.values(n)),l=Object.entries(n).sort((d,c)=>d[0]>c[0]?1:d[0]<c[0]?-1:0);for(let d of l)console.log(`${d[0]}... ${"|".repeat(Math.ceil(d[1]*100/a))}`);return console.log("------------------------------------ DIST ------------------------------------"),this}async showIgrama(e,t="png",n){const r=await this.igramaDataUrl(e,t),o=new Image;o.src=r,n==null?document.body.appendChild(o):document.getElementById(n).appendChild(o)}async igramaDataUrl(e,t="png"){const n=this.igrama.metadata.width,r=this.igrama.metadata.height;let o=document.createElement("canvas");o.width=n,o.height=r;const s=o.getContext("2d");s.lineJoin="round",s.lineCap="round",s.fillStyle=this.igrama.metadata.bg||"#FFFFFF",s.fillRect(0,0,n,r),await this.drawLayers(e,s);let a;if(t==="png")a=o.toDataURL();else if(t==="gif"){if(typeof MiniGif>"u")return console.error(this.lang==="es"?"Para crear Gifs debes tener también la librería MiniGif":"To create Gifs you must have also the MiniGif library"),"";const l={colorResolution:7,dither:!1,delay:50};Object.assign(l,this.minigifOptions);const d=new MiniGif(l);d.addFrame(o);const c=this.getLayerWiggle(e);s.fillStyle=this.igrama.metadata.bg||"#FFFFFF",s.fillRect(0,0,n,r),await this.drawLayers(c,s),d.addFrame(o);const u=d.makeGif();a="data:image/gif;base64,"+await this.base64_arraybuffer(u)}return o.remove(),a}async base64_arraybuffer(e){return(await new Promise(n=>{const r=new FileReader;r.onload=()=>n(r.result),r.readAsDataURL(new Blob([e]))})).split(",",2)[1]}getLayerWiggle(e){const n=JSON.parse(JSON.stringify(e)),r=(o,s)=>Math.floor(o+Math.random()*(s-o));for(let[o,s]of n.entries())if(s.type==="vector")for(let[a,l]of s.content.entries()){for(let[d,c]of l.entries())Math.random()<.5?c[0]+=r(-3,3):c[1]+=r(-3,3);l.color=e[o].content[a].color,l.weight=e[o].content[a].weight}return n}getIgramaText(e){return e.map(n=>n.attribute).reverse().join(" ").trim()}async drawLayers(e,t){for(let[n,r]of e.entries())if(r.type==="url"){const{w:o,h:s,x:a,y:l}=this.igrama.sections[n];if(this.imgsMemo[r.content]===void 0){const d=new Image;d.src=r.content,this.imgsMemo[r.content]=await new Promise(c=>{d.addEventListener("load",()=>{c(d)},!1)})}t.drawImage(this.imgsMemo[r.content],a,l,o,s)}else if(r.type=="vector")for(let o of r.content){if(o.length===0)continue;const s=this.getSpline(o);this.drawSpline(s,t,o.color,o.weight)}}drawSpline(e,t,n,r){t.lineWidth=r,t.strokeStyle=n,t.fillStyle="rgba(0,0,0,0)",t.beginPath();for(let o=0;o<e.length;o++)o===0?t.moveTo(...e[0]):t.lineTo(...e[o]);t.stroke()}getSpline(e){let t=[];for(let n=0;n<e.length-1;n++){const r=[];r[0]=n>0?e[n-1]:e[0],r[1]=e[n],r[2]=e[n+1],r[3]=n<e.length-2?e[n+2]:e[e.length-1];for(let o=0;o<1;o+=.05){const s=this.getSplinePoint(o,r);t.push(s)}}return t}getSplinePoint(e,t){const n=Math.floor(e)+1,r=n+1,o=r+1,s=n-1,a=e*e,l=a*e,d=-l+2*a-e,c=3*l-5*a+2,u=-3*l+4*a+e,f=l-a,h=.5*(t[s][0]*d+t[n][0]*c+t[r][0]*u+t[o][0]*f),b=.5*(t[s][1]*d+t[n][1]*c+t[r][1]*u+t[o][1]*f);return[h,b]}setCSS(){const e=document.createElement("style");e.id="adventurestyle",e.innerHTML=Kt,document.getElementsByTagName("head")[0].appendChild(e)}}async function Gt(i,e,t,n,r=()=>{}){const o=[e.find(k=>k.ID==t),e.find(k=>k.ID==n)],s=i.options.vizWidth,a=i.options.vizHeight;let l=0;const d=[];for(let k of o){const E=new Image;E.setAttribute("crossorigin","anonymous"),E.src=k.IMGURL,await new Promise(y=>{E.onload=()=>{y(!0)}}),d.push({url:k.IMGURL,img:E,ID:k.ID}),r(l/o.length),l++}const c=document.createElement("canvas"),u=c.getContext("2d");c.width=s,c.height=a,u.fillStyle=i.options.vizBg,u.fillRect(0,0,s,a);const f=[];let h=0;for(let k of d){const E=parseInt(s/2)*.1,y=parseInt(s/2)-E,p=parseInt(y*k.img.height/k.img.width),v=h*(y+E)+y/2+E/2,w=a/2;u.save(),u.translate(-y/2,-p/2),u.drawImage(k.img,v,w,y,p),u.restore();const C={x:v,y:w,w:y,h:p,btn:"",scene:`ind_${k.ID}`,tooltip:""};f.push(C),h++}const b=c.toDataURL("image/png");return c.remove(),{viz:b,areas:f}}async function Wt(i,e,t,n,r=()=>{}){const o=i.options.vizWidth,s=i.options.vizHeight,a=i.options.vizImageSize,l={l:.2*o,r:.1*o,t:.1*s,b:.1*s},d=o-l.l-l.r,c=s-l.t-l.b,u=e,f=[...new Set(u.map(O=>O[t]))],h=[...new Set(u.map(O=>O[n]))],b=d3.scalePoint().domain(f).range([0,d]).padding(.5).round(!0),k=d3.scalePoint().domain(h).range([0,c]).padding(.5).round(!0);let E=0;const y=[];for(let O of u){if(i.imgsMemo[O.IMGURL]===void 0){const V=new Image;V.setAttribute("crossorigin","anonymous"),V.src=O.IMGURL,i.imgsMemo[O.IMGURL]=await new Promise(D=>{V.onload=()=>{D(V)}})}y.push({url:O.IMGURL,x:b(O[t]),y:k(O[n]),img:i.imgsMemo[O.IMGURL],r:a,ID:O.ID}),r(E/u.length),E++}d3.forceSimulation(y).force("charge",d3.forceManyBody().strength(5)).force("collide",d3.forceCollide(10)).tick(200);const p=document.createElement("canvas"),v=p.getContext("2d");p.width=o,p.height=s,v.fillStyle=i.options.vizBg,v.fillRect(0,0,o,s),v.strokeStyle=i.options.vizCol,v.font="14px serif",v.textBaseline="middle",v.textAlign="center";for(let O of f)v.fillStyle=i.options.vizCol,v.fillText(O,l.l+b(O),l.t+c+l.b/2);v.beginPath(),v.moveTo(l.l,l.t+c),v.lineTo(l.l+d,l.t+c),v.stroke(),v.textAlign="right";for(let O of h)v.fillStyle=i.options.vizCol,v.fillText(O,l.l-5,l.t+k(O));v.beginPath(),v.moveTo(l.l,l.t),v.lineTo(l.l,l.t+c),v.stroke(),v.strokeStyle=i.options.vizCol;const w=[];for(let O of y){const V=a,D=V*O.img.height/O.img.width,N=O.x+l.l,j=O.y+l.t;v.save(),v.translate(-V/2,-D/2),v.drawImage(O.img,N,j,V,D),v.restore();const X={x:N,y:j,w:V,h:D,btn:"",scene:`ind_${O.ID}`,tooltip:""};w.push(X)}const C=p.toDataURL("image/png");return p.remove(),{viz:C,areas:w}}async function Ft(i,e,t,n,r=()=>{}){const o=i.options.vizWidth,s=i.options.vizHeight,a=e,l=d3.rollup(a,w=>w.length,w=>w[t],w=>w[n]),d=([w,C])=>C.size&&Array.from(C),c=d3.hierarchy(l,d).sum(([,w])=>w).sort((w,C)=>C.value-w.value),u=[...d3.schemeGreys[4]].reverse(),f=c.descendants(),h=w=>u[w];d3.pack(c).size([o,s]).padding(20)(c);const b=[];let k=0;for(let w of a){for(let C of c.leaves())if(w[t]===C.parent.data[0]&&w[n]===C.data[0]){if(i.imgsMemo[w.IMGURL]===void 0){const O=new Image;O.setAttribute("crossorigin","anonymous"),O.src=w.IMGURL,i.imgsMemo[w.IMGURL]=await new Promise(V=>{O.onload=()=>{V(O)}})}b.push({url:w.IMGURL,x:C.x,y:C.y,r:i.options.vizImageSize,img:i.imgsMemo[w.IMGURL],ID:w.ID})}r(k/a.length),k++}d3.forceSimulation(b).force("collide",d3.forceCollide(20)).tick(200);const E=document.createElement("canvas"),y=E.getContext("2d");E.width=o,E.height=s,y.fillStyle=i.options.vizBg,y.fillRect(0,0,o,s),y.font="12px serif",y.textBaseline="middle",y.textAlign="center";for(let w of f)y.save(),y.translate(w.x,w.y),y.strokeStyle=i.options.vizCol,y.fillStyle=h(w.depth),y.beginPath(),y.ellipse(0,0,w.r,w.r,0,0,Math.PI*2),y.fill(),y.stroke(),y.fillStyle=i.options.vizCol,y.fillText(w.depth===1||w.depth===2?w.data[0]:"",0,-w.r-5),y.restore();const p=[];for(let w of b){const C=parseInt(50),O=parseInt(C*w.img.height/w.img.width),V=w.x,D=w.y;y.save(),y.translate(-C/2,-O/2),y.drawImage(w.img,V,D,C,O),y.restore();const N={x:V,y:D,w:C,h:O,btn:"",scene:`ind_${w.ID}`,tooltip:""};p.push(N)}const v=E.toDataURL("image/png");return E.remove(),{viz:v,areas:p}}const Kt=`#storygeneraldiv {
  box-sizing: border-box;
  margin: auto;
  max-width: 600px;
  font-family: 'Courier New', Courier, monospace;
  background: white;
}

.storydiv {
  box-sizing: border-box;
  border: solid black 1px;
  width: 100%;
  display: flex;
  padding: 1em;
  flex-direction: column;
}

.storytitle {
  font-size: 2em;
  margin: 0.1em 0;
}

.storyp {
  font-size: 1em;
}

.storymeta-container {
  margin: 0.5em 0;
}

.storymeta-key {
  font-weight: 700;
}

.storybutton-container {
  margin: auto;
}

.storybutton {
  background: white;
  box-shadow: none;
  border: solid 1px;
  margin: 0px 1em 0px 0px;
  font-size: 20px;
  font-family: 'Courier New', Courier, monospace;
  cursor: pointer;
}

.storybutton:hover {
  color: white;
  background: black;
}

.storyimage-container {
  box-sizing: content-box;
  position: relative;
  width: 100%;
  margin: auto;
}

.storyimage {
  justify-content: center;
  width: 100%;
  margin: auto;
  border-radius: 20px;
  display: block;
}

.storyimage-area {
  box-sizing: border-box;
  position: absolute;
  cursor: pointer;
  text-align: center;
  color: black;
  background: #ffffff00;
  border: solid 1px black;
}

.storyimage-area:hover {
  background: #ffffff33;
}

@media screen and (max-device-width: 500px) {
  #storygeneraldiv {
    max-width:100%;
  }
  .storyp {
    font-size: 7vw;
  }
  .storybutton {
    font-size: 10vw;
  }
}
`,At=De(Vt);function qt(i){let e,t,n,r,o,s,a,l,d,c,u,f,h,b,k,E,y,p,v,w,C,O,V,D;return{c(){e=S("div"),t=S("input"),n=B(),r=S("div"),o=S("button"),s=q("Nuevo proyecto"),a=B(),l=S("label"),d=q("Importar"),c=B(),u=S("button"),f=q("Exportar"),h=B(),b=S("button"),k=q("Previsualizar"),E=B(),y=S("button"),p=q("Generar interactivo final"),v=B(),w=S("div"),C=S("button"),O=q("Nueva escena"),this.h()},l(N){e=I(N,"DIV",{class:!0});var j=T(e);t=I(j,"INPUT",{type:!0,id:!0}),n=R(j),r=I(j,"DIV",{class:!0});var X=T(r);o=I(X,"BUTTON",{class:!0});var x=T(o);s=H(x,"Nuevo proyecto"),x.forEach(g),a=R(X),l=I(X,"LABEL",{class:!0,for:!0});var F=T(l);d=H(F,"Importar"),F.forEach(g),c=R(X),u=I(X,"BUTTON",{class:!0});var $=T(u);f=H($,"Exportar"),$.forEach(g),h=R(X),b=I(X,"BUTTON",{class:!0});var G=T(b);k=H(G,"Previsualizar"),G.forEach(g),E=R(X),y=I(X,"BUTTON",{class:!0});var se=T(y);p=H(se,"Generar interactivo final"),se.forEach(g),X.forEach(g),v=R(j),w=I(j,"DIV",{class:!0});var ie=T(w);C=I(ie,"BUTTON",{class:!0});var Q=T(C);O=H(Q,"Nueva escena"),Q.forEach(g),ie.forEach(g),j.forEach(g),this.h()},h(){m(t,"type","file"),m(t,"id","load-input"),t.hidden=!0,m(o,"class","toolbar-button svelte-bproii"),m(l,"class","toolbar-button svelte-bproii"),m(l,"for","load-input"),m(u,"class","toolbar-button svelte-bproii"),m(b,"class","toolbar-button svelte-bproii"),m(y,"class","toolbar-button svelte-bproii"),m(r,"class","project-toolbar svelte-bproii"),m(C,"class","toolbar-button svelte-bproii"),m(w,"class","scene-toolbar svelte-bproii"),m(e,"class","toolbar svelte-bproii")},m(N,j){L(N,e,j),_(e,t),i[9](t),_(e,n),_(e,r),_(r,o),_(o,s),_(r,a),_(r,l),_(l,d),_(r,c),_(r,u),_(u,f),_(r,h),_(r,b),_(b,k),_(r,E),_(r,y),_(y,p),_(e,v),_(e,w),_(w,C),_(C,O),V||(D=[W(t,"change",i[3]),W(o,"click",i[2]),W(u,"click",i[4]),W(b,"click",i[5]),W(y,"click",i[6]),W(C,"click",i[1])],V=!0)},p:ke,i:ke,o:ke,d(N){N&&g(e),i[9](null),V=!1,Te(D)}}}function Ht(i,e,t){let n,r,o,s,a;ee(i,Bt,p=>t(10,n=p)),ee(i,jt,p=>t(11,r=p)),ee(i,te,p=>t(12,o=p)),ee(i,At,p=>t(13,s=p)),ee(i,Pt,p=>t(14,a=p));let{showNewScene:l}=e,{showTest:d}=e,c;function u(){t(7,l=!0)}function f(){Ee(te,o={},o)}function h(){const p=c.files[0];if(p.type==="application/json"){const v=new FileReader;v.addEventListener("load",function(){Ee(te,o={},o);const w=v.result,C=JSON.parse(w);Ee(te,o=C,o)}),this.value=null,v.readAsText(p);return}else alert("Formato de archivo incorrecto / incorrect file format")}function b(){a(o,"aventuraInteractiva")}function k(){t(8,d=!0)}function E(){const p=Object.entries(o).sort((O,V)=>O[1].display.y-V[1].display.y);if(p.length===0){alert("No hay escenas / There are no scenes");return}const v=s.toString(),w=JSON.stringify(o),C=r(v,w,p[0][0]);n(C)}function y(p){re[p?"unshift":"push"](()=>{c=p,t(0,c)})}return i.$$set=p=>{"showNewScene"in p&&t(7,l=p.showNewScene),"showTest"in p&&t(8,d=p.showTest)},[c,u,f,h,b,k,E,l,d,y]}class Jt extends ye{constructor(e){super(),we(this,e,Ht,qt,_e,{showNewScene:7,showTest:8})}}function Xt(i){let e,t,n,r;const o=i[4].default,s=It(o,i,i[3],null);return{c(){e=S("div"),s&&s.c(),this.h()},l(a){e=I(a,"DIV",{class:!0});var l=T(e);s&&s.l(l),l.forEach(g),this.h()},h(){m(e,"class","scene-node-container svelte-sua7yb")},m(a,l){L(a,e,l),s&&s.m(e,null),t=!0,n||(r=Ue(i[0].call(null,e)),n=!0)},p(a,[l]){s&&s.p&&(!t||l&8)&&Ct(s,o,a,a[3],t?Mt(o,a[3],l,null):Tt(a[3]),null)},i(a){t||(K(s,a),t=!0)},o(a){Y(s,a),t=!1},d(a){a&&g(e),s&&s.d(a),n=!1,r()}}}function Yt(i,e,t){let{$$slots:n={},$$scope:r}=e,{scene:o}=e,{movingNode:s=!1}=e;function a(l){let d=!1;l.style.left=`${o.display.x}px`,l.style.top=`${o.display.y}px`,l.addEventListener("mousedown",()=>{d=!0,t(2,s=!0)}),window.addEventListener("mousemove",c=>{d&&(t(1,o.display.x+=c.movementX,o),t(1,o.display.y+=c.movementY,o),l.style.left=`${o.display.x}px`,l.style.top=`${o.display.y}px`)}),window.addEventListener("mouseup",()=>{d=!1,t(2,s=!1)})}return i.$$set=l=>{"scene"in l&&t(1,o=l.scene),"movingNode"in l&&t(2,s=l.movingNode),"$$scope"in l&&t(3,r=l.$$scope)},[a,o,s,r,n]}class Qt extends ye{constructor(e){super(),we(this,e,Yt,Xt,_e,{scene:1,movingNode:2})}}function Zt(i){let e,t,n,r;const o=i[5].default,s=It(o,i,i[4],null);return{c(){e=S("div"),s&&s.c(),this.h()},l(a){e=I(a,"DIV",{class:!0});var l=T(e);s&&s.l(l),l.forEach(g),this.h()},h(){m(e,"class","draggui svelte-lq1cua")},m(a,l){L(a,e,l),s&&s.m(e,null),t=!0,n||(r=[Ue(i[0].call(null,e)),Ue(i[1].call(null,e)),W(e,"mousedown",pe(i[6]))],n=!0)},p(a,[l]){s&&s.p&&(!t||l&16)&&Ct(s,o,a,a[4],t?Mt(o,a[4],l,null):Tt(a[4]),null)},i(a){t||(K(s,a),t=!0)},o(a){Y(s,a),t=!1},d(a){a&&g(e),s&&s.d(a),n=!1,Te(r)}}}function xt(i,e,t){let{$$slots:n={},$$scope:r}=e,{pos:o}=e,{displace:s={x:o.x,y:o.y}}=e;function a(c){c.style.left=`${s.x}px`,c.style.top=`${s.y}px`}function l(c){let u=!1;c.style.left=`${s.x}px`,c.style.top=`${s.y}px`,c.addEventListener("mousedown",()=>{u=!0}),window.addEventListener("mousemove",f=>{u&&(t(2,s.x+=f.movementX,s),t(2,s.y+=f.movementY,s),c.style.left=`${s.x}px`,c.style.top=`${s.y}px`,c.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{u=!1,c.style.cursor="grab"})}function d(c){he.call(this,i,c)}return i.$$set=c=>{"pos"in c&&t(3,o=c.pos),"displace"in c&&t(2,s=c.displace),"$$scope"in c&&t(4,r=c.$$scope)},[a,l,s,o,r,n,d]}class qe extends ye{constructor(e){super(),we(this,e,xt,Zt,_e,{pos:3,displace:2})}}function $t(i){let e,t,n,r,o;return{c(){e=S("div"),t=S("button"),n=q("X"),this.h()},l(s){e=I(s,"DIV",{class:!0});var a=T(e);t=I(a,"BUTTON",{class:!0});var l=T(t);n=H(l,"X"),l.forEach(g),a.forEach(g),this.h()},h(){m(t,"class","x-button"),m(e,"class","top-bar svelte-15bdkib")},m(s,a){L(s,e,a),_(e,t),_(t,n),r||(o=W(t,"click",i[0]),r=!0)},p:ke,i:ke,o:ke,d(s){s&&g(e),r=!1,o()}}}function en(i,e,t){let{toggle:n}=e;function r(){t(1,n=!1)}return i.$$set=o=>{"toggle"in o&&t(1,n=o.toggle)},[r,n]}class He extends ye{constructor(e){super(),we(this,e,en,$t,_e,{toggle:1})}}function tn(i){let e,t,n,r,o,s,a,l,d,c,u,f,h,b,k;function E(p){i[6](p)}let y={};return i[0]!==void 0&&(y.toggle=i[0]),e=new He({props:y}),re.push(()=>me(e,"toggle",E)),{c(){le(e.$$.fragment),n=B(),r=S("div"),o=S("label"),s=q("Btn:"),a=B(),l=S("input"),d=B(),c=S("div"),u=S("button"),f=q("Aceptar"),this.h()},l(p){ae(e.$$.fragment,p),n=R(p),r=I(p,"DIV",{});var v=T(r);o=I(v,"LABEL",{for:!0});var w=T(o);s=H(w,"Btn:"),w.forEach(g),a=R(v),l=I(v,"INPUT",{id:!0,type:!0}),v.forEach(g),d=R(p),c=I(p,"DIV",{class:!0});var C=T(c);u=I(C,"BUTTON",{class:!0});var O=T(u);f=H(O,"Aceptar"),O.forEach(g),C.forEach(g),this.h()},h(){m(o,"for","inp"),m(l,"id","inp"),m(l,"type","text"),m(u,"class","gui-button"),m(c,"class","bar svelte-1bhrmvp")},m(p,v){ue(e,p,v),L(p,n,v),L(p,r,v),_(r,o),_(o,s),_(r,a),_(r,l),be(l,i[2]),L(p,d,v),L(p,c,v),_(c,u),_(u,f),h=!0,b||(k=[W(l,"input",i[7]),W(l,"mousedown",pe(i[5])),W(u,"click",i[3])],b=!0)},p(p,v){const w={};!t&&v&1&&(t=!0,w.toggle=p[0],ge(()=>t=!1)),e.$set(w),v&4&&l.value!==p[2]&&be(l,p[2])},i(p){h||(K(e.$$.fragment,p),h=!0)},o(p){Y(e.$$.fragment,p),h=!1},d(p){ce(e,p),p&&g(n),p&&g(r),p&&g(d),p&&g(c),b=!1,Te(k)}}}function nn(i){let e,t;return e=new qe({props:{pos:i[1],$$slots:{default:[tn]},$$scope:{ctx:i}}}),{c(){le(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){ue(e,n,r),t=!0},p(n,[r]){const o={};r&2&&(o.pos=n[1]),r&2053&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function sn(i,e,t){let n,r,o;ee(i,te,b=>t(8,r=b)),ee(i,Qe,b=>t(9,o=b));let{key:s}=e,{pos:a}=e,{showNewOption:l}=e;const d=o(r[s]);function c(){r[s][d]===void 0&&Ee(te,r[s][d]=[],r),r[s][d].push({btn:n}),te.set(r),t(0,l=!1)}function u(b){he.call(this,i,b)}function f(b){l=b,t(0,l)}function h(){n=this.value,t(2,n)}return i.$$set=b=>{"key"in b&&t(4,s=b.key),"pos"in b&&t(1,a=b.pos),"showNewOption"in b&&t(0,l=b.showNewOption)},t(2,n=""),[l,a,n,c,s,u,f,h]}class on extends ye{constructor(e){super(),we(this,e,sn,nn,_e,{key:4,pos:1,showNewOption:0})}}function tt(i){let e,t,n,r;return{c(){e=S("div"),t=q(i[8]),this.h()},l(o){e=I(o,"DIV",{class:!0});var s=T(e);t=H(s,i[8]),s.forEach(g),this.h()},h(){m(e,"class","area svelte-nya92k")},m(o,s){L(o,e,s),_(e,t),i[23](e),n||(r=W(e,"mousedown",pe(i[14])),n=!0)},p(o,s){s&256&&Fe(t,o[8])},d(o){o&&g(e),i[23](null),n=!1,r()}}}function rn(i){let e,t,n,r,o,s,a,l,d,c,u,f,h,b,k,E,y,p,v,w,C,O,V,D,N,j,X,x,F,$,G,se,ie,Q,oe,J,ve,ne,A;function M(P){i[18](P)}let z={};i[0]!==void 0&&(z.toggle=i[0]),e=new He({props:z}),re.push(()=>me(e,"toggle",M));let U=i[5]&&tt(i);return{c(){le(e.$$.fragment),n=B(),r=S("div"),o=S("h1"),s=q(i[1]),a=B(),l=S("div"),d=S("div"),c=S("h2"),u=q("Nombre de referencia"),f=B(),h=S("input"),b=B(),k=S("div"),E=S("h2"),y=q("Btn"),p=B(),v=S("input"),w=B(),C=S("div"),O=S("h2"),V=q("Tooltip"),D=B(),N=S("input"),j=B(),X=S("div"),x=S("div"),F=S("div"),$=S("img"),se=B(),U&&U.c(),ie=B(),Q=S("div"),oe=S("button"),J=q("Aceptar"),this.h()},l(P){ae(e.$$.fragment,P),n=R(P),r=I(P,"DIV",{});var Z=T(r);o=I(Z,"H1",{class:!0});var de=T(o);s=H(de,i[1]),de.forEach(g),Z.forEach(g),a=R(P),l=I(P,"DIV",{class:!0});var fe=T(l);d=I(fe,"DIV",{class:!0});var Ne=T(d);c=I(Ne,"H2",{class:!0});var Se=T(c);u=H(Se,"Nombre de referencia"),Se.forEach(g),f=R(Ne),h=I(Ne,"INPUT",{}),Ne.forEach(g),b=R(fe),k=I(fe,"DIV",{class:!0});var Ie=T(k);E=I(Ie,"H2",{class:!0});var Be=T(E);y=H(Be,"Btn"),Be.forEach(g),p=R(Ie),v=I(Ie,"INPUT",{}),Ie.forEach(g),w=R(fe),C=I(fe,"DIV",{class:!0});var Me=T(C);O=I(Me,"H2",{class:!0});var Re=T(O);V=H(Re,"Tooltip"),Re.forEach(g),D=R(Me),N=I(Me,"INPUT",{}),Me.forEach(g),fe.forEach(g),j=R(P),X=I(P,"DIV",{class:!0});var je=T(X);x=I(je,"DIV",{class:!0});var Ve=T(x);F=I(Ve,"DIV",{class:!0});var Je=T(F);$=I(Je,"IMG",{src:!0,alt:!0,class:!0}),se=R(Je),U&&U.l(Je),Je.forEach(g),Ve.forEach(g),je.forEach(g),ie=R(P),Q=I(P,"DIV",{class:!0});var Ze=T(Q);oe=I(Ze,"BUTTON",{class:!0});var xe=T(oe);J=H(xe,"Aceptar"),xe.forEach(g),Ze.forEach(g),this.h()},h(){m(o,"class","svelte-nya92k"),m(c,"class","svelte-nya92k"),m(d,"class","input"),m(E,"class","svelte-nya92k"),m(k,"class","input"),m(O,"class","svelte-nya92k"),m(C,"class","input"),m(l,"class","inputs svelte-nya92k"),We($.src,G=i[9][i[10]])||m($,"src",G),m($,"alt","Preview"),m($,"class","img-preview svelte-nya92k"),m(F,"class","area-container"),m(x,"class","area-absolute-container svelte-nya92k"),m(X,"class","area-normal-container svelte-nya92k"),m(oe,"class","gui-button"),m(Q,"class","bar")},m(P,Z){ue(e,P,Z),L(P,n,Z),L(P,r,Z),_(r,o),_(o,s),L(P,a,Z),L(P,l,Z),_(l,d),_(d,c),_(c,u),_(d,f),_(d,h),be(h,i[6]),_(l,b),_(l,k),_(k,E),_(E,y),_(k,p),_(k,v),be(v,i[8]),_(l,w),_(l,C),_(C,O),_(O,V),_(C,D),_(C,N),be(N,i[7]),L(P,j,Z),L(P,X,Z),_(X,x),_(x,F),_(F,$),i[22]($),_(F,se),U&&U.m(F,null),L(P,ie,Z),L(P,Q,Z),_(Q,oe),_(oe,J),ve=!0,ne||(A=[W(h,"input",i[19]),W(h,"mousedown",pe(i[17])),W(v,"input",i[20]),W(v,"mousedown",pe(i[16])),W(N,"input",i[21]),W(N,"mousedown",pe(i[15])),Ue(i[11].call(null,$)),W(x,"mousedown",pe(i[13])),W(oe,"click",i[12])],ne=!0)},p(P,Z){const de={};!t&&Z&1&&(t=!0,de.toggle=P[0],ge(()=>t=!1)),e.$set(de),(!ve||Z&2)&&Fe(s,P[1]),Z&64&&h.value!==P[6]&&be(h,P[6]),Z&256&&v.value!==P[8]&&be(v,P[8]),Z&128&&N.value!==P[7]&&be(N,P[7]),P[5]?U?U.p(P,Z):(U=tt(P),U.c(),U.m(F,null)):U&&(U.d(1),U=null)},i(P){ve||(K(e.$$.fragment,P),ve=!0)},o(P){Y(e.$$.fragment,P),ve=!1},d(P){ce(e,P),P&&g(n),P&&g(r),P&&g(a),P&&g(l),P&&g(j),P&&g(X),i[22](null),U&&U.d(),P&&g(ie),P&&g(Q),ne=!1,Te(A)}}}function ln(i){let e,t;return e=new qe({props:{pos:i[2],$$slots:{default:[rn]},$$scope:{ctx:i}}}),{c(){le(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){ue(e,n,r),t=!0},p(n,[r]){const o={};r&4&&(o.pos=n[2]),r&268435963&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function an(i,e,t){let n,r,o,s,a;ee(i,te,G=>t(25,s=G)),ee(i,zt,G=>t(26,a=G));let{key:l}=e,{pos:d}=e,{showNewArea:c}=e,u,f=s[l];const h=a(f);let b={},k,E;function y(G){let se=!1;G.addEventListener("mousedown",Q=>{Q.preventDefault(),se=!0,t(5,E={x1:Q.offsetX,y1:Q.offsetY,x2:Q.offsetX,y2:Q.offsetY})}),G.addEventListener("mousemove",Q=>{se&&p(Q)}),G.addEventListener("mouseup",Q=>{ie(Q)}),G.addEventListener("mouseout",Q=>{ie(Q)});function ie(Q){if(E===void 0||!se)return;se=!1;const oe=p(Q),J={};for(let ve of Object.keys(oe))J[ve]=Math.floor(oe[ve]*u.naturalWidth/u.width);Object.assign(b,{...J}),b.x=Math.floor(J.x+J.w/2),b.y=Math.floor(J.y+J.h/2)}}function p(G){t(5,E.x2=G.offsetX,E),t(5,E.y2=G.offsetY,E);const se=Math.min(E.x1,E.x2),ie=Math.max(E.x1,E.x2),Q=Math.min(E.y1,E.y2),oe=Math.max(E.y1,E.y2),J={x:se,y:Q,w:ie-se,h:oe-Q};return t(4,k.style.width=`${J.w}px`,k),t(4,k.style.height=`${J.h}px`,k),t(4,k.style.top=`${J.y}px`,k),t(4,k.style.left=`${J.x}px`,k),J}function v(){if(b===void 0){alert("debes escoger un area / you must choose an area");return}Object.assign(b,{btn:n,tooltip:r,name:o}),s[l].areas===void 0&&Ee(te,s[l].areas=[],s),s[l].areas.push(b),te.set(s),t(0,c=!1)}function w(G){he.call(this,i,G)}function C(G){he.call(this,i,G)}function O(G){he.call(this,i,G)}function V(G){he.call(this,i,G)}function D(G){he.call(this,i,G)}function N(G){c=G,t(0,c)}function j(){o=this.value,t(6,o)}function X(){n=this.value,t(8,n)}function x(){r=this.value,t(7,r)}function F(G){re[G?"unshift":"push"](()=>{u=G,t(3,u)})}function $(G){re[G?"unshift":"push"](()=>{k=G,t(4,k)})}return i.$$set=G=>{"key"in G&&t(1,l=G.key),"pos"in G&&t(2,d=G.pos),"showNewArea"in G&&t(0,c=G.showNewArea)},t(8,n=""),t(7,r=""),t(6,o="area"),[c,l,d,u,k,E,o,r,n,f,h,y,v,w,C,O,V,D,N,j,X,x,F,$]}class un extends ye{constructor(e){super(),we(this,e,an,ln,_e,{key:1,pos:2,showNewArea:0})}}function cn(i){let e,t,n,r,o,s,a,l,d,c,u;return{c(){e=S("input"),t=B(),n=S("label"),r=q("Cargar archivo"),o=B(),s=S("div"),a=S("img"),this.h()},l(f){e=I(f,"INPUT",{type:!0,id:!0}),t=R(f),n=I(f,"LABEL",{class:!0,for:!0});var h=T(n);r=H(h,"Cargar archivo"),h.forEach(g),o=R(f),s=I(f,"DIV",{class:!0,id:!0});var b=T(s);a=I(b,"IMG",{src:!0,alt:!0,class:!0}),b.forEach(g),this.h()},h(){m(e,"type","file"),m(e,"id","load-image"),e.hidden=!0,m(n,"class","gui-button svelte-1f4uqrr"),m(n,"for","load-image"),We(a.src,l=i[1])||m(a,"src",l),m(a,"alt","Preview"),m(a,"class",d=$e(`img-preview ${i[0]||i[1]?"":"hide"}`)+" svelte-1f4uqrr"),m(s,"class","image-preview-container svelte-1f4uqrr"),m(s,"id","image-preview-container")},m(f,h){L(f,e,h),i[5](e),L(f,t,h),L(f,n,h),_(n,r),L(f,o,h),L(f,s,h),_(s,a),i[6](a),c||(u=W(e,"change",i[4]),c=!0)},p(f,[h]){h&2&&!We(a.src,l=f[1])&&m(a,"src",l),h&3&&d!==(d=$e(`img-preview ${f[0]||f[1]?"":"hide"}`)+" svelte-1f4uqrr")&&m(a,"class",d)},i:ke,o:ke,d(f){f&&g(e),i[5](null),f&&g(t),f&&g(n),f&&g(o),f&&g(s),i[6](null),c=!1,u()}}}function fn(i,e,t){let{imageUrl:n}=e,{preview:r}=e,o,s;function a(){const c=o.files[0];if(c){const u=new FileReader;u.addEventListener("load",function(){s.setAttribute("src",u.result),t(0,n=u.result)}),u.readAsDataURL(c)}}function l(c){re[c?"unshift":"push"](()=>{o=c,t(2,o)})}function d(c){re[c?"unshift":"push"](()=>{s=c,t(3,s)})}return i.$$set=c=>{"imageUrl"in c&&t(0,n=c.imageUrl),"preview"in c&&t(1,r=c.preview)},[n,r,o,s,a,l,d]}class dn extends ye{constructor(e){super(),we(this,e,fn,cn,_e,{imageUrl:0,preview:1})}}function nt(i){let e,t,n,r;return{c(){e=S("button"),t=q("Quitar"),this.h()},l(o){e=I(o,"BUTTON",{class:!0});var s=T(e);t=H(s,"Quitar"),s.forEach(g),this.h()},h(){m(e,"class","gui-button")},m(o,s){L(o,e,s),_(e,t),n||(r=W(e,"click",i[7]),n=!0)},p:ke,d(o){o&&g(e),n=!1,r()}}}function hn(i){let e,t,n,r,o,s,a,l,d,c,u,f,h,b,k,E,y,p,v,w,C,O,V,D,N,j,X,x,F,$,G,se,ie;function Q(A){i[10](A)}let oe={};i[0]!==void 0&&(oe.toggle=i[0]),e=new He({props:oe}),re.push(()=>me(e,"toggle",Q));let J=i[5][i[1]].image&&nt(i);function ve(A){i[13](A)}let ne={preview:i[5][i[1]].image};return i[3]!==void 0&&(ne.imageUrl=i[3]),N=new dn({props:ne}),re.push(()=>me(N,"imageUrl",ve)),{c(){le(e.$$.fragment),n=B(),r=S("div"),o=S("h1"),s=q(i[1]),a=B(),l=S("div"),d=S("h2"),c=q("Texto"),u=B(),f=S("textarea"),h=B(),b=S("div"),k=S("h2"),E=q("Imagen (opcional)"),y=B(),p=S("div"),J&&J.c(),v=B(),w=S("label"),C=q("Url:"),O=B(),V=S("input"),D=B(),le(N.$$.fragment),X=B(),x=S("div"),F=S("button"),$=q("Aceptar"),this.h()},l(A){ae(e.$$.fragment,A),n=R(A),r=I(A,"DIV",{});var M=T(r);o=I(M,"H1",{class:!0});var z=T(o);s=H(z,i[1]),z.forEach(g),M.forEach(g),a=R(A),l=I(A,"DIV",{});var U=T(l);d=I(U,"H2",{class:!0});var P=T(d);c=H(P,"Texto"),P.forEach(g),u=R(U),f=I(U,"TEXTAREA",{class:!0}),T(f).forEach(g),U.forEach(g),h=R(A),b=I(A,"DIV",{});var Z=T(b);k=I(Z,"H2",{class:!0});var de=T(k);E=H(de,"Imagen (opcional)"),de.forEach(g),y=R(Z),p=I(Z,"DIV",{});var fe=T(p);J&&J.l(fe),v=R(fe),w=I(fe,"LABEL",{for:!0});var Ne=T(w);C=H(Ne,"Url:"),Ne.forEach(g),O=R(fe),V=I(fe,"INPUT",{id:!0,type:!0}),D=R(fe),ae(N.$$.fragment,fe),fe.forEach(g),X=R(Z),x=I(Z,"DIV",{class:!0});var Se=T(x);F=I(Se,"BUTTON",{class:!0});var Ie=T(F);$=H(Ie,"Aceptar"),Ie.forEach(g),Se.forEach(g),Z.forEach(g),this.h()},h(){m(o,"class","svelte-1b2cvxk"),m(d,"class","no-select svelte-1b2cvxk"),m(f,"class","svelte-1b2cvxk"),m(k,"class","no-select svelte-1b2cvxk"),m(w,"for","inp"),m(V,"id","inp"),m(V,"type","text"),m(F,"class","gui-button"),m(x,"class","bar")},m(A,M){ue(e,A,M),L(A,n,M),L(A,r,M),_(r,o),_(o,s),L(A,a,M),L(A,l,M),_(l,d),_(d,c),_(l,u),_(l,f),be(f,i[4]),L(A,h,M),L(A,b,M),_(b,k),_(k,E),_(b,y),_(b,p),J&&J.m(p,null),_(p,v),_(p,w),_(w,C),_(p,O),_(p,V),be(V,i[3]),_(p,D),ue(N,p,null),_(b,X),_(b,x),_(x,F),_(F,$),G=!0,se||(ie=[W(f,"input",i[11]),W(f,"mousedown",pe(i[9])),W(V,"input",i[12]),W(V,"mousedown",pe(i[8])),W(F,"click",i[6])],se=!0)},p(A,M){const z={};!t&&M&1&&(t=!0,z.toggle=A[0],ge(()=>t=!1)),e.$set(z),(!G||M&2)&&Fe(s,A[1]),M&16&&be(f,A[4]),A[5][A[1]].image?J?J.p(A,M):(J=nt(A),J.c(),J.m(p,v)):J&&(J.d(1),J=null),M&8&&V.value!==A[3]&&be(V,A[3]);const U={};M&34&&(U.preview=A[5][A[1]].image),!j&&M&8&&(j=!0,U.imageUrl=A[3],ge(()=>j=!1)),N.$set(U)},i(A){G||(K(e.$$.fragment,A),K(N.$$.fragment,A),G=!0)},o(A){Y(e.$$.fragment,A),Y(N.$$.fragment,A),G=!1},d(A){ce(e,A),A&&g(n),A&&g(r),A&&g(a),A&&g(l),A&&g(h),A&&g(b),J&&J.d(),ce(N),se=!1,Te(ie)}}}function pn(i){let e,t;return e=new qe({props:{pos:i[2],$$slots:{default:[hn]},$$scope:{ctx:i}}}),{c(){le(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){ue(e,n,r),t=!0},p(n,[r]){const o={};r&4&&(o.pos=n[2]),r&65595&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function mn(i,e,t){let n,r;ee(i,te,v=>t(5,r=v));let{key:o}=e,{pos:s}=e,{showEditor:a}=e,l=null,d=r[o];const c=d.text===void 0&&d.texto!==void 0?"texto":"text";function u(){Ee(te,r[o][c]=n,r),l!==null&&Ee(te,r[o].image=l,r),t(0,a=!1)}function f(){delete r[o].image,delete r[o].areas,t(3,l=null),te.set(r)}function h(v){he.call(this,i,v)}function b(v){he.call(this,i,v)}function k(v){a=v,t(0,a)}function E(){n=this.value,t(4,n),t(14,d)}function y(){l=this.value,t(3,l)}function p(v){l=v,t(3,l)}return i.$$set=v=>{"key"in v&&t(1,o=v.key),"pos"in v&&t(2,s=v.pos),"showEditor"in v&&t(0,a=v.showEditor)},i.$$.update=()=>{i.$$.dirty&2&&Ee(te,r[o]=d,r)},t(4,n=d[c]),[a,o,s,l,n,r,u,f,h,b,k,E,y,p]}class gn extends ye{constructor(e){super(),we(this,e,mn,pn,_e,{key:1,pos:2,showEditor:0})}}function st(i,e,t){const n=i.slice();return n[37]=e[t],n[39]=t,n}function ot(i,e,t){const n=i.slice();return n[40]=e[t],n[39]=t,n}function it(i){let e,t,n;return{c(){e=S("div"),t=S("img"),this.h()},l(r){e=I(r,"DIV",{class:!0});var o=T(e);t=I(o,"IMG",{src:!0,alt:!0,class:!0}),o.forEach(g),this.h()},h(){We(t.src,n=i[6][i[13]])||m(t,"src",n),m(t,"alt","Preview"),m(t,"class","img-preview svelte-1r55f5w"),m(e,"class","img-preview-container svelte-1r55f5w")},m(r,o){L(r,e,o),_(e,t)},p(r,o){o[0]&64&&!We(t.src,n=r[6][r[13]])&&m(t,"src",n)},d(r){r&&g(e)}}}function rt(i){let e,t,n,r,o,s,a,l,d;return{c(){e=S("div"),t=S("span"),n=q("área"),r=B(),o=S("div"),s=S("button"),a=q("+"),this.h()},l(c){e=I(c,"DIV",{});var u=T(e);t=I(u,"SPAN",{class:!0});var f=T(t);n=H(f,"área"),f.forEach(g),r=R(u),o=I(u,"DIV",{class:!0});var h=T(o);s=I(h,"BUTTON",{class:!0});var b=T(s);a=H(b,"+"),b.forEach(g),h.forEach(g),u.forEach(g),this.h()},h(){m(t,"class","btns-name svelte-1r55f5w"),m(s,"class","svelte-1r55f5w"),m(o,"class","node-btns-div svelte-1r55f5w")},m(c,u){L(c,e,u),_(e,t),_(t,n),_(e,r),_(e,o),_(o,s),_(s,a),l||(d=W(s,"click",i[10]),l=!0)},p:ke,d(c){c&&g(e),l=!1,d()}}}function lt(i,e){let t,n,r,o,s,a,l,d,c,u,f,h,b,k;return{key:i,first:null,c(){t=S("div"),n=S("input"),s=B(),a=S("button"),l=q("x"),c=B(),u=S("div"),this.h()},l(E){t=I(E,"DIV",{class:!0});var y=T(t);n=I(y,"INPUT",{type:!0,class:!0,i:!0}),s=R(y),a=I(y,"BUTTON",{class:!0,i:!0});var p=T(a);l=H(p,"x"),p.forEach(g),c=R(y),u=I(y,"DIV",{type:!0,key:!0,content:!0,class:!0,i:!0}),T(u).forEach(g),y.forEach(g),this.h()},h(){m(n,"type","text"),m(n,"class","output-text svelte-1r55f5w"),n.value=r=e[40].btn,m(n,"i",o=e[39]),m(a,"class","x-button"),m(a,"i",d=e[39]),m(u,"type","ops"),m(u,"key",e[1]),m(u,"content",f=e[40].btn),m(u,"class","connection output option-connection svelte-1r55f5w"),m(u,"i",h=e[39]),m(t,"class","output-container svelte-1r55f5w"),this.first=t},m(E,y){L(E,t,y),_(t,n),_(t,s),_(t,a),_(a,l),_(t,c),_(t,u),b||(k=[Ue(e[15].call(null,n)),W(n,"change",e[14]),W(n,"mousedown",pe(e[26])),W(a,"click",e[21]),W(u,"click",e[18]),W(u,"mousedown",pe(e[25]))],b=!0)},p(E,y){e=E,y[0]&6&&r!==(r=e[40].btn)&&n.value!==r&&(n.value=r),y[0]&6&&o!==(o=e[39])&&m(n,"i",o),y[0]&6&&d!==(d=e[39])&&m(a,"i",d),y[0]&2&&m(u,"key",e[1]),y[0]&6&&f!==(f=e[40].btn)&&m(u,"content",f),y[0]&6&&h!==(h=e[39])&&m(u,"i",h)},d(E){E&&g(t),b=!1,Te(k)}}}function at(i,e){let t,n,r,o,s,a,l,d,c,u,f,h,b,k,E;return{key:i,first:null,c(){t=S("div"),n=S("input"),s=B(),a=S("button"),l=q("x"),c=B(),u=S("div"),b=B(),this.h()},l(y){t=I(y,"DIV",{class:!0});var p=T(t);n=I(p,"INPUT",{type:!0,class:!0,i:!0}),s=R(p),a=I(p,"BUTTON",{class:!0,i:!0});var v=T(a);l=H(v,"x"),v.forEach(g),c=R(p),u=I(p,"DIV",{type:!0,key:!0,content:!0,class:!0,i:!0}),T(u).forEach(g),b=R(p),p.forEach(g),this.h()},h(){m(n,"type","text"),m(n,"class","output-text svelte-1r55f5w"),n.value=r=e[37].name,m(n,"i",o=e[39]),m(a,"class","x-button"),m(a,"i",d=e[39]),m(u,"type","areas"),m(u,"key",e[1]),m(u,"content",f=e[37].name),m(u,"class","connection output area-connection svelte-1r55f5w"),m(u,"i",h=e[39]),m(t,"class","output-container svelte-1r55f5w"),this.first=t},m(y,p){L(y,t,p),_(t,n),_(t,s),_(t,a),_(a,l),_(t,c),_(t,u),_(t,b),k||(E=[Ue(e[17].call(null,n)),W(n,"change",e[16]),W(n,"mousedown",pe(e[24])),W(a,"click",e[22]),W(u,"click",e[18]),W(u,"mousedown",pe(e[23]))],k=!0)},p(y,p){e=y,p[0]&6&&r!==(r=e[37].name)&&n.value!==r&&(n.value=r),p[0]&6&&o!==(o=e[39])&&m(n,"i",o),p[0]&6&&d!==(d=e[39])&&m(a,"i",d),p[0]&2&&m(u,"key",e[1]),p[0]&6&&f!==(f=e[37].name)&&m(u,"content",f),p[0]&6&&h!==(h=e[39])&&m(u,"i",h)},d(y){y&&g(t),k=!1,Te(E)}}}function ut(i){let e,t=[],n=new Map,r,o=[],s=new Map,a=i[2][i[1]][i[12]]||[];const l=u=>"op"+u[39];for(let u=0;u<a.length;u+=1){let f=ot(i,a,u),h=l(f);n.set(h,t[u]=lt(h,f))}let d=i[2][i[1]].areas||[];const c=u=>"a"+u[39];for(let u=0;u<d.length;u+=1){let f=st(i,d,u),h=c(f);s.set(h,o[u]=at(h,f))}return{c(){e=S("div");for(let u=0;u<t.length;u+=1)t[u].c();r=B();for(let u=0;u<o.length;u+=1)o[u].c();this.h()},l(u){e=I(u,"DIV",{class:!0});var f=T(e);for(let h=0;h<t.length;h+=1)t[h].l(f);r=R(f);for(let h=0;h<o.length;h+=1)o[h].l(f);f.forEach(g),this.h()},h(){m(e,"class","node-outputs svelte-1r55f5w")},m(u,f){L(u,e,f);for(let h=0;h<t.length;h+=1)t[h].m(e,null);_(e,r);for(let h=0;h<o.length;h+=1)o[h].m(e,null)},p(u,f){f[0]&2379782&&(a=u[2][u[1]][u[12]]||[],t=Ae(t,f,l,1,u,a,n,e,Ke,lt,r,ot)),f[0]&4521990&&(d=u[2][u[1]].areas||[],o=Ae(o,f,c,1,u,d,s,e,Ke,at,null,st))},d(u){u&&g(e);for(let f=0;f<t.length;f+=1)t[f].d();for(let f=0;f<o.length;f+=1)o[f].d()}}}function vn(i){let e,t,n,r,o,s,a,l,d,c=(i[6][i[11]].length<210?i[6][i[11]]:i[6][i[11]].slice(0,210)+"...")+"",u,f,h,b,k,E,y,p,v,w,C,O,V,D,N,j,X,x,F,$,G,se,ie,Q=i[7],oe,J,ve,ne=i[6][i[13]]!==void 0&&i[6][i[13]]!==null&&it(i),A=i[6][i[13]]!==void 0&&i[6][i[13]]!==null&&rt(i),M=ut(i);return{c(){e=S("div"),t=B(),n=S("h1"),r=q("Escena: "),o=q(i[1]),s=B(),ne&&ne.c(),a=B(),l=S("div"),d=S("p"),u=q(c),f=B(),h=S("div"),b=S("div"),k=S("span"),E=q("escena"),y=B(),p=S("div"),v=S("button"),w=q("editar"),C=B(),O=S("button"),V=q("x"),D=B(),N=S("div"),j=S("span"),X=q("btn"),x=B(),F=S("div"),$=S("button"),G=q("+"),se=B(),A&&A.c(),ie=B(),M.c(),oe=Ce(),this.h()},l(z){e=I(z,"DIV",{class:!0}),T(e).forEach(g),t=R(z),n=I(z,"H1",{class:!0});var U=T(n);r=H(U,"Escena: "),o=H(U,i[1]),U.forEach(g),s=R(z),ne&&ne.l(z),a=R(z),l=I(z,"DIV",{class:!0});var P=T(l);d=I(P,"P",{class:!0});var Z=T(d);u=H(Z,c),Z.forEach(g),P.forEach(g),f=R(z),h=I(z,"DIV",{class:!0});var de=T(h);b=I(de,"DIV",{});var fe=T(b);k=I(fe,"SPAN",{class:!0});var Ne=T(k);E=H(Ne,"escena"),Ne.forEach(g),y=R(fe),p=I(fe,"DIV",{class:!0});var Se=T(p);v=I(Se,"BUTTON",{class:!0});var Ie=T(v);w=H(Ie,"editar"),Ie.forEach(g),C=R(Se),O=I(Se,"BUTTON",{class:!0});var Be=T(O);V=H(Be,"x"),Be.forEach(g),Se.forEach(g),fe.forEach(g),D=R(de),N=I(de,"DIV",{});var Me=T(N);j=I(Me,"SPAN",{class:!0});var Re=T(j);X=H(Re,"btn"),Re.forEach(g),x=R(Me),F=I(Me,"DIV",{class:!0});var je=T(F);$=I(je,"BUTTON",{class:!0});var Ve=T($);G=H(Ve,"+"),Ve.forEach(g),je.forEach(g),Me.forEach(g),se=R(de),A&&A.l(de),de.forEach(g),ie=R(z),M.l(z),oe=Ce(),this.h()},h(){m(e,"class","connection input svelte-1r55f5w"),m(n,"class","svelte-1r55f5w"),m(d,"class","text-p svelte-1r55f5w"),m(l,"class","p-container svelte-1r55f5w"),m(k,"class","btns-name svelte-1r55f5w"),m(v,"class","svelte-1r55f5w"),m(O,"class","svelte-1r55f5w"),m(p,"class","node-btns-div svelte-1r55f5w"),m(j,"class","btns-name svelte-1r55f5w"),m($,"class","svelte-1r55f5w"),m(F,"class","node-btns-div svelte-1r55f5w"),m(h,"class","node-btns svelte-1r55f5w")},m(z,U){L(z,e,U),L(z,t,U),L(z,n,U),_(n,r),_(n,o),L(z,s,U),ne&&ne.m(z,U),L(z,a,U),L(z,l,U),_(l,d),_(d,u),L(z,f,U),L(z,h,U),_(h,b),_(b,k),_(k,E),_(b,y),_(b,p),_(p,v),_(v,w),_(p,C),_(p,O),_(O,V),_(h,D),_(h,N),_(N,j),_(j,X),_(N,x),_(N,F),_(F,$),_($,G),_(h,se),A&&A.m(h,null),L(z,ie,U),M.m(z,U),L(z,oe,U),J||(ve=[W(e,"mousedown",pe(i[27])),W(e,"click",i[19]),W(v,"click",i[8]),W(O,"click",i[20]),W($,"click",i[9])],J=!0)},p(z,U){U[0]&2&&Fe(o,z[1]),z[6][z[13]]!==void 0&&z[6][z[13]]!==null?ne?ne.p(z,U):(ne=it(z),ne.c(),ne.m(a.parentNode,a)):ne&&(ne.d(1),ne=null),U[0]&64&&c!==(c=(z[6][z[11]].length<210?z[6][z[11]]:z[6][z[11]].slice(0,210)+"...")+"")&&Fe(u,c),z[6][z[13]]!==void 0&&z[6][z[13]]!==null?A?A.p(z,U):(A=rt(z),A.c(),A.m(h,null)):A&&(A.d(1),A=null),U[0]&128&&_e(Q,Q=z[7])?(M.d(1),M=ut(z),M.c(),M.m(oe.parentNode,oe)):M.p(z,U)},d(z){z&&g(e),z&&g(t),z&&g(n),z&&g(s),ne&&ne.d(z),z&&g(a),z&&g(l),z&&g(f),z&&g(h),A&&A.d(),z&&g(ie),z&&g(oe),M.d(z),J=!1,Te(ve)}}}function ct(i){let e,t,n;function r(s){i[29](s)}let o={key:i[1],pos:i[6].display};return i[3]!==void 0&&(o.showEditor=i[3]),e=new gn({props:o}),re.push(()=>me(e,"showEditor",r)),{c(){le(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){ue(e,s,a),n=!0},p(s,a){const l={};a[0]&2&&(l.key=s[1]),a[0]&64&&(l.pos=s[6].display),!t&&a[0]&8&&(t=!0,l.showEditor=s[3],ge(()=>t=!1)),e.$set(l)},i(s){n||(K(e.$$.fragment,s),n=!0)},o(s){Y(e.$$.fragment,s),n=!1},d(s){ce(e,s)}}}function ft(i){let e,t,n;function r(s){i[30](s)}let o={key:i[1],pos:i[6].display};return i[4]!==void 0&&(o.showNewOption=i[4]),e=new on({props:o}),re.push(()=>me(e,"showNewOption",r)),{c(){le(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){ue(e,s,a),n=!0},p(s,a){const l={};a[0]&2&&(l.key=s[1]),a[0]&64&&(l.pos=s[6].display),!t&&a[0]&16&&(t=!0,l.showNewOption=s[4],ge(()=>t=!1)),e.$set(l)},i(s){n||(K(e.$$.fragment,s),n=!0)},o(s){Y(e.$$.fragment,s),n=!1},d(s){ce(e,s)}}}function dt(i){let e,t,n;function r(s){i[31](s)}let o={key:i[1],pos:i[6].display};return i[5]!==void 0&&(o.showNewArea=i[5]),e=new un({props:o}),re.push(()=>me(e,"showNewArea",r)),{c(){le(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){ue(e,s,a),n=!0},p(s,a){const l={};a[0]&2&&(l.key=s[1]),a[0]&64&&(l.pos=s[6].display),!t&&a[0]&32&&(t=!0,l.showNewArea=s[5],ge(()=>t=!1)),e.$set(l)},i(s){n||(K(e.$$.fragment,s),n=!0)},o(s){Y(e.$$.fragment,s),n=!1},d(s){ce(e,s)}}}function _n(i){let e,t,n,r,o,s,a;function l(h){i[28](h)}let d={scene:i[6],$$slots:{default:[vn]},$$scope:{ctx:i}};i[0]!==void 0&&(d.movingNode=i[0]),e=new Qt({props:d}),re.push(()=>me(e,"movingNode",l));let c=i[3]&&ct(i),u=i[4]&&ft(i),f=i[5]&&dt(i);return{c(){le(e.$$.fragment),n=B(),c&&c.c(),r=B(),u&&u.c(),o=B(),f&&f.c(),s=Ce()},l(h){ae(e.$$.fragment,h),n=R(h),c&&c.l(h),r=R(h),u&&u.l(h),o=R(h),f&&f.l(h),s=Ce()},m(h,b){ue(e,h,b),L(h,n,b),c&&c.m(h,b),L(h,r,b),u&&u.m(h,b),L(h,o,b),f&&f.m(h,b),L(h,s,b),a=!0},p(h,b){const k={};b[0]&64&&(k.scene=h[6]),b[0]&198|b[1]&2048&&(k.$$scope={dirty:b,ctx:h}),!t&&b[0]&1&&(t=!0,k.movingNode=h[0],ge(()=>t=!1)),e.$set(k),h[3]?c?(c.p(h,b),b[0]&8&&K(c,1)):(c=ct(h),c.c(),K(c,1),c.m(r.parentNode,r)):c&&(ze(),Y(c,1,1,()=>{c=null}),Oe()),h[4]?u?(u.p(h,b),b[0]&16&&K(u,1)):(u=ft(h),u.c(),K(u,1),u.m(o.parentNode,o)):u&&(ze(),Y(u,1,1,()=>{u=null}),Oe()),h[5]?f?(f.p(h,b),b[0]&32&&K(f,1)):(f=dt(h),f.c(),K(f,1),f.m(s.parentNode,s)):f&&(ze(),Y(f,1,1,()=>{f=null}),Oe())},i(h){a||(K(e.$$.fragment,h),K(c),K(u),K(f),a=!0)},o(h){Y(e.$$.fragment,h),Y(c),Y(u),Y(f),a=!1},d(h){ce(e,h),h&&g(n),c&&c.d(h),h&&g(r),u&&u.d(h),h&&g(o),f&&f.d(h),h&&g(s)}}}function bn(i,e,t){let n,r,o,s,a,l,d;ee(i,te,M=>t(2,n=M)),ee(i,Dt,M=>t(32,r=M)),ee(i,Qe,M=>t(33,o=M)),ee(i,Ge,M=>t(34,s=M)),ee(i,zt,M=>t(35,a=M)),ee(i,Lt,M=>t(36,l=M)),ee(i,Xe,M=>t(7,d=M));let{movingNode:c=!1}=e,{key:u}=e,f=!1,h=!1,b=!1;function k(){t(3,f=!0)}function E(){t(4,h=!0)}function y(){t(5,b=!0)}let p=n[u];const v=l(p),w=o(p),C=a(p);p.display===void 0&&(p.display={x:0,y:0});function O(){V(this)}function V(M){const z=+M.getAttribute("i");M.style.width=M.value.length*6.1+"px",t(6,p[w][z].btn=M.value,p),te.set(n)}function D(){N(this)}function N(M){const z=+M.getAttribute("i");M.style.width=M.value.length*6.1+"px",t(6,p.areas[z].name=M.value,p),te.set(n)}function j(M){const z=M.target,U=+z.getAttribute("i"),P=z.getAttribute("type");if(s!==void 0&&s.key===u&&s.i===U&&s.type===P){Ee(Ge,s=void 0,s);const Z=P==="ops"?w:"areas",de=r(p[Z][U]);t(6,p[Z][U][de]=void 0,p);return}Ee(Ge,s={key:u,i:U,type:P},s)}function X(){if(s===void 0)return;const M=n[s.key],z=s.type==="ops"?o(M):"areas",U=r(M[z][s.i]);M[z][s.i][U]=u,Ee(Ge,s=void 0,s)}function x(){for(let M of Object.keys(n)){const z=o(n[M]);if(n[M][z]!==void 0){for(let U of n[M][z]){const P=r(U);U[P]===u&&(U[P]=void 0)}if(n[M].areas!==void 0)for(let U of n[M].areas){const P=r(U);U[P]===u&&(U[P]=void 0)}}}delete n[u],te.set(n)}function F(M){const U=+M.target.getAttribute("i");n[u][w].splice(U,1),te.set(n)}function $(M){const U=+M.target.getAttribute("i");n[u].areas.splice(U,1),te.set(n)}function G(M){he.call(this,i,M)}function se(M){he.call(this,i,M)}function ie(M){he.call(this,i,M)}function Q(M){he.call(this,i,M)}function oe(M){he.call(this,i,M)}function J(M){c=M,t(0,c)}function ve(M){f=M,t(3,f)}function ne(M){h=M,t(4,h)}function A(M){b=M,t(5,b)}return i.$$set=M=>{"movingNode"in M&&t(0,c=M.movingNode),"key"in M&&t(1,u=M.key)},i.$$.update=()=>{i.$$.dirty[0]&6&&t(6,p=n[u])},[c,u,n,f,h,b,p,d,k,E,y,v,w,C,O,V,D,N,j,X,x,F,$,G,se,ie,Q,oe,J,ve,ne,A]}class yn extends ye{constructor(e){super(),we(this,e,bn,_n,_e,{movingNode:0,key:1},null,[-1,-1])}}function ht(i,e,t){const n=i.slice();return n[13]=e[t],n[15]=t,n}function pt(i,e,t){const n=i.slice();return n[13]=e[t],n[15]=t,n}function mt(i){let e,t=[],n=new Map,r,o=[],s=new Map,a=i[0][i[2]]||[];const l=u=>"op"+u[15];for(let u=0;u<a.length;u+=1){let f=pt(i,a,u),h=l(f);n.set(h,t[u]=gt(h,f))}let d=i[0].areas||[];const c=u=>"a"+u[15];for(let u=0;u<d.length;u+=1){let f=ht(i,d,u),h=c(f);s.set(h,o[u]=vt(h,f))}return{c(){e=Le("g");for(let u=0;u<t.length;u+=1)t[u].c();r=Ce();for(let u=0;u<o.length;u+=1)o[u].c()},l(u){e=Pe(u,"g",{});var f=T(e);for(let h=0;h<t.length;h+=1)t[h].l(f);r=Ce();for(let h=0;h<o.length;h+=1)o[h].l(f);f.forEach(g)},m(u,f){L(u,e,f);for(let h=0;h<t.length;h+=1)t[h].m(e,null);_(e,r);for(let h=0;h<o.length;h+=1)o[h].m(e,null)},p(u,f){f&29&&(a=u[0][u[2]]||[],t=Ae(t,f,l,1,u,a,n,e,Ke,gt,r,pt)),f&25&&(d=u[0].areas||[],o=Ae(o,f,c,1,u,d,s,e,Ke,vt,null,ht))},d(u){u&&g(e);for(let f=0;f<t.length;f+=1)t[f].d();for(let f=0;f<o.length;f+=1)o[f].d()}}}function gt(i,e){let t,n,r,o,s;return{key:i,first:null,c(){t=Le("line"),this.h()},l(a){t=Pe(a,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0});var l=T(t);l.forEach(g),this.h()},h(){m(t,"class","op-connection svelte-1lsc27u"),m(t,"x1",n=e[3]("x","ops",e[15])),m(t,"y1",r=e[3]("y","ops",e[15])),m(t,"x2",o=e[4]("x","ops",e[15])),m(t,"y2",s=e[4]("y","ops",e[15])),this.first=t},m(a,l){L(a,t,l)},p(a,l){e=a,l&1&&n!==(n=e[3]("x","ops",e[15]))&&m(t,"x1",n),l&1&&r!==(r=e[3]("y","ops",e[15]))&&m(t,"y1",r),l&1&&o!==(o=e[4]("x","ops",e[15]))&&m(t,"x2",o),l&1&&s!==(s=e[4]("y","ops",e[15]))&&m(t,"y2",s)},d(a){a&&g(t)}}}function vt(i,e){let t,n,r,o,s;return{key:i,first:null,c(){t=Le("line"),this.h()},l(a){t=Pe(a,"line",{class:!0,x1:!0,y1:!0,x2:!0,y2:!0});var l=T(t);l.forEach(g),this.h()},h(){m(t,"class","a-connection svelte-1lsc27u"),m(t,"x1",n=e[3]("x","areas",e[15])),m(t,"y1",r=e[3]("y","areas",e[15])),m(t,"x2",o=e[4]("x","areas",e[15])),m(t,"y2",s=e[4]("y","areas",e[15])),this.first=t},m(a,l){L(a,t,l)},p(a,l){e=a,l&1&&n!==(n=e[3]("x","areas",e[15]))&&m(t,"x1",n),l&1&&r!==(r=e[3]("y","areas",e[15]))&&m(t,"y1",r),l&1&&o!==(o=e[4]("x","areas",e[15]))&&m(t,"x2",o),l&1&&s!==(s=e[4]("y","areas",e[15]))&&m(t,"y2",s)},d(a){a&&g(t)}}}function wn(i){let e,t=i[1]&&mt(i);return{c(){t&&t.c(),e=Ce()},l(n){t&&t.l(n),e=Ce()},m(n,r){t&&t.m(n,r),L(n,e,r)},p(n,[r]){n[1]?t?t.p(n,r):(t=mt(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ke,o:ke,d(n){t&&t.d(n),n&&g(e)}}}function kn(i,e,t){let n,r,o,s,a;ee(i,te,E=>t(8,n=E)),ee(i,Ge,E=>t(9,r=E)),ee(i,Dt,E=>t(10,o=E)),ee(i,Xe,E=>t(11,s=E)),ee(i,Qe,E=>t(12,a=E));let{key:l}=e,{pageMouse:d}=e,{movingNode:c}=e,u=n[l],f=a(u),h=!1;Ut(()=>{t(1,h=!0)});function b(E,y,p){u.areas!==void 0&&document.querySelectorAll(`.connection[key=${l}]`).length!==u[f].length+u.areas.length&&E==="x"&&y==="areas"&&Ee(Xe,s=!s,s);const v=document.querySelector(`[type=${y}][i="${p}"][key=${l}]`);if(!v)return n[l].display[E];const w=E==="x"?v.offsetLeft:v.offsetTop,C=E==="x"?v.offsetWidth/2:v.offsetHeight;return n[l].display[E]+w+C}function k(E,y,p){const v=y==="ops"?f:"areas",w=u[v][p],C=o(w),O=u[v][p][C];return r!==void 0&&r.key===l&&r.i===p&&r.type===y?d[E]:O===void 0?b(E,y,p):n[O].display[E]+5}return i.$$set=E=>{"key"in E&&t(5,l=E.key),"pageMouse"in E&&t(6,d=E.pageMouse),"movingNode"in E&&t(7,c=E.movingNode)},i.$$.update=()=>{i.$$.dirty&449&&(d||n||c)&&(t(0,u),t(6,d),t(8,n),t(7,c))},[u,h,f,b,k,l,d,c,n]}class En extends ye{constructor(e){super(),we(this,e,kn,wn,_e,{key:5,pageMouse:6,movingNode:7})}}function Nn(i){let e,t,n,r,o,s,a,l,d,c,u,f,h,b,k;function E(p){i[7](p)}let y={};return i[0]!==void 0&&(y.toggle=i[0]),e=new He({props:y}),re.push(()=>me(e,"toggle",E)),{c(){le(e.$$.fragment),n=B(),r=S("div"),o=S("label"),s=q("Escena:"),a=B(),l=S("input"),d=B(),c=S("div"),u=S("button"),f=q("Aceptar"),this.h()},l(p){ae(e.$$.fragment,p),n=R(p),r=I(p,"DIV",{});var v=T(r);o=I(v,"LABEL",{for:!0});var w=T(o);s=H(w,"Escena:"),w.forEach(g),a=R(v),l=I(v,"INPUT",{id:!0,type:!0}),v.forEach(g),d=R(p),c=I(p,"DIV",{class:!0});var C=T(c);u=I(C,"BUTTON",{class:!0});var O=T(u);f=H(O,"Aceptar"),O.forEach(g),C.forEach(g),this.h()},h(){m(o,"for","inp"),m(l,"id","inp"),m(l,"type","text"),m(u,"class","gui-button"),m(c,"class","bar svelte-1bhrmvp")},m(p,v){ue(e,p,v),L(p,n,v),L(p,r,v),_(r,o),_(o,s),_(r,a),_(r,l),be(l,i[2]),L(p,d,v),L(p,c,v),_(c,u),_(u,f),h=!0,b||(k=[W(l,"input",i[8]),W(l,"mousedown",pe(i[6])),W(u,"click",i[4])],b=!0)},p(p,v){const w={};!t&&v&1&&(t=!0,w.toggle=p[0],ge(()=>t=!1)),e.$set(w),v&4&&l.value!==p[2]&&be(l,p[2])},i(p){h||(K(e.$$.fragment,p),h=!0)},o(p){Y(e.$$.fragment,p),h=!1},d(p){ce(e,p),p&&g(n),p&&g(r),p&&g(d),p&&g(c),b=!1,Te(k)}}}function Sn(i){let e,t,n;function r(s){i[9](s)}let o={pos:i[3],$$slots:{default:[Nn]},$$scope:{ctx:i}};return i[1]!==void 0&&(o.displace=i[1]),e=new qe({props:o}),re.push(()=>me(e,"displace",r)),{c(){le(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){ue(e,s,a),n=!0},p(s,[a]){const l={};a&4101&&(l.$$scope={dirty:a,ctx:s}),!t&&a&2&&(t=!0,l.displace=s[1],ge(()=>t=!1)),e.$set(l)},i(s){n||(K(e.$$.fragment,s),n=!0)},o(s){Y(e.$$.fragment,s),n=!1},d(s){ce(e,s)}}}function In(i){const e=["á","é","í","ó","ú","ü","ñ"],t=["a","e","i","o","u","u","n"],n=i.toLowerCase();let r="";for(let o=0;o<i.length;o++){const s=n.charAt(o),a=i.charAt(o);if(e.includes(s)){let l;for(let d=0;d<e.length;d++)if(e[d]===s){l=d;break}a===a.toUpperCase()?r+=t[l].toUpperCase():r+=t[l]}else r+=a}return r}function Cn(i,e,t){let n,r;ee(i,te,k=>t(11,r=k));let{showNewScene:o}=e,{offset:s}=e,a=r,l={x:s.x*-1+20,y:s.y*-1+20},d;function c(){if(n.length<=0){alert(`Debes dar un nombre a la escena /
You must give a name to the scene`);return}if(/^\d/.test(n)===!0){alert(`El nombre de la escena no puede empezar con un número /
The name of the scene cannot start with a number`);return}let k=n.replace(/\s/gi,"_").replace(/\W/,"").replace(/[;.,:{}()<>$%&!¡?¿"'/\\#@&*+-]/gi,"");if(k=In(k),r[k]!==void 0){alert(`Ya existe una escena con ese nombre /
There is already a scene with that name`);return}a[k]={text:"",display:{x:l.x,y:l.y}},Ee(te,r[k]=a[k],r),t(0,o=!1)}function u(k){he.call(this,i,k)}function f(k){o=k,t(0,o)}function h(){n=this.value,t(2,n)}function b(k){d=k,t(1,d)}return i.$$set=k=>{"showNewScene"in k&&t(0,o=k.showNewScene),"offset"in k&&t(5,s=k.offset)},t(2,n=""),[o,d,n,l,c,s,u,f,h,b]}class Tn extends ye{constructor(e){super(),we(this,e,Cn,Sn,_e,{showNewScene:0,offset:5})}}function _t(i,e,t){const n=i.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function bt(i,e,t){const n=i.slice();return n[17]=e[t],n}function yt(i,e,t){const n=i.slice();return n[17]=e[t],n}function wt(i,e){let t,n,r,o,s,a;function l(c){e[12](c)}let d={key:e[17]};return e[3]!==void 0&&(d.movingNode=e[3]),n=new yn({props:d}),re.push(()=>me(n,"movingNode",l)),{key:i,first:null,c(){t=S("div"),le(n.$$.fragment),this.h()},l(c){t=I(c,"DIV",{class:!0});var u=T(t);ae(n.$$.fragment,u),u.forEach(g),this.h()},h(){m(t,"class","scene-node-container"),this.first=t},m(c,u){L(c,t,u),ue(n,t,null),o=!0,s||(a=W(t,"mouseenter",Dn),s=!0)},p(c,u){e=c;const f={};u&32&&(f.key=e[17]),!r&&u&8&&(r=!0,f.movingNode=e[3],ge(()=>r=!1)),n.$set(f)},i(c){o||(K(n.$$.fragment,c),o=!0)},o(c){Y(n.$$.fragment,c),o=!1},d(c){c&&g(t),ce(n),s=!1,a()}}}function kt(i,e){let t,n,r;return n=new En({props:{key:e[17],pageMouse:e[1],movingNode:e[3]}}),{key:i,first:null,c(){t=Ce(),le(n.$$.fragment),this.h()},l(o){t=Ce(),ae(n.$$.fragment,o),this.h()},h(){this.first=t},m(o,s){L(o,t,s),ue(n,o,s),r=!0},p(o,s){e=o;const a={};s&32&&(a.key=e[17]),s&2&&(a.pageMouse=e[1]),s&8&&(a.movingNode=e[3]),n.$set(a)},i(o){r||(K(n.$$.fragment,o),r=!0)},o(o){Y(n.$$.fragment,o),r=!1},d(o){o&&g(t),ce(n,o)}}}function Et(i){let e,t,n;function r(s){i[13](s)}let o={offset:i[4]};return i[0]!==void 0&&(o.showNewScene=i[0]),e=new Tn({props:o}),re.push(()=>me(e,"showNewScene",r)),{c(){le(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){ue(e,s,a),n=!0},p(s,a){const l={};a&16&&(l.offset=s[4]),!t&&a&1&&(t=!0,l.showNewScene=s[0],ge(()=>t=!1)),e.$set(l)},i(s){n||(K(e.$$.fragment,s),n=!0)},o(s){Y(e.$$.fragment,s),n=!1},d(s){ce(e,s)}}}function Nt(i,e){let t,n,r;return{key:i,first:null,c(){t=Le("rect"),this.h()},l(o){t=Pe(o,"rect",{class:!0,x:!0,y:!0,width:!0,height:!0,fill:!0}),T(t).forEach(g),this.h()},h(){m(t,"class","minimap-rect svelte-13wv1gj"),m(t,"x",n=e[18].display.x/20),m(t,"y",r=e[18].display.y/20),m(t,"width","8"),m(t,"height","8"),m(t,"fill","green"),this.first=t},m(o,s){L(o,t,s)},p(o,s){e=o,s&4&&n!==(n=e[18].display.x/20)&&m(t,"x",n),s&4&&r!==(r=e[18].display.y/20)&&m(t,"y",r)},d(o){o&&g(t)}}}function Mn(i){let e,t=[],n=new Map,r,o,s=[],a=new Map,l,d,c,u,f=[],h=new Map,b,k,E,y=i[5];const p=D=>D[17];for(let D=0;D<y.length;D+=1){let N=yt(i,y,D),j=p(N);n.set(j,t[D]=wt(j,N))}let v=i[5];const w=D=>D[17];for(let D=0;D<v.length;D+=1){let N=bt(i,v,D),j=w(N);a.set(j,s[D]=kt(j,N))}let C=i[0]&&Et(i),O=i[2];const V=D=>D[17];for(let D=0;D<O.length;D+=1){let N=_t(i,O,D),j=V(N);h.set(j,f[D]=Nt(j,N))}return{c(){e=S("div");for(let D=0;D<t.length;D+=1)t[D].c();r=B(),o=Le("svg");for(let D=0;D<s.length;D+=1)s[D].c();l=B(),C&&C.c(),d=B(),c=S("div"),u=Le("svg");for(let D=0;D<f.length;D+=1)f[D].c();this.h()},l(D){e=I(D,"DIV",{class:!0});var N=T(e);for(let F=0;F<t.length;F+=1)t[F].l(N);r=R(N),o=Pe(N,"svg",{class:!0});var j=T(o);for(let F=0;F<s.length;F+=1)s[F].l(j);j.forEach(g),l=R(N),C&&C.l(N),N.forEach(g),d=R(D),c=I(D,"DIV",{class:!0});var X=T(c);u=Pe(X,"svg",{width:!0,height:!0});var x=T(u);for(let F=0;F<f.length;F+=1)f[F].l(x);x.forEach(g),X.forEach(g),this.h()},h(){m(o,"class","connections-container svelte-13wv1gj"),m(e,"class","node-page svelte-13wv1gj"),m(u,"width","100px"),m(u,"height","250px"),m(c,"class","minimap-container svelte-13wv1gj")},m(D,N){L(D,e,N);for(let j=0;j<t.length;j+=1)t[j].m(e,null);_(e,r),_(e,o);for(let j=0;j<s.length;j+=1)s[j].m(o,null);_(e,l),C&&C.m(e,null),L(D,d,N),L(D,c,N),_(c,u);for(let j=0;j<f.length;j+=1)f[j].m(u,null);b=!0,k||(E=[W(e,"mousedown",i[7]),W(e,"mouseup",i[8]),W(e,"mousemove",i[9]),W(e,"mouseleave",i[8]),W(u,"click",i[6]),W(c,"mousedown",pe(i[11]))],k=!0)},p(D,[N]){N&40&&(y=D[5],ze(),t=Ae(t,N,p,1,D,y,n,e,et,wt,r,yt),Oe()),N&42&&(v=D[5],ze(),s=Ae(s,N,w,1,D,v,a,o,et,kt,null,bt),Oe()),D[0]?C?(C.p(D,N),N&1&&K(C,1)):(C=Et(D),C.c(),K(C,1),C.m(e,null)):C&&(ze(),Y(C,1,1,()=>{C=null}),Oe()),N&4&&(O=D[2],f=Ae(f,N,V,1,D,O,h,u,Ke,Nt,null,_t))},i(D){if(!b){for(let N=0;N<y.length;N+=1)K(t[N]);for(let N=0;N<v.length;N+=1)K(s[N]);K(C),b=!0}},o(D){for(let N=0;N<t.length;N+=1)Y(t[N]);for(let N=0;N<s.length;N+=1)Y(s[N]);Y(C),b=!1},d(D){D&&g(e);for(let N=0;N<t.length;N+=1)t[N].d();for(let N=0;N<s.length;N+=1)s[N].d();C&&C.d(),D&&g(d),D&&g(c);for(let N=0;N<f.length;N+=1)f[N].d();k=!1,Te(E)}}}function Dn(i){[...document.getElementsByClassName("scene-node-container")].forEach(e=>e.style.zIndex="0"),i.target.firstChild.style.zIndex="1"}function zn(i,e,t){let n,r,o;ee(i,te,w=>t(10,o=w));let{showNewScene:s}=e,a,l={},d,c,u=!1;const f={x:0,y:0};function h(w){const C=document.querySelector(".node-page"),O=document.querySelector(".page-container"),V=getComputedStyle(O),D=+V.borderWidth.replace("px","")*2,N=+V.width.replace("px","")-D,j=+V.height.replace("px","")-D;t(4,f.x=-w.offsetX*20+ +V.width.replace("px","")/2,f),t(4,f.y=-w.offsetY*20+ +V.height.replace("px","")/2,f),t(4,f.x=f.x>0?0:N-f.x>d?N-d:f.x,f),t(4,f.y=f.y>0?0:j-f.y>c?j-c:f.y,f),C.style.left=`${f.x}px`,C.style.top=`${f.y}px`}function b(){u=!0,this.style.cursor="grabbing"}function k(){u=!1,this.style.cursor="grab"}function E(w){if(u&&!a){d===void 0&&(d=+getComputedStyle(this).width.replace("px","")),c===void 0&&(c=+getComputedStyle(this).height.replace("px",""));const O=+getComputedStyle(this.offsetParent).borderWidth.replace("px","")*2,V=+getComputedStyle(this.offsetParent).width.replace("px","")-O,D=+getComputedStyle(this.offsetParent).height.replace("px","")-O;t(4,f.x+=w.movementX,f),t(4,f.y+=w.movementY,f),t(4,f.x=f.x>0?0:V-f.x>d?V-d:f.x,f),t(4,f.y=f.y>0?0:D-f.y>c?D-c:f.y,f),this.style.left=`${f.x}px`,this.style.top=`${f.y}px`}t(1,l={x:w.offsetX,y:w.offsetY});let C=w.target;for(;C!==this;)t(1,l.x+=C.offsetLeft,l),t(1,l.y+=C.offsetTop,l),C=C.offsetParent}function y(w){he.call(this,i,w)}function p(w){a=w,t(3,a)}function v(w){s=w,t(0,s)}return i.$$set=w=>{"showNewScene"in w&&t(0,s=w.showNewScene)},i.$$.update=()=>{i.$$.dirty&1024&&t(5,n=Object.keys(o)),i.$$.dirty&1024&&t(2,r=Object.entries(o)),i.$$.dirty&6&&l&&(t(2,r),t(10,o),t(1,l))},[s,l,r,a,f,n,h,b,k,E,o,y,p,v]}let On=class extends ye{constructor(e){super(),we(this,e,zn,Mn,_e,{showNewScene:0})}};function St(i){let e,t;return e=new qe({props:{pos:i[2],$$slots:{default:[An]},$$scope:{ctx:i}}}),{c(){le(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){ue(e,n,r),t=!0},p(n,r){const o={};r&1026&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function An(i){let e,t,n,r,o,s,a;function l(c){i[7](c)}let d={};return i[1]!==void 0&&(d.toggle=i[1]),e=new He({props:d}),re.push(()=>me(e,"toggle",l)),{c(){le(e.$$.fragment),n=B(),r=S("div"),this.h()},l(c){ae(e.$$.fragment,c),n=R(c),r=I(c,"DIV",{class:!0,id:!0}),T(r).forEach(g),this.h()},h(){m(r,"class","test-story-container svelte-1x7qk0r"),m(r,"id","test-story-container")},m(c,u){ue(e,c,u),L(c,n,u),L(c,r,u),o=!0,s||(a=Ue(i[3].call(null,r)),s=!0)},p(c,u){const f={};!t&&u&2&&(t=!0,f.toggle=c[1],ge(()=>t=!1)),e.$set(f)},i(c){o||(K(e.$$.fragment,c),o=!0)},o(c){Y(e.$$.fragment,c),o=!1},d(c){ce(e,c),c&&g(n),c&&g(r),s=!1,a()}}}function Un(i){let e,t,n,r,o,s,a,l,d,c,u;function f(p){i[4](p)}function h(p){i[5](p)}let b={};i[0]!==void 0&&(b.showNewScene=i[0]),i[1]!==void 0&&(b.showTest=i[1]),t=new Jt({props:b}),re.push(()=>me(t,"showNewScene",f)),re.push(()=>me(t,"showTest",h));function k(p){i[6](p)}let E={};i[0]!==void 0&&(E.showNewScene=i[0]),l=new On({props:E}),re.push(()=>me(l,"showNewScene",k));let y=i[1]&&St(i);return{c(){e=S("div"),le(t.$$.fragment),o=B(),s=S("div"),a=S("div"),le(l.$$.fragment),c=B(),y&&y.c(),this.h()},l(p){e=I(p,"DIV",{class:!0});var v=T(e);ae(t.$$.fragment,v),o=R(v),s=I(v,"DIV",{class:!0});var w=T(s);a=I(w,"DIV",{class:!0});var C=T(a);ae(l.$$.fragment,C),C.forEach(g),w.forEach(g),c=R(v),y&&y.l(v),v.forEach(g),this.h()},h(){m(a,"class","page-container svelte-1x7qk0r"),m(s,"class","static-page-container svelte-1x7qk0r"),m(e,"class","main-window-container svelte-1x7qk0r")},m(p,v){L(p,e,v),ue(t,e,null),_(e,o),_(e,s),_(s,a),ue(l,a,null),_(e,c),y&&y.m(e,null),u=!0},p(p,[v]){const w={};!n&&v&1&&(n=!0,w.showNewScene=p[0],ge(()=>n=!1)),!r&&v&2&&(r=!0,w.showTest=p[1],ge(()=>r=!1)),t.$set(w);const C={};!d&&v&1&&(d=!0,C.showNewScene=p[0],ge(()=>d=!1)),l.$set(C),p[1]?y?(y.p(p,v),v&2&&K(y,1)):(y=St(p),y.c(),K(y,1),y.m(e,null)):y&&(ze(),Y(y,1,1,()=>{y=null}),Oe())},i(p){u||(K(t.$$.fragment,p),K(l.$$.fragment,p),K(y),u=!0)},o(p){Y(t.$$.fragment,p),Y(l.$$.fragment,p),Y(y),u=!1},d(p){p&&g(e),ce(t),ce(l),y&&y.d()}}}function Ln(i,e,t){let n,r;ee(i,te,h=>t(8,n=h)),ee(i,At,h=>t(9,r=h));let o=!1,s=!1,a={x:40,y:40};function l(){console.log(n);const h=document.getElementById("storygeneraldiv");h&&h.remove();const b=new r("es",{adventureSlide:!1,typewriterSpeed:20}),k=Object.entries(n).sort((p,v)=>p[1].display.y-v[1].display.y);if(k.length===0){alert("No hay escenas / There are no scenes");return}b.setScenes(n).startAdventure(k[0][0]);const E=document.getElementById("test-story-container"),y=document.getElementById("storygeneraldiv");E.appendChild(y)}function d(h){o=h,t(0,o)}function c(h){s=h,t(1,s)}function u(h){o=h,t(0,o)}function f(h){s=h,t(1,s)}return[o,s,a,l,d,c,u,f]}class Pn extends ye{constructor(e){super(),we(this,e,Ln,Un,_e,{})}}function Bn(i){let e,t,n,r,o,s,a,l,d,c,u,f,h,b;return c=new Pn({}),{c(){e=S("section"),t=S("h1"),n=q("Aventura interactiva"),r=B(),o=S("p"),s=q("Un editor de historias interactivas para la librería "),a=S("a"),l=q("Aventura.js"),d=B(),le(c.$$.fragment),u=B(),f=S("footer"),h=q("Sergio Rodríguez Gómez — 2023 — v1.0.0"),this.h()},l(k){e=I(k,"SECTION",{class:!0});var E=T(e);t=I(E,"H1",{class:!0});var y=T(t);n=H(y,"Aventura interactiva"),y.forEach(g),r=R(E),o=I(E,"P",{class:!0});var p=T(o);s=H(p,"Un editor de historias interactivas para la librería "),a=I(p,"A",{href:!0,target:!0,rel:!0,class:!0});var v=T(a);l=H(v,"Aventura.js"),v.forEach(g),p.forEach(g),d=R(E),ae(c.$$.fragment,E),u=R(E),f=I(E,"FOOTER",{class:!0});var w=T(f);h=H(w,"Sergio Rodríguez Gómez — 2023 — v1.0.0"),w.forEach(g),E.forEach(g),this.h()},h(){m(t,"class","svelte-1ekz32g"),m(a,"href","https://github.com/srsergiorodriguez/aventura/blob/master/README_es.md"),m(a,"target","_blank"),m(a,"rel","noreferrer"),m(a,"class","svelte-1ekz32g"),m(o,"class","svelte-1ekz32g"),m(f,"class","no-select svelte-1ekz32g"),m(e,"class","general no-select")},m(k,E){L(k,e,E),_(e,t),_(t,n),_(e,r),_(e,o),_(o,s),_(o,a),_(a,l),_(e,d),ue(c,e,null),_(e,u),_(e,f),_(f,h),b=!0},p:ke,i(k){b||(K(c.$$.fragment,k),b=!0)},o(k){Y(c.$$.fragment,k),b=!1},d(k){k&&g(e),ce(c)}}}class Gn extends ye{constructor(e){super(),we(this,e,null,Bn,_e,{})}}export{Gn as default};
